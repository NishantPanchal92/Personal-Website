/*
 MIT License - http://www.opensource.org/licenses/mit-license.php

 For usage and examples, visit:
 http://timeago.yarp.com/

 Copyright (c) 2008-2013, Ryan McGeary (ryan -[at]- mcgeary [*dot*] org)
*/
this.Handlebars={};
(function(Handlebars){Handlebars.VERSION="1.0.0-rc.3";Handlebars.COMPILER_REVISION=2;Handlebars.REVISION_CHANGES={1:"<= 1.0.rc.2",2:">= 1.0.0-rc.3"};Handlebars.helpers={};Handlebars.partials={};Handlebars.registerHelper=function(name,fn,inverse){if(inverse)fn.not=inverse;this.helpers[name]=fn};Handlebars.registerPartial=function(name,str){this.partials[name]=str};Handlebars.registerHelper("helperMissing",function(arg){if(arguments.length===2)return undefined;else throw new Error("Could not find property '"+arg+
"'");});var toString=Object.prototype.toString,functionType="[object Function]";Handlebars.registerHelper("blockHelperMissing",function(context,options){var inverse=options.inverse||function(){},fn=options.fn;var ret="";var type=toString.call(context);if(type===functionType)context=context.call(this);if(context===true)return fn(this);else if(context===false||context==null)return inverse(this);else if(type==="[object Array]")if(context.length>0)return Handlebars.helpers.each(context,options);else return inverse(this);
else return fn(context)});Handlebars.K=function(){};Handlebars.createFrame=Object.create||function(object){Handlebars.K.prototype=object;var obj=new Handlebars.K;Handlebars.K.prototype=null;return obj};Handlebars.logger={DEBUG:0,INFO:1,WARN:2,ERROR:3,level:3,methodMap:{"0":"debug",1:"info",2:"warn",3:"error"},log:function(level,obj){if(Handlebars.logger.level<=level){var method=Handlebars.logger.methodMap[level];if(typeof console!=="undefined"&&console[method])console[method].call(console,obj)}}};
Handlebars.log=function(level,obj){Handlebars.logger.log(level,obj)};Handlebars.registerHelper("each",function(context,options){var fn=options.fn,inverse=options.inverse;var i=0,ret="",data;if(options.data)data=Handlebars.createFrame(options.data);if(context&&typeof context==="object")if(context instanceof Array)for(var j=context.length;i<j;i++){if(data)data.index=i;ret=ret+fn(context[i],{data:data})}else for(var key in context)if(context.hasOwnProperty(key)){if(data)data.key=key;ret=ret+fn(context[key],
{data:data});i++}if(i===0)ret=inverse(this);return ret});Handlebars.registerHelper("if",function(context,options){var type=toString.call(context);if(type===functionType)context=context.call(this);if(!context||Handlebars.Utils.isEmpty(context))return options.inverse(this);else return options.fn(this)});Handlebars.registerHelper("unless",function(context,options){var fn=options.fn,inverse=options.inverse;options.fn=inverse;options.inverse=fn;return Handlebars.helpers["if"].call(this,context,options)});
Handlebars.registerHelper("with",function(context,options){return options.fn(context)});Handlebars.registerHelper("log",function(context,options){var level=options.data&&options.data.level!=null?parseInt(options.data.level,10):1;Handlebars.log(level,context)})})(this.Handlebars);
var handlebars=function(){var parser={trace:function trace(){},yy:{},symbols_:{"error":2,"root":3,"program":4,"EOF":5,"simpleInverse":6,"statements":7,"statement":8,"openInverse":9,"closeBlock":10,"openBlock":11,"mustache":12,"partial":13,"CONTENT":14,"COMMENT":15,"OPEN_BLOCK":16,"inMustache":17,"CLOSE":18,"OPEN_INVERSE":19,"OPEN_ENDBLOCK":20,"path":21,"OPEN":22,"OPEN_UNESCAPED":23,"OPEN_PARTIAL":24,"partialName":25,"params":26,"hash":27,"DATA":28,"param":29,"STRING":30,"INTEGER":31,"BOOLEAN":32,
"hashSegments":33,"hashSegment":34,"ID":35,"EQUALS":36,"PARTIAL_NAME":37,"pathSegments":38,"SEP":39,"$accept":0,"$end":1},terminals_:{2:"error",5:"EOF",14:"CONTENT",15:"COMMENT",16:"OPEN_BLOCK",18:"CLOSE",19:"OPEN_INVERSE",20:"OPEN_ENDBLOCK",22:"OPEN",23:"OPEN_UNESCAPED",24:"OPEN_PARTIAL",28:"DATA",30:"STRING",31:"INTEGER",32:"BOOLEAN",35:"ID",36:"EQUALS",37:"PARTIAL_NAME",39:"SEP"},productions_:[0,[3,2],[4,2],[4,3],[4,2],[4,1],[4,1],[4,0],[7,1],[7,2],[8,3],[8,3],[8,1],[8,1],[8,1],[8,1],[11,3],[9,
3],[10,3],[12,3],[12,3],[13,3],[13,4],[6,2],[17,3],[17,2],[17,2],[17,1],[17,1],[26,2],[26,1],[29,1],[29,1],[29,1],[29,1],[29,1],[27,1],[33,2],[33,1],[34,3],[34,3],[34,3],[34,3],[34,3],[25,1],[21,1],[38,3],[38,1]],performAction:function anonymous(yytext,yyleng,yylineno,yy,yystate,$$,_$){var $0=$$.length-1;switch(yystate){case 1:return $$[$0-1];break;case 2:this.$=new yy.ProgramNode([],$$[$0]);break;case 3:this.$=new yy.ProgramNode($$[$0-2],$$[$0]);break;case 4:this.$=new yy.ProgramNode($$[$0-1],[]);
break;case 5:this.$=new yy.ProgramNode($$[$0]);break;case 6:this.$=new yy.ProgramNode([],[]);break;case 7:this.$=new yy.ProgramNode([]);break;case 8:this.$=[$$[$0]];break;case 9:$$[$0-1].push($$[$0]);this.$=$$[$0-1];break;case 10:this.$=new yy.BlockNode($$[$0-2],$$[$0-1].inverse,$$[$0-1],$$[$0]);break;case 11:this.$=new yy.BlockNode($$[$0-2],$$[$0-1],$$[$0-1].inverse,$$[$0]);break;case 12:this.$=$$[$0];break;case 13:this.$=$$[$0];break;case 14:this.$=new yy.ContentNode($$[$0]);break;case 15:this.$=
new yy.CommentNode($$[$0]);break;case 16:this.$=new yy.MustacheNode($$[$0-1][0],$$[$0-1][1]);break;case 17:this.$=new yy.MustacheNode($$[$0-1][0],$$[$0-1][1]);break;case 18:this.$=$$[$0-1];break;case 19:this.$=new yy.MustacheNode($$[$0-1][0],$$[$0-1][1]);break;case 20:this.$=new yy.MustacheNode($$[$0-1][0],$$[$0-1][1],true);break;case 21:this.$=new yy.PartialNode($$[$0-1]);break;case 22:this.$=new yy.PartialNode($$[$0-2],$$[$0-1]);break;case 23:break;case 24:this.$=[[$$[$0-2]].concat($$[$0-1]),$$[$0]];
break;case 25:this.$=[[$$[$0-1]].concat($$[$0]),null];break;case 26:this.$=[[$$[$0-1]],$$[$0]];break;case 27:this.$=[[$$[$0]],null];break;case 28:this.$=[[new yy.DataNode($$[$0])],null];break;case 29:$$[$0-1].push($$[$0]);this.$=$$[$0-1];break;case 30:this.$=[$$[$0]];break;case 31:this.$=$$[$0];break;case 32:this.$=new yy.StringNode($$[$0]);break;case 33:this.$=new yy.IntegerNode($$[$0]);break;case 34:this.$=new yy.BooleanNode($$[$0]);break;case 35:this.$=new yy.DataNode($$[$0]);break;case 36:this.$=
new yy.HashNode($$[$0]);break;case 37:$$[$0-1].push($$[$0]);this.$=$$[$0-1];break;case 38:this.$=[$$[$0]];break;case 39:this.$=[$$[$0-2],$$[$0]];break;case 40:this.$=[$$[$0-2],new yy.StringNode($$[$0])];break;case 41:this.$=[$$[$0-2],new yy.IntegerNode($$[$0])];break;case 42:this.$=[$$[$0-2],new yy.BooleanNode($$[$0])];break;case 43:this.$=[$$[$0-2],new yy.DataNode($$[$0])];break;case 44:this.$=new yy.PartialNameNode($$[$0]);break;case 45:this.$=new yy.IdNode($$[$0]);break;case 46:$$[$0-2].push($$[$0]);
this.$=$$[$0-2];break;case 47:this.$=[$$[$0]];break}},table:[{3:1,4:2,5:[2,7],6:3,7:4,8:6,9:7,11:8,12:9,13:10,14:[1,11],15:[1,12],16:[1,13],19:[1,5],22:[1,14],23:[1,15],24:[1,16]},{1:[3]},{5:[1,17]},{5:[2,6],7:18,8:6,9:7,11:8,12:9,13:10,14:[1,11],15:[1,12],16:[1,13],19:[1,19],20:[2,6],22:[1,14],23:[1,15],24:[1,16]},{5:[2,5],6:20,8:21,9:7,11:8,12:9,13:10,14:[1,11],15:[1,12],16:[1,13],19:[1,5],20:[2,5],22:[1,14],23:[1,15],24:[1,16]},{17:23,18:[1,22],21:24,28:[1,25],35:[1,27],38:26},{5:[2,8],14:[2,8],
15:[2,8],16:[2,8],19:[2,8],20:[2,8],22:[2,8],23:[2,8],24:[2,8]},{4:28,6:3,7:4,8:6,9:7,11:8,12:9,13:10,14:[1,11],15:[1,12],16:[1,13],19:[1,5],20:[2,7],22:[1,14],23:[1,15],24:[1,16]},{4:29,6:3,7:4,8:6,9:7,11:8,12:9,13:10,14:[1,11],15:[1,12],16:[1,13],19:[1,5],20:[2,7],22:[1,14],23:[1,15],24:[1,16]},{5:[2,12],14:[2,12],15:[2,12],16:[2,12],19:[2,12],20:[2,12],22:[2,12],23:[2,12],24:[2,12]},{5:[2,13],14:[2,13],15:[2,13],16:[2,13],19:[2,13],20:[2,13],22:[2,13],23:[2,13],24:[2,13]},{5:[2,14],14:[2,14],15:[2,
14],16:[2,14],19:[2,14],20:[2,14],22:[2,14],23:[2,14],24:[2,14]},{5:[2,15],14:[2,15],15:[2,15],16:[2,15],19:[2,15],20:[2,15],22:[2,15],23:[2,15],24:[2,15]},{17:30,21:24,28:[1,25],35:[1,27],38:26},{17:31,21:24,28:[1,25],35:[1,27],38:26},{17:32,21:24,28:[1,25],35:[1,27],38:26},{25:33,37:[1,34]},{1:[2,1]},{5:[2,2],8:21,9:7,11:8,12:9,13:10,14:[1,11],15:[1,12],16:[1,13],19:[1,19],20:[2,2],22:[1,14],23:[1,15],24:[1,16]},{17:23,21:24,28:[1,25],35:[1,27],38:26},{5:[2,4],7:35,8:6,9:7,11:8,12:9,13:10,14:[1,
11],15:[1,12],16:[1,13],19:[1,19],20:[2,4],22:[1,14],23:[1,15],24:[1,16]},{5:[2,9],14:[2,9],15:[2,9],16:[2,9],19:[2,9],20:[2,9],22:[2,9],23:[2,9],24:[2,9]},{5:[2,23],14:[2,23],15:[2,23],16:[2,23],19:[2,23],20:[2,23],22:[2,23],23:[2,23],24:[2,23]},{18:[1,36]},{18:[2,27],21:41,26:37,27:38,28:[1,45],29:39,30:[1,42],31:[1,43],32:[1,44],33:40,34:46,35:[1,47],38:26},{18:[2,28]},{18:[2,45],28:[2,45],30:[2,45],31:[2,45],32:[2,45],35:[2,45],39:[1,48]},{18:[2,47],28:[2,47],30:[2,47],31:[2,47],32:[2,47],35:[2,
47],39:[2,47]},{10:49,20:[1,50]},{10:51,20:[1,50]},{18:[1,52]},{18:[1,53]},{18:[1,54]},{18:[1,55],21:56,35:[1,27],38:26},{18:[2,44],35:[2,44]},{5:[2,3],8:21,9:7,11:8,12:9,13:10,14:[1,11],15:[1,12],16:[1,13],19:[1,19],20:[2,3],22:[1,14],23:[1,15],24:[1,16]},{14:[2,17],15:[2,17],16:[2,17],19:[2,17],20:[2,17],22:[2,17],23:[2,17],24:[2,17]},{18:[2,25],21:41,27:57,28:[1,45],29:58,30:[1,42],31:[1,43],32:[1,44],33:40,34:46,35:[1,47],38:26},{18:[2,26]},{18:[2,30],28:[2,30],30:[2,30],31:[2,30],32:[2,30],35:[2,
30]},{18:[2,36],34:59,35:[1,60]},{18:[2,31],28:[2,31],30:[2,31],31:[2,31],32:[2,31],35:[2,31]},{18:[2,32],28:[2,32],30:[2,32],31:[2,32],32:[2,32],35:[2,32]},{18:[2,33],28:[2,33],30:[2,33],31:[2,33],32:[2,33],35:[2,33]},{18:[2,34],28:[2,34],30:[2,34],31:[2,34],32:[2,34],35:[2,34]},{18:[2,35],28:[2,35],30:[2,35],31:[2,35],32:[2,35],35:[2,35]},{18:[2,38],35:[2,38]},{18:[2,47],28:[2,47],30:[2,47],31:[2,47],32:[2,47],35:[2,47],36:[1,61],39:[2,47]},{35:[1,62]},{5:[2,10],14:[2,10],15:[2,10],16:[2,10],19:[2,
10],20:[2,10],22:[2,10],23:[2,10],24:[2,10]},{21:63,35:[1,27],38:26},{5:[2,11],14:[2,11],15:[2,11],16:[2,11],19:[2,11],20:[2,11],22:[2,11],23:[2,11],24:[2,11]},{14:[2,16],15:[2,16],16:[2,16],19:[2,16],20:[2,16],22:[2,16],23:[2,16],24:[2,16]},{5:[2,19],14:[2,19],15:[2,19],16:[2,19],19:[2,19],20:[2,19],22:[2,19],23:[2,19],24:[2,19]},{5:[2,20],14:[2,20],15:[2,20],16:[2,20],19:[2,20],20:[2,20],22:[2,20],23:[2,20],24:[2,20]},{5:[2,21],14:[2,21],15:[2,21],16:[2,21],19:[2,21],20:[2,21],22:[2,21],23:[2,21],
24:[2,21]},{18:[1,64]},{18:[2,24]},{18:[2,29],28:[2,29],30:[2,29],31:[2,29],32:[2,29],35:[2,29]},{18:[2,37],35:[2,37]},{36:[1,61]},{21:65,28:[1,69],30:[1,66],31:[1,67],32:[1,68],35:[1,27],38:26},{18:[2,46],28:[2,46],30:[2,46],31:[2,46],32:[2,46],35:[2,46],39:[2,46]},{18:[1,70]},{5:[2,22],14:[2,22],15:[2,22],16:[2,22],19:[2,22],20:[2,22],22:[2,22],23:[2,22],24:[2,22]},{18:[2,39],35:[2,39]},{18:[2,40],35:[2,40]},{18:[2,41],35:[2,41]},{18:[2,42],35:[2,42]},{18:[2,43],35:[2,43]},{5:[2,18],14:[2,18],15:[2,
18],16:[2,18],19:[2,18],20:[2,18],22:[2,18],23:[2,18],24:[2,18]}],defaultActions:{17:[2,1],25:[2,28],38:[2,26],57:[2,24]},parseError:function parseError(str,hash){throw new Error(str);},parse:function parse(input){var self=this,stack=[0],vstack=[null],lstack=[],table=this.table,yytext="",yylineno=0,yyleng=0,recovering=0,TERROR=2,EOF=1;this.lexer.setInput(input);this.lexer.yy=this.yy;this.yy.lexer=this.lexer;this.yy.parser=this;if(typeof this.lexer.yylloc=="undefined")this.lexer.yylloc={};var yyloc=
this.lexer.yylloc;lstack.push(yyloc);var ranges=this.lexer.options&&this.lexer.options.ranges;if(typeof this.yy.parseError==="function")this.parseError=this.yy.parseError;function popStack(n){stack.length=stack.length-2*n;vstack.length=vstack.length-n;lstack.length=lstack.length-n}function lex(){var token;token=self.lexer.lex()||1;if(typeof token!=="number")token=self.symbols_[token]||token;return token}var symbol,preErrorSymbol,state,action,a,r,yyval={},p,len,newState,expected;while(true){state=
stack[stack.length-1];if(this.defaultActions[state])action=this.defaultActions[state];else{if(symbol===null||typeof symbol=="undefined")symbol=lex();action=table[state]&&table[state][symbol]}if(typeof action==="undefined"||!action.length||!action[0]){var errStr="";if(!recovering){expected=[];for(p in table[state])if(this.terminals_[p]&&p>2)expected.push("'"+this.terminals_[p]+"'");if(this.lexer.showPosition)errStr="Parse error on line "+(yylineno+1)+":\n"+this.lexer.showPosition()+"\nExpecting "+
expected.join(", ")+", got '"+(this.terminals_[symbol]||symbol)+"'";else errStr="Parse error on line "+(yylineno+1)+": Unexpected "+(symbol==1?"end of input":"'"+(this.terminals_[symbol]||symbol)+"'");this.parseError(errStr,{text:this.lexer.match,token:this.terminals_[symbol]||symbol,line:this.lexer.yylineno,loc:yyloc,expected:expected})}}if(action[0]instanceof Array&&action.length>1)throw new Error("Parse Error: multiple actions possible at state: "+state+", token: "+symbol);switch(action[0]){case 1:stack.push(symbol);
vstack.push(this.lexer.yytext);lstack.push(this.lexer.yylloc);stack.push(action[1]);symbol=null;if(!preErrorSymbol){yyleng=this.lexer.yyleng;yytext=this.lexer.yytext;yylineno=this.lexer.yylineno;yyloc=this.lexer.yylloc;if(recovering>0)recovering--}else{symbol=preErrorSymbol;preErrorSymbol=null}break;case 2:len=this.productions_[action[1]][1];yyval.$=vstack[vstack.length-len];yyval._$={first_line:lstack[lstack.length-(len||1)].first_line,last_line:lstack[lstack.length-1].last_line,first_column:lstack[lstack.length-
(len||1)].first_column,last_column:lstack[lstack.length-1].last_column};if(ranges)yyval._$.range=[lstack[lstack.length-(len||1)].range[0],lstack[lstack.length-1].range[1]];r=this.performAction.call(yyval,yytext,yyleng,yylineno,this.yy,action[1],vstack,lstack);if(typeof r!=="undefined")return r;if(len){stack=stack.slice(0,-1*len*2);vstack=vstack.slice(0,-1*len);lstack=lstack.slice(0,-1*len)}stack.push(this.productions_[action[1]][0]);vstack.push(yyval.$);lstack.push(yyval._$);newState=table[stack[stack.length-
2]][stack[stack.length-1]];stack.push(newState);break;case 3:return true}}return true}};var lexer=function(){var lexer={EOF:1,parseError:function parseError(str,hash){if(this.yy.parser)this.yy.parser.parseError(str,hash);else throw new Error(str);},setInput:function(input){this._input=input;this._more=this._less=this.done=false;this.yylineno=this.yyleng=0;this.yytext=this.matched=this.match="";this.conditionStack=["INITIAL"];this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0};if(this.options.ranges)this.yylloc.range=
[0,0];this.offset=0;return this},input:function(){var ch=this._input[0];this.yytext+=ch;this.yyleng++;this.offset++;this.match+=ch;this.matched+=ch;var lines=ch.match(/(?:\r\n?|\n).*/g);if(lines){this.yylineno++;this.yylloc.last_line++}else this.yylloc.last_column++;if(this.options.ranges)this.yylloc.range[1]++;this._input=this._input.slice(1);return ch},unput:function(ch){var len=ch.length;var lines=ch.split(/(?:\r\n?|\n)/g);this._input=ch+this._input;this.yytext=this.yytext.substr(0,this.yytext.length-
len-1);this.offset-=len;var oldLines=this.match.split(/(?:\r\n?|\n)/g);this.match=this.match.substr(0,this.match.length-1);this.matched=this.matched.substr(0,this.matched.length-1);if(lines.length-1)this.yylineno-=lines.length-1;var r=this.yylloc.range;this.yylloc={first_line:this.yylloc.first_line,last_line:this.yylineno+1,first_column:this.yylloc.first_column,last_column:lines?(lines.length===oldLines.length?this.yylloc.first_column:0)+oldLines[oldLines.length-lines.length].length-lines[0].length:
this.yylloc.first_column-len};if(this.options.ranges)this.yylloc.range=[r[0],r[0]+this.yyleng-len];return this},more:function(){this._more=true;return this},less:function(n){this.unput(this.match.slice(n))},pastInput:function(){var past=this.matched.substr(0,this.matched.length-this.match.length);return(past.length>20?"...":"")+past.substr(-20).replace(/\n/g,"")},upcomingInput:function(){var next=this.match;if(next.length<20)next+=this._input.substr(0,20-next.length);return(next.substr(0,20)+(next.length>
20?"...":"")).replace(/\n/g,"")},showPosition:function(){var pre=this.pastInput();var c=(new Array(pre.length+1)).join("-");return pre+this.upcomingInput()+"\n"+c+"^"},next:function(){if(this.done)return this.EOF;if(!this._input)this.done=true;var token,match,tempMatch,index,col,lines;if(!this._more){this.yytext="";this.match=""}var rules=this._currentRules();for(var i=0;i<rules.length;i++){tempMatch=this._input.match(this.rules[rules[i]]);if(tempMatch&&(!match||tempMatch[0].length>match[0].length)){match=
tempMatch;index=i;if(!this.options.flex)break}}if(match){lines=match[0].match(/(?:\r\n?|\n).*/g);if(lines)this.yylineno+=lines.length;this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:lines?lines[lines.length-1].length-lines[lines.length-1].match(/\r?\n?/)[0].length:this.yylloc.last_column+match[0].length};this.yytext+=match[0];this.match+=match[0];this.matches=match;this.yyleng=this.yytext.length;if(this.options.ranges)this.yylloc.range=
[this.offset,this.offset+=this.yyleng];this._more=false;this._input=this._input.slice(match[0].length);this.matched+=match[0];token=this.performAction.call(this,this.yy,this,rules[index],this.conditionStack[this.conditionStack.length-1]);if(this.done&&this._input)this.done=false;if(token)return token;else return}if(this._input==="")return this.EOF;else return this.parseError("Lexical error on line "+(this.yylineno+1)+". Unrecognized text.\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})},
lex:function lex(){var r=this.next();if(typeof r!=="undefined")return r;else return this.lex()},begin:function begin(condition){this.conditionStack.push(condition)},popState:function popState(){return this.conditionStack.pop()},_currentRules:function _currentRules(){return this.conditions[this.conditionStack[this.conditionStack.length-1]].rules},topState:function(){return this.conditionStack[this.conditionStack.length-2]},pushState:function begin(condition){this.begin(condition)}};lexer.options={};
lexer.performAction=function anonymous(yy,yy_,$avoiding_name_collisions,YY_START){var YYSTATE=YY_START;switch($avoiding_name_collisions){case 0:if(yy_.yytext.slice(-1)!=="\\")this.begin("mu");if(yy_.yytext.slice(-1)==="\\")yy_.yytext=yy_.yytext.substr(0,yy_.yyleng-1),this.begin("emu");if(yy_.yytext)return 14;break;case 1:return 14;break;case 2:if(yy_.yytext.slice(-1)!=="\\")this.popState();if(yy_.yytext.slice(-1)==="\\")yy_.yytext=yy_.yytext.substr(0,yy_.yyleng-1);return 14;break;case 3:yy_.yytext=
yy_.yytext.substr(0,yy_.yyleng-4);this.popState();return 15;break;case 4:this.begin("par");return 24;break;case 5:return 16;break;case 6:return 20;break;case 7:return 19;break;case 8:return 19;break;case 9:return 23;break;case 10:return 23;break;case 11:this.popState();this.begin("com");break;case 12:yy_.yytext=yy_.yytext.substr(3,yy_.yyleng-5);this.popState();return 15;break;case 13:return 22;break;case 14:return 36;break;case 15:return 35;break;case 16:return 35;break;case 17:return 39;break;case 18:break;
case 19:this.popState();return 18;break;case 20:this.popState();return 18;break;case 21:yy_.yytext=yy_.yytext.substr(1,yy_.yyleng-2).replace(/\\"/g,'"');return 30;break;case 22:yy_.yytext=yy_.yytext.substr(1,yy_.yyleng-2).replace(/\\'/g,"'");return 30;break;case 23:yy_.yytext=yy_.yytext.substr(1);return 28;break;case 24:return 32;break;case 25:return 32;break;case 26:return 31;break;case 27:return 35;break;case 28:yy_.yytext=yy_.yytext.substr(1,yy_.yyleng-2);return 35;break;case 29:return"INVALID";
break;case 30:break;case 31:this.popState();return 37;break;case 32:return 5;break}};lexer.rules=[/^(?:[^\x00]*?(?=(\{\{)))/,/^(?:[^\x00]+)/,/^(?:[^\x00]{2,}?(?=(\{\{|$)))/,/^(?:[\s\S]*?--\}\})/,/^(?:\{\{>)/,/^(?:\{\{#)/,/^(?:\{\{\/)/,/^(?:\{\{\^)/,/^(?:\{\{\s*else\b)/,/^(?:\{\{\{)/,/^(?:\{\{&)/,/^(?:\{\{!--)/,/^(?:\{\{![\s\S]*?\}\})/,/^(?:\{\{)/,/^(?:=)/,/^(?:\.(?=[} ]))/,/^(?:\.\.)/,/^(?:[\/.])/,/^(?:\s+)/,/^(?:\}\}\})/,/^(?:\}\})/,/^(?:"(\\["]|[^"])*")/,/^(?:'(\\[']|[^'])*')/,/^(?:@[a-zA-Z]+)/,
/^(?:true(?=[}\s]))/,/^(?:false(?=[}\s]))/,/^(?:[0-9]+(?=[}\s]))/,/^(?:[a-zA-Z0-9_$-]+(?=[=}\s\/.]))/,/^(?:\[[^\]]*\])/,/^(?:.)/,/^(?:\s+)/,/^(?:[a-zA-Z0-9_$-/]+)/,/^(?:$)/];lexer.conditions={"mu":{"rules":[4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,32],"inclusive":false},"emu":{"rules":[2],"inclusive":false},"com":{"rules":[3],"inclusive":false},"par":{"rules":[30,31],"inclusive":false},"INITIAL":{"rules":[0,1,32],"inclusive":true}};return lexer}();parser.lexer=lexer;
function Parser(){this.yy={}}Parser.prototype=parser;parser.Parser=Parser;return new Parser}();Handlebars.Parser=handlebars;Handlebars.parse=function(input){if(input.constructor===Handlebars.AST.ProgramNode)return input;Handlebars.Parser.yy=Handlebars.AST;return Handlebars.Parser.parse(input)};Handlebars.print=function(ast){return(new Handlebars.PrintVisitor).accept(ast)};
(function(){Handlebars.AST={};Handlebars.AST.ProgramNode=function(statements,inverse){this.type="program";this.statements=statements;if(inverse)this.inverse=new Handlebars.AST.ProgramNode(inverse)};Handlebars.AST.MustacheNode=function(rawParams,hash,unescaped){this.type="mustache";this.escaped=!unescaped;this.hash=hash;var id=this.id=rawParams[0];var params=this.params=rawParams.slice(1);var eligibleHelper=this.eligibleHelper=id.isSimple;this.isHelper=eligibleHelper&&(params.length||hash)};Handlebars.AST.PartialNode=
function(partialName,context){this.type="partial";this.partialName=partialName;this.context=context};var verifyMatch=function(open,close){if(open.original!==close.original)throw new Handlebars.Exception(open.original+" doesn't match "+close.original);};Handlebars.AST.BlockNode=function(mustache,program,inverse,close){verifyMatch(mustache.id,close);this.type="block";this.mustache=mustache;this.program=program;this.inverse=inverse;if(this.inverse&&!this.program)this.isInverse=true};Handlebars.AST.ContentNode=
function(string){this.type="content";this.string=string};Handlebars.AST.HashNode=function(pairs){this.type="hash";this.pairs=pairs};Handlebars.AST.IdNode=function(parts){this.type="ID";this.original=parts.join(".");var dig=[],depth=0;for(var i=0,l=parts.length;i<l;i++){var part=parts[i];if(part===".."||part==="."||part==="this")if(dig.length>0)throw new Handlebars.Exception("Invalid path: "+this.original);else if(part==="..")depth++;else this.isScoped=true;else dig.push(part)}this.parts=dig;this.string=
dig.join(".");this.depth=depth;this.isSimple=parts.length===1&&!this.isScoped&&depth===0;this.stringModeValue=this.string};Handlebars.AST.PartialNameNode=function(name){this.type="PARTIAL_NAME";this.name=name};Handlebars.AST.DataNode=function(id){this.type="DATA";this.id=id};Handlebars.AST.StringNode=function(string){this.type="STRING";this.string=string;this.stringModeValue=string};Handlebars.AST.IntegerNode=function(integer){this.type="INTEGER";this.integer=integer;this.stringModeValue=Number(integer)};
Handlebars.AST.BooleanNode=function(bool){this.type="BOOLEAN";this.bool=bool;this.stringModeValue=bool==="true"};Handlebars.AST.CommentNode=function(comment){this.type="comment";this.comment=comment}})();var errorProps=["description","fileName","lineNumber","message","name","number","stack"];Handlebars.Exception=function(message){var tmp=Error.prototype.constructor.apply(this,arguments);for(var idx=0;idx<errorProps.length;idx++)this[errorProps[idx]]=tmp[errorProps[idx]]};
Handlebars.Exception.prototype=new Error;Handlebars.SafeString=function(string){this.string=string};Handlebars.SafeString.prototype.toString=function(){return this.string.toString()};
(function(){var escape={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"};var badChars=/[&<>"'`]/g;var possible=/[&<>"'`]/;var escapeChar=function(chr){return escape[chr]||"&amp;"};Handlebars.Utils={escapeExpression:function(string){if(string instanceof Handlebars.SafeString)return string.toString();else if(string==null||string===false)return"";if(!possible.test(string))return string;return string.replace(badChars,escapeChar)},isEmpty:function(value){if(!value&&value!==0)return true;
else if(Object.prototype.toString.call(value)==="[object Array]"&&value.length===0)return true;else return false}}})();Handlebars.Compiler=function(){};Handlebars.JavaScriptCompiler=function(){};
(function(Compiler,JavaScriptCompiler){Compiler.prototype={compiler:Compiler,disassemble:function(){var opcodes=this.opcodes,opcode,out=[],params,param;for(var i=0,l=opcodes.length;i<l;i++){opcode=opcodes[i];if(opcode.opcode==="DECLARE")out.push("DECLARE "+opcode.name+"="+opcode.value);else{params=[];for(var j=0;j<opcode.args.length;j++){param=opcode.args[j];if(typeof param==="string")param='"'+param.replace("\n","\\n")+'"';params.push(param)}out.push(opcode.opcode+" "+params.join(" "))}}return out.join("\n")},
equals:function(other){var len=this.opcodes.length;if(other.opcodes.length!==len)return false;for(var i=0;i<len;i++){var opcode=this.opcodes[i],otherOpcode=other.opcodes[i];if(opcode.opcode!==otherOpcode.opcode||opcode.args.length!==otherOpcode.args.length)return false;for(var j=0;j<opcode.args.length;j++)if(opcode.args[j]!==otherOpcode.args[j])return false}return true},guid:0,compile:function(program,options){this.children=[];this.depths={list:[]};this.options=options;var knownHelpers=this.options.knownHelpers;
this.options.knownHelpers={"helperMissing":true,"blockHelperMissing":true,"each":true,"if":true,"unless":true,"with":true,"log":true};if(knownHelpers)for(var name in knownHelpers)this.options.knownHelpers[name]=knownHelpers[name];return this.program(program)},accept:function(node){return this[node.type](node)},program:function(program){var statements=program.statements,statement;this.opcodes=[];for(var i=0,l=statements.length;i<l;i++){statement=statements[i];this[statement.type](statement)}this.isSimple=
l===1;this.depths.list=this.depths.list.sort(function(a,b){return a-b});return this},compileProgram:function(program){var result=(new this.compiler).compile(program,this.options);var guid=this.guid++,depth;this.usePartial=this.usePartial||result.usePartial;this.children[guid]=result;for(var i=0,l=result.depths.list.length;i<l;i++){depth=result.depths.list[i];if(depth<2)continue;else this.addDepth(depth-1)}return guid},block:function(block){var mustache=block.mustache,program=block.program,inverse=
block.inverse;if(program)program=this.compileProgram(program);if(inverse)inverse=this.compileProgram(inverse);var type=this.classifyMustache(mustache);if(type==="helper")this.helperMustache(mustache,program,inverse);else if(type==="simple"){this.simpleMustache(mustache);this.opcode("pushProgram",program);this.opcode("pushProgram",inverse);this.opcode("emptyHash");this.opcode("blockValue")}else{this.ambiguousMustache(mustache,program,inverse);this.opcode("pushProgram",program);this.opcode("pushProgram",
inverse);this.opcode("emptyHash");this.opcode("ambiguousBlockValue")}this.opcode("append")},hash:function(hash){var pairs=hash.pairs,pair,val;this.opcode("pushHash");for(var i=0,l=pairs.length;i<l;i++){pair=pairs[i];val=pair[1];if(this.options.stringParams)this.opcode("pushStringParam",val.stringModeValue,val.type);else this.accept(val);this.opcode("assignToHash",pair[0])}this.opcode("popHash")},partial:function(partial){var partialName=partial.partialName;this.usePartial=true;if(partial.context)this.ID(partial.context);
else this.opcode("push","depth0");this.opcode("invokePartial",partialName.name);this.opcode("append")},content:function(content){this.opcode("appendContent",content.string)},mustache:function(mustache){var options=this.options;var type=this.classifyMustache(mustache);if(type==="simple")this.simpleMustache(mustache);else if(type==="helper")this.helperMustache(mustache);else this.ambiguousMustache(mustache);if(mustache.escaped&&!options.noEscape)this.opcode("appendEscaped");else this.opcode("append")},
ambiguousMustache:function(mustache,program,inverse){var id=mustache.id,name=id.parts[0],isBlock=program!=null||inverse!=null;this.opcode("getContext",id.depth);this.opcode("pushProgram",program);this.opcode("pushProgram",inverse);this.opcode("invokeAmbiguous",name,isBlock)},simpleMustache:function(mustache){var id=mustache.id;if(id.type==="DATA")this.DATA(id);else if(id.parts.length)this.ID(id);else{this.addDepth(id.depth);this.opcode("getContext",id.depth);this.opcode("pushContext")}this.opcode("resolvePossibleLambda")},
helperMustache:function(mustache,program,inverse){var params=this.setupFullMustacheParams(mustache,program,inverse),name=mustache.id.parts[0];if(this.options.knownHelpers[name])this.opcode("invokeKnownHelper",params.length,name);else if(this.knownHelpersOnly)throw new Error("You specified knownHelpersOnly, but used the unknown helper "+name);else this.opcode("invokeHelper",params.length,name)},ID:function(id){this.addDepth(id.depth);this.opcode("getContext",id.depth);var name=id.parts[0];if(!name)this.opcode("pushContext");
else this.opcode("lookupOnContext",id.parts[0]);for(var i=1,l=id.parts.length;i<l;i++)this.opcode("lookup",id.parts[i])},DATA:function(data){this.options.data=true;this.opcode("lookupData",data.id)},STRING:function(string){this.opcode("pushString",string.string)},INTEGER:function(integer){this.opcode("pushLiteral",integer.integer)},BOOLEAN:function(bool){this.opcode("pushLiteral",bool.bool)},comment:function(){},opcode:function(name){this.opcodes.push({opcode:name,args:[].slice.call(arguments,1)})},
declare:function(name,value){this.opcodes.push({opcode:"DECLARE",name:name,value:value})},addDepth:function(depth){if(isNaN(depth))throw new Error("EWOT");if(depth===0)return;if(!this.depths[depth]){this.depths[depth]=true;this.depths.list.push(depth)}},classifyMustache:function(mustache){var isHelper=mustache.isHelper;var isEligible=mustache.eligibleHelper;var options=this.options;if(isEligible&&!isHelper){var name=mustache.id.parts[0];if(options.knownHelpers[name])isHelper=true;else if(options.knownHelpersOnly)isEligible=
false}if(isHelper)return"helper";else if(isEligible)return"ambiguous";else return"simple"},pushParams:function(params){var i=params.length,param;while(i--){param=params[i];if(this.options.stringParams){if(param.depth)this.addDepth(param.depth);this.opcode("getContext",param.depth||0);this.opcode("pushStringParam",param.stringModeValue,param.type)}else this[param.type](param)}},setupMustacheParams:function(mustache){var params=mustache.params;this.pushParams(params);if(mustache.hash)this.hash(mustache.hash);
else this.opcode("emptyHash");return params},setupFullMustacheParams:function(mustache,program,inverse){var params=mustache.params;this.pushParams(params);this.opcode("pushProgram",program);this.opcode("pushProgram",inverse);if(mustache.hash)this.hash(mustache.hash);else this.opcode("emptyHash");return params}};var Literal=function(value){this.value=value};JavaScriptCompiler.prototype={nameLookup:function(parent,name){if(/^[0-9]+$/.test(name))return parent+"["+name+"]";else if(JavaScriptCompiler.isValidJavaScriptVariableName(name))return parent+
"."+name;else return parent+"['"+name+"']"},appendToBuffer:function(string){if(this.environment.isSimple)return"return "+string+";";else return{appendToBuffer:true,content:string,toString:function(){return"buffer += "+string+";"}}},initializeBuffer:function(){return this.quotedString("")},namespace:"Handlebars",compile:function(environment,options,context,asObject){this.environment=environment;this.options=options||{};Handlebars.log(Handlebars.logger.DEBUG,this.environment.disassemble()+"\n\n");this.name=
this.environment.name;this.isChild=!!context;this.context=context||{programs:[],environments:[],aliases:{}};this.preamble();this.stackSlot=0;this.stackVars=[];this.registers={list:[]};this.compileStack=[];this.inlineStack=[];this.compileChildren(environment,options);var opcodes=environment.opcodes,opcode;this.i=0;for(l=opcodes.length;this.i<l;this.i++){opcode=opcodes[this.i];if(opcode.opcode==="DECLARE")this[opcode.name]=opcode.value;else this[opcode.opcode].apply(this,opcode.args)}return this.createFunctionContext(asObject)},
nextOpcode:function(){var opcodes=this.environment.opcodes;return opcodes[this.i+1]},eat:function(){this.i=this.i+1},preamble:function(){var out=[];if(!this.isChild){var namespace=this.namespace;var copies="helpers = helpers || "+namespace+".helpers;";if(this.environment.usePartial)copies=copies+" partials = partials || "+namespace+".partials;";if(this.options.data)copies=copies+" data = data || {};";out.push(copies)}else out.push("");if(!this.environment.isSimple)out.push(", buffer = "+this.initializeBuffer());
else out.push("");this.lastContext=0;this.source=out},createFunctionContext:function(asObject){var locals=this.stackVars.concat(this.registers.list);if(locals.length>0)this.source[1]=this.source[1]+", "+locals.join(", ");if(!this.isChild)for(var alias in this.context.aliases)this.source[1]=this.source[1]+", "+alias+"="+this.context.aliases[alias];if(this.source[1])this.source[1]="var "+this.source[1].substring(2)+";";if(!this.isChild)this.source[1]+="\n"+this.context.programs.join("\n")+"\n";if(!this.environment.isSimple)this.source.push("return buffer;");
var params=this.isChild?["depth0","data"]:["Handlebars","depth0","helpers","partials","data"];for(var i=0,l=this.environment.depths.list.length;i<l;i++)params.push("depth"+this.environment.depths.list[i]);var source=this.mergeSource();if(!this.isChild){var revision=Handlebars.COMPILER_REVISION,versions=Handlebars.REVISION_CHANGES[revision];source="this.compilerInfo = ["+revision+",'"+versions+"'];\n"+source}if(asObject){params.push(source);return Function.apply(this,params)}else{var functionSource=
"function "+(this.name||"")+"("+params.join(",")+") {\n  "+source+"}";Handlebars.log(Handlebars.logger.DEBUG,functionSource+"\n\n");return functionSource}},mergeSource:function(){var source="",buffer;for(var i=0,len=this.source.length;i<len;i++){var line=this.source[i];if(line.appendToBuffer)if(buffer)buffer=buffer+"\n    + "+line.content;else buffer=line.content;else{if(buffer){source+="buffer += "+buffer+";\n  ";buffer=undefined}source+=line+"\n  "}}return source},blockValue:function(){this.context.aliases.blockHelperMissing=
"helpers.blockHelperMissing";var params=["depth0"];this.setupParams(0,params);this.replaceStack(function(current){params.splice(1,0,current);return"blockHelperMissing.call("+params.join(", ")+")"})},ambiguousBlockValue:function(){this.context.aliases.blockHelperMissing="helpers.blockHelperMissing";var params=["depth0"];this.setupParams(0,params);var current=this.topStack();params.splice(1,0,current);params[params.length-1]="options";this.source.push("if (!"+this.lastHelper+") { "+current+" = blockHelperMissing.call("+
params.join(", ")+"); }")},appendContent:function(content){this.source.push(this.appendToBuffer(this.quotedString(content)))},append:function(){this.flushInline();var local=this.popStack();this.source.push("if("+local+" || "+local+" === 0) { "+this.appendToBuffer(local)+" }");if(this.environment.isSimple)this.source.push("else { "+this.appendToBuffer("''")+" }")},appendEscaped:function(){this.context.aliases.escapeExpression="this.escapeExpression";this.source.push(this.appendToBuffer("escapeExpression("+
this.popStack()+")"))},getContext:function(depth){if(this.lastContext!==depth)this.lastContext=depth},lookupOnContext:function(name){this.push(this.nameLookup("depth"+this.lastContext,name,"context"))},pushContext:function(){this.pushStackLiteral("depth"+this.lastContext)},resolvePossibleLambda:function(){this.context.aliases.functionType='"function"';this.replaceStack(function(current){return"typeof "+current+" === functionType ? "+current+".apply(depth0) : "+current})},lookup:function(name){this.replaceStack(function(current){return current+
" == null || "+current+" === false ? "+current+" : "+this.nameLookup(current,name,"context")})},lookupData:function(id){this.push(this.nameLookup("data",id,"data"))},pushStringParam:function(string,type){this.pushStackLiteral("depth"+this.lastContext);this.pushString(type);if(typeof string==="string")this.pushString(string);else this.pushStackLiteral(string)},emptyHash:function(){this.pushStackLiteral("{}");if(this.options.stringParams)this.register("hashTypes","{}")},pushHash:function(){this.hash=
{values:[],types:[]}},popHash:function(){var hash=this.hash;this.hash=undefined;if(this.options.stringParams)this.register("hashTypes","{"+hash.types.join(",")+"}");this.push("{\n    "+hash.values.join(",\n    ")+"\n  }")},pushString:function(string){this.pushStackLiteral(this.quotedString(string))},push:function(expr){this.inlineStack.push(expr);return expr},pushLiteral:function(value){this.pushStackLiteral(value)},pushProgram:function(guid){if(guid!=null)this.pushStackLiteral(this.programExpression(guid));
else this.pushStackLiteral(null)},invokeHelper:function(paramSize,name){this.context.aliases.helperMissing="helpers.helperMissing";var helper=this.lastHelper=this.setupHelper(paramSize,name,true);this.push(helper.name);this.replaceStack(function(name){return name+" ? "+name+".call("+helper.callParams+") "+": helperMissing.call("+helper.helperMissingParams+")"})},invokeKnownHelper:function(paramSize,name){var helper=this.setupHelper(paramSize,name);this.push(helper.name+".call("+helper.callParams+
")")},invokeAmbiguous:function(name,helperCall){this.context.aliases.functionType='"function"';this.pushStackLiteral("{}");var helper=this.setupHelper(0,name,helperCall);var helperName=this.lastHelper=this.nameLookup("helpers",name,"helper");var nonHelper=this.nameLookup("depth"+this.lastContext,name,"context");var nextStack=this.nextStack();this.source.push("if ("+nextStack+" = "+helperName+") { "+nextStack+" = "+nextStack+".call("+helper.callParams+"); }");this.source.push("else { "+nextStack+" = "+
nonHelper+"; "+nextStack+" = typeof "+nextStack+" === functionType ? "+nextStack+".apply(depth0) : "+nextStack+"; }")},invokePartial:function(name){var params=[this.nameLookup("partials",name,"partial"),"'"+name+"'",this.popStack(),"helpers","partials"];if(this.options.data)params.push("data");this.context.aliases.self="this";this.push("self.invokePartial("+params.join(", ")+")")},assignToHash:function(key){var value=this.popStack(),type;if(this.options.stringParams){type=this.popStack();this.popStack()}var hash=
this.hash;if(type)hash.types.push("'"+key+"': "+type);hash.values.push("'"+key+"': ("+value+")")},compiler:JavaScriptCompiler,compileChildren:function(environment,options){var children=environment.children,child,compiler;for(var i=0,l=children.length;i<l;i++){child=children[i];compiler=new this.compiler;var index=this.matchExistingProgram(child);if(index==null){this.context.programs.push("");index=this.context.programs.length;child.index=index;child.name="program"+index;this.context.programs[index]=
compiler.compile(child,options,this.context);this.context.environments[index]=child}else{child.index=index;child.name="program"+index}}},matchExistingProgram:function(child){for(var i=0,len=this.context.environments.length;i<len;i++){var environment=this.context.environments[i];if(environment&&environment.equals(child))return i}},programExpression:function(guid){this.context.aliases.self="this";if(guid==null)return"self.noop";var child=this.environment.children[guid],depths=child.depths.list,depth;
var programParams=[child.index,child.name,"data"];for(var i=0,l=depths.length;i<l;i++){depth=depths[i];if(depth===1)programParams.push("depth0");else programParams.push("depth"+(depth-1))}if(depths.length===0)return"self.program("+programParams.join(", ")+")";else{programParams.shift();return"self.programWithDepth("+programParams.join(", ")+")"}},register:function(name,val){this.useRegister(name);this.source.push(name+" = "+val+";")},useRegister:function(name){if(!this.registers[name]){this.registers[name]=
true;this.registers.list.push(name)}},pushStackLiteral:function(item){return this.push(new Literal(item))},pushStack:function(item){this.flushInline();var stack=this.incrStack();if(item)this.source.push(stack+" = "+item+";");this.compileStack.push(stack);return stack},replaceStack:function(callback){var prefix="",inline=this.isInline(),stack;if(inline){var top=this.popStack(true);if(top instanceof Literal)stack=top.value;else{var name=this.stackSlot?this.topStackName():this.incrStack();prefix="("+
this.push(name)+" = "+top+"),";stack=this.topStack()}}else stack=this.topStack();var item=callback.call(this,stack);if(inline){if(this.inlineStack.length||this.compileStack.length)this.popStack();this.push("("+prefix+item+")")}else{if(!/^stack/.test(stack))stack=this.nextStack();this.source.push(stack+" = ("+prefix+item+");")}return stack},nextStack:function(){return this.pushStack()},incrStack:function(){this.stackSlot++;if(this.stackSlot>this.stackVars.length)this.stackVars.push("stack"+this.stackSlot);
return this.topStackName()},topStackName:function(){return"stack"+this.stackSlot},flushInline:function(){var inlineStack=this.inlineStack;if(inlineStack.length){this.inlineStack=[];for(var i=0,len=inlineStack.length;i<len;i++){var entry=inlineStack[i];if(entry instanceof Literal)this.compileStack.push(entry);else this.pushStack(entry)}}},isInline:function(){return this.inlineStack.length},popStack:function(wrapped){var inline=this.isInline(),item=(inline?this.inlineStack:this.compileStack).pop();
if(!wrapped&&item instanceof Literal)return item.value;else{if(!inline)this.stackSlot--;return item}},topStack:function(wrapped){var stack=this.isInline()?this.inlineStack:this.compileStack,item=stack[stack.length-1];if(!wrapped&&item instanceof Literal)return item.value;else return item},quotedString:function(str){return'"'+str.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\n/g,"\\n").replace(/\r/g,"\\r")+'"'},setupHelper:function(paramSize,name,missingParams){var params=[];this.setupParams(paramSize,
params,missingParams);var foundHelper=this.nameLookup("helpers",name,"helper");return{params:params,name:foundHelper,callParams:["depth0"].concat(params).join(", "),helperMissingParams:missingParams&&["depth0",this.quotedString(name)].concat(params).join(", ")}},setupParams:function(paramSize,params,useRegister){var options=[],contexts=[],types=[],param,inverse,program;options.push("hash:"+this.popStack());inverse=this.popStack();program=this.popStack();if(program||inverse){if(!program){this.context.aliases.self=
"this";program="self.noop"}if(!inverse){this.context.aliases.self="this";inverse="self.noop"}options.push("inverse:"+inverse);options.push("fn:"+program)}for(var i=0;i<paramSize;i++){param=this.popStack();params.push(param);if(this.options.stringParams){types.push(this.popStack());contexts.push(this.popStack())}}if(this.options.stringParams){options.push("contexts:["+contexts.join(",")+"]");options.push("types:["+types.join(",")+"]");options.push("hashTypes:hashTypes")}if(this.options.data)options.push("data:data");
options="{"+options.join(",")+"}";if(useRegister){this.register("options",options);params.push("options")}else params.push(options);return params.join(", ")}};var reservedWords=("break else new var"+" case finally return void"+" catch for switch while"+" continue function this with"+" default if throw"+" delete in try"+" do instanceof typeof"+" abstract enum int short"+" boolean export interface static"+" byte extends long super"+" char final native synchronized"+" class float package throws"+" const goto private transient"+
" debugger implements protected volatile"+" double import public let yield").split(" ");var compilerWords=JavaScriptCompiler.RESERVED_WORDS={};for(var i=0,l=reservedWords.length;i<l;i++)compilerWords[reservedWords[i]]=true;JavaScriptCompiler.isValidJavaScriptVariableName=function(name){if(!JavaScriptCompiler.RESERVED_WORDS[name]&&/^[a-zA-Z_$][0-9a-zA-Z_$]+$/.test(name))return true;return false}})(Handlebars.Compiler,Handlebars.JavaScriptCompiler);
Handlebars.precompile=function(input,options){if(!input||typeof input!=="string"&&input.constructor!==Handlebars.AST.ProgramNode)throw new Handlebars.Exception("You must pass a string or Handlebars AST to Handlebars.compile. You passed "+input);options=options||{};if(!("data"in options))options.data=true;var ast=Handlebars.parse(input);var environment=(new Handlebars.Compiler).compile(ast,options);return(new Handlebars.JavaScriptCompiler).compile(environment,options)};
Handlebars.compile=function(input,options){if(!input||typeof input!=="string"&&input.constructor!==Handlebars.AST.ProgramNode)throw new Handlebars.Exception("You must pass a string or Handlebars AST to Handlebars.compile. You passed "+input);options=options||{};if(!("data"in options))options.data=true;var compiled;function compile(){var ast=Handlebars.parse(input);var environment=(new Handlebars.Compiler).compile(ast,options);var templateSpec=(new Handlebars.JavaScriptCompiler).compile(environment,
options,undefined,true);return Handlebars.template(templateSpec)}return function(context,options){if(!compiled)compiled=compile();return compiled.call(this,context,options)}};
Handlebars.VM={template:function(templateSpec){var container={escapeExpression:Handlebars.Utils.escapeExpression,invokePartial:Handlebars.VM.invokePartial,programs:[],program:function(i,fn,data){var programWrapper=this.programs[i];if(data)return Handlebars.VM.program(fn,data);else if(programWrapper)return programWrapper;else{programWrapper=this.programs[i]=Handlebars.VM.program(fn);return programWrapper}},programWithDepth:Handlebars.VM.programWithDepth,noop:Handlebars.VM.noop,compilerInfo:null};return function(context,
options){options=options||{};var result=templateSpec.call(container,Handlebars,context,options.helpers,options.partials,options.data);var compilerInfo=container.compilerInfo||[],compilerRevision=compilerInfo[0]||1,currentRevision=Handlebars.COMPILER_REVISION;if(compilerRevision!==currentRevision)if(compilerRevision<currentRevision){var runtimeVersions=Handlebars.REVISION_CHANGES[currentRevision],compilerVersions=Handlebars.REVISION_CHANGES[compilerRevision];throw"Template was precompiled with an older version of Handlebars than the current runtime. "+
"Please update your precompiler to a newer version ("+runtimeVersions+") or downgrade your runtime to an older version ("+compilerVersions+").";}else throw"Template was precompiled with a newer version of Handlebars than the current runtime. "+"Please update your runtime to a newer version ("+compilerInfo[1]+").";return result}},programWithDepth:function(fn,data,$depth){var args=Array.prototype.slice.call(arguments,2);return function(context,options){options=options||{};return fn.apply(this,[context,
options.data||data].concat(args))}},program:function(fn,data){return function(context,options){options=options||{};return fn(context,options.data||data)}},noop:function(){return""},invokePartial:function(partial,name,context,helpers,partials,data){var options={helpers:helpers,partials:partials,data:data};if(partial===undefined)throw new Handlebars.Exception("The partial "+name+" could not be found");else if(partial instanceof Function)return partial(context,options);else if(!Handlebars.compile)throw new Handlebars.Exception("The partial "+
name+" could not be compiled when running in runtime-only mode");else{partials[name]=Handlebars.compile(partial,{data:data!==undefined});return partials[name](context,options)}}};Handlebars.template=Handlebars.VM.template;
(function($){Handlebars.registerHelper("gravatar",function(emailOrId,size){var imgSize=size||20,defaultImg=IMAGES_ROOT+"unknown_user_"+imgSize+".png",email=isNaN(emailOrId)?emailOrId:Assistly.users.get(emailOrId).email,gravatarUrl="https://secure.gravatar.com/avatar/"+hex_md5(email)+"?";gravatarUrl+=$.param({"rating":"PG","size":size,"default":defaultImg});return new Handlebars.SafeString(gravatarUrl)});Handlebars.registerHelper("userName",function(userId){var user=Assistly.users.get(userId),name=
user!==undefined?user.name:"";return new Handlebars.SafeString(name)});Handlebars.registerHelper("groupName",function(groupId){var group=Assistly.groups.get(groupId),name=group!==undefined?group.name:"";return new Handlebars.SafeString(name)});Handlebars.registerHelper("autolink",function(content){return new Handlebars.SafeString($.autolink(content))});Handlebars.registerHelper("interactionIcon",function(typeName){switch(typeName){case "email":return new Handlebars.SafeString("https://cdn.desk.com/assets/interactions/20/a-email-5a0ea05227839a544b26a8f7d078d07d.png");
case "twitter":return new Handlebars.SafeString("https://cdn.desk.com/assets/interactions/20/a-twitter-4b6d949d903fba14fb2ea6a3305d9c48.png");case "chat":return new Handlebars.SafeString("https://cdn.desk.com/assets/interactions/20/a-chat-6d4c9fb5162c1215c618db496025d779.png");case "phone":return new Handlebars.SafeString("https://cdn.desk.com/assets/interactions/20/a-phone-eaa538c4c612e8eb6f15f7fac70e8bad.png");case "qna":return new Handlebars.SafeString("https://cdn.desk.com/assets/interactions/20/a-qna-81d2ca1c8221cc38675a16ad8277fe8a.png");
case "facebook":return new Handlebars.SafeString("https://cdn.desk.com/assets/interactions/20/a-facebook-0eaf38fc1cf12c068d81e2393c0cea34.png")}})})(jQuery);var hbHelperVars={};$(document).ready(function(){hbHelperVars={isSSL:document.location.protocol==="https:"?true:false,currentHost:location.protocol+"//"+location.host,assetPath:"https://cdn.desk.com/assets/"}});
function gravatar_api_url(hash,ssl){if(ssl)return"https://secure.gravatar.com/avatar/"+hash;return"http://www.gravatar.com/avatar/"+hash}Handlebars.registerHelper("truncate",function(str,len){if(!str)str="";if(str.length>len){str=str.substr(0,parseInt(len)+1);str=$.trim(str)+"..."}return str});Handlebars.registerHelper("format",function(str,opt){return $.format(str,opt)});
Handlebars.registerHelper("customerThumb",function(customer,size,default_img,use_ssl){ssl=use_ssl||false;if(customer.twitter_user&&customer.twitter_user.profile_image_url)return'<img width="'+size+'" height="'+size+'" src="'+(ssl?customer.twitter_user.profile_image_url.replace(/^https?:\/\/[^.]+.twimg.com\/(?!sticky\/default_profile_images)/,"https://pbs.twimg.com/"):customer.twitter_user.profile_image_url)+'" alt="">';if(customer.facebook_user&&customer.facebook_user.profile_image_url)return'<img width="'+
size+'" height="'+size+'" src="'+customer.facebook_user.profile_image_url+'" alt="">';return'<img width="'+size+'" height="'+size+'" src="'+gravatar_api_url(customer.email_MD5,ssl)+"?rating=PG&size="+size+"&default="+default_img+'" alt="" class="gravatar">'});
Handlebars.registerHelper("agentThumb",function(user_id,size,default_img,use_ssl){ssl=use_ssl||false;user=Assistly.users.get(user_id);if(user.twitter_user&&user.twitter_user.profile_image_url)return'<img width="'+size+'" height="'+size+'" src="'+(ssl?user.twitter_user.profile_image_url.replace(/^https?:\/\/[^.]+.twimg.com\/(?!sticky\/default_profile_images)/,"https://pbs.twimg.com/"):user.twitter_user.profile_image_url)+'" alt="">';return'<img width="'+size+'" height="'+size+'" src="'+gravatar_api_url(user.email_MD5,
ssl)+"?rating=PG&size="+size+"&default="+default_img+'" alt="" class="gravatar">'});Handlebars.registerHelper("twitterProfileImage",function(img,size){return'<img width="'+size+'" height="'+size+'" src="'+img.replace(/^https?:\/\/[^.]+.twimg.com\/(?!sticky\/default_profile_images)/,"https://pbs.twimg.com/")+'" alt="">'});
Handlebars.registerHelper("generateAgentThumb",function(email,size){if(typeof email==="undefined"){var size=size||64;return"<img src='/assets/unknown_user_"+size+".png'/>"}var MD5=function(s){function L(k,d){return k<<d|k>>>32-d}function K(G,k){var I,d,F,H,x;F=G&2147483648;H=k&2147483648;I=G&1073741824;d=k&1073741824;x=(G&1073741823)+(k&1073741823);if(I&d)return x^2147483648^F^H;if(I|d)if(x&1073741824)return x^3221225472^F^H;else return x^1073741824^F^H;else return x^F^H}function r(d,F,k){return d&
F|~d&k}function q(d,F,k){return d&k|F&~k}function p(d,F,k){return d^F^k}function n(d,F,k){return F^(d|~k)}function u(G,F,aa,Z,k,H,I){G=K(G,K(K(r(F,aa,Z),k),I));return K(L(G,H),F)}function f(G,F,aa,Z,k,H,I){G=K(G,K(K(q(F,aa,Z),k),I));return K(L(G,H),F)}function D(G,F,aa,Z,k,H,I){G=K(G,K(K(p(F,aa,Z),k),I));return K(L(G,H),F)}function t(G,F,aa,Z,k,H,I){G=K(G,K(K(n(F,aa,Z),k),I));return K(L(G,H),F)}function e(G){var Z;var F=G.length;var x=F+8;var k=(x-x%64)/64;var I=(k+1)*16;var aa=Array(I-1);var d=0;
var H=0;while(H<F){Z=(H-H%4)/4;d=H%4*8;aa[Z]=aa[Z]|G.charCodeAt(H)<<d;H++}Z=(H-H%4)/4;d=H%4*8;aa[Z]=aa[Z]|128<<d;aa[I-2]=F<<3;aa[I-1]=F>>>29;return aa}function B(x){var k="",F="",G,d;for(d=0;d<=3;d++){G=x>>>d*8&255;F="0"+G.toString(16);k=k+F.substr(F.length-2,2)}return k}function J(k){k=k.replace(/\r\n/g,"\n");var d="";for(var F=0;F<k.length;F++){var x=k.charCodeAt(F);if(x<128)d+=String.fromCharCode(x);else if(x>127&&x<2048){d+=String.fromCharCode(x>>6|192);d+=String.fromCharCode(x&63|128)}else{d+=
String.fromCharCode(x>>12|224);d+=String.fromCharCode(x>>6&63|128);d+=String.fromCharCode(x&63|128)}}return d}var C=Array();var P,h,E,v,g,Y,X,W,V;var S=7,Q=12,N=17,M=22;var A=5,z=9,y=14,w=20;var o=4,m=11,l=16,j=23;var U=6,T=10,R=15,O=21;s=J(s);C=e(s);Y=1732584193;X=4023233417;W=2562383102;V=271733878;for(P=0;P<C.length;P+=16){h=Y;E=X;v=W;g=V;Y=u(Y,X,W,V,C[P+0],S,3614090360);V=u(V,Y,X,W,C[P+1],Q,3905402710);W=u(W,V,Y,X,C[P+2],N,606105819);X=u(X,W,V,Y,C[P+3],M,3250441966);Y=u(Y,X,W,V,C[P+4],S,4118548399);
V=u(V,Y,X,W,C[P+5],Q,1200080426);W=u(W,V,Y,X,C[P+6],N,2821735955);X=u(X,W,V,Y,C[P+7],M,4249261313);Y=u(Y,X,W,V,C[P+8],S,1770035416);V=u(V,Y,X,W,C[P+9],Q,2336552879);W=u(W,V,Y,X,C[P+10],N,4294925233);X=u(X,W,V,Y,C[P+11],M,2304563134);Y=u(Y,X,W,V,C[P+12],S,1804603682);V=u(V,Y,X,W,C[P+13],Q,4254626195);W=u(W,V,Y,X,C[P+14],N,2792965006);X=u(X,W,V,Y,C[P+15],M,1236535329);Y=f(Y,X,W,V,C[P+1],A,4129170786);V=f(V,Y,X,W,C[P+6],z,3225465664);W=f(W,V,Y,X,C[P+11],y,643717713);X=f(X,W,V,Y,C[P+0],w,3921069994);
Y=f(Y,X,W,V,C[P+5],A,3593408605);V=f(V,Y,X,W,C[P+10],z,38016083);W=f(W,V,Y,X,C[P+15],y,3634488961);X=f(X,W,V,Y,C[P+4],w,3889429448);Y=f(Y,X,W,V,C[P+9],A,568446438);V=f(V,Y,X,W,C[P+14],z,3275163606);W=f(W,V,Y,X,C[P+3],y,4107603335);X=f(X,W,V,Y,C[P+8],w,1163531501);Y=f(Y,X,W,V,C[P+13],A,2850285829);V=f(V,Y,X,W,C[P+2],z,4243563512);W=f(W,V,Y,X,C[P+7],y,1735328473);X=f(X,W,V,Y,C[P+12],w,2368359562);Y=D(Y,X,W,V,C[P+5],o,4294588738);V=D(V,Y,X,W,C[P+8],m,2272392833);W=D(W,V,Y,X,C[P+11],l,1839030562);X=D(X,
W,V,Y,C[P+14],j,4259657740);Y=D(Y,X,W,V,C[P+1],o,2763975236);V=D(V,Y,X,W,C[P+4],m,1272893353);W=D(W,V,Y,X,C[P+7],l,4139469664);X=D(X,W,V,Y,C[P+10],j,3200236656);Y=D(Y,X,W,V,C[P+13],o,681279174);V=D(V,Y,X,W,C[P+0],m,3936430074);W=D(W,V,Y,X,C[P+3],l,3572445317);X=D(X,W,V,Y,C[P+6],j,76029189);Y=D(Y,X,W,V,C[P+9],o,3654602809);V=D(V,Y,X,W,C[P+12],m,3873151461);W=D(W,V,Y,X,C[P+15],l,530742520);X=D(X,W,V,Y,C[P+2],j,3299628645);Y=t(Y,X,W,V,C[P+0],U,4096336452);V=t(V,Y,X,W,C[P+7],T,1126891415);W=t(W,V,Y,X,
C[P+14],R,2878612391);X=t(X,W,V,Y,C[P+5],O,4237533241);Y=t(Y,X,W,V,C[P+12],U,1700485571);V=t(V,Y,X,W,C[P+3],T,2399980690);W=t(W,V,Y,X,C[P+10],R,4293915773);X=t(X,W,V,Y,C[P+1],O,2240044497);Y=t(Y,X,W,V,C[P+8],U,1873313359);V=t(V,Y,X,W,C[P+15],T,4264355552);W=t(W,V,Y,X,C[P+6],R,2734768916);X=t(X,W,V,Y,C[P+13],O,1309151649);Y=t(Y,X,W,V,C[P+4],U,4149444226);V=t(V,Y,X,W,C[P+11],T,3174756917);W=t(W,V,Y,X,C[P+2],R,718787259);X=t(X,W,V,Y,C[P+9],O,3951481745);Y=K(Y,h);X=K(X,E);W=K(W,v);V=K(V,g)}var i=B(Y)+
B(X)+B(W)+B(V);return i.toLowerCase()};var hash=MD5(email);var size=size||80;return"<img src='"+gravatar_api_url(hash,hbHelperVars.isSSL)+".jpg?rating=PG&size="+size+"&default="+encodeURIComponent("https://cdn.desk.com/assets/unknown_user_64-8ccd1bbc084544acad8c3da8eb0c1812.png")+"'/>"});
Handlebars.registerHelper("generateAgentThumbRetina",function(email,size){if(typeof email==="undefined"){var size=size||64;return"<div class='a-gravitar-default-"+size+"'></div>"}var MD5=function(s){function L(k,d){return k<<d|k>>>32-d}function K(G,k){var I,d,F,H,x;F=G&2147483648;H=k&2147483648;I=G&1073741824;d=k&1073741824;x=(G&1073741823)+(k&1073741823);if(I&d)return x^2147483648^F^H;if(I|d)if(x&1073741824)return x^3221225472^F^H;else return x^1073741824^F^H;else return x^F^H}function r(d,F,k){return d&
F|~d&k}function q(d,F,k){return d&k|F&~k}function p(d,F,k){return d^F^k}function n(d,F,k){return F^(d|~k)}function u(G,F,aa,Z,k,H,I){G=K(G,K(K(r(F,aa,Z),k),I));return K(L(G,H),F)}function f(G,F,aa,Z,k,H,I){G=K(G,K(K(q(F,aa,Z),k),I));return K(L(G,H),F)}function D(G,F,aa,Z,k,H,I){G=K(G,K(K(p(F,aa,Z),k),I));return K(L(G,H),F)}function t(G,F,aa,Z,k,H,I){G=K(G,K(K(n(F,aa,Z),k),I));return K(L(G,H),F)}function e(G){var Z;var F=G.length;var x=F+8;var k=(x-x%64)/64;var I=(k+1)*16;var aa=Array(I-1);var d=0;
var H=0;while(H<F){Z=(H-H%4)/4;d=H%4*8;aa[Z]=aa[Z]|G.charCodeAt(H)<<d;H++}Z=(H-H%4)/4;d=H%4*8;aa[Z]=aa[Z]|128<<d;aa[I-2]=F<<3;aa[I-1]=F>>>29;return aa}function B(x){var k="",F="",G,d;for(d=0;d<=3;d++){G=x>>>d*8&255;F="0"+G.toString(16);k=k+F.substr(F.length-2,2)}return k}function J(k){k=k.replace(/\r\n/g,"\n");var d="";for(var F=0;F<k.length;F++){var x=k.charCodeAt(F);if(x<128)d+=String.fromCharCode(x);else if(x>127&&x<2048){d+=String.fromCharCode(x>>6|192);d+=String.fromCharCode(x&63|128)}else{d+=
String.fromCharCode(x>>12|224);d+=String.fromCharCode(x>>6&63|128);d+=String.fromCharCode(x&63|128)}}return d}var C=Array();var P,h,E,v,g,Y,X,W,V;var S=7,Q=12,N=17,M=22;var A=5,z=9,y=14,w=20;var o=4,m=11,l=16,j=23;var U=6,T=10,R=15,O=21;s=J(s);C=e(s);Y=1732584193;X=4023233417;W=2562383102;V=271733878;for(P=0;P<C.length;P+=16){h=Y;E=X;v=W;g=V;Y=u(Y,X,W,V,C[P+0],S,3614090360);V=u(V,Y,X,W,C[P+1],Q,3905402710);W=u(W,V,Y,X,C[P+2],N,606105819);X=u(X,W,V,Y,C[P+3],M,3250441966);Y=u(Y,X,W,V,C[P+4],S,4118548399);
V=u(V,Y,X,W,C[P+5],Q,1200080426);W=u(W,V,Y,X,C[P+6],N,2821735955);X=u(X,W,V,Y,C[P+7],M,4249261313);Y=u(Y,X,W,V,C[P+8],S,1770035416);V=u(V,Y,X,W,C[P+9],Q,2336552879);W=u(W,V,Y,X,C[P+10],N,4294925233);X=u(X,W,V,Y,C[P+11],M,2304563134);Y=u(Y,X,W,V,C[P+12],S,1804603682);V=u(V,Y,X,W,C[P+13],Q,4254626195);W=u(W,V,Y,X,C[P+14],N,2792965006);X=u(X,W,V,Y,C[P+15],M,1236535329);Y=f(Y,X,W,V,C[P+1],A,4129170786);V=f(V,Y,X,W,C[P+6],z,3225465664);W=f(W,V,Y,X,C[P+11],y,643717713);X=f(X,W,V,Y,C[P+0],w,3921069994);
Y=f(Y,X,W,V,C[P+5],A,3593408605);V=f(V,Y,X,W,C[P+10],z,38016083);W=f(W,V,Y,X,C[P+15],y,3634488961);X=f(X,W,V,Y,C[P+4],w,3889429448);Y=f(Y,X,W,V,C[P+9],A,568446438);V=f(V,Y,X,W,C[P+14],z,3275163606);W=f(W,V,Y,X,C[P+3],y,4107603335);X=f(X,W,V,Y,C[P+8],w,1163531501);Y=f(Y,X,W,V,C[P+13],A,2850285829);V=f(V,Y,X,W,C[P+2],z,4243563512);W=f(W,V,Y,X,C[P+7],y,1735328473);X=f(X,W,V,Y,C[P+12],w,2368359562);Y=D(Y,X,W,V,C[P+5],o,4294588738);V=D(V,Y,X,W,C[P+8],m,2272392833);W=D(W,V,Y,X,C[P+11],l,1839030562);X=D(X,
W,V,Y,C[P+14],j,4259657740);Y=D(Y,X,W,V,C[P+1],o,2763975236);V=D(V,Y,X,W,C[P+4],m,1272893353);W=D(W,V,Y,X,C[P+7],l,4139469664);X=D(X,W,V,Y,C[P+10],j,3200236656);Y=D(Y,X,W,V,C[P+13],o,681279174);V=D(V,Y,X,W,C[P+0],m,3936430074);W=D(W,V,Y,X,C[P+3],l,3572445317);X=D(X,W,V,Y,C[P+6],j,76029189);Y=D(Y,X,W,V,C[P+9],o,3654602809);V=D(V,Y,X,W,C[P+12],m,3873151461);W=D(W,V,Y,X,C[P+15],l,530742520);X=D(X,W,V,Y,C[P+2],j,3299628645);Y=t(Y,X,W,V,C[P+0],U,4096336452);V=t(V,Y,X,W,C[P+7],T,1126891415);W=t(W,V,Y,X,
C[P+14],R,2878612391);X=t(X,W,V,Y,C[P+5],O,4237533241);Y=t(Y,X,W,V,C[P+12],U,1700485571);V=t(V,Y,X,W,C[P+3],T,2399980690);W=t(W,V,Y,X,C[P+10],R,4293915773);X=t(X,W,V,Y,C[P+1],O,2240044497);Y=t(Y,X,W,V,C[P+8],U,1873313359);V=t(V,Y,X,W,C[P+15],T,4264355552);W=t(W,V,Y,X,C[P+6],R,2734768916);X=t(X,W,V,Y,C[P+13],O,1309151649);Y=t(Y,X,W,V,C[P+4],U,4149444226);V=t(V,Y,X,W,C[P+11],T,3174756917);W=t(W,V,Y,X,C[P+2],R,718787259);X=t(X,W,V,Y,C[P+9],O,3951481745);Y=K(Y,h);X=K(X,E);W=K(W,v);V=K(V,g)}var i=B(Y)+
B(X)+B(W)+B(V);return i.toLowerCase()};var hash=MD5(email);var size=size||80;return"<div class='a-gravitar-default-"+size+"'><img alt='' style='display:none' onload='this.style.display=\"inline\";' src='"+gravatar_api_url(hash,hbHelperVars.isSSL)+".jpg?rating=PG&size="+size+"&default=javascript:void(0)'/></div>"});Handlebars.registerHelper("translate",function(full_key,o){hash={};for(var propertyName in this)hash[propertyName]=this[propertyName];hash["count"]=o;return I18n.translate(full_key,hash)});
Handlebars.registerHelper("translateAndTruncate",function(full_key,len,o){hash={};for(var propertyName in this)hash[propertyName]=this[propertyName];hash["count"]=o;var str=I18n.translate(full_key,hash);if(str.length>len){str=str.substr(0,parseInt(len)+1);str=$.trim(str)+"..."}return str});
Handlebars.registerHelper("generateDefaultTemplateTag",function(id){defaultid=$(".a-template-list").attr("data-default-id");if(id==defaultid)return"<span class='a-tag a-default'>"+I18n.translate("admin.templates.default")+"</span>"});Handlebars.registerHelper("formatDate",function(date,formatType){try{return dateFormat(date,formatType)}catch(e){var d=date.match(/^(\d{4})-(\d{2})-(\d{2})T/i);return dateFormat(d[2]+"/"+d[3]+"/"+d[1],formatType)}});
Handlebars.registerHelper("convertAmountInCentsToCurrency",function(amountInCents){if(amountInCents==0)return(0).toFixed(2);else return(amountInCents/100).toFixed(2)});Handlebars.registerHelper("debug",function(optionalValue){console.log("Current Context");console.log("====================");console.log(this);if(optionalValue){console.log("Value");console.log("====================");console.log(optionalValue)}});
Handlebars.registerHelper("ifeq",function(a,b,options){if(typeof a==="undefined"||typeof a==="undefined")return false;if(a==b)return options.fn(this)});
Handlebars.registerHelper("ifCond",function(v1,operator,v2,options){switch(operator){case "==":return v1==v2?options.fn(this):options.inverse(this);case "===":return v1===v2?options.fn(this):options.inverse(this);case "<":return v1<v2?options.fn(this):options.inverse(this);case "<=":return v1<=v2?options.fn(this):options.inverse(this);case ">":return v1>v2?options.fn(this):options.inverse(this);case ">=":return v1>=v2?options.fn(this):options.inverse(this);case "&&":return v1&&v2?options.fn(this):
options.inverse(this);case "||":return v1||v2?options.fn(this):options.inverse(this);default:return options.inverse(this)}});Handlebars.registerHelper("timeago",function(time){if(typeof time==="undefined")return false;if(time!=null){return"<span class='timeago' title='"+time+"'>"+(new Date(time)).toUTCString();+"</span>"}});
Handlebars.registerHelper("exportStatus",function(status_id,obj_id){if(typeof status_id==="undefined"||typeof obj_id==="undefined")return false;switch(status_id){case "queued":return"<span class='queue-link'>"+I18n.translate("agent.case_exports.status.queued")+"<a href='/agent/case_exports/"+obj_id+"' data-obj-id='"+obj_id+"'>"+I18n.translate("agent.case_exports.cancel_export")+"</a></span>";case "processing":return I18n.translate("agent.case_exports.status.processing");case "download":return"<a class='download-link' href='/agent/case_exports/"+
obj_id+"' target='_blank'>"+I18n.translate("agent.case_exports.status.download")+"</a>"}});Handlebars.registerHelper("exportMoreHelper",function(filter_len,exp_len){if(typeof filter_len==="undefined"||typeof exp_len==="undefined")return false;if(exp_len.split(",").length<parseInt(filter_len.replace(/\D/gi,"")))return I18n.translate("agent.case_exports.export_all_cases")});
Handlebars.registerHelper("generateCustomerFeedbackImagePath",function(rating,ratingType,size){var base=hbHelperVars.assetPath+"rating_type"+ratingType+"_"+rating;if(size)base+="x"+size;return base+".png"});Handlebars.registerHelper("img",function(imgPath){var img=$("<img/>",{src:IMAGES_ROOT+imgPath}),html=img.get(0).outerHTML;return new Handlebars.SafeString(html)});Handlebars.registerHelper("imgPath",function(imgPath){return new Handlebars.SafeString(IMAGES_ROOT+imgPath)});
(function(){this.AssistlyHB||(this.AssistlyHB={});this.AssistlyHB["agent/achievements"]=Handlebars.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[2,">= 1.0.0-rc.3"];helpers=helpers||Handlebars.helpers;data=data||{};var buffer="",stack1,stack2,options,functionType="function",escapeExpression=this.escapeExpression,helperMissing=helpers.helperMissing,self=this;function program1(depth0,data){var buffer="",stack1;buffer+='\n        <li class="achievement ';stack1=helpers["if"].call(depth0,
depth0.unlocked,{hash:{},inverse:self.program(4,program4,data),fn:self.program(2,program2,data),data:data});if(stack1||stack1===0)buffer+=stack1;buffer+='">\n          <span class="achievement-icon ';if(stack1=helpers.icon)stack1=stack1.call(depth0,{hash:{},data:data});else{stack1=depth0.icon;stack1=typeof stack1===functionType?stack1.apply(depth0):stack1}buffer+=escapeExpression(stack1)+'"></span>\n          <strong>\n            ';if(stack1=helpers.title)stack1=stack1.call(depth0,{hash:{},data:data});
else{stack1=depth0.title;stack1=typeof stack1===functionType?stack1.apply(depth0):stack1}buffer+=escapeExpression(stack1)+"\n            ";stack1=helpers["if"].call(depth0,depth0.count,{hash:{},inverse:self.noop,fn:self.program(6,program6,data),data:data});if(stack1||stack1===0)buffer+=stack1;buffer+="\n          </strong>\n          <p>";if(stack1=helpers.message)stack1=stack1.call(depth0,{hash:{},data:data});else{stack1=depth0.message;stack1=typeof stack1===functionType?stack1.apply(depth0):stack1}buffer+=
escapeExpression(stack1)+'</p>\n          <span class="status">\n            ';stack1=helpers["if"].call(depth0,depth0.unlocked,{hash:{},inverse:self.program(10,program10,data),fn:self.program(8,program8,data),data:data});if(stack1||stack1===0)buffer+=stack1;buffer+="\n          </span>\n        </li>\n      ";return buffer}function program2(depth0,data){return"unlocked"}function program4(depth0,data){return"locked"}function program6(depth0,data){var buffer="",stack1;buffer+='\n              <span class="multiplier count';
if(stack1=helpers.count)stack1=stack1.call(depth0,{hash:{},data:data});else{stack1=depth0.count;stack1=typeof stack1===functionType?stack1.apply(depth0):stack1}buffer+=escapeExpression(stack1)+'">x';if(stack1=helpers.count)stack1=stack1.call(depth0,{hash:{},data:data});else{stack1=depth0.count;stack1=typeof stack1===functionType?stack1.apply(depth0):stack1}buffer+=escapeExpression(stack1)+"</span>\n            ";return buffer}function program8(depth0,data){var buffer="",stack1,options;buffer+="\n              ";
options={hash:{},data:data};buffer+=escapeExpression((stack1=helpers.translate,stack1?stack1.call(depth0,"agent.achievements.status.unlocked",options):helperMissing.call(depth0,"translate","agent.achievements.status.unlocked",options)))+"\n            ";return buffer}function program10(depth0,data){var buffer="",stack1,options;buffer+="\n              ";options={hash:{},data:data};buffer+=escapeExpression((stack1=helpers.translate,stack1?stack1.call(depth0,"agent.achievements.status.locked",options):
helperMissing.call(depth0,"translate","agent.achievements.status.locked",options)))+"\n            ";return buffer}buffer+='<div id="achievements_modal" class="a-modal-content">\n  <span class="a-modal-x">\n    <a href="#"><img alt="Growl-modal-close" src="https://cdn.desk.com/assets/growl-modal-close-062e0b8c961061148edf952c1cbd3f57.png" /></a>\n  </span>\n  <div class="a-modal-top">\n    <div class="a-modal-title">';options={hash:{},data:data};buffer+=escapeExpression((stack1=helpers.translate,
stack1?stack1.call(depth0,"agent.achievements.title",options):helperMissing.call(depth0,"translate","agent.achievements.title",options)))+'</div>\n    <ul class="a-pill-navigation">\n      <li class="active" data-filter="all">\n        <a href="#">';options={hash:{},data:data};buffer+=escapeExpression((stack1=helpers.translate,stack1?stack1.call(depth0,"agent.achievements.filter.all",options):helperMissing.call(depth0,"translate","agent.achievements.filter.all",options)))+'</a>\n      </li>\n      <li data-filter="unlocked">\n        <a href="#">';
options={hash:{},data:data};buffer+=escapeExpression((stack1=helpers.translate,stack1?stack1.call(depth0,"agent.achievements.filter.unlocked",options):helperMissing.call(depth0,"translate","agent.achievements.filter.unlocked",options)))+'</a>\n      </li>\n      <li data-filter="locked">\n        <a href="#">';options={hash:{},data:data};buffer+=escapeExpression((stack1=helpers.translate,stack1?stack1.call(depth0,"agent.achievements.filter.locked",options):helperMissing.call(depth0,"translate","agent.achievements.filter.locked",
options)))+'</a>\n      </li>\n    </ul>\n  </div>\n  <div class="a-modal-body">\n    <ul class="achievements">\n      ';stack2=helpers.each.call(depth0,depth0,{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data});if(stack2||stack2===0)buffer+=stack2;buffer+="\n    </ul>\n  </div>\n</div>\n";return buffer});return this.AssistlyHB["agent/achievements"]}).call(this);
(function(){this.AssistlyHB||(this.AssistlyHB={});this.AssistlyHB["agent/case_exports/confirm_export"]=Handlebars.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[2,">= 1.0.0-rc.3"];helpers=helpers||Handlebars.helpers;data=data||{};var buffer="",stack1,stack2,options,helperMissing=helpers.helperMissing,escapeExpression=this.escapeExpression,self=this,functionType="function";function program1(depth0,data){var buffer="",stack1,options;buffer+="\n\t<p>";options={hash:{},
data:data};buffer+=escapeExpression((stack1=helpers.exportMoreHelper,stack1?stack1.call(depth0,depth0.filter_len,(stack1=depth0.query,stack1==null||stack1===false?stack1:stack1.ticket_ids),options):helperMissing.call(depth0,"exportMoreHelper",depth0.filter_len,(stack1=depth0.query,stack1==null||stack1===false?stack1:stack1.ticket_ids),options)))+"</p>\n";return buffer}buffer+='<p class="export-count">';options={hash:{},data:data};stack2=(stack1=helpers.translate,stack1?stack1.call(depth0,"agent.case_exports.case_count",
(stack1=depth0.data,stack1==null||stack1===false?stack1:stack1.export_case_count),options):helperMissing.call(depth0,"translate","agent.case_exports.case_count",(stack1=depth0.data,stack1==null||stack1===false?stack1:stack1.export_case_count),options));if(stack2||stack2===0)buffer+=stack2;buffer+="</p>\n";stack2=helpers["if"].call(depth0,depth0.all_selected,{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data});if(stack2||stack2===0)buffer+=stack2;buffer+="\n\t<p>";options={hash:{},
data:data};stack2=(stack1=helpers.translate,stack1?stack1.call(depth0,"agent.case_exports.confirm_export.message",options):helperMissing.call(depth0,"translate","agent.case_exports.confirm_export.message",options));if(stack2||stack2===0)buffer+=stack2;buffer+='</p>\n<p>\n\t<input type="hidden" name="ticket_ids" value="'+escapeExpression((stack1=(stack1=depth0.data,stack1==null||stack1===false?stack1:stack1.ticket_ids),typeof stack1===functionType?stack1.apply(depth0):stack1))+'"/>\n\t<input type="hidden" name="search" value="'+
escapeExpression((stack1=(stack1=depth0.data,stack1==null||stack1===false?stack1:stack1.search),typeof stack1===functionType?stack1.apply(depth0):stack1))+'"/>\n\t<input type="hidden" name="ticket_filter" value="'+escapeExpression((stack1=(stack1=depth0.data,stack1==null||stack1===false?stack1:stack1.ticket_filter),typeof stack1===functionType?stack1.apply(depth0):stack1))+'"/>\n\t';options={hash:{},data:data};buffer+=escapeExpression((stack1=helpers.translate,stack1?stack1.call(depth0,"agent.case_exports.confirm_export.notify_check",
options):helperMissing.call(depth0,"translate","agent.case_exports.confirm_export.notify_check",options)))+' <span class="a-tooltip" rel=\'';options={hash:{},data:data};buffer+=escapeExpression((stack1=helpers.translate,stack1?stack1.call(depth0,"agent.case_exports.confirm_export.tooltip",options):helperMissing.call(depth0,"translate","agent.case_exports.confirm_export.tooltip",options)))+'\'>(?)</span> <input type="checkbox" checked=\'false\' name=\'notify_on_complete\'/>\n</p>\n<div class="input button">\n\t<button class="a-button" id="export_cases_button" type="button">';
options={hash:{},data:data};buffer+=escapeExpression((stack1=helpers.translate,stack1?stack1.call(depth0,"agent.case_exports.confirm_export.button",options):helperMissing.call(depth0,"translate","agent.case_exports.confirm_export.button",options)))+"</button>\n</div>\n";return buffer});return this.AssistlyHB["agent/case_exports/confirm_export"]}).call(this);
(function(){this.AssistlyHB||(this.AssistlyHB={});this.AssistlyHB["agent/case_exports/download"]=Handlebars.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[2,">= 1.0.0-rc.3"];helpers=helpers||Handlebars.helpers;data=data||{};var buffer="",stack1,functionType="function",escapeExpression=this.escapeExpression,helperMissing=helpers.helperMissing,self=this;function program1(depth0,data){var buffer="",stack1,stack2,options;buffer+='\n\t<div class="a-modal-scrollable a-scroll">\n\t\t<table class="a-modal-table">\n\t\t\t<thead>\n\t\t\t\t<tr>\n\t\t\t\t\t<th>Request</th>\n\t\t\t\t\t<th>Sent</th>\n\t\t\t\t\t<th>Expires</th>\n\t\t\t\t\t<th>Status</th>\n\t\t\t\t</tr>\n\t\t\t</thead>\n\t\t\t';
stack1=helpers.each.call(depth0,depth0.data,{hash:{},inverse:self.noop,fn:self.program(2,program2,data),data:data});if(stack1||stack1===0)buffer+=stack1;buffer+='\n\t\t\t<tbody>\n\t\t\t</tbody>\n\t\t</table>\n\t</div>\n\t<div class="a-footer-note">\n\t\t';options={hash:{},data:data};stack2=(stack1=helpers.translate,stack1?stack1.call(depth0,"agent.case_exports.footer_note",options):helperMissing.call(depth0,"translate","agent.case_exports.footer_note",options));if(stack2||stack2===0)buffer+=stack2;
buffer+="\n\t</div>\n";return buffer}function program2(depth0,data){var buffer="",stack1,stack2,options;buffer+='\n\t\t\t\t<tr data-row-id="';if(stack1=helpers.id)stack1=stack1.call(depth0,{hash:{},data:data});else{stack1=depth0.id;stack1=typeof stack1===functionType?stack1.apply(depth0):stack1}buffer+=escapeExpression(stack1)+'">\n\t\t\t\t\t<td>';if(stack1=helpers.request)stack1=stack1.call(depth0,{hash:{},data:data});else{stack1=depth0.request;stack1=typeof stack1===functionType?stack1.apply(depth0):
stack1}buffer+=escapeExpression(stack1)+"</td>\n\t\t\t\t\t<td>";options={hash:{},data:data};stack2=(stack1=helpers.timeago,stack1?stack1.call(depth0,depth0.sent,options):helperMissing.call(depth0,"timeago",depth0.sent,options));if(stack2||stack2===0)buffer+=stack2;buffer+="</td>\n\t\t\t\t\t<td>";options={hash:{},data:data};stack2=(stack1=helpers.timeago,stack1?stack1.call(depth0,depth0.expires,options):helperMissing.call(depth0,"timeago",depth0.expires,options));if(stack2||stack2===0)buffer+=stack2;
buffer+="</td>\n\t\t\t\t\t<td>";options={hash:{},data:data};stack2=(stack1=helpers.exportStatus,stack1?stack1.call(depth0,depth0.status,depth0.id,options):helperMissing.call(depth0,"exportStatus",depth0.status,depth0.id,options));if(stack2||stack2===0)buffer+=stack2;buffer+="</td>\n\t\t\t\t</tr>\n\t\t\t";return buffer}stack1=helpers["if"].call(depth0,depth0.data,{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data});if(stack1||stack1===0)buffer+=stack1;buffer+="\n";return buffer});
return this.AssistlyHB["agent/case_exports/download"]}).call(this);
(function(){this.AssistlyHB||(this.AssistlyHB={});this.AssistlyHB["agent/case_exports/export_too_big"]=Handlebars.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[2,">= 1.0.0-rc.3"];helpers=helpers||Handlebars.helpers;data=data||{};var buffer="",stack1,stack2,options,helperMissing=helpers.helperMissing;buffer+='<p class="export-count">';options={hash:{},data:data};stack2=(stack1=helpers.translate,stack1?stack1.call(depth0,"agent.case_exports.case_count",(stack1=depth0.data,
stack1==null||stack1===false?stack1:stack1.export_case_count),options):helperMissing.call(depth0,"translate","agent.case_exports.case_count",(stack1=depth0.data,stack1==null||stack1===false?stack1:stack1.export_case_count),options));if(stack2||stack2===0)buffer+=stack2;buffer+='</p>\n<div class="warning_box">\n\t';options={hash:{},data:data};stack2=(stack1=helpers.translate,stack1?stack1.call(depth0,"agent.case_exports.warning.export_too_big",(stack1=depth0.data,stack1==null||stack1===false?stack1:
stack1.export_case_limit),options):helperMissing.call(depth0,"translate","agent.case_exports.warning.export_too_big",(stack1=depth0.data,stack1==null||stack1===false?stack1:stack1.export_case_limit),options));if(stack2||stack2===0)buffer+=stack2;buffer+="\n</div>\n";return buffer});return this.AssistlyHB["agent/case_exports/export_too_big"]}).call(this);
(function(){this.AssistlyHB||(this.AssistlyHB={});this.AssistlyHB["agent/case_exports/loading"]=Handlebars.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[2,">= 1.0.0-rc.3"];helpers=helpers||Handlebars.helpers;data=data||{};var buffer="",stack1,stack2,options,helperMissing=helpers.helperMissing,escapeExpression=this.escapeExpression,self=this;function program1(depth0,data){return" active "}buffer+='<div id="case_exports_modal" class="a-modal-content">\n\n  <span class="a-modal-x">\n    <a href="#">\n      <img alt="Growl-modal-close" src="https://cdn.desk.com/assets/growl-modal-close-062e0b8c961061148edf952c1cbd3f57.png" />\n    </a>\n  </span>\n\n\t<div class="a-modal-top">\n  \t<div class="a-modal-title">';
options={hash:{},data:data};buffer+=escapeExpression((stack1=helpers.translate,stack1?stack1.call(depth0,"agent.case_exports.title",options):helperMissing.call(depth0,"translate","agent.case_exports.title",options)))+'</div>\n    <ul class="a-pill-navigation">\n      <li class="agent_settings_menu_item request-nav-button ';options={hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data};stack2=(stack1=helpers.ifeq,stack1?stack1.call(depth0,depth0.req_type,"request",options):helperMissing.call(depth0,
"ifeq",depth0.req_type,"request",options));if(stack2||stack2===0)buffer+=stack2;buffer+='">\n        <a class="a-case-export-request-link active-link">';options={hash:{},data:data};buffer+=escapeExpression((stack1=helpers.translate,stack1?stack1.call(depth0,"agent.case_exports.nav_buttons.request",options):helperMissing.call(depth0,"translate","agent.case_exports.nav_buttons.request",options)))+'</a>\n      </li>\n      <li class="agent_settings_menu_item download-nav-button ';options={hash:{},inverse:self.noop,
fn:self.program(1,program1,data),data:data};stack2=(stack1=helpers.ifeq,stack1?stack1.call(depth0,depth0.req_type,"download",options):helperMissing.call(depth0,"ifeq",depth0.req_type,"download",options));if(stack2||stack2===0)buffer+=stack2;buffer+='">\n        <a class="a-case-exports-link active-link">';options={hash:{},data:data};buffer+=escapeExpression((stack1=helpers.translate,stack1?stack1.call(depth0,"agent.case_exports.nav_buttons.download",options):helperMissing.call(depth0,"translate",
"agent.case_exports.nav_buttons.download",options)))+'</a>\n      </li>\n    </ul>\n\t</div>\n\n\t<div class="a-modal-body">\n\t\t <div class="a-spinner-wrapper">\n      <img alt="Ajax-loader-big" height="54" src="https://cdn.desk.com/assets/ajax-loader-big-60a8643356fe28ca83c537422e2be289.gif" width="55" />\n\t\t</div>\n    <div class="a-download-container"/>\n    <div class="a-request-container"/>\n\t</div>\n</div>\n';return buffer});return this.AssistlyHB["agent/case_exports/loading"]}).call(this);
(function(){this.AssistlyHB||(this.AssistlyHB={});this.AssistlyHB["agent/case_exports/no_cases_selected"]=Handlebars.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[2,">= 1.0.0-rc.3"];helpers=helpers||Handlebars.helpers;data=data||{};var buffer="",stack1,options,helperMissing=helpers.helperMissing,escapeExpression=this.escapeExpression;options={hash:{},data:data};buffer+=escapeExpression((stack1=helpers.translate,stack1?stack1.call(depth0,"agent.case_exports.no_cases_selected",
options):helperMissing.call(depth0,"translate","agent.case_exports.no_cases_selected",options)))+"\n";return buffer});return this.AssistlyHB["agent/case_exports/no_cases_selected"]}).call(this);
(function(){this.AssistlyHB||(this.AssistlyHB={});this.AssistlyHB["agent/case_exports/queue_full"]=Handlebars.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[2,">= 1.0.0-rc.3"];helpers=helpers||Handlebars.helpers;data=data||{};var buffer="",stack1,stack2,options,helperMissing=helpers.helperMissing;buffer+='<p class="export-count">';options={hash:{},data:data};stack2=(stack1=helpers.translate,stack1?stack1.call(depth0,"agent.case_exports.case_count",(stack1=depth0.data,
stack1==null||stack1===false?stack1:stack1.export_case_count),options):helperMissing.call(depth0,"translate","agent.case_exports.case_count",(stack1=depth0.data,stack1==null||stack1===false?stack1:stack1.export_case_count),options));if(stack2||stack2===0)buffer+=stack2;buffer+='</p>\n<div class="warning_box">\n\t';options={hash:{},data:data};stack2=(stack1=helpers.translate,stack1?stack1.call(depth0,"agent.case_exports.warning.queue_full",(stack1=depth0.data,stack1==null||stack1===false?stack1:stack1.export_queue_count),
options):helperMissing.call(depth0,"translate","agent.case_exports.warning.queue_full",(stack1=depth0.data,stack1==null||stack1===false?stack1:stack1.export_queue_count),options));if(stack2||stack2===0)buffer+=stack2;buffer+="\n</div>\n";return buffer});return this.AssistlyHB["agent/case_exports/queue_full"]}).call(this);
(function(){this.AssistlyHB||(this.AssistlyHB={});this.AssistlyHB["agent/case_histories/ticket"]=Handlebars.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[2,">= 1.0.0-rc.3"];helpers=helpers||Handlebars.helpers;data=data||{};var buffer="",stack1,helperMissing=helpers.helperMissing,escapeExpression=this.escapeExpression,functionType="function",self=this;function program1(depth0,data){var buffer="",stack1,stack2,options;buffer+='\n  <div class="a-search-results-item" data-ticket-id="';
if(stack1=helpers.ticket_id)stack1=stack1.call(depth0,{hash:{},data:data});else{stack1=depth0.ticket_id;stack1=typeof stack1===functionType?stack1.apply(depth0):stack1}buffer+=escapeExpression(stack1)+'">\n    <div class="a-item-arrow" data-action="expand"></div>\n    <div class="a-search-results-item-main" data-action="expand">\n      <div class="a-metadata-actions" data-action="expand">\n        <div class="a-metadata">\n          <img alt="" class="agent_icon_button" height="20" src="https://cdn.desk.com/assets/ticket/a-open-1b10e8c47700b0a697fc529ea05222b8.png" width="20" />\n          <a href="';
if(stack1=helpers.open_url)stack1=stack1.call(depth0,{hash:{},data:data});else{stack1=depth0.open_url;stack1=typeof stack1===functionType?stack1.apply(depth0):stack1}buffer+=escapeExpression(stack1)+'" data-remote="true">';options={hash:{},data:data};buffer+=escapeExpression((stack1=helpers.translate,stack1?stack1.call(depth0,"agent.case.history.open",options):helperMissing.call(depth0,"translate","agent.case.history.open",options)))+'</a>\n        </div>\n      </div>\n      <div class="a-item-data a-ellipsis">\n        <img src="';
options={hash:{},data:data};buffer+=escapeExpression((stack1=helpers.interactionIcon,stack1?stack1.call(depth0,depth0.interaction_type,options):helperMissing.call(depth0,"interactionIcon",depth0.interaction_type,options)))+'", class="agent_icon_button" alt="" />\n        <span class="a-item-subject">';options={hash:{},data:data};buffer+=escapeExpression((stack1=helpers.autolink,stack1?stack1.call(depth0,depth0.subject,options):helperMissing.call(depth0,"autolink",depth0.subject,options)))+'</span>\n      </div>\n      <div class="a-search-results-metadata">\n        <div class="metadata ticket_filter_item_status_box ticket_filter_item_status_box_';
if(stack2=helpers.raw_status)stack2=stack2.call(depth0,{hash:{},data:data});else{stack2=depth0.raw_status;stack2=typeof stack2===functionType?stack2.apply(depth0):stack2}buffer+=escapeExpression(stack2)+'">\n          <span>';if(stack2=helpers.status)stack2=stack2.call(depth0,{hash:{},data:data});else{stack2=depth0.status;stack2=typeof stack2===functionType?stack2.apply(depth0):stack2}buffer+=escapeExpression(stack2)+'</span>\n        </div>\n        <div class="metadata">\n          <label>';options=
{hash:{},data:data};buffer+=escapeExpression((stack1=helpers.translate,stack1?stack1.call(depth0,"agent.case.history.priority",options):helperMissing.call(depth0,"translate","agent.case.history.priority",options)))+":</label>\n          <span>";if(stack2=helpers.priority)stack2=stack2.call(depth0,{hash:{},data:data});else{stack2=depth0.priority;stack2=typeof stack2===functionType?stack2.apply(depth0):stack2}buffer+=escapeExpression(stack2)+'</span>\n        </div>\n        <div class="metadata">\n          <label>';
options={hash:{},data:data};buffer+=escapeExpression((stack1=helpers.translate,stack1?stack1.call(depth0,"agent.case.history.case",options):helperMissing.call(depth0,"translate","agent.case.history.case",options)))+":</label>\n          <span>";if(stack2=helpers.display_id)stack2=stack2.call(depth0,{hash:{},data:data});else{stack2=depth0.display_id;stack2=typeof stack2===functionType?stack2.apply(depth0):stack2}buffer+=escapeExpression(stack2)+'</span>\n        </div>\n        <div class="metadata">\n          <label>';
options={hash:{},data:data};buffer+=escapeExpression((stack1=helpers.translate,stack1?stack1.call(depth0,"agent.case.history.group",options):helperMissing.call(depth0,"translate","agent.case.history.group",options)))+":</label>\n          <span>";options={hash:{},data:data};buffer+=escapeExpression((stack1=helpers.groupName,stack1?stack1.call(depth0,depth0.group_id,options):helperMissing.call(depth0,"groupName",depth0.group_id,options)))+'</span>\n        </div>\n        <div class="metadata">\n          <label>';
options={hash:{},data:data};buffer+=escapeExpression((stack1=helpers.translate,stack1?stack1.call(depth0,"agent.case.history.created",options):helperMissing.call(depth0,"translate","agent.case.history.created",options)))+":</label>\n          <span>";if(stack2=helpers.created_at)stack2=stack2.call(depth0,{hash:{},data:data});else{stack2=depth0.created_at;stack2=typeof stack2===functionType?stack2.apply(depth0):stack2}buffer+=escapeExpression(stack2)+'</span>\n        </div>\n        <div class="metadata">\n          <label>';
options={hash:{},data:data};buffer+=escapeExpression((stack1=helpers.translate,stack1?stack1.call(depth0,"agent.case.history.updated",options):helperMissing.call(depth0,"translate","agent.case.history.updated",options)))+':</label>\n          <span title="';if(stack2=helpers.updated)stack2=stack2.call(depth0,{hash:{},data:data});else{stack2=depth0.updated;stack2=typeof stack2===functionType?stack2.apply(depth0):stack2}buffer+=escapeExpression(stack2)+'" data-type="time">';if(stack2=helpers.updated)stack2=
stack2.call(depth0,{hash:{},data:data});else{stack2=depth0.updated;stack2=typeof stack2===functionType?stack2.apply(depth0):stack2}buffer+=escapeExpression(stack2)+'</span>\n        </div>\n        <div class="metadata">\n          <label>';options={hash:{},data:data};buffer+=escapeExpression((stack1=helpers.translate,stack1?stack1.call(depth0,"agent.case.history.assigned",options):helperMissing.call(depth0,"translate","agent.case.history.assigned",options)))+":</label>\n          <span>\n          ";
stack2=helpers["if"].call(depth0,depth0.user_id,{hash:{},inverse:self.program(4,program4,data),fn:self.program(2,program2,data),data:data});if(stack2||stack2===0)buffer+=stack2;buffer+="\n          </span>\n        </div>\n\n        ";stack2=helpers["if"].call(depth0,depth0.labels,{hash:{},inverse:self.noop,fn:self.program(6,program6,data),data:data});if(stack2||stack2===0)buffer+=stack2;buffer+='\n      </div>\n    </div>\n\n    <div class="interaction">\n      <div class="a-spinner-center"><img alt="Ajax-loader-big" src="https://cdn.desk.com/assets/ajax-loader-big-60a8643356fe28ca83c537422e2be289.gif" /></div>\n    </div>\n  </div>\n';
return buffer}function program2(depth0,data){var buffer="",stack1,options;buffer+='\n            <span class="a-user-icon sm"><img src="';options={hash:{},data:data};buffer+=escapeExpression((stack1=helpers.gravatar,stack1?stack1.call(depth0,depth0.user_id,"16",options):helperMissing.call(depth0,"gravatar",depth0.user_id,"16",options)))+'" class="gravatar gravatar-vert-align"></span>\n            ';options={hash:{},data:data};buffer+=escapeExpression((stack1=helpers.userName,stack1?stack1.call(depth0,
depth0.user_id,options):helperMissing.call(depth0,"userName",depth0.user_id,options)))+"\n          ";return buffer}function program4(depth0,data){var buffer="",stack1,options;buffer+="\n            ";options={hash:{},data:data};buffer+=escapeExpression((stack1=helpers.translate,stack1?stack1.call(depth0,"agent.case.history.unassigned",options):helperMissing.call(depth0,"translate","agent.case.history.unassigned",options)))+"\n          ";return buffer}function program6(depth0,data){var buffer="",
stack1,options;buffer+='\n          <div class="metadata a-metadata-labels">\n            <div>\n              <ul class="a-labels">\n                ';options={hash:{},data:data};buffer+=escapeExpression((stack1=helpers.ticketFilterLabelIdsToSortedLabelNames,stack1?stack1.call(depth0,depth0,options):helperMissing.call(depth0,"ticketFilterLabelIdsToSortedLabelNames",depth0,options)))+"\n              </ul>\n            </div>\n          </div>\n        ";return buffer}stack1=helpers.each.call(depth0,
depth0.tickets,{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data});if(stack1||stack1===0)buffer+=stack1;buffer+="\n\n";if(stack1=helpers.pagination)stack1=stack1.call(depth0,{hash:{},data:data});else{stack1=depth0.pagination;stack1=typeof stack1===functionType?stack1.apply(depth0):stack1}if(stack1||stack1===0)buffer+=stack1;buffer+="\n";return buffer});return this.AssistlyHB["agent/case_histories/ticket"]}).call(this);
(function(){this.AssistlyHB||(this.AssistlyHB={});this.AssistlyHB["agent/companies/field_domain"]=Handlebars.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[2,">= 1.0.0-rc.3"];helpers=helpers||Handlebars.helpers;data=data||{};var buffer="",stack1,stack2,options,helperMissing=helpers.helperMissing,escapeExpression=this.escapeExpression,functionType="function";buffer+='<div class="agent_company_section short org_section">\n  <span class="agent_company_section_label">';
options={hash:{},data:data};buffer+=escapeExpression((stack1=helpers.translate,stack1?stack1.call(depth0,"agent.company.labels.org",options):helperMissing.call(depth0,"translate","agent.company.labels.org",options)))+'</span>\n  <div class="agent_company_section_data">\n    <input type="text" name="company_domains_attributes[';if(stack2=helpers.id)stack2=stack2.call(depth0,{hash:{},data:data});else{stack2=depth0.id;stack2=typeof stack2===functionType?stack2.apply(depth0):stack2}buffer+=escapeExpression(stack2)+
'][domain]" class="default company_record_input_field" autocomplete="off" />\n    <a href="#" class="remove_domain"><img alt="Cancel16" src="https://cdn.desk.com/assets/cancel16-8ab1afb1a49a86918afea7a70224ede9.png" /></a>\n    <span class="agent_company_section_error">';options={hash:{},data:data};buffer+=escapeExpression((stack1=helpers.translate,stack1?stack1.call(depth0,"agent.company.labels.invalid",options):helperMissing.call(depth0,"translate","agent.company.labels.invalid",options)))+"</span>\n  </div>\n</div>\n";
return buffer});return this.AssistlyHB["agent/companies/field_domain"]}).call(this);
(function(){this.AssistlyHB||(this.AssistlyHB={});this.AssistlyHB["agent/customers/new_salesforce_contact"]=Handlebars.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[2,">= 1.0.0-rc.3"];helpers=helpers||Handlebars.helpers;data=data||{};var buffer="",stack1,functionType="function",escapeExpression=this.escapeExpression;buffer+="<h3>Salesforce Contact</h3>\n<div class=\"options\">\n  <div class='no-contact-or-lead'>\n    This contact does not exist in Salesforce.com.\n  </div>\n  <div class=\"input button\">\n    <button class='sf-widget-add-as-lead'>Add as a Lead</button>\n    <button class='sf-widget-add-as-contact' data-attr-accid='";if(stack1=
helpers.sfdc_ext_acc_id)stack1=stack1.call(depth0,{hash:{},data:data});else{stack1=depth0.sfdc_ext_acc_id;stack1=typeof stack1===functionType?stack1.apply(depth0):stack1}buffer+=escapeExpression(stack1)+'\'>Add as a Contact</button>\n  </div>\n  <div class="a-modal-loader">\n    <img alt="Ajax-loader-big" src="https://cdn.desk.com/assets/ajax-loader-big-60a8643356fe28ca83c537422e2be289.gif" />\n  </div>\n</div>\n';return buffer});return this.AssistlyHB["agent/customers/new_salesforce_contact"]}).call(this);
(function(){this.AssistlyHB||(this.AssistlyHB={});this.AssistlyHB["agent/customers/new_salesforce_contact_success"]=Handlebars.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[2,">= 1.0.0-rc.3"];helpers=helpers||Handlebars.helpers;data=data||{};return"<h3>Salesforce Contact</h3>\n<div class=\"options\">\n  <div class='no-contact-or-lead'>\n    Contact has been Created.\n  </div>\n</div>\n"});return this.AssistlyHB["agent/customers/new_salesforce_contact_success"]}).call(this);
(function(){this.AssistlyHB||(this.AssistlyHB={});this.AssistlyHB["agent/customers/new_salesforce_contact_sync"]=Handlebars.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[2,">= 1.0.0-rc.3"];helpers=helpers||Handlebars.helpers;data=data||{};return'<h3>Salesforce Contact</h3>\n<div class="options">\n  <div class=\'no-contact-or-lead\'>\n    This contact does not exist in Salesforce.com.\n  </div>\n  <div class="a-modal-loader">\n    <img alt="Ajax-loader-big" src="https://cdn.desk.com/assets/ajax-loader-big-60a8643356fe28ca83c537422e2be289.gif" />\n  </div>\n</div>\n'});
return this.AssistlyHB["agent/customers/new_salesforce_contact_sync"]}).call(this);
(function(){this.AssistlyHB||(this.AssistlyHB={});this.AssistlyHB["agent/customers/new_salesforce_failure"]=Handlebars.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[2,">= 1.0.0-rc.3"];helpers=helpers||Handlebars.helpers;data=data||{};var buffer="",stack1,functionType="function",escapeExpression=this.escapeExpression;buffer+="<h3>Salesforce Creation Failure</h3>\n<div class=\"options\">\n  <div class='no-contact-or-lead'>\n    Unable to create ";if(stack1=helpers.type)stack1=
stack1.call(depth0,{hash:{},data:data});else{stack1=depth0.type;stack1=typeof stack1===functionType?stack1.apply(depth0):stack1}buffer+=escapeExpression(stack1)+".\n    <div>An error has occurred. Please contact your system administrator.</div>\n  </div>\n\n  <div class=\"input button\">\n    <button class='sf-widget-continue a-button'>Continue</button>\n  </div>\n\n</div>\n";return buffer});return this.AssistlyHB["agent/customers/new_salesforce_failure"]}).call(this);
(function(){this.AssistlyHB||(this.AssistlyHB={});this.AssistlyHB["agent/customers/new_salesforce_lead_success"]=Handlebars.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[2,">= 1.0.0-rc.3"];helpers=helpers||Handlebars.helpers;data=data||{};return"<h3>Salesforce Lead</h3>\n<div class=\"options\">\n  <div class='no-contact-or-lead'>\n    Lead has been Created.\n  </div>\n</div>\n"});return this.AssistlyHB["agent/customers/new_salesforce_lead_success"]}).call(this);
(function(){this.AssistlyHB||(this.AssistlyHB={});this.AssistlyHB["agent/customers/salesforce_account_search"]=Handlebars.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[2,">= 1.0.0-rc.3"];helpers=helpers||Handlebars.helpers;data=data||{};var buffer="",stack1,functionType="function",escapeExpression=this.escapeExpression;buffer+='<div id="salesforce_account_search_modal" class="a-modal-content">\n  <h3>';if(stack1=helpers.search_heading)stack1=stack1.call(depth0,{hash:{},
data:data});else{stack1=depth0.search_heading;stack1=typeof stack1===functionType?stack1.apply(depth0):stack1}buffer+=escapeExpression(stack1)+'</h3>\n  <div class="a-modal-top">\n    <form class="fancy-search-form">\n      <div class="input_wrapper">\n        <input type="text" class="default" placeholder=\'';if(stack1=helpers.search_placeholder)stack1=stack1.call(depth0,{hash:{},data:data});else{stack1=depth0.search_placeholder;stack1=typeof stack1===functionType?stack1.apply(depth0):stack1}buffer+=
escapeExpression(stack1)+'\' name="term" id="term" maxlength="40"/>\n        <button class="a-search-button" type="submit">\n          <span class="icon"></span>\n          <span class="text">';if(stack1=helpers.button_text)stack1=stack1.call(depth0,{hash:{},data:data});else{stack1=depth0.button_text;stack1=typeof stack1===functionType?stack1.apply(depth0):stack1}buffer+=escapeExpression(stack1)+'</span>\n        </button>\n      </div>\n    </form>\n  </div>\n\n  <div class="a-modal-loader">\n    <img alt="Ajax-loader-big" src="https://cdn.desk.com/assets/ajax-loader-big-60a8643356fe28ca83c537422e2be289.gif" />\n  </div>\n\n  <div class="a-modal-body">\n    <div class="search-instructions"><span class="bold">';
if(stack1=helpers.salesforce_company_note)stack1=stack1.call(depth0,{hash:{},data:data});else{stack1=depth0.salesforce_company_note;stack1=typeof stack1===functionType?stack1.apply(depth0):stack1}buffer+=escapeExpression(stack1)+'</span></div>\n    <div class="search-instructions">';if(stack1=helpers.search_instructions)stack1=stack1.call(depth0,{hash:{},data:data});else{stack1=depth0.search_instructions;stack1=typeof stack1===functionType?stack1.apply(depth0):stack1}buffer+=escapeExpression(stack1)+
'</div>\n    <div class="search-not-found">\n      <div>';if(stack1=helpers.account_not_found)stack1=stack1.call(depth0,{hash:{},data:data});else{stack1=depth0.account_not_found;stack1=typeof stack1===functionType?stack1.apply(depth0):stack1}buffer+=escapeExpression(stack1)+'</div>\n      <div class="search-add-lead">\n        <button class="sf-widget-add-as-lead a-button">';if(stack1=helpers.add_lead_button)stack1=stack1.call(depth0,{hash:{},data:data});else{stack1=depth0.add_lead_button;stack1=
typeof stack1===functionType?stack1.apply(depth0):stack1}buffer+=escapeExpression(stack1)+'</button>\n      </div>\n    </div>\n    <ul class="account_list"></ul>\n  </div>\n\n  <div class="a-modal-bottom">\n    <button class="a-button a-cancel-button">\n      <span class="icon"></span>\n      <span class="text ">';if(stack1=helpers.cancel_button)stack1=stack1.call(depth0,{hash:{},data:data});else{stack1=depth0.cancel_button;stack1=typeof stack1===functionType?stack1.apply(depth0):stack1}buffer+=
escapeExpression(stack1)+"</span>\n    </button>\n  </div>\n</div>\n";return buffer});return this.AssistlyHB["agent/customers/salesforce_account_search"]}).call(this);
(function(){this.AssistlyHB||(this.AssistlyHB={});this.AssistlyHB["agent/customers/salesforce_app_insufficient_information"]=Handlebars.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[2,">= 1.0.0-rc.3"];helpers=helpers||Handlebars.helpers;data=data||{};var buffer="",stack1,functionType="function",escapeExpression=this.escapeExpression;buffer+="<h3>Salesforce Creation Failure</h3>\n<div class=\"options\">\n  <div class='no-contact-or-lead'>\n    ";if(stack1=helpers.message)stack1=
stack1.call(depth0,{hash:{},data:data});else{stack1=depth0.message;stack1=typeof stack1===functionType?stack1.apply(depth0):stack1}buffer+=escapeExpression(stack1)+"\n    <div></div>\n  </div>\n</div>\n";return buffer});return this.AssistlyHB["agent/customers/salesforce_app_insufficient_information"]}).call(this);
(function(){this.AssistlyHB||(this.AssistlyHB={});this.AssistlyHB["agent/customers/salesforce_app_not_installed"]=Handlebars.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[2,">= 1.0.0-rc.3"];helpers=helpers||Handlebars.helpers;data=data||{};var buffer="",stack1,stack2,options,helperMissing=helpers.helperMissing,escapeExpression=this.escapeExpression,functionType="function";buffer+="<h3>Salesforce Creation Failure</h3>\n<div class=\"options\">\n  <div class='no-contact-or-lead'>\n    ";
options={hash:{},data:data};buffer+=escapeExpression((stack1=helpers.translate,stack1?stack1.call(depth0,"agent.app.salesforce.app_likely_not_installed_check",options):helperMissing.call(depth0,"translate","agent.app.salesforce.app_likely_not_installed_check",options)))+'<br>\n    <a href="';if(stack2=helpers.url)stack2=stack2.call(depth0,{hash:{},data:data});else{stack2=depth0.url;stack2=typeof stack2===functionType?stack2.apply(depth0):stack2}buffer+=escapeExpression(stack2)+'">';options={hash:{},
data:data};buffer+=escapeExpression((stack1=helpers.translate,stack1?stack1.call(depth0,"agent.app.salesforce.app_install_link",options):helperMissing.call(depth0,"translate","agent.app.salesforce.app_install_link",options)))+"</a><br>\n    ";options={hash:{},data:data};buffer+=escapeExpression((stack1=helpers.translate,stack1?stack1.call(depth0,"agent.app.salesforce.app_install_after",options):helperMissing.call(depth0,"translate","agent.app.salesforce.app_install_after",options)))+"\n  </div>\n</div>\n";
return buffer});return this.AssistlyHB["agent/customers/salesforce_app_not_installed"]}).call(this);
(function(){this.AssistlyHB||(this.AssistlyHB={});this.AssistlyHB["agent/keyboard_shortcuts"]=Handlebars.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[2,">= 1.0.0-rc.3"];helpers=helpers||Handlebars.helpers;data=data||{};var buffer="",stack1,stack2,options,helperMissing=helpers.helperMissing,escapeExpression=this.escapeExpression,self=this;function program1(depth0,data){var buffer="",stack1,options;buffer+="\n\t\t\t\t\t\t\t\t";options={hash:{},data:data};buffer+=escapeExpression((stack1=
helpers.translate,stack1?stack1.call(depth0,"agent.agents.keyboard_shortcuts.section.ticket_filter.shortcuts.open_with_switching.key.mac",options):helperMissing.call(depth0,"translate","agent.agents.keyboard_shortcuts.section.ticket_filter.shortcuts.open_with_switching.key.mac",options)))+"\n\t\t\t\t\t\t\t";return buffer}function program3(depth0,data){var buffer="",stack1,options;buffer+="\n\t\t\t\t\t\t\t\t";options={hash:{},data:data};buffer+=escapeExpression((stack1=helpers.translate,stack1?stack1.call(depth0,
"agent.agents.keyboard_shortcuts.section.ticket_filter.shortcuts.open_with_switching.key.other",options):helperMissing.call(depth0,"translate","agent.agents.keyboard_shortcuts.section.ticket_filter.shortcuts.open_with_switching.key.other",options)))+"\n\t\t\t\t\t\t\t";return buffer}buffer+='<div id="keyboard_shortcuts_modal" class="a-modal-content">\n\n  <span class="a-modal-x">\n    <a href="#"><img alt="Growl-modal-close" src="https://cdn.desk.com/assets/growl-modal-close-062e0b8c961061148edf952c1cbd3f57.png" /></a>\n  </span>\n\n  <div class="a-modal-top">\n    <div class="a-modal-title">';
options={hash:{},data:data};buffer+=escapeExpression((stack1=helpers.translate,stack1?stack1.call(depth0,"agent.agents.keyboard_shortcuts.title",options):helperMissing.call(depth0,"translate","agent.agents.keyboard_shortcuts.title",options)))+'</div>\n  </div>\n\n\t<div class="a-modal-body">\n\t\t<span style="font-weight:bold;color:grey;" id="kb_shortcuts_disabled"></span>\n\n\t\t<table>\n\t\t\t<tr>\n\t\t\t\t<td style="width:325px;">\n\n\t\t\t\t\t<div class="keyboard_shortcut_section_title">';options=
{hash:{},data:data};buffer+=escapeExpression((stack1=helpers.translate,stack1?stack1.call(depth0,"agent.agents.keyboard_shortcuts.section.system_wide.title",options):helperMissing.call(depth0,"translate","agent.agents.keyboard_shortcuts.section.system_wide.title",options)))+'</div>\n\n\t\t\t\t\t<div class="keyboard_shortcut_command">\n\t\t\t\t\t\t<span class="keyboard_shortcut_command_key">';options={hash:{},data:data};buffer+=escapeExpression((stack1=helpers.translate,stack1?stack1.call(depth0,"agent.agents.keyboard_shortcuts.section.system_wide.shortcuts.tab_left.key",
options):helperMissing.call(depth0,"translate","agent.agents.keyboard_shortcuts.section.system_wide.shortcuts.tab_left.key",options)))+'</span>\n\t\t\t\t\t\t<span class="keyboard_shortcut_command_description">';options={hash:{},data:data};buffer+=escapeExpression((stack1=helpers.translate,stack1?stack1.call(depth0,"agent.agents.keyboard_shortcuts.section.system_wide.shortcuts.tab_left.description",options):helperMissing.call(depth0,"translate","agent.agents.keyboard_shortcuts.section.system_wide.shortcuts.tab_left.description",
options)))+'</span>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="keyboard_shortcut_command">\n\t\t\t\t\t\t<span class="keyboard_shortcut_command_key">';options={hash:{},data:data};buffer+=escapeExpression((stack1=helpers.translate,stack1?stack1.call(depth0,"agent.agents.keyboard_shortcuts.section.system_wide.shortcuts.tab_right.key",options):helperMissing.call(depth0,"translate","agent.agents.keyboard_shortcuts.section.system_wide.shortcuts.tab_right.key",options)))+'</span>\n\t\t\t\t\t\t<span class="keyboard_shortcut_command_description">';
options={hash:{},data:data};buffer+=escapeExpression((stack1=helpers.translate,stack1?stack1.call(depth0,"agent.agents.keyboard_shortcuts.section.system_wide.shortcuts.tab_right.description",options):helperMissing.call(depth0,"translate","agent.agents.keyboard_shortcuts.section.system_wide.shortcuts.tab_right.description",options)))+'</span>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div class="keyboard_shortcut_command">\n\t\t\t\t\t\t<span class="keyboard_shortcut_command_key">';options={hash:{},data:data};
buffer+=escapeExpression((stack1=helpers.translate,stack1?stack1.call(depth0,"agent.agents.keyboard_shortcuts.section.system_wide.shortcuts.prev_page.key",options):helperMissing.call(depth0,"translate","agent.agents.keyboard_shortcuts.section.system_wide.shortcuts.prev_page.key",options)))+'</span>\n\t\t\t\t\t\t<span class="keyboard_shortcut_command_description">';options={hash:{},data:data};buffer+=escapeExpression((stack1=helpers.translate,stack1?stack1.call(depth0,"agent.agents.keyboard_shortcuts.section.system_wide.shortcuts.prev_page.description",
options):helperMissing.call(depth0,"translate","agent.agents.keyboard_shortcuts.section.system_wide.shortcuts.prev_page.description",options)))+'</span>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div class="keyboard_shortcut_command">\n\t\t\t\t\t\t<span class="keyboard_shortcut_command_key">';options={hash:{},data:data};buffer+=escapeExpression((stack1=helpers.translate,stack1?stack1.call(depth0,"agent.agents.keyboard_shortcuts.section.system_wide.shortcuts.next_page.key",options):helperMissing.call(depth0,
"translate","agent.agents.keyboard_shortcuts.section.system_wide.shortcuts.next_page.key",options)))+'</span>\n\t\t\t\t\t\t<span class="keyboard_shortcut_command_description">';options={hash:{},data:data};buffer+=escapeExpression((stack1=helpers.translate,stack1?stack1.call(depth0,"agent.agents.keyboard_shortcuts.section.system_wide.shortcuts.next_page.description",options):helperMissing.call(depth0,"translate","agent.agents.keyboard_shortcuts.section.system_wide.shortcuts.next_page.description",
options)))+'</span>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div class="keyboard_shortcut_command">\n\t\t\t\t\t\t<span class="keyboard_shortcut_command_key">';options={hash:{},data:data};buffer+=escapeExpression((stack1=helpers.translate,stack1?stack1.call(depth0,"agent.agents.keyboard_shortcuts.section.system_wide.shortcuts.quick_search.key",options):helperMissing.call(depth0,"translate","agent.agents.keyboard_shortcuts.section.system_wide.shortcuts.quick_search.key",options)))+'</span>\n\t\t\t\t\t\t<span class="keyboard_shortcut_command_description">';
options={hash:{},data:data};buffer+=escapeExpression((stack1=helpers.translate,stack1?stack1.call(depth0,"agent.agents.keyboard_shortcuts.section.system_wide.shortcuts.quick_search.description",options):helperMissing.call(depth0,"translate","agent.agents.keyboard_shortcuts.section.system_wide.shortcuts.quick_search.description",options)))+'</span>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div class="keyboard_shortcut_command">\n\t\t\t\t\t\t<span class="keyboard_shortcut_command_key">';options={hash:{},data:data};
buffer+=escapeExpression((stack1=helpers.translate,stack1?stack1.call(depth0,"agent.agents.keyboard_shortcuts.section.system_wide.shortcuts.toggle_routing.key",options):helperMissing.call(depth0,"translate","agent.agents.keyboard_shortcuts.section.system_wide.shortcuts.toggle_routing.key",options)))+'</span>\n\t\t\t\t\t\t<span class="keyboard_shortcut_command_description">';options={hash:{},data:data};buffer+=escapeExpression((stack1=helpers.translate,stack1?stack1.call(depth0,"agent.agents.keyboard_shortcuts.section.system_wide.shortcuts.toggle_routing.description",
options):helperMissing.call(depth0,"translate","agent.agents.keyboard_shortcuts.section.system_wide.shortcuts.toggle_routing.description",options)))+'</span>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div class="keyboard_shortcut_command">\n\t\t\t\t\t\t<span class="keyboard_shortcut_command_key">';options={hash:{},data:data};buffer+=escapeExpression((stack1=helpers.translate,stack1?stack1.call(depth0,"agent.agents.keyboard_shortcuts.section.system_wide.shortcuts.escape.key",options):helperMissing.call(depth0,
"translate","agent.agents.keyboard_shortcuts.section.system_wide.shortcuts.escape.key",options)))+'</span>\n\t\t\t\t\t\t<span class="keyboard_shortcut_command_description">';options={hash:{},data:data};buffer+=escapeExpression((stack1=helpers.translate,stack1?stack1.call(depth0,"agent.agents.keyboard_shortcuts.section.system_wide.shortcuts.escape.description",options):helperMissing.call(depth0,"translate","agent.agents.keyboard_shortcuts.section.system_wide.shortcuts.escape.description",options)))+
'</span>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div class="keyboard_shortcut_section_title">';options={hash:{},data:data};buffer+=escapeExpression((stack1=helpers.translate,stack1?stack1.call(depth0,"agent.agents.keyboard_shortcuts.section.ticket_filter.title",options):helperMissing.call(depth0,"translate","agent.agents.keyboard_shortcuts.section.ticket_filter.title",options)))+'</div>\n\n\t\t\t\t\t<div class="keyboard_shortcut_command">\n\t\t\t\t\t\t<span class="keyboard_shortcut_command_key">';options=
{hash:{},data:data};buffer+=escapeExpression((stack1=helpers.translate,stack1?stack1.call(depth0,"agent.agents.keyboard_shortcuts.section.ticket_filter.shortcuts.down.key",options):helperMissing.call(depth0,"translate","agent.agents.keyboard_shortcuts.section.ticket_filter.shortcuts.down.key",options)))+'</span>\n\t\t\t\t\t\t<span class="keyboard_shortcut_command_description">';options={hash:{},data:data};buffer+=escapeExpression((stack1=helpers.translate,stack1?stack1.call(depth0,"agent.agents.keyboard_shortcuts.section.ticket_filter.shortcuts.down.description",
options):helperMissing.call(depth0,"translate","agent.agents.keyboard_shortcuts.section.ticket_filter.shortcuts.down.description",options)))+'</span>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div class="keyboard_shortcut_command">\n\t\t\t\t\t\t<span class="keyboard_shortcut_command_key">';options={hash:{},data:data};buffer+=escapeExpression((stack1=helpers.translate,stack1?stack1.call(depth0,"agent.agents.keyboard_shortcuts.section.ticket_filter.shortcuts.up.key",options):helperMissing.call(depth0,"translate",
"agent.agents.keyboard_shortcuts.section.ticket_filter.shortcuts.up.key",options)))+'</span>\n\t\t\t\t\t\t<span class="keyboard_shortcut_command_description">';options={hash:{},data:data};buffer+=escapeExpression((stack1=helpers.translate,stack1?stack1.call(depth0,"agent.agents.keyboard_shortcuts.section.ticket_filter.shortcuts.up.description",options):helperMissing.call(depth0,"translate","agent.agents.keyboard_shortcuts.section.ticket_filter.shortcuts.up.description",options)))+'</span>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div class="keyboard_shortcut_command">\n\t\t\t\t\t\t<span class="keyboard_shortcut_command_key">';
options={hash:{},data:data};buffer+=escapeExpression((stack1=helpers.translate,stack1?stack1.call(depth0,"agent.agents.keyboard_shortcuts.section.ticket_filter.shortcuts.open.key",options):helperMissing.call(depth0,"translate","agent.agents.keyboard_shortcuts.section.ticket_filter.shortcuts.open.key",options)))+'</span>\n\t\t\t\t\t\t<span class="keyboard_shortcut_command_description">';options={hash:{},data:data};buffer+=escapeExpression((stack1=helpers.translate,stack1?stack1.call(depth0,"agent.agents.keyboard_shortcuts.section.ticket_filter.shortcuts.open.description",
options):helperMissing.call(depth0,"translate","agent.agents.keyboard_shortcuts.section.ticket_filter.shortcuts.open.description",options)))+'</span>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div class="keyboard_shortcut_command">\n\t\t\t\t\t\t<span class="keyboard_shortcut_command_key">';options={hash:{},data:data};buffer+=escapeExpression((stack1=helpers.translate,stack1?stack1.call(depth0,"agent.agents.keyboard_shortcuts.section.ticket_filter.shortcuts.open_all.key",options):helperMissing.call(depth0,"translate",
"agent.agents.keyboard_shortcuts.section.ticket_filter.shortcuts.open_all.key",options)))+'</span>\n\t\t\t\t\t\t<span class="keyboard_shortcut_command_description">';options={hash:{},data:data};buffer+=escapeExpression((stack1=helpers.translate,stack1?stack1.call(depth0,"agent.agents.keyboard_shortcuts.section.ticket_filter.shortcuts.open_all.description",options):helperMissing.call(depth0,"translate","agent.agents.keyboard_shortcuts.section.ticket_filter.shortcuts.open_all.description",options)))+
'</span>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div class="keyboard_shortcut_command">\n\t\t\t\t\t\t<span class="keyboard_shortcut_command_key">';options={hash:{},data:data};buffer+=escapeExpression((stack1=helpers.translate,stack1?stack1.call(depth0,"agent.agents.keyboard_shortcuts.section.ticket_filter.shortcuts.select.key",options):helperMissing.call(depth0,"translate","agent.agents.keyboard_shortcuts.section.ticket_filter.shortcuts.select.key",options)))+'</span>\n\t\t\t\t\t\t<span class="keyboard_shortcut_command_description">';
options={hash:{},data:data};buffer+=escapeExpression((stack1=helpers.translate,stack1?stack1.call(depth0,"agent.agents.keyboard_shortcuts.section.ticket_filter.shortcuts.select.description",options):helperMissing.call(depth0,"translate","agent.agents.keyboard_shortcuts.section.ticket_filter.shortcuts.select.description",options)))+'</span>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div class="keyboard_shortcut_command">\n\t\t\t\t\t\t<span class="keyboard_shortcut_command_key">';options={hash:{},data:data};buffer+=
escapeExpression((stack1=helpers.translate,stack1?stack1.call(depth0,"agent.agents.keyboard_shortcuts.section.ticket_filter.shortcuts.select_all.key",options):helperMissing.call(depth0,"translate","agent.agents.keyboard_shortcuts.section.ticket_filter.shortcuts.select_all.key",options)))+'</span>\n\t\t\t\t\t\t<span class="keyboard_shortcut_command_description">';options={hash:{},data:data};buffer+=escapeExpression((stack1=helpers.translate,stack1?stack1.call(depth0,"agent.agents.keyboard_shortcuts.section.ticket_filter.shortcuts.select_all.description",
options):helperMissing.call(depth0,"translate","agent.agents.keyboard_shortcuts.section.ticket_filter.shortcuts.select_all.description",options)))+'</span>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="keyboard_shortcut_command">\n\t\t\t\t\t\t<span class="keyboard_shortcut_command_key">';options={hash:{},data:data};buffer+=escapeExpression((stack1=helpers.translate,stack1?stack1.call(depth0,"agent.agents.keyboard_shortcuts.section.ticket_filter.shortcuts.select_none.key",options):helperMissing.call(depth0,
"translate","agent.agents.keyboard_shortcuts.section.ticket_filter.shortcuts.select_none.key",options)))+'</span>\n\t\t\t\t\t\t<span class="keyboard_shortcut_command_description">';options={hash:{},data:data};buffer+=escapeExpression((stack1=helpers.translate,stack1?stack1.call(depth0,"agent.agents.keyboard_shortcuts.section.ticket_filter.shortcuts.select_none.description",options):helperMissing.call(depth0,"translate","agent.agents.keyboard_shortcuts.section.ticket_filter.shortcuts.select_none.description",
options)))+'</span>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div class="keyboard_shortcut_command">\n\t\t\t\t\t\t<span class="keyboard_shortcut_command_key">';options={hash:{},data:data};buffer+=escapeExpression((stack1=helpers.translate,stack1?stack1.call(depth0,"agent.agents.keyboard_shortcuts.section.ticket_filter.shortcuts.toggle_minimize.key",options):helperMissing.call(depth0,"translate","agent.agents.keyboard_shortcuts.section.ticket_filter.shortcuts.toggle_minimize.key",options)))+'</span>\n\t\t\t\t\t\t<span class="keyboard_shortcut_command_description">';
options={hash:{},data:data};buffer+=escapeExpression((stack1=helpers.translate,stack1?stack1.call(depth0,"agent.agents.keyboard_shortcuts.section.ticket_filter.shortcuts.toggle_minimize.description",options):helperMissing.call(depth0,"translate","agent.agents.keyboard_shortcuts.section.ticket_filter.shortcuts.toggle_minimize.description",options)))+'</span>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div class="keyboard_shortcut_command">\n\t\t\t\t\t\t<span class="keyboard_shortcut_command_key">\n\t\t\t\t\t\t\t';
stack2=helpers["if"].call(depth0,depth0.isMac,{hash:{},inverse:self.program(3,program3,data),fn:self.program(1,program1,data),data:data});if(stack2||stack2===0)buffer+=stack2;buffer+='\n\t\t\t\t\t\t</span>\n\t\t\t\t\t\t<span class="keyboard_shortcut_command_description">';options={hash:{},data:data};buffer+=escapeExpression((stack1=helpers.translate,stack1?stack1.call(depth0,"agent.agents.keyboard_shortcuts.section.ticket_filter.shortcuts.open_with_switching.description",options):helperMissing.call(depth0,
"translate","agent.agents.keyboard_shortcuts.section.ticket_filter.shortcuts.open_with_switching.description",options)))+'</span>\n\t\t\t\t\t</div>\n\t\t\t\t</td>\n\n\t\t\t\t<td style="width:300px;">\n\n\t\t\t\t\t<div class="keyboard_shortcut_section_title">';options={hash:{},data:data};buffer+=escapeExpression((stack1=helpers.translate,stack1?stack1.call(depth0,"agent.agents.keyboard_shortcuts.section.ticket.title",options):helperMissing.call(depth0,"translate","agent.agents.keyboard_shortcuts.section.ticket.title",
options)))+'</div>\n\n\t\t\t\t\t<div class="keyboard_shortcut_command">\n\t\t\t\t\t\t<span class="keyboard_shortcut_command_key">';options={hash:{},data:data};buffer+=escapeExpression((stack1=helpers.translate,stack1?stack1.call(depth0,"agent.agents.keyboard_shortcuts.section.ticket.shortcuts.update.key",options):helperMissing.call(depth0,"translate","agent.agents.keyboard_shortcuts.section.ticket.shortcuts.update.key",options)))+'</span>\n\t\t\t\t\t\t<span class="keyboard_shortcut_command_description">';
options={hash:{},data:data};buffer+=escapeExpression((stack1=helpers.translate,stack1?stack1.call(depth0,"agent.agents.keyboard_shortcuts.section.ticket.shortcuts.update.description",options):helperMissing.call(depth0,"translate","agent.agents.keyboard_shortcuts.section.ticket.shortcuts.update.description",options)))+'</span>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="keyboard_shortcut_command">\n\t\t\t\t\t\t<span class="keyboard_shortcut_command_key">';options={hash:{},data:data};buffer+=escapeExpression((stack1=
helpers.translate,stack1?stack1.call(depth0,"agent.agents.keyboard_shortcuts.section.ticket.shortcuts.update_close.key",options):helperMissing.call(depth0,"translate","agent.agents.keyboard_shortcuts.section.ticket.shortcuts.update_close.key",options)))+'</span>\n\t\t\t\t\t\t<span class="keyboard_shortcut_command_description">';options={hash:{},data:data};buffer+=escapeExpression((stack1=helpers.translate,stack1?stack1.call(depth0,"agent.agents.keyboard_shortcuts.section.ticket.shortcuts.update_close.description",
options):helperMissing.call(depth0,"translate","agent.agents.keyboard_shortcuts.section.ticket.shortcuts.update_close.description",options)))+'</span>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="keyboard_shortcut_command">\n\t\t\t\t\t\t<span class="keyboard_shortcut_command_key">';options={hash:{},data:data};buffer+=escapeExpression((stack1=helpers.translate,stack1?stack1.call(depth0,"agent.agents.keyboard_shortcuts.section.ticket.shortcuts.update_resolve.key",options):helperMissing.call(depth0,"translate",
"agent.agents.keyboard_shortcuts.section.ticket.shortcuts.update_resolve.key",options)))+'</span>\n\t\t\t\t\t\t<span class="keyboard_shortcut_command_description">';options={hash:{},data:data};buffer+=escapeExpression((stack1=helpers.translate,stack1?stack1.call(depth0,"agent.agents.keyboard_shortcuts.section.ticket.shortcuts.update_resolve.description",options):helperMissing.call(depth0,"translate","agent.agents.keyboard_shortcuts.section.ticket.shortcuts.update_resolve.description",options)))+'</span>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="keyboard_shortcut_command">\n\t\t\t\t\t\t<span class="keyboard_shortcut_command_key">';
options={hash:{},data:data};buffer+=escapeExpression((stack1=helpers.translate,stack1?stack1.call(depth0,"agent.agents.keyboard_shortcuts.section.ticket.shortcuts.select_close.key",options):helperMissing.call(depth0,"translate","agent.agents.keyboard_shortcuts.section.ticket.shortcuts.select_close.key",options)))+'</span>\n\t\t\t\t\t\t<span class="keyboard_shortcut_command_description">';options={hash:{},data:data};buffer+=escapeExpression((stack1=helpers.translate,stack1?stack1.call(depth0,"agent.agents.keyboard_shortcuts.section.ticket.shortcuts.select_close.description",
options):helperMissing.call(depth0,"translate","agent.agents.keyboard_shortcuts.section.ticket.shortcuts.select_close.description",options)))+'</span>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div class="keyboard_shortcut_command">\n\t\t\t\t\t\t<span class="keyboard_shortcut_command_key">';options={hash:{},data:data};buffer+=escapeExpression((stack1=helpers.translate,stack1?stack1.call(depth0,"agent.agents.keyboard_shortcuts.section.ticket.shortcuts.close.key",options):helperMissing.call(depth0,"translate",
"agent.agents.keyboard_shortcuts.section.ticket.shortcuts.close.key",options)))+'</span>\n\t\t\t\t\t\t<span class="keyboard_shortcut_command_description">';options={hash:{},data:data};buffer+=escapeExpression((stack1=helpers.translate,stack1?stack1.call(depth0,"agent.agents.keyboard_shortcuts.section.ticket.shortcuts.close.description",options):helperMissing.call(depth0,"translate","agent.agents.keyboard_shortcuts.section.ticket.shortcuts.close.description",options)))+'</span>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div class="keyboard_shortcut_command">\n\t\t\t\t\t\t<span class="keyboard_shortcut_command_key">';
options={hash:{},data:data};buffer+=escapeExpression((stack1=helpers.translate,stack1?stack1.call(depth0,"agent.agents.keyboard_shortcuts.section.ticket.shortcuts.reply.key",options):helperMissing.call(depth0,"translate","agent.agents.keyboard_shortcuts.section.ticket.shortcuts.reply.key",options)))+'</span>\n\t\t\t\t\t\t<span class="keyboard_shortcut_command_description">';options={hash:{},data:data};buffer+=escapeExpression((stack1=helpers.translate,stack1?stack1.call(depth0,"agent.agents.keyboard_shortcuts.section.ticket.shortcuts.reply.description",
options):helperMissing.call(depth0,"translate","agent.agents.keyboard_shortcuts.section.ticket.shortcuts.reply.description",options)))+'</span>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div class="keyboard_shortcut_command">\n\t\t\t\t\t\t<span class="keyboard_shortcut_command_key">';options={hash:{},data:data};buffer+=escapeExpression((stack1=helpers.translate,stack1?stack1.call(depth0,"agent.agents.keyboard_shortcuts.section.ticket.shortcuts.label.key",options):helperMissing.call(depth0,"translate","agent.agents.keyboard_shortcuts.section.ticket.shortcuts.label.key",
options)))+'</span>\n\t\t\t\t\t\t<span class="keyboard_shortcut_command_description">';options={hash:{},data:data};buffer+=escapeExpression((stack1=helpers.translate,stack1?stack1.call(depth0,"agent.agents.keyboard_shortcuts.section.ticket.shortcuts.label.description",options):helperMissing.call(depth0,"translate","agent.agents.keyboard_shortcuts.section.ticket.shortcuts.label.description",options)))+'</span>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div class="keyboard_shortcut_command">\n\t\t\t\t\t\t<span class="keyboard_shortcut_command_key">';
options={hash:{},data:data};buffer+=escapeExpression((stack1=helpers.translate,stack1?stack1.call(depth0,"agent.agents.keyboard_shortcuts.section.ticket.shortcuts.macro.key",options):helperMissing.call(depth0,"translate","agent.agents.keyboard_shortcuts.section.ticket.shortcuts.macro.key",options)))+'</span>\n\t\t\t\t\t\t<span class="keyboard_shortcut_command_description">';options={hash:{},data:data};buffer+=escapeExpression((stack1=helpers.translate,stack1?stack1.call(depth0,"agent.agents.keyboard_shortcuts.section.ticket.shortcuts.macro.description",
options):helperMissing.call(depth0,"translate","agent.agents.keyboard_shortcuts.section.ticket.shortcuts.macro.description",options)))+'</span>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div class="keyboard_shortcut_command">\n\t\t\t\t\t\t<span class="keyboard_shortcut_command_key">';options={hash:{},data:data};buffer+=escapeExpression((stack1=helpers.translate,stack1?stack1.call(depth0,"agent.agents.keyboard_shortcuts.section.ticket.shortcuts.kb_quickcode.key",options):helperMissing.call(depth0,"translate",
"agent.agents.keyboard_shortcuts.section.ticket.shortcuts.kb_quickcode.key",options)))+'</span>\n\t\t\t\t\t\t<span class="keyboard_shortcut_command_description">';options={hash:{},data:data};buffer+=escapeExpression((stack1=helpers.translate,stack1?stack1.call(depth0,"agent.agents.keyboard_shortcuts.section.ticket.shortcuts.kb_quickcode.description",options):helperMissing.call(depth0,"translate","agent.agents.keyboard_shortcuts.section.ticket.shortcuts.kb_quickcode.description",options)))+'</span>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div class="keyboard_shortcut_command">\n\t\t\t\t\t\t<span class="keyboard_shortcut_command_key">';
options={hash:{},data:data};buffer+=escapeExpression((stack1=helpers.translate,stack1?stack1.call(depth0,"agent.agents.keyboard_shortcuts.section.ticket.shortcuts.kb_browse.key",options):helperMissing.call(depth0,"translate","agent.agents.keyboard_shortcuts.section.ticket.shortcuts.kb_browse.key",options)))+'</span>\n\t\t\t\t\t\t<span class="keyboard_shortcut_command_description">';options={hash:{},data:data};buffer+=escapeExpression((stack1=helpers.translate,stack1?stack1.call(depth0,"agent.agents.keyboard_shortcuts.section.ticket.shortcuts.kb_browse.description",
options):helperMissing.call(depth0,"translate","agent.agents.keyboard_shortcuts.section.ticket.shortcuts.kb_browse.description",options)))+'</span>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div class="keyboard_shortcut_command">\n\t\t\t\t\t\t<span class="keyboard_shortcut_command_key">';options={hash:{},data:data};buffer+=escapeExpression((stack1=helpers.translate,stack1?stack1.call(depth0,"agent.agents.keyboard_shortcuts.section.ticket.shortcuts.iurl_menu.key",options):helperMissing.call(depth0,"translate",
"agent.agents.keyboard_shortcuts.section.ticket.shortcuts.iurl_menu.key",options)))+'</span>\n\t\t\t\t\t\t<span class="keyboard_shortcut_command_description">';options={hash:{},data:data};buffer+=escapeExpression((stack1=helpers.translate,stack1?stack1.call(depth0,"agent.agents.keyboard_shortcuts.section.ticket.shortcuts.iurl_menu.description",options):helperMissing.call(depth0,"translate","agent.agents.keyboard_shortcuts.section.ticket.shortcuts.iurl_menu.description",options)))+'</span>\n\t\t\t\t\t</div>\n\n\n\t\t\t\t\t<div class="keyboard_shortcut_command">\n\t\t\t\t\t\t<span class="keyboard_shortcut_command_key">';
options={hash:{},data:data};buffer+=escapeExpression((stack1=helpers.translate,stack1?stack1.call(depth0,"agent.agents.keyboard_shortcuts.section.ticket.shortcuts.add_note.key",options):helperMissing.call(depth0,"translate","agent.agents.keyboard_shortcuts.section.ticket.shortcuts.add_note.key",options)))+'</span>\n\t\t\t\t\t\t<span class="keyboard_shortcut_command_description">';options={hash:{},data:data};buffer+=escapeExpression((stack1=helpers.translate,stack1?stack1.call(depth0,"agent.agents.keyboard_shortcuts.section.ticket.shortcuts.add_note.description",
options):helperMissing.call(depth0,"translate","agent.agents.keyboard_shortcuts.section.ticket.shortcuts.add_note.description",options)))+'</span>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div class="keyboard_shortcut_section_title">';options={hash:{},data:data};buffer+=escapeExpression((stack1=helpers.translate,stack1?stack1.call(depth0,"agent.agents.keyboard_shortcuts.section.twitter_search.title",options):helperMissing.call(depth0,"translate","agent.agents.keyboard_shortcuts.section.twitter_search.title",
options)))+'</div>\n\n\t\t\t\t\t<div class="keyboard_shortcut_command">\n\t\t\t\t\t\t<span class="keyboard_shortcut_command_key">';options={hash:{},data:data};buffer+=escapeExpression((stack1=helpers.translate,stack1?stack1.call(depth0,"agent.agents.keyboard_shortcuts.section.twitter_search.shortcuts.toggle_minimize.key",options):helperMissing.call(depth0,"translate","agent.agents.keyboard_shortcuts.section.twitter_search.shortcuts.toggle_minimize.key",options)))+'</span>\n\t\t\t\t\t\t<span class="keyboard_shortcut_command_description">';
options={hash:{},data:data};buffer+=escapeExpression((stack1=helpers.translate,stack1?stack1.call(depth0,"agent.agents.keyboard_shortcuts.section.twitter_search.shortcuts.toggle_minimize.description",options):helperMissing.call(depth0,"translate","agent.agents.keyboard_shortcuts.section.twitter_search.shortcuts.toggle_minimize.description",options)))+"</span>\n\t\t\t\t\t</div>\n\n\t\t\t\t</td>\n\t\t\t</tr>\n\t\t</table>\n\t</div>\n</div>\n\n<script type=\"text/javascript\">\n\tif (!Assistly.options.agent_kb_shortcuts_enabled) {\n\t\t$('#kb_shortcuts_disabled').text('";
options={hash:{},data:data};buffer+=escapeExpression((stack1=helpers.translate,stack1?stack1.call(depth0,"agent.agents.keyboard_shortcuts.disabled",options):helperMissing.call(depth0,"translate","agent.agents.keyboard_shortcuts.disabled",options)))+"');\n\t}\n\x3c/script>\n";return buffer});return this.AssistlyHB["agent/keyboard_shortcuts"]}).call(this);
(function(){this.AssistlyHB||(this.AssistlyHB={});this.AssistlyHB["common/browser_version/unsupportedBrowser"]=Handlebars.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[2,">= 1.0.0-rc.3"];helpers=helpers||Handlebars.helpers;data=data||{};var buffer="",stack1,stack2,options,helperMissing=helpers.helperMissing,escapeExpression=this.escapeExpression,functionType="function";buffer+="<div id='browserNotSupportedModal'>\n  <div class=\"modalTop\">\n    <h2>";options={hash:{},
data:data};buffer+=escapeExpression((stack1=helpers.translate,stack1?stack1.call(depth0,"common.browserVersionCheck.title",options):helperMissing.call(depth0,"translate","common.browserVersionCheck.title",options)))+"</h2>\n    <p>";if(stack2=helpers.browserVersionMessage)stack2=stack2.call(depth0,{hash:{},data:data});else{stack2=depth0.browserVersionMessage;stack2=typeof stack2===functionType?stack2.apply(depth0):stack2}buffer+=escapeExpression(stack2)+"</p>\n    <ul class=\"browserList\">\n      <li class='browser'>\n        <div class='icon firefox'></div>\n        <h5>";
options={hash:{},data:data};buffer+=escapeExpression((stack1=helpers.translate,stack1?stack1.call(depth0,"common.browserVersionCheck.browsers.mozilla",options):helperMissing.call(depth0,"translate","common.browserVersionCheck.browsers.mozilla",options)))+"</h5>\n        <p>";options={hash:{},data:data};buffer+=escapeExpression((stack1=helpers.browserRecommended,stack1?stack1.call(depth0,"mozilla",options):helperMissing.call(depth0,"browserRecommended","mozilla",options)))+"</p>\n        <p>";options=
{hash:{},data:data};buffer+=escapeExpression((stack1=helpers.translate,stack1?stack1.call(depth0,"common.browserVersionCheck.labels.versions",options):helperMissing.call(depth0,"translate","common.browserVersionCheck.labels.versions",options)))+" "+escapeExpression((stack1=(stack1=depth0.mozilla,stack1==null||stack1===false?stack1:stack1.min),typeof stack1===functionType?stack1.apply(depth0):stack1))+" - "+escapeExpression((stack1=(stack1=depth0.mozilla,stack1==null||stack1===false?stack1:stack1.max),
typeof stack1===functionType?stack1.apply(depth0):stack1))+"</p>\n      </li>\n      <li class='browser'>\n        <div class='icon chrome'></div>\n        <h5>";options={hash:{},data:data};buffer+=escapeExpression((stack1=helpers.translate,stack1?stack1.call(depth0,"common.browserVersionCheck.browsers.chrome",options):helperMissing.call(depth0,"translate","common.browserVersionCheck.browsers.chrome",options)))+"</h5>\n        <p>";options={hash:{},data:data};buffer+=escapeExpression((stack1=helpers.browserRecommended,
stack1?stack1.call(depth0,"chrome",options):helperMissing.call(depth0,"browserRecommended","chrome",options)))+"</p>\n        <p>";options={hash:{},data:data};buffer+=escapeExpression((stack1=helpers.translate,stack1?stack1.call(depth0,"common.browserVersionCheck.labels.versions",options):helperMissing.call(depth0,"translate","common.browserVersionCheck.labels.versions",options)))+" "+escapeExpression((stack1=(stack1=depth0.chrome,stack1==null||stack1===false?stack1:stack1.min),typeof stack1===functionType?
stack1.apply(depth0):stack1))+" - "+escapeExpression((stack1=(stack1=depth0.chrome,stack1==null||stack1===false?stack1:stack1.max),typeof stack1===functionType?stack1.apply(depth0):stack1))+"</p>\n      </li>\n      <li class='browser'>\n        <div class='icon safari'></div>\n        <h5>";options={hash:{},data:data};buffer+=escapeExpression((stack1=helpers.translate,stack1?stack1.call(depth0,"common.browserVersionCheck.browsers.safari",options):helperMissing.call(depth0,"translate","common.browserVersionCheck.browsers.safari",
options)))+"</h5>\n        <p>";options={hash:{},data:data};buffer+=escapeExpression((stack1=helpers.browserRecommended,stack1?stack1.call(depth0,"safari",options):helperMissing.call(depth0,"browserRecommended","safari",options)))+"</p>\n        <p>";options={hash:{},data:data};buffer+=escapeExpression((stack1=helpers.translate,stack1?stack1.call(depth0,"common.browserVersionCheck.labels.versions",options):helperMissing.call(depth0,"translate","common.browserVersionCheck.labels.versions",options)))+
" "+escapeExpression((stack1=(stack1=depth0.safari,stack1==null||stack1===false?stack1:stack1.min),typeof stack1===functionType?stack1.apply(depth0):stack1))+" - "+escapeExpression((stack1=(stack1=depth0.safari,stack1==null||stack1===false?stack1:stack1.max),typeof stack1===functionType?stack1.apply(depth0):stack1))+"</p>\n      </li>\n      <li class='browser'>\n        <div class='icon msie'></div>\n        <h5>";options={hash:{},data:data};buffer+=escapeExpression((stack1=helpers.translate,stack1?
stack1.call(depth0,"common.browserVersionCheck.browsers.msie",options):helperMissing.call(depth0,"translate","common.browserVersionCheck.browsers.msie",options)))+"</h5>\n        <p>";options={hash:{},data:data};buffer+=escapeExpression((stack1=helpers.browserRecommended,stack1?stack1.call(depth0,"msie",options):helperMissing.call(depth0,"browserRecommended","msie",options)))+"</p>\n        <p>";options={hash:{},data:data};buffer+=escapeExpression((stack1=helpers.translate,stack1?stack1.call(depth0,
"common.browserVersionCheck.labels.versions",options):helperMissing.call(depth0,"translate","common.browserVersionCheck.labels.versions",options)))+" "+escapeExpression((stack1=(stack1=depth0.msie,stack1==null||stack1===false?stack1:stack1.min),typeof stack1===functionType?stack1.apply(depth0):stack1))+" - "+escapeExpression((stack1=(stack1=depth0.msie,stack1==null||stack1===false?stack1:stack1.max),typeof stack1===functionType?stack1.apply(depth0):stack1))+"</p>\n      </li>\n    </ul>\n    <p>\n      ";
options={hash:{},data:data};stack2=(stack1=helpers.translate,stack1?stack1.call(depth0,"common.browserVersionCheck.helpPage",options):helperMissing.call(depth0,"translate","common.browserVersionCheck.helpPage",options));if(stack2||stack2===0)buffer+=stack2;buffer+='\n    </p>\n  </div>\n  <div class="modalBottom">\n    <p>';options={hash:{},data:data};buffer+=escapeExpression((stack1=helpers.translate,stack1?stack1.call(depth0,"common.browserVersionCheck.unexpectedBehavior",options):helperMissing.call(depth0,
"translate","common.browserVersionCheck.unexpectedBehavior",options)))+"</p>\n    <div class='input button'>\n      <button class='a-button close_modal'>";options={hash:{},data:data};buffer+=escapeExpression((stack1=helpers.translate,stack1?stack1.call(depth0,"common.browserVersionCheck.labels.button",options):helperMissing.call(depth0,"translate","common.browserVersionCheck.labels.button",options)))+"</button>\n    </div>\n  </div>\n</div>\n";return buffer});return this.AssistlyHB["common/browser_version/unsupportedBrowser"]}).call(this);
var I18n=window.I18n||{};I18n.setup=function(locale,json){I18n.locale=locale;I18n.strings=I18n.strings||{};$.extend(true,I18n.strings,json);return I18n.strings};
I18n.translate=function(full_key,o){full_key=full_key.replace(/{([^{}]*)}/g,function(a,b){var r=o[b];return typeof r==="string"||typeof r==="number"?r:a});var keys=full_key.split(".");var template=I18n.strings;var len=keys.length;for(x=0;x<len;x++)if(template)template=template[keys[x]];if(template===undefined)return"Missing translation "+I18n.locale+"."+full_key;if(typeof template==="object"&&o["count"]!==undefined)template=o["count"]==1?template["one"]:template["other"];return template.replace(/{([^{}]*)}/g,
function(a,b){var r=o[b];return typeof r==="string"||typeof r==="number"?r:a})};
(function(window,$){window.toastr=function(){var defaults={tapToDismiss:true,toastClass:"toast",containerId:"toast-container",debug:false,fadeIn:300,fadeOut:300,extendedTimeOut:1E3,iconClasses:{error:"toast-error",info:"toast-info",success:"toast-success",warning:"toast-warning"},iconClass:"toast-info",positionClass:"toast-top-right",timeOut:5E3,titleClass:"toast-title",messageClass:"toast-message",achievementType:""},hide=function(){$toastElement.hide()},error=function(message,title){return notify({iconClass:getOptions().iconClasses.error,
message:message,title:title})},getContainer=function(options){var $container=$("#"+options.containerId);if($container.length)return $container;$container=$("<div/>").attr("id",options.containerId).addClass(options.positionClass);$container.appendTo($("body"));return $container},getOptions=function(){return $.extend({},defaults,toastr.options)},info=function(message,title){return notify({iconClass:getOptions().iconClasses.info,message:message,title:title})},notify=function(map){var options=getOptions(),
iconClass=map.iconClass||options.iconClass,intervalId=null,$container=getContainer(options),$toastElement=$("<div/>"),$titleElement=$("<div/>"),$messageElement=$("<div/>"),$closeElement=$("<a/>").addClass("close"),response={options:options,map:map};if(map.iconClass)$toastElement.addClass("growl").addClass(options.toastClass).addClass(iconClass);if(map.title){$titleElement.append(map.title).addClass(options.titleClass);$toastElement.append($titleElement)}if(map.achievementType)$toastElement.append($("<span/>").addClass("achievement-icon").addClass(map.achievementType));
if(map.message){$messageElement.append(map.message).addClass(options.messageClass);$toastElement.append($messageElement)}$toastElement.append($closeElement);var fadeAway=function(){if($(":focus",$toastElement).length>0)return;var fade=function(){};$.when(fade()).done(function(){if($toastElement.is(":visible"))return;$toastElement.remove();if($container.children().length===0)$container.remove()})};var delayedFadeAway=function(){if(options.timeOut>0||options.extendedTimeOut>0)intervalId=setTimeout(fadeAway,
options.extendedTimeOut)};var stickAround=function(){clearTimeout(intervalId);$toastElement.stop(true,true).fadeIn(options.fadeIn)};$toastElement.find("a").bind("click",function(e){e.preventDefault();$toastElement.fadeOut(options.fadeOut)});$toastElement.hide();$container.prepend($toastElement);$toastElement.fadeIn(options.fadeIn);if(options.timeOut>0)intervalId=setTimeout(fadeAway,options.timeOut);$toastElement.hover(stickAround,delayedFadeAway);if(!options.onclick&&options.tapToDismiss)$toastElement.click(fadeAway);
if(options.onclick)$toastElement.click(function(){options.onclick();fadeAway()});if(options.debug)console.log(response);return $toastElement},success=function(message,title){return notify({iconClass:getOptions().iconClasses.success,message:message,title:title})},warning=function(message,title){return notify({iconClass:getOptions().iconClasses.warning,message:message,title:title})};return{hide:hide,notify:notify,error:error,info:info,options:{},success:success,warning:warning}}()})(window,jQuery);
(function($){var globals={errorClass:"a-error",progressClass:"a-progress",hideClass:"hide",fieldClass:"a-field",modalLoadingParent:".a-modal-bottom:visible:last",inlineLoadingParent:".a-buttons",loadingWrapper:".a-loading",loadingMessage:".a-success"};var methods={init:function(options){var settings={resource:null,context:"inline",closeOnSuccess:true,requestType:"add",updateDOM:false,updateContext:".a-list",before:false,formName:false,callback:false,newHTML:false,errors:false,success:false,hideBlankSlate:true,
skipShowSuccess:false,additionalParams:null,submitType:"post",noAjaxNav:false};if(options)$.extend(settings,options);return this.each(function(){var $this=$(this);$this.bind("submit",function(event){event.preventDefault();methods.sendRequest($this,settings)})})},sendRequest:function(form,settings){if(settings.before&&settings.before(settings)==false)return;methods.showLoading(settings);Assistly.blockUI.start();var form_data=form.serializeArray();if(settings.additionalParams)form_data.push(settings.additionalParams);
$.ajax({data:form_data,type:settings.submitType,dataType:"json",url:form.prop("action"),success:function(data){if(!settings.skipShowSuccess)methods.showSuccess(form,settings);if(settings.updateDOM&&settings.context!="inline"){var html=settings.newHTML?settings.newHTML.call(this,data):data.html;if(settings.requestType==="add"){if($("#a-section-header").hasClass("hide")&&settings.hideBlankSlate==true)$("#a-section-header").removeClass("hide");if($("#a-blank-slate")&&settings.hideBlankSlate==true)$("#a-blank-slate").addClass("hide");
$(".a-event").trigger("a-new-record",data);if($(".a-no-outbound").length>0)$(".a-no-outbound").removeClass("hide")}else $("#"+$(form).attr("rel")).replaceWith(html)}else if(settings.requestType==="add"&&!settings.noAjaxNav)$(".a-event").trigger("a-new-record",data);if(settings.success)settings.success(data)},error:function(data,status,msg){methods.hideLoading();if(data.status==422)data=$.parseJSON(data.responseText);else data={errors:{base:msg}};if(settings.errors==false||settings.errors(data))methods.showErrors(data,
settings)},complete:function(data){if(data.status>=200&&data.status<300&&settings.resource&&settings.resource.form_name&&(settings.resource.form_name=="facebook_feed"||settings.resource.form_name=="bill_subscription")){settings.resource.tracking("add");setTimeout(function(){if(settings.callback)settings.callback(data,settings)},700)}else if(settings.callback)settings.callback(data,settings);Assistly.blockUI.stop()}})},showErrors:function(data,settings){for(var key in data.errors)if(data.errors.hasOwnProperty(key))if(key==
"base")$(".a-base-error").removeClass("hide").html(data.errors[key]);else{field=$("."+globals.fieldClass+" input[name='"+settings.formName+"["+key+"]']");if(!field.length)field=$("."+globals.fieldClass+" textarea[name='"+settings.formName+"["+key+"]']");if(!field.length)field=$("."+globals.fieldClass+" select[name='"+settings.formName+"["+key+"]']");if(!field.length){field=$("."+key.replace(".","_"));var field_display_name="";if(!field.length){parts=key.split(".");var objName=parts[0].substring(0,
parts[0].length-1);field=$("div[id^=new_"+objName+"_all_select]");if(!field.length)field=$("div[id^=new_"+objName+"_any_select]");if(!field.length){field=$("div.error_"+key);field_display_name=key+": "}}if(field.length){field.addClass(globals.errorClass);field.append("<span class='"+globals.errorClass+"'>"+field_display_name+data.errors[key].html_encode()+"</span>")}}else{error="";if(typeof data.errors[key]==="object"){var sorted_arr=data.errors[key].sort();var results=[];for(var i=0;i<sorted_arr.length-
1;i++)if(sorted_arr[i+1]==sorted_arr[i])results.push(sorted_arr[i]);for(var subkey in results)error=error+data.errors[key][subkey]}else error=data.errors[key];field.parent().addClass(globals.errorClass);field.closest("."+globals.fieldClass).append("<span class='"+globals.errorClass+"'>"+error.html_encode()+"</span>")}}if(settings.context==="modal"){$.fn.assistlyModal("reposition");$(".a-modal-body .a-scroll").scrollTop(0);var firstErrorField=$(".a-modal-body .a-scroll div.a-error:first").parents(".a-field");
if(firstErrorField.length>0)$(".a-modal-body .a-scroll").scrollTop(firstErrorField.position().top)}else $(globals.inlineLoadingParent).find("input").css({"opacity":1})},showLoading:function(settings){if(settings.context=="modal")loadingWrapper=$(globals.modalLoadingParent).find(globals.loadingWrapper);else{loadingWrapper=$(globals.inlineLoadingParent).find(globals.loadingWrapper);$(globals.inlineLoadingParent).find("input").css({"opacity":0.2})}loadingWrapper.removeClass(globals.hideClass);loadingWrapper.addClass(globals.progressClass);
$(globals.loadingMessage).addClass(globals.hideClass);$(".a-base-error").addClass("hide");$("div."+globals.errorClass).removeClass(globals.errorClass);$("span."+globals.errorClass).remove()},hideLoading:function(){$(globals.loadingWrapper).addClass(globals.hideClass)},showSuccess:function(form,settings){$(".a-event").trigger("a-form-success",{form:form,settings:settings});if(settings.context=="modal"){loadingWrapper=$(globals.modalLoadingParent).find(globals.loadingWrapper);if(settings.closeOnSuccess)setTimeout(function(){form.unbind();
$.fn.assistlyModal("destroy")},500)}else{loadingWrapper=$(globals.inlineLoadingParent).find(globals.loadingWrapper);$(globals.inlineLoadingParent).find("input").css({"opacity":1})}loadingWrapper.removeClass(globals.progressClass);$(globals.loadingMessage).removeClass(globals.hideClass);setTimeout(function(){loadingWrapper.animate({opacity:0},function(){loadingWrapper.addClass(globals.hideClass);loadingWrapper.css({"opacity":1})})},500)}};$.fn.assistlyFormHandler=function(method){if(methods[method])return methods[method].apply(this,
Array.prototype.slice.call(arguments,1));else if(typeof method==="object"||!method)return methods.init.apply(this,arguments);else $.error("Method "+method+" does not exist on jQuery.assistlyFormHandler")}})(jQuery);
(function($){var methods={init:function(options){return this.each(function(){var $this=$(this);if(window.localStorage){var hideHelpText=localStorage.getItem($this.attr("rel"));if(!hideHelpText)$this.parent().slideDown()}$this.unbind();$this.bind("click",function(){if(window.localStorage)localStorage.setItem($this.attr("rel"),true);$this.parent().slideUp()})})}};$.fn.assistlyHelpText=function(method){if(methods[method])return methods[method].apply(this,Array.prototype.slice.call(arguments,1));else if(typeof method===
"object"||!method)return methods.init.apply(this,arguments);else $.error("Method "+method+" does not exist on jQuery.assistlyHelpText")}})(jQuery);
(function($){var globals={bodyPadding:20,contentPadding:40,modalOverlay:"a-modal-overlay",modalWrapper:"a-modal-wrapper",modalContent:"a-modal-content",modalTop:"a-modal-top",modalBottom:"a-modal-bottom",modalScrollable:"a-modal-scrollable",modalLoading:"a-loading",modalCancel:"a-cancel",modalCancelPositive:"a-cancel-positive",modalScroll:"a-scroll",modalNoScroll:"a-modal-noscroll"};var methods={init:function(options){var settings={url:false,width:"600px",fullScreen:false,callback:false,isStatic:false,
staticContent:false,before:false,closeOnEscape:true,extendedClass:""};if(options)$.extend(settings,options);return this.each(function(){var $this=$(this);if(!$this.data("assistlyModal")){$this.data("assistlyModal",settings);$this.bind("click",function(event){event.preventDefault();if(settings.before&&settings.before()==false)return;$this.assistlyModal("show",event)})}})},show:function(event){var $this=$(this);var settings=$this.data("assistlyModal");var href=settings.url||$this.prop("href");$this.trigger("modal:beforeShow",
event);var $modalOverlay=$("<div/>",{"class":settings.fullScreen?globals.modalOverlay+" a-fullscreen":globals.modalOverlay});var $modalWrapper=$("<div/>",{"class":globals.modalWrapper});var $modalContent=$("<div/>",{"class":globals.modalContent+" "+globals.modalLoading+" "+settings.extendedClass});$modalWrapper.append($modalContent);$modalOverlay.append($modalWrapper);$("body").append($modalOverlay);methods.reposition();if(!settings.isStatic)$.ajax({url:settings.url||href,dataType:"json",success:function(data){$modalContent.removeClass(globals.modalLoading);
$(".a-event").trigger("modalLoaded",$modalContent);$modalContent.html(data.html);$modalContent.find("."+globals.modalCancel).bind("click",function(){methods.destroy()});$modalContent.find("."+globals.modalCancelPositive).bind("click",function(){methods.destroy_positive()});$modalContent.find(".a-modal-scrollable").scroll(function(){$(".ui-autocomplete").hide()});if(!settings.fullScreen)$modalContent.css({"width":settings.width});$(".a-event").trigger("modalContentLoaded",$modalContent);methods.reposition();
$firstInput=$modalContent.find(".a-text input[type='text']:first");$firstInput.focus().val($firstInput.val())},error:function(data){if(data&&data.status==401){window.location="/login/new";return}methods.destroy()},complete:function(){if(settings.callback)settings.callback(methods.show);$this.trigger("modal:afterShow",event);$("input, textarea").placeholder()}});else{$modalContent.removeClass(globals.modalLoading);$modalContent.css({"width":settings.width});$modalContent.html($(settings.staticContent).html());
methods.reposition();$("."+globals.modalCancel).bind("click",function(){methods.destroy()});$("."+globals.modalCancelPositive).bind("click",function(){methods.destroy_positive()});if(settings.callback)settings.callback(methods.show,settings);$this.trigger("modal:afterShow",event)}$(window).unbind("resize");$(window).bind("resize",function(event){methods.reposition()});if(settings.closeOnEscape){$(document).unbind("keyup");$(document).bind("keyup",function(event){if(event.keyCode===27){methods.destroy();
$(".select2-drop").hide()}})}$modalContent.delegate("#a-content-label-input","assistly.labelbox.labelSelected assistly.labelbox.labelUnselected",function(){$this.assistlyModal("reposition")});$modalContent.keydown(function(event){if(event.keyCode===9){$focusDudes=$modalContent.find(":focusable");var currentDude=$focusDudes.index($(event.target));if(event.shiftKey){prev=$focusDudes.eq(currentDude-1).length?$focusDudes.eq(currentDude-1):$focusDudes.eq(0);prev.focus()}else{next=$focusDudes.eq(currentDude+
1).length?$focusDudes.eq(currentDude+1):$focusDudes.eq(0);next.focus()}event.preventDefault()}})},destroy:function(callback){methods.destroy_worker(callback,0)},destroy_positive:function(callback){methods.destroy_worker(callback,1)},destroy_worker:function(callback,trigger_value){topModal=$("."+globals.modalOverlay+":last");topModal.animate({"opacity":"0"},250,function(){topModal.remove();if(callback!=null)callback();$(document).trigger("modal:afterdestroy",trigger_value);if($("."+globals.modalOverlay).length===
0)$("body").removeClass("a-noscroll")})},destroy_first:function(callback){bottomModal=$("."+globals.modalOverlay+":first");bottomModal.animate({"opacity":"0"},250,function(){bottomModal.remove();if(callback!=null)callback();if($("."+globals.modalOverlay).length===0)$("body").removeClass("a-noscroll")})},reposition:function(){$("."+globals.modalOverlay).each(function(){modalOverlay=$(this);modalContent=modalOverlay.find("."+globals.modalContent);if($(this).find(".a-modal-scrollable").length==2)modalScrollable=
modalOverlay.find("."+globals.modalScrollable+":visible");else modalScrollable=modalOverlay.find("."+globals.modalScrollable);modalTop=modalOverlay.find("."+globals.modalTop);modalBottom=modalOverlay.find("."+globals.modalBottom);documentWindow=$(window);if(modalOverlay.hasClass("a-fullscreen")&&!modalContent.hasClass(globals.modalLoading)){$("body").addClass("a-noscroll");modalScrollable.addClass(globals.modalScroll);modalContent.css({"width":documentWindow.width()-globals.bodyPadding,"height":documentWindow.height()-
globals.bodyPadding});var modalBottomHeight=modalOverlay.find(".a-audit-trail").length>0?modalBottom.height()+modalOverlay.find(".a-audit-trail").height():modalBottom.height();modalScrollable.css({"height":documentWindow.height()-globals.bodyPadding-globals.contentPadding*2-modalBottomHeight-(modalScrollable.offset().top-modalTop.offset().top)-20})}else if(modalContent.height()>documentWindow.height()-globals.bodyPadding){modalScrollable.addClass(globals.modalScroll);modalScrollable.css({"height":modalScrollable.height()-
(modalContent.height()-documentWindow.height())-globals.bodyPadding})}modalContent=modalOverlay.find("."+globals.modalContent);modalContent.css({"margin-top":$(window).height()/2-modalContent.height()/2})})}};$.fn.assistlyModal=function(method){if(methods[method])return methods[method].apply(this,Array.prototype.slice.call(arguments,1));else if(typeof method==="object"||!method)return methods.init.apply(this,arguments);else $.error("Method "+method+" does not exist on jQuery.assistlyModal")}})(jQuery);
(function($){var methods={turnOnSwitch:function(){var switchDiv=$(this);var onLabel=switchDiv.find(".a-switch .a-on");var offLabel=switchDiv.find(".a-switch .a-off");onLabel.addClass("a-active");offLabel.removeClass("a-active");if(switchDiv.closest(".a-list"))switchDiv.closest("li").removeClass("a-disabled");var $elem=switchDiv.find(".switch-new");$elem.removeClass("switch-off");$elem.addClass("switch-on")},turnOffSwitch:function(){var switchDiv=$(this);var onLabel=switchDiv.find(".a-switch .a-on");
var offLabel=switchDiv.find(".a-switch .a-off");onLabel.removeClass("a-active");offLabel.addClass("a-active");if(switchDiv.closest(".a-list"))switchDiv.closest("li").addClass("a-disabled");var $elem=switchDiv.find(".switch-new");$elem.removeClass("switch-on");$elem.addClass("switch-off")},init:function(options){var settings={callback_before:false,callback:false,callback_after:false};if(options)$.extend(settings,options);var html='<div class="switch-new"><div class="switch-circle"></div><span class="switch-symbol"><div class="mark-container"></div><div class="forward-slash"></div><div class="back-slash"></div></span></div>';
return this.each(function(){var $this=$(this);if($this.find(".switch-new").length==0){if(Assistly.new_admin_ui&!$this.hasClass("a-special")){var opt=$this.html();$this.html(html+opt);$this.find(".a-on").hide();$this.find(".a-off").hide()}if($this.find("input[type='checkbox']:checked").length>0){$this.find(".a-on").addClass("a-active");$this.find(".a-off").removeClass("a-active");$this.find(".switch-new").addClass("switch-on")}else{$this.find(".a-on").removeClass("a-active");$this.find(".a-off").addClass("a-active");
if($this.closest(".a-list"))$this.closest("li").addClass("a-disabled");$this.find(".switch-new").addClass("switch-off")}$this.find(".switch-new").on("click",function(){var $elem=$(this);var parent=$this.parent();if($elem.hasClass("switch-on")){$elem.removeClass("switch-on");$elem.addClass("switch-off");$elem.parent().find(".a-off").click()}else{$elem.removeClass("switch-off");$elem.addClass("switch-on");$elem.parent().find(".a-on").click()}});methods.bindEvents(settings)}})},bindEvents:function(settings){if($(".a-on").hasClass("a-persistent")==
false)$(".a-on").unbind();$(".a-on").bind("click",function(){var $this=$(this);var status="on";var parent=$this.parent();if(settings.callback_before&&false==settings.callback_before(status,parent))return;$(".a-off",parent).removeClass("a-active");$this.addClass("a-active");parent.find("input[type='checkbox']").prop("checked","checked");if(settings.callback)settings.callback(status,parent);if($this.closest(".a-list"))$this.closest("li").removeClass("a-disabled");if(settings.callback_after)settings.callback_after(status,
parent)});if($(".a-off").hasClass("a-persistent")==false)$(".a-off").unbind();$(".a-off").bind("click",function(){var $this=$(this);var status="off";var parent=$this.parent();if(settings.callback_before&&false==settings.callback_before(status,parent))return;$(".a-on",parent).removeClass("a-active");$this.addClass("a-active");parent.find("input[type='checkbox']").prop("checked",false);if(settings.callback)settings.callback(status,parent);if($this.closest(".a-list"))$this.closest("li").addClass("a-disabled");
if(settings.callback_after)settings.callback_after(status,parent)})}};$.fn.assistlyToggle=function(method){if(methods[method])return methods[method].apply(this,Array.prototype.slice.call(arguments,1));else if(typeof method==="object"||!method)return methods.init.apply(this,arguments);else $.error("Method "+method+" does not exist on jQuery.assistlyToggle")}})(jQuery);
(function($){var globals={tooltip:"a-tooltip"};var methods={init:function(options){var settings={duration:180,topOffset:0};if(options)$.extend(settings,options);return this.each(function(){$this=$(this);$this.bind("mouseover",function(event){event.preventDefault();methods.show($(this),settings)});$this.bind("mouseout",function(event){event.preventDefault();setTimeout(function(){if(!$("#"+globals.tooltip).hasClass("hover"))methods.hide()},200)})})},show:function(element,settings){$("#"+globals.tooltip).hide();
var $tooltip=$("<div/>",{id:globals.tooltip,html:"<div>"+element.attr("rel")+"</div>"});var $tooltipArrow=$("<span/>",{html:"&nbsp;"});$tooltip.append($tooltipArrow);$("body").append($tooltip);if(element.attr("rel").indexOf("<img")!=-1)$tooltip.css({width:"auto"});$tooltip.css({opacity:0,top:element.offset().top-element.height()-$tooltip.height()+settings.topOffset,left:element.offset().left-$tooltip.width()/2+8});$tooltipArrow.css({left:$tooltip.width()/2-$tooltipArrow.width()/2});$tooltip.animate({opacity:1,
top:"-=5px"},settings.duration,"swing");$tooltip.bind("mouseover",function(event){event.preventDefault();$(this).addClass("hover")});$tooltip.bind("mouseout",function(event){$this=$(this);event.preventDefault();$this.removeClass("hover");setTimeout(function(){if(!$this.hasClass("hover"))methods.hide()},200)})},hide:function(){$("#"+globals.tooltip).remove()}};$.fn.assistlyTooltip=function(method){if(methods[method])return methods[method].apply(this,Array.prototype.slice.call(arguments,1));else if(typeof method===
"object"||!method)return methods.init.apply(this,arguments);else $.error("Method "+method+" does not exist on jQuery.assistlyTooltip")}})(jQuery);
(function($){Desk=window.Desk||{};Desk.Achievements=function(){var locale=I18n.strings.agent.achievements;var data=$.extend({},locale.badges);$.each(data,function(key){$.extend(data[key],{unlocked:false,id:key,count:0})});var get=function(achievementType){return data[achievementType]};var list=function(){return $.map(data,function(v,k){return v})};var update=function(achievements,preventGrowl){$.each(achievements,function(key){if(data[key]){if(!preventGrowl&&data[key].count<achievements[key])growl(key);
data[key].count=achievements[key];data[key].unlocked=true}});refresh()};var growl=function(achievementType){var achievement=get(achievementType);return toastr.notify({title:locale.unlocked,iconClass:"toast-achievement",achievementType:achievement.icon,message:"<strong>"+achievement.title+"</strong><p>"+achievement.message+"</p><a>"+locale.view_all+"</a>"})};var close=function(){tb_remove()};var show=function(){close();refresh();tb_show("achievements","#TB_inline?height=550&inlineId=achievements_modal_container&modal=true")};
var refresh=function(){var achievements=list(),container=$("#achievements_modal_container").empty();if(container.length===0)container=$("<div/>",{id:"achievements_modal_container"}).hide().appendTo("body");else;container.template("agent/achievements",achievements)};return{get:get,list:list,show:show,close:close,update:update,refresh:refresh}}()})(jQuery);
(function($){$.expr[":"].agentTab=function(element){return $(element).is("div.a-case-tab")};$.expr[":"].currentAgentTab=function(element){if(isNaN(current_tab_id))return $(element).is(":agentTab:not(.ui-tabs-hide)");else return $(element).is("#tabs-tid_"+current_tab_id)};$.fn.agentTab=function(){return $(this).parents(":agentTab")}})(jQuery);
(function($){$.fn.fancybox=function(options){return this.click(function(e){e.preventDefault();options=options||{};if(!$.fancybox)return;if(!options.autoSize)options.autoSize=false;if(!options.closeClick)options.closeClick=false;$.fancybox.open($(this),options)})}})(jQuery);
(function($){$.template=function(key,data){var templates=AssistlyHB;if(typeof templates[key]==="string")templates[key]=Handlebars.compile(templates[key]);if(typeof templates[key]==="function")return templates[key](data)};$.fn.template=function(key,data){var html=$.template(key,data);return $(this).html(html)}})(jQuery);
(function(window,document,$){var isInputSupported="placeholder"in document.createElement("input"),isTextareaSupported="placeholder"in document.createElement("textarea"),prototype=$.fn,valHooks=$.valHooks,hooks,placeholder;if(isInputSupported&&isTextareaSupported){placeholder=prototype.placeholder=function(){return this};placeholder.input=placeholder.textarea=true}else{placeholder=prototype.placeholder=function(){var $this=this;$this.filter((isInputSupported?"textarea":":input")+"[placeholder]").not(".placeholder").bind({"focus.placeholder":clearPlaceholder,
"blur.placeholder":setPlaceholder}).data("placeholder-enabled",true).trigger("blur.placeholder");return $this};placeholder.input=isInputSupported;placeholder.textarea=isTextareaSupported;hooks={"get":function(element){var $element=$(element);return $element.data("placeholder-enabled")&&$element.hasClass("placeholder")?"":element.value},"set":function(element,value){var $element=$(element);if(!$element.data("placeholder-enabled"))return element.value=value;if(value==""){element.value=value;if(element!=
document.activeElement)setPlaceholder.call(element)}else if($element.hasClass("placeholder"))clearPlaceholder.call(element,true,value)||(element.value=value);else element.value=value;return $element}};isInputSupported||(valHooks.input=hooks);isTextareaSupported||(valHooks.textarea=hooks);$(function(){$(document).delegate("form","submit.placeholder",function(){var $inputs=$(".placeholder",this).each(clearPlaceholder);setTimeout(function(){$inputs.each(setPlaceholder)},10)})});$(window).bind("beforeunload.placeholder",
function(){$(".placeholder").each(function(){this.value=""})})}function args(elem){var newAttrs={},rinlinejQuery=/^jQuery\d+$/;$.each(elem.attributes,function(i,attr){if(attr.specified&&!rinlinejQuery.test(attr.name))newAttrs[attr.name]=attr.value});return newAttrs}function clearPlaceholder(event,value){var input=this,$input=$(input);if(input.value==$input.attr("placeholder")&&$input.hasClass("placeholder"))if($input.data("placeholder-password")){$input=$input.hide().next().show().attr("id",$input.removeAttr("id").data("placeholder-id"));
if(event===true)return $input[0].value=value;$input.focus()}else{input.value="";$input.removeClass("placeholder");input==document.activeElement&&input.select()}}function setPlaceholder(){var $replacement,input=this,$input=$(input),$origInput=$input,id=this.id;if(input.value==""){if(input.type=="password"){if(!$input.data("placeholder-textinput")){try{$replacement=$input.clone().attr({"type":"text"})}catch(e){$replacement=$("<input>").attr($.extend(args(this),{"type":"text"}))}$replacement.removeAttr("name").data({"placeholder-password":true,
"placeholder-id":id}).bind("focus.placeholder",clearPlaceholder);$input.data({"placeholder-textinput":$replacement,"placeholder-id":id}).before($replacement)}$input=$input.removeAttr("id").hide().prev().attr("id",id).show()}$input.addClass("placeholder");$input[0].value=$input.attr("placeholder")}else $input.removeClass("placeholder")}})(this,document,jQuery);
(function(factory){if(typeof define==="function"&&define.amd)define(["jquery"],factory);else factory(jQuery)})(function($){$.timeago=function(timestamp){if(timestamp instanceof Date)return inWords(timestamp);else if(typeof timestamp==="string")return inWords($.timeago.parse(timestamp));else if(typeof timestamp==="number")return inWords(new Date(timestamp));else return inWords($.timeago.datetime(timestamp))};var $t=$.timeago;$.extend($.timeago,{settings:{refreshMillis:6E4,allowFuture:true,localeTitle:false,
strings:{prefixAgo:null,prefixFromNow:"in",suffixAgo:"ago",suffixFromNow:"",seconds:"less than a minute",minute:"about a minute",minutes:"%d minutes",hour:"about an hour",hours:"about %d hours",day:"a day",days:"%d days",month:"about a month",months:"%d months",year:"about a year",years:"%d years",wordSeparator:" ",numbers:[]}},inWords:function(distanceMillis){var $l=this.settings.strings;var prefix=$l.prefixAgo;var suffix=$l.suffixAgo;if(this.settings.allowFuture)if(distanceMillis<0){prefix=$l.prefixFromNow;
suffix=$l.suffixFromNow}var seconds=Math.abs(distanceMillis)/1E3;var minutes=seconds/60;var hours=minutes/60;var days=hours/24;var years=days/365;function substitute(stringOrFunction,number){var string=$.isFunction(stringOrFunction)?stringOrFunction(number,distanceMillis):stringOrFunction;var value=$l.numbers&&$l.numbers[number]||number;return string.replace(/%d/i,value)}var words=seconds<45&&substitute($l.seconds,Math.round(seconds))||seconds<90&&substitute($l.minute,1)||minutes<45&&substitute($l.minutes,
Math.round(minutes))||minutes<90&&substitute($l.hour,1)||hours<24&&substitute($l.hours,Math.round(hours))||hours<42&&substitute($l.day,1)||days<30&&substitute($l.days,Math.round(days))||days<45&&substitute($l.month,1)||days<365&&substitute($l.months,Math.round(days/30))||years<1.5&&substitute($l.year,1)||substitute($l.years,Math.round(years));var separator=$l.wordSeparator||"";if($l.wordSeparator===undefined)separator=" ";return $.trim([prefix,words,suffix].join(separator))},parse:function(iso8601){var s=
$.trim(iso8601);s=s.replace(/\.\d+/,"");s=s.replace(/-/,"/").replace(/-/,"/");s=s.replace(/T/," ").replace(/Z/," UTC");s=s.replace(/([\+\-]\d\d)\:?(\d\d)/," $1$2");return new Date(s)},datetime:function(elem){var iso8601=$t.isTime(elem)?$(elem).attr("datetime"):$(elem).attr("title");return $t.parse(iso8601)},isTime:function(elem){return $(elem).get(0).tagName.toLowerCase()==="time"}});var functions={init:function(){var refresh_el=$.proxy(refresh,this);refresh_el();var $s=$t.settings;if($s.refreshMillis>
0)setInterval(refresh_el,$s.refreshMillis)},update:function(time){$(this).data("timeago",{datetime:$t.parse(time)});refresh.apply(this)}};$.fn.timeago=function(action,options){var fn=action?functions[action]:functions.init;if(!fn)throw new Error("Unknown function name '"+action+"' for timeago");this.each(function(){fn.call(this,options)});return this};function refresh(){var data=prepareData(this);if(!isNaN(data.datetime))$(this).text(inWords(data.datetime));return this}function prepareData(element){element=
$(element);if(!element.data("timeago")){element.data("timeago",{datetime:$t.datetime(element)});var text=$.trim(element.text());if($t.settings.localeTitle)element.attr("title",element.data("timeago").datetime.toLocaleString());else if(text.length>0&&!($t.isTime(element)&&element.attr("title")))element.attr("title",text)}return element.data("timeago")}function inWords(date){return $t.inWords(distance(date))}function distance(date){return(new Date).getTime()-date.getTime()}document.createElement("abbr");
document.createElement("time")});
var dateFormat=function(){var token=/d{1,4}|m{1,4}|yy(?:yy)?|([HhMsTt])\1?|[LloSZ]|"[^"]*"|'[^']*'/g,timezone=/\b(?:[PMCEA][SDP]T|(?:Pacific|Mountain|Central|Eastern|Atlantic) (?:Standard|Daylight|Prevailing) Time|(?:GMT|UTC)(?:[-+]\d{4})?)\b/g,timezoneClip=/[^-+\dA-Z]/g,pad=function(val,len){val=String(val);len=len||2;while(val.length<len)val="0"+val;return val};return function(date,mask,utc){var dF=dateFormat;if(arguments.length==1&&Object.prototype.toString.call(date)=="[object String]"&&!/\d/.test(date)){mask=
date;date=undefined}date=date?new Date(date):new Date;if(isNaN(date))throw SyntaxError("invalid date");mask=String(dF.masks[mask]||mask||dF.masks["default"]);if(mask.slice(0,4)=="UTC:"){mask=mask.slice(4);utc=true}var _=utc?"getUTC":"get",d=date[_+"Date"](),D=date[_+"Day"](),m=date[_+"Month"](),y=date[_+"FullYear"](),H=date[_+"Hours"](),M=date[_+"Minutes"](),s=date[_+"Seconds"](),L=date[_+"Milliseconds"](),o=utc?0:date.getTimezoneOffset(),flags={d:d,dd:pad(d),ddd:dF.i18n.dayNames[D],dddd:dF.i18n.dayNames[D+
7],m:m+1,mm:pad(m+1),mmm:dF.i18n.monthNames[m],mmmm:dF.i18n.monthNames[m+12],yy:String(y).slice(2),yyyy:y,h:H%12||12,hh:pad(H%12||12),H:H,HH:pad(H),M:M,MM:pad(M),s:s,ss:pad(s),l:pad(L,3),L:pad(L>99?Math.round(L/10):L),t:H<12?"a":"p",tt:H<12?"am":"pm",T:H<12?"A":"P",TT:H<12?"AM":"PM",Z:utc?"UTC":(String(date).match(timezone)||[""]).pop().replace(timezoneClip,""),o:(o>0?"-":"+")+pad(Math.floor(Math.abs(o)/60)*100+Math.abs(o)%60,4),S:["th","st","nd","rd"][d%10>3?0:(d%100-d%10!=10)*d%10]};return mask.replace(token,
function($0){return $0 in flags?flags[$0]:$0.slice(1,$0.length-1)})}}();dateFormat.masks={"default":"ddd mmm dd yyyy HH:MM:ss",shortDate:"m/d/yy",mediumDate:"mmm d, yyyy",longDate:"mmmm d, yyyy",fullDate:"dddd, mmmm d, yyyy",shortTime:"h:MM TT",mediumTime:"h:MM:ss TT",longTime:"h:MM:ss TT Z",isoDate:"yyyy-mm-dd",isoTime:"HH:MM:ss",isoDateTime:"yyyy-mm-dd'T'HH:MM:ss",isoUtcDateTime:"UTC:yyyy-mm-dd'T'HH:MM:ss'Z'"};
dateFormat.i18n={dayNames:["Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],monthNames:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec","January","February","March","April","May","June","July","August","September","October","November","December"]};Date.prototype.format=function(mask,utc){return dateFormat(this,mask,utc)};var Stopwatch;if(!Stopwatch)Stopwatch={};
function Stopwatch(displayTime,runtime){this.runtime=runtime;this.timer=null;this.displayTime=displayTime;this.inited=false}Stopwatch.INCREMENT=1E3;Stopwatch.prototype.doDisplay=function(){if(!this.laptime)this.displayTime(this.runtime);else this.displayTime(this.laptime)};Stopwatch.prototype.updateRuntime=function(runtime){this.runtime=runtime};Stopwatch.prototype.isRunning=function(runtime){if(this.timer==null)return false;else return true};
Stopwatch.prototype.startStop=function(){if(!this.timer){var instance=this;this.timer=window.setInterval(function(){instance.runtime+=Stopwatch.INCREMENT;instance.doDisplay()},Stopwatch.INCREMENT)}else{window.clearInterval(this.timer);this.timer=null;this.doDisplay()}};Stopwatch.prototype.start=function(){if(!this.timer){var instance=this;this.timer=window.setInterval(function(){instance.runtime+=Stopwatch.INCREMENT;instance.doDisplay()},Stopwatch.INCREMENT)}};
Stopwatch.prototype.stop=function(){if(this.timer){window.clearInterval(this.timer);this.timer=null;this.doDisplay()}};Stopwatch.prototype.resetLap=function(){if(!this.laptime)if(this.timer)this.laptime=this.runtime;else this.runtime=0;else delete this.laptime;this.doDisplay()};
function calculate_time_zone(){var rightNow=new Date;var jan1=new Date(rightNow.getFullYear(),0,1,0,0,0,0);var june1=new Date(rightNow.getFullYear(),6,1,0,0,0,0);var temp=jan1.toGMTString();var jan2=new Date(temp.substring(0,temp.lastIndexOf(" ")-1));temp=june1.toGMTString();var june2=new Date(temp.substring(0,temp.lastIndexOf(" ")-1));var std_time_offset=(jan1-jan2)/(1E3*60*60);var daylight_time_offset=(june1-june2)/(1E3*60*60);var dst;if(std_time_offset==daylight_time_offset)dst="0";else{var hemisphere=
std_time_offset-daylight_time_offset;if(hemisphere>=0)std_time_offset=daylight_time_offset;dst="1"}var i;return convert(std_time_offset)+","+dst}
function convert(value){var hours=parseInt(value);value-=parseInt(value);value*=60;var mins=parseInt(value);value-=parseInt(value);value*=60;var secs=parseInt(value);var display_hours=hours;if(hours==0)display_hours="00";else if(hours>0)display_hours=hours<10?"+0"+hours:"+"+hours;else display_hours=hours>-10?"-0"+Math.abs(hours):hours;mins=mins<10?"0"+mins:mins;return display_hours+":"+mins}
(function(){var dep={"jQuery":"http://code.jquery.com/jquery-latest.min.js"};var init=function(){(function($){$.fn.idTabs=function(){var s={};for(var i=0;i<arguments.length;++i){var a=arguments[i];switch(a.constructor){case Object:$.extend(s,a);break;case Boolean:s.change=a;break;case Number:s.start=a;break;case Function:s.click=a;break;case String:if(a.charAt(0)==".")s.selected=a;else if(a.charAt(0)=="!")s.event=a;else s.start=a;break}}if(typeof s["return"]=="function")s.change=s["return"];return this.each(function(){$.idTabs(this,
s)})};$.idTabs=function(tabs,options){var meta=$.metadata?$(tabs).metadata():{};var s=$.extend({},$.idTabs.settings,meta,options);if(s.selected.charAt(0)==".")s.selected=s.selected.substr(1);if(s.event.charAt(0)=="!")s.event=s.event.substr(1);if(s.start==null)s.start=-1;var showId=function(){if($(this).is("."+s.selected))return s.change;var id="#"+this.href.split("#")[1];var aList=[];var idList=[];$("a",tabs).each(function(){if(this.href.match(/#/)){aList.push(this);idList.push("#"+this.href.split("#")[1])}});
if(s.click&&!s.click.apply(this,[id,idList,tabs,s]))return s.change;for(i in aList)$(aList[i]).removeClass(s.selected);for(i in idList)$(idList[i]).hide();$(this).addClass(s.selected);$(id).show();return s.change};var list=$("a[href*='#']",tabs).unbind(s.event,showId).bind(s.event,showId);list.each(function(){$("#"+this.href.split("#")[1]).hide()});var test=false;if((test=list.filter("."+s.selected)).length);else if(typeof s.start=="number"&&(test=list.eq(s.start)).length);else if(typeof s.start==
"string"&&(test=list.filter("[href*='#"+s.start+"']")).length);if(test){test.removeClass(s.selected);test.trigger(s.event)}return s};$.idTabs.settings={start:0,change:false,click:null,selected:".selected",event:"!click"};$.idTabs.version="2.2";$(function(){$(".idTabs").idTabs()})})(jQuery)};var check=function(o,s){s=s.split(".");while(o&&s.length)o=o[s.shift()];return o};var head=document.getElementsByTagName("head")[0];var add=function(url){var s=document.createElement("script");s.type="text/javascript";
s.src=url;head.appendChild(s)};var s=document.getElementsByTagName("script");var src=s[s.length-1].src;var ok=true;for(d in dep){if(check(this,d))continue;ok=false;add(dep[d])}if(ok)return init();add(src)})();
(function(a){var c=(a.browser.msie?"paste":"input")+".mask";var b=window.orientation!=undefined;a.mask={definitions:{9:"[0-9]",a:"[A-Za-z]","*":"[A-Za-z0-9]"}};a.fn.extend({caret:function(e,f){if(this.length==0)return;if(typeof e=="number"){f=typeof f=="number"?f:e;return this.each(function(){if(this.setSelectionRange){this.focus();this.setSelectionRange(e,f)}else if(this.createTextRange){var g=this.createTextRange();g.collapse(true);g.moveEnd("character",f);g.moveStart("character",e);g.select()}})}else{if(this[0].setSelectionRange){e=
this[0].selectionStart;f=this[0].selectionEnd}else if(document.selection&&document.selection.createRange){var d=document.selection.createRange();e=0-d.duplicate().moveStart("character",-1E5);f=e+d.text.length}return{begin:e,end:f}}},unmask:function(){return this.trigger("unmask")},mask:function(j,d){if(!j&&this.length>0){var f=a(this[0]);var g=f.data("tests");return a.map(f.data("buffer"),function(l,m){return g[m]?l:null}).join("")}d=a.extend({placeholder:"_",completed:null},d);var k=a.mask.definitions;
var g=[];var e=j.length;var i=null;var h=j.length;a.each(j.split(""),function(m,l){if(l=="?"){h--;e=m}else if(k[l]){g.push(new RegExp(k[l]));if(i==null)i=g.length-1}else g.push(null)});return this.each(function(){var r=a(this);var m=a.map(j.split(""),function(x,y){if(x!="?")return k[x]?d.placeholder:x});var n=false;var q=r.val();r.data("buffer",m).data("tests",g);function v(x){while(++x<=h&&!g[x]);return x}function t(x){while(!g[x]&&--x>=0);for(var y=x;y<h;y++)if(g[y]){m[y]=d.placeholder;var z=v(y);
if(z<h&&g[y].test(m[z]))m[y]=m[z];else break}s();r.caret(Math.max(i,x))}function u(y){for(var A=y,z=d.placeholder;A<h;A++)if(g[A]){var B=v(A);var x=m[A];m[A]=z;if(B<h&&g[B].test(x))z=x;else break}}function l(y){var x=a(this).caret();var z=y.keyCode;n=z<16||z>16&&z<32||z>32&&z<41;if(x.begin-x.end!=0&&(!n||z==8||z==46))w(x.begin,x.end);if(z==8||z==46||b&&z==127){t(x.begin+(z==46?0:-1));return false}else if(z==27){r.val(q);r.caret(0,p());return false}}function o(B){if(n){n=false;return B.keyCode==8?
false:null}B=B||window.event;var C=B.charCode||B.keyCode||B.which;var z=a(this).caret();if(B.ctrlKey||B.altKey||B.metaKey)return true;else if(C>=32&&C<=125||C>186){var x=v(z.begin-1);if(x<h){var A=String.fromCharCode(C);if(g[x].test(A)){u(x);m[x]=A;s();var y=v(x);a(this).caret(y);if(d.completed&&y==h)d.completed.call(r)}}}return false}function w(x,y){for(var z=x;z<y&&z<h;z++)if(g[z])m[z]=d.placeholder}function s(){return r.val(m.join("")).val()}function p(y){var z=r.val();var C=-1;for(var B=0,x=0;B<
h;B++)if(g[B]){m[B]=d.placeholder;while(x++<z.length){var A=z.charAt(x-1);if(g[B].test(A)){m[B]=A;C=B;break}}if(x>z.length)break}else if(m[B]==z[x]&&B!=e){x++;C=B}if(!y&&C+1<e){r.val("");w(0,h)}else if(y||C+1>=e){s();if(!y)r.val(r.val().substring(0,C+1))}return e?B:i}if(!r.attr("readonly"))r.one("unmask",function(){r.unbind(".mask").removeData("buffer").removeData("tests")}).bind("focus.mask",function(){q=r.val();var x=p();s();setTimeout(function(){if(x==j.length)r.caret(0,x);else r.caret(x)},0)}).bind("blur.mask",
function(){p();if(r.val()!=q)r.change()}).bind("keydown.mask",l).bind("keypress.mask",o).bind(c,function(){setTimeout(function(){r.caret(p(true))},0)});p()})}})})(jQuery);
(function($){$.fn.alphanumeric=function(p){p=$.extend({allow:"",disallow:"",allow_wide:false},p);this.IsValid=function(){ret=true;this.each(function(){if(!this.IsValid())ret=false});return ret};return this.each(function(){var allowedchars="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";var nonalphanums="!@#$%^&*()+=[]\\';,/{}|\":<>?~`.- ";allowedchars+=p.allow;var me=this;$(this).keypress(function(e){var c=String.fromCharCode(e.which||e.charCode);if(!e.charCode&&{"0":1,8:1}[e.which]&&
{8:1,9:1,37:1,39:1,46:1}[e.keyCode])return;if(!checkChar(c))e.preventDefault()});$(this).bind("paste",function(e){var ob=$(this);setTimeout(function(){cleanPaste(ob)},1)});function cleanPaste(ob){if(!checkChars(ob.val()))ob.val("")}function checkChars(str){var ret=true;try{$.each(str,function(i){var c=str.charAt(i);if(!checkChar(c)){ret=false;return}})}catch(e){}return ret}function checkChar(c){if(p.disallow.indexOf(c)>=0)return false;if(p.allow.indexOf(c)>=0)return true;if(p.allow_wide){if(nonalphanums.indexOf(c)>=
0)return false}else if(allowedchars.indexOf(c)==-1)return false;return true}$(this).bind("contextmenu",function(){return false});this.IsValid=function(){return checkChars($(me).val())}})};$.fn.numeric=function(p){var az="abcdefghijklmnopqrstuvwxyz";az+=az.toUpperCase();p=$.extend({disallow:az},p);return this.each(function(){$(this).alphanumeric(p)})};$.fn.alpha=function(p){var nm="1234567890";p=$.extend({disallow:nm},p);return this.each(function(){$(this).alphanumeric(p)})}})(jQuery);
(function($){$.fn.hoverIntent=function(f,g){var cfg={sensitivity:7,interval:100,timeout:0};cfg=$.extend(cfg,g?{over:f,out:g}:f);var cX,cY,pX,pY;var track=function(ev){cX=ev.pageX;cY=ev.pageY};var compare=function(ev,ob){ob.hoverIntent_t=clearTimeout(ob.hoverIntent_t);if(Math.abs(pX-cX)+Math.abs(pY-cY)<cfg.sensitivity){$(ob).unbind("mousemove",track);ob.hoverIntent_s=1;return cfg.over.apply(ob,[ev])}else{pX=cX;pY=cY;ob.hoverIntent_t=setTimeout(function(){compare(ev,ob)},cfg.interval)}};var delay=function(ev,
ob){ob.hoverIntent_t=clearTimeout(ob.hoverIntent_t);ob.hoverIntent_s=0;return cfg.out.apply(ob,[ev])};var handleHover=function(e){var ev=jQuery.extend({},e);var ob=this;if(ob.hoverIntent_t)ob.hoverIntent_t=clearTimeout(ob.hoverIntent_t);if(e.type=="mouseenter"){pX=ev.pageX;pY=ev.pageY;$(ob).bind("mousemove",track);if(ob.hoverIntent_s!=1)ob.hoverIntent_t=setTimeout(function(){compare(ev,ob)},cfg.interval)}else{$(ob).unbind("mousemove",track);if(ob.hoverIntent_s==1)ob.hoverIntent_t=setTimeout(function(){delay(ev,
ob)},cfg.timeout)}};return this.bind("mouseenter",handleHover).bind("mouseleave",handleHover)}})(jQuery);
(function($){function Countdown(){this.regional=[];this.regional[""]={labels:["Years","Months","Weeks","Days","Hours","Minutes","Seconds"],labels1:["Year","Month","Week","Day","Hour","Minute","Second"],compactLabels:["y","m","w","d"],timeSeparator:":",isRTL:false};this._defaults={until:null,since:null,timezone:null,serverSync:null,format:"dHMS",layout:"",compact:false,description:"",expiryUrl:"",expiryText:"",alwaysExpire:false,onExpiry:null,onTick:null,tickInterval:1};$.extend(this._defaults,this.regional[""]);
this._serverSyncs=[]}var w="countdown";var Y=0;var O=1;var W=2;var D=3;var H=4;var M=5;var S=6;$.extend(Countdown.prototype,{markerClassName:"hasCountdown",_timer:setInterval(function(){$.countdown._updateTargets()},980),_timerTargets:[],setDefaults:function(a){this._resetExtraLabels(this._defaults,a);extendRemove(this._defaults,a||{})},UTCDate:function(a,b,c,e,f,g,h,i){if(typeof b=="object"&&b.constructor==Date){i=b.getMilliseconds();h=b.getSeconds();g=b.getMinutes();f=b.getHours();e=b.getDate();
c=b.getMonth();b=b.getFullYear()}var d=new Date;d.setUTCFullYear(b);d.setUTCDate(1);d.setUTCMonth(c||0);d.setUTCDate(e||1);d.setUTCHours(f||0);d.setUTCMinutes((g||0)-(Math.abs(a)<30?a*60:a));d.setUTCSeconds(h||0);d.setUTCMilliseconds(i||0);return d},periodsToSeconds:function(a){return a[0]*31557600+a[1]*2629800+a[2]*604800+a[3]*86400+a[4]*3600+a[5]*60+a[6]},_settingsCountdown:function(a,b){if(!b)return $.countdown._defaults;var c=$.data(a,w);return b=="all"?c.options:c.options[b]},_attachCountdown:function(a,
b){var c=$(a);if(c.hasClass(this.markerClassName))return;c.addClass(this.markerClassName);var d={options:$.extend({},b),_periods:[0,0,0,0,0,0,0]};$.data(a,w,d);this._changeCountdown(a)},_addTarget:function(a){if(!this._hasTarget(a))this._timerTargets.push(a)},_hasTarget:function(a){return $.inArray(a,this._timerTargets)>-1},_removeTarget:function(b){this._timerTargets=$.map(this._timerTargets,function(a){return a==b?null:a})},_updateTargets:function(){for(var i=this._timerTargets.length-1;i>=0;i--)this._updateCountdown(this._timerTargets[i])},
_updateCountdown:function(a,b){var c=$(a);b=b||$.data(a,w);if(!b)return;c.html(this._generateHTML(b));c[(this._get(b,"isRTL")?"add":"remove")+"Class"]("countdown_rtl");var d=this._get(b,"onTick");if(d){var e=b._hold!="lap"?b._periods:this._calculatePeriods(b,b._show,new Date);var f=this._get(b,"tickInterval");if(f==1||this.periodsToSeconds(e)%f==0)d.apply(a,[e])}var g=b._hold!="pause"&&(b._since?b._now.getTime()<b._since.getTime():b._now.getTime()>=b._until.getTime());if(g&&!b._expiring){b._expiring=
true;if(this._hasTarget(a)||this._get(b,"alwaysExpire")){this._removeTarget(a);var h=this._get(b,"onExpiry");if(h)h.apply(a,[]);var i=this._get(b,"expiryText");if(i){var j=this._get(b,"layout");b.options.layout=i;this._updateCountdown(a,b);b.options.layout=j}var k=this._get(b,"expiryUrl");if(k)window.location=k}b._expiring=false}else if(b._hold=="pause")this._removeTarget(a);$.data(a,w,b)},_changeCountdown:function(a,b,c){b=b||{};if(typeof b=="string"){var d=b;b={};b[d]=c}var e=$.data(a,w);if(e){this._resetExtraLabels(e.options,
b);extendRemove(e.options,b);this._adjustSettings(a,e);$.data(a,w,e);var f=new Date;if(e._since&&e._since<f||e._until&&e._until>f)this._addTarget(a);this._updateCountdown(a,e)}},_resetExtraLabels:function(a,b){var c=false;for(var n in b)if(n.match(/[Ll]abels/)){c=true;break}if(c)for(var n in a)if(n.match(/[Ll]abels[0-9]/))a[n]=null},_adjustSettings:function(a,b){var c;var d=this._get(b,"serverSync");var e=0;var f=null;for(var i=0;i<this._serverSyncs.length;i++)if(this._serverSyncs[i][0]==d){f=this._serverSyncs[i][1];
break}if(f!=null){e=d?f:0;c=new Date}else{var g=d?d.apply(a,[]):null;c=new Date;e=g?c.getTime()-g.getTime():0;this._serverSyncs.push([d,e])}var h=this._get(b,"timezone");h=h==null?-c.getTimezoneOffset():h;b._since=this._get(b,"since");if(b._since!=null){b._since=this.UTCDate(h,this._determineTime(b._since,null));if(b._since&&e)b._since.setMilliseconds(b._since.getMilliseconds()+e)}b._until=this.UTCDate(h,this._determineTime(this._get(b,"until"),c));if(e)b._until.setMilliseconds(b._until.getMilliseconds()+
e);b._show=this._determineShow(b)},_destroyCountdown:function(a){var b=$(a);if(!b.hasClass(this.markerClassName))return;this._removeTarget(a);b.removeClass(this.markerClassName).empty();$.removeData(a,w)},_pauseCountdown:function(a){this._hold(a,"pause")},_lapCountdown:function(a){this._hold(a,"lap")},_resumeCountdown:function(a){this._hold(a,null)},_hold:function(a,b){var c=$.data(a,w);if(c){if(c._hold=="pause"&&!b){c._periods=c._savePeriods;var d=c._since?"-":"+";c[c._since?"_since":"_until"]=this._determineTime(d+
c._periods[0]+"y"+d+c._periods[1]+"o"+d+c._periods[2]+"w"+d+c._periods[3]+"d"+d+c._periods[4]+"h"+d+c._periods[5]+"m"+d+c._periods[6]+"s");this._addTarget(a)}c._hold=b;c._savePeriods=b=="pause"?c._periods:null;$.data(a,w,c);this._updateCountdown(a,c)}},_getTimesCountdown:function(a){var b=$.data(a,w);return!b?null:!b._hold?b._periods:this._calculatePeriods(b,b._show,new Date)},_get:function(a,b){return a.options[b]!=null?a.options[b]:$.countdown._defaults[b]},_determineTime:function(k,l){var m=function(a){var b=
new Date;b.setTime(b.getTime()+a*1E3);return b};var n=function(a){a=a.toLowerCase();var b=new Date;var c=b.getFullYear();var d=b.getMonth();var e=b.getDate();var f=b.getHours();var g=b.getMinutes();var h=b.getSeconds();var i=/([+-]?[0-9]+)\s*(s|m|h|d|w|o|y)?/g;var j=i.exec(a);while(j){switch(j[2]||"s"){case "s":h+=parseInt(j[1],10);break;case "m":g+=parseInt(j[1],10);break;case "h":f+=parseInt(j[1],10);break;case "d":e+=parseInt(j[1],10);break;case "w":e+=parseInt(j[1],10)*7;break;case "o":d+=parseInt(j[1],
10);e=Math.min(e,$.countdown._getDaysInMonth(c,d));break;case "y":c+=parseInt(j[1],10);e=Math.min(e,$.countdown._getDaysInMonth(c,d));break}j=i.exec(a)}return new Date(c,d,e,f,g,h,0)};var o=k==null?l:typeof k=="string"?n(k):typeof k=="number"?m(k):k;if(o)o.setMilliseconds(0);return o},_getDaysInMonth:function(a,b){return 32-(new Date(a,b,32)).getDate()},_generateHTML:function(c){c._periods=periods=c._hold?c._periods:this._calculatePeriods(c,c._show,new Date);var d=false;var e=0;var f=$.extend({},
c._show);for(var g=0;g<c._show.length;g++){d|=c._show[g]=="?"&&periods[g]>0;f[g]=c._show[g]=="?"&&!d?null:c._show[g];e+=f[g]?1:0}var h=this._get(c,"compact");var i=this._get(c,"layout");var j=h?this._get(c,"compactLabels"):this._get(c,"labels");var k=this._get(c,"timeSeparator");var l=this._get(c,"description")||"";var m=function(a){var b=$.countdown._get(c,"compactLabels"+periods[a]);return f[a]?periods[a]+(b?b[a]:j[a])+" ":""};var n=function(a){var b=$.countdown._get(c,"labels"+periods[a]);return f[a]?
'<span class="countdown_section"><span class="countdown_amount">'+periods[a]+"</span><br/>"+(b?b[a]:j[a])+"</span>":""};return i?this._buildLayout(c,f,i,h):(h?'<span class="countdown_row countdown_amount'+(c._hold?" countdown_holding":"")+'">'+m(Y)+m(O)+m(W)+m(D)+(f[H]?this._minDigits(periods[H],2):"")+(f[M]?(f[H]?k:"")+this._minDigits(periods[M],2):"")+(f[S]?(f[H]||f[M]?k:"")+this._minDigits(periods[S],2):""):'<span class="countdown_row countdown_show'+e+(c._hold?" countdown_holding":"")+'">'+n(Y)+
n(O)+n(W)+n(D)+n(H)+n(M)+n(S))+"</span>"+(l?'<span class="countdown_row countdown_descr">'+l+"</span>":"")},_buildLayout:function(c,d,e,f){var g=this._get(c,f?"compactLabels":"labels");var h=function(a){return($.countdown._get(c,(f?"compactLabels":"labels")+c._periods[a])||g)[a]};var j=function(a,b){return Math.floor(a/b)%10};var k={desc:this._get(c,"description"),sep:this._get(c,"timeSeparator"),yl:h(Y),yn:c._periods[Y],ynn:this._minDigits(c._periods[Y],2),ynnn:this._minDigits(c._periods[Y],3),y1:j(c._periods[Y],
1),y10:j(c._periods[Y],10),y100:j(c._periods[Y],100),y1000:j(c._periods[Y],1E3),ol:h(O),on:c._periods[O],onn:this._minDigits(c._periods[O],2),onnn:this._minDigits(c._periods[O],3),o1:j(c._periods[O],1),o10:j(c._periods[O],10),o100:j(c._periods[O],100),o1000:j(c._periods[O],1E3),wl:h(W),wn:c._periods[W],wnn:this._minDigits(c._periods[W],2),wnnn:this._minDigits(c._periods[W],3),w1:j(c._periods[W],1),w10:j(c._periods[W],10),w100:j(c._periods[W],100),w1000:j(c._periods[W],1E3),dl:h(D),dn:c._periods[D],
dnn:this._minDigits(c._periods[D],2),dnnn:this._minDigits(c._periods[D],3),d1:j(c._periods[D],1),d10:j(c._periods[D],10),d100:j(c._periods[D],100),d1000:j(c._periods[D],1E3),hl:h(H),hn:c._periods[H],hnn:this._minDigits(c._periods[H],2),hnnn:this._minDigits(c._periods[H],3),h1:j(c._periods[H],1),h10:j(c._periods[H],10),h100:j(c._periods[H],100),h1000:j(c._periods[H],1E3),ml:h(M),mn:c._periods[M],mnn:this._minDigits(c._periods[M],2),mnnn:this._minDigits(c._periods[M],3),m1:j(c._periods[M],1),m10:j(c._periods[M],
10),m100:j(c._periods[M],100),m1000:j(c._periods[M],1E3),sl:h(S),sn:c._periods[S],snn:this._minDigits(c._periods[S],2),snnn:this._minDigits(c._periods[S],3),s1:j(c._periods[S],1),s10:j(c._periods[S],10),s100:j(c._periods[S],100),s1000:j(c._periods[S],1E3)};var l=e;for(var i=0;i<7;i++){var m="yowdhms".charAt(i);var o=new RegExp("\\{"+m+"<\\}(.*)\\{"+m+">\\}","g");l=l.replace(o,d[i]?"$1":"")}$.each(k,function(n,v){var a=new RegExp("\\{"+n+"\\}","g");l=l.replace(a,v)});return l},_minDigits:function(a,
b){a=""+a;if(a.length>=b)return a;a="0000000000"+a;return a.substr(a.length-b)},_determineShow:function(a){var b=this._get(a,"format");var c=[];c[Y]=b.match("y")?"?":b.match("Y")?"!":null;c[O]=b.match("o")?"?":b.match("O")?"!":null;c[W]=b.match("w")?"?":b.match("W")?"!":null;c[D]=b.match("d")?"?":b.match("D")?"!":null;c[H]=b.match("h")?"?":b.match("H")?"!":null;c[M]=b.match("m")?"?":b.match("M")?"!":null;c[S]=b.match("s")?"?":b.match("S")?"!":null;return c},_calculatePeriods:function(f,g,h){f._now=
h;f._now.setMilliseconds(0);var i=new Date(f._now.getTime());if(f._since)if(h.getTime()<f._since.getTime())f._now=h=i;else h=f._since;else{i.setTime(f._until.getTime());if(h.getTime()>f._until.getTime())f._now=h=i}var j=[0,0,0,0,0,0,0];if(g[Y]||g[O]){var k=$.countdown._getDaysInMonth(h.getFullYear(),h.getMonth());var l=$.countdown._getDaysInMonth(i.getFullYear(),i.getMonth());var m=i.getDate()==h.getDate()||i.getDate()>=Math.min(k,l)&&h.getDate()>=Math.min(k,l);var n=function(a){return(a.getHours()*
60+a.getMinutes())*60+a.getSeconds()};var o=Math.max(0,(i.getFullYear()-h.getFullYear())*12+i.getMonth()-h.getMonth()+(i.getDate()<h.getDate()&&!m||m&&n(i)<n(h)?-1:0));j[Y]=g[Y]?Math.floor(o/12):0;j[O]=g[O]?o-j[Y]*12:0;var p=function(a,b,c){var d=a.getDate()==c;var e=$.countdown._getDaysInMonth(a.getFullYear()+b*j[Y],a.getMonth()+b*j[O]);if(a.getDate()>e)a.setDate(e);a.setFullYear(a.getFullYear()+b*j[Y]);a.setMonth(a.getMonth()+b*j[O]);if(d)a.setDate(e);return a};if(f._since)i=p(i,-1,l);else h=p(new Date(h.getTime()),
+1,k)}var q=Math.floor((i.getTime()-h.getTime())/1E3);var r=function(a,b){j[a]=g[a]?Math.floor(q/b):0;q-=j[a]*b};r(W,604800);r(D,86400);r(H,3600);r(M,60);r(S,1);if(q>0&&!f._since){var s=[1,12,4.3482,7,24,60,60];var t=S;var u=1;for(var v=S;v>=Y;v--){if(g[v]){if(j[t]>=u){j[t]=0;q=1}if(q>0){j[v]++;q=0;t=v;u=1}}u*=s[v]}}return j}});function extendRemove(a,b){$.extend(a,b);for(var c in b)if(b[c]==null)a[c]=null;return a}$.fn.countdown=function(a){var b=Array.prototype.slice.call(arguments,1);if(a=="getTimes"||
a=="settings")return $.countdown["_"+a+"Countdown"].apply($.countdown,[this[0]].concat(b));return this.each(function(){if(typeof a=="string")$.countdown["_"+a+"Countdown"].apply($.countdown,[this].concat(b));else $.countdown._attachCountdown(this,a)})};$.countdown=new Countdown})(jQuery);
(function($){$.fn.charLimit=function(options){var defaults={limit:30,speed:"normal",descending:true,default_color:"#000",orange_color:"orange",red_color:"red",chop:false,hardStop:true,countFunction:null};var o=$.extend(defaults,options);return this.each(function(i){var obj=$(this);function countChars(){if(o.countFunction)var value=o.descending?o.limit-o.countFunction(obj):o.countFunction(obj);else var value=o.descending?o.limit-obj.val().length:obj.val().length;$(o.display_box).text(value);if(value>
o.warn_orange)$(o.display_box).css("color",o.default_color);if(value<=o.warn_orange&&value>o.warn_red)$(o.display_box).css("color",o.orange_color);if(value<=o.warn_red)$(o.display_box).css("color",o.red_color)}countChars();obj.keydown(function(e){if(o.hardStop&&obj.val().length>=o.limit&&e.keyCode!="8"&&e.keyCode!="9"&&e.keyCode!="46"&&e.keyCode!="37"&&e.keyCode!="38"&&e.keyCode!="39"&&e.keyCode!="40")e.preventDefault();countChars()}).keyup(function(e){if(obj.val().length>=o.limit&&o.chop)obj.val(obj.val().substr(0,
o.limit));countChars();if(o.callback)o.callback()}).focus(function(){countChars();if(o.callback)o.callback()}).blur(function(){})})}})(jQuery);
(function(){if(typeof twttr==="undefined"||twttr===null)var twttr={};twttr.txt={};twttr.txt.regexen={};var HTML_ENTITIES={"&":"&amp;",">":"&gt;","<":"&lt;",'"':"&quot;","'":"&#39;"};twttr.txt.htmlEscape=function(text){return text&&text.replace(/[&"'><]/g,function(character){return HTML_ENTITIES[character]})};function regexSupplant(regex,flags){flags=flags||"";if(typeof regex!=="string"){if(regex.global&&flags.indexOf("g")<0)flags+="g";if(regex.ignoreCase&&flags.indexOf("i")<0)flags+="i";if(regex.multiline&&
flags.indexOf("m")<0)flags+="m";regex=regex.source}return new RegExp(regex.replace(/#\{(\w+)\}/g,function(match,name){var newRegex=twttr.txt.regexen[name]||"";if(typeof newRegex!=="string")newRegex=newRegex.source;return newRegex}),flags)}twttr.txt.regexSupplant=regexSupplant;function stringSupplant(str,values){return str.replace(/#\{(\w+)\}/g,function(match,name){return values[name]||""})}twttr.txt.stringSupplant=stringSupplant;function addCharsToCharClass(charClass,start,end){var s=String.fromCharCode(start);
if(end!==start)s+="-"+String.fromCharCode(end);charClass.push(s);return charClass}twttr.txt.addCharsToCharClass=addCharsToCharClass;var fromCode=String.fromCharCode;var UNICODE_SPACES=[fromCode(32),fromCode(133),fromCode(160),fromCode(5760),fromCode(6158),fromCode(8232),fromCode(8233),fromCode(8239),fromCode(8287),fromCode(12288)];addCharsToCharClass(UNICODE_SPACES,9,13);addCharsToCharClass(UNICODE_SPACES,8192,8202);var INVALID_CHARS=[fromCode(65534),fromCode(65279),fromCode(65535)];addCharsToCharClass(INVALID_CHARS,
8234,8238);twttr.txt.regexen.spaces_group=regexSupplant(UNICODE_SPACES.join(""));twttr.txt.regexen.spaces=regexSupplant("["+UNICODE_SPACES.join("")+"]");twttr.txt.regexen.invalid_chars_group=regexSupplant(INVALID_CHARS.join(""));twttr.txt.regexen.punct=/\!'#%&'\(\)*\+,\\\-\.\/:;<=>\?@\[\]\^_{|}~\$/;twttr.txt.regexen.rtl_chars=/[\u0600-\u06FF]|[\u0750-\u077F]|[\u0590-\u05FF]|[\uFE70-\uFEFF]/mg;twttr.txt.regexen.non_bmp_code_pairs=/[\uD800-\uDBFF][\uDC00-\uDFFF]/mg;var nonLatinHashtagChars=[];addCharsToCharClass(nonLatinHashtagChars,
1024,1279);addCharsToCharClass(nonLatinHashtagChars,1280,1319);addCharsToCharClass(nonLatinHashtagChars,11744,11775);addCharsToCharClass(nonLatinHashtagChars,42560,42655);addCharsToCharClass(nonLatinHashtagChars,1425,1471);addCharsToCharClass(nonLatinHashtagChars,1473,1474);addCharsToCharClass(nonLatinHashtagChars,1476,1477);addCharsToCharClass(nonLatinHashtagChars,1479,1479);addCharsToCharClass(nonLatinHashtagChars,1488,1514);addCharsToCharClass(nonLatinHashtagChars,1520,1524);addCharsToCharClass(nonLatinHashtagChars,
64274,64296);addCharsToCharClass(nonLatinHashtagChars,64298,64310);addCharsToCharClass(nonLatinHashtagChars,64312,64316);addCharsToCharClass(nonLatinHashtagChars,64318,64318);addCharsToCharClass(nonLatinHashtagChars,64320,64321);addCharsToCharClass(nonLatinHashtagChars,64323,64324);addCharsToCharClass(nonLatinHashtagChars,64326,64335);addCharsToCharClass(nonLatinHashtagChars,1552,1562);addCharsToCharClass(nonLatinHashtagChars,1568,1631);addCharsToCharClass(nonLatinHashtagChars,1646,1747);addCharsToCharClass(nonLatinHashtagChars,
1749,1756);addCharsToCharClass(nonLatinHashtagChars,1758,1768);addCharsToCharClass(nonLatinHashtagChars,1770,1775);addCharsToCharClass(nonLatinHashtagChars,1786,1788);addCharsToCharClass(nonLatinHashtagChars,1791,1791);addCharsToCharClass(nonLatinHashtagChars,1872,1919);addCharsToCharClass(nonLatinHashtagChars,2208,2208);addCharsToCharClass(nonLatinHashtagChars,2210,2220);addCharsToCharClass(nonLatinHashtagChars,2276,2302);addCharsToCharClass(nonLatinHashtagChars,64336,64433);addCharsToCharClass(nonLatinHashtagChars,
64467,64829);addCharsToCharClass(nonLatinHashtagChars,64848,64911);addCharsToCharClass(nonLatinHashtagChars,64914,64967);addCharsToCharClass(nonLatinHashtagChars,65008,65019);addCharsToCharClass(nonLatinHashtagChars,65136,65140);addCharsToCharClass(nonLatinHashtagChars,65142,65276);addCharsToCharClass(nonLatinHashtagChars,8204,8204);addCharsToCharClass(nonLatinHashtagChars,3585,3642);addCharsToCharClass(nonLatinHashtagChars,3648,3662);addCharsToCharClass(nonLatinHashtagChars,4352,4607);addCharsToCharClass(nonLatinHashtagChars,
12592,12677);addCharsToCharClass(nonLatinHashtagChars,43360,43391);addCharsToCharClass(nonLatinHashtagChars,44032,55215);addCharsToCharClass(nonLatinHashtagChars,55216,55295);addCharsToCharClass(nonLatinHashtagChars,65441,65500);addCharsToCharClass(nonLatinHashtagChars,12449,12538);addCharsToCharClass(nonLatinHashtagChars,12540,12542);addCharsToCharClass(nonLatinHashtagChars,65382,65439);addCharsToCharClass(nonLatinHashtagChars,65392,65392);addCharsToCharClass(nonLatinHashtagChars,65296,65305);addCharsToCharClass(nonLatinHashtagChars,
65313,65338);addCharsToCharClass(nonLatinHashtagChars,65345,65370);addCharsToCharClass(nonLatinHashtagChars,12353,12438);addCharsToCharClass(nonLatinHashtagChars,12441,12446);addCharsToCharClass(nonLatinHashtagChars,13312,19903);addCharsToCharClass(nonLatinHashtagChars,19968,40959);addCharsToCharClass(nonLatinHashtagChars,173824,177983);addCharsToCharClass(nonLatinHashtagChars,177984,178207);addCharsToCharClass(nonLatinHashtagChars,194560,195103);addCharsToCharClass(nonLatinHashtagChars,12291,12291);
addCharsToCharClass(nonLatinHashtagChars,12293,12293);addCharsToCharClass(nonLatinHashtagChars,12347,12347);twttr.txt.regexen.nonLatinHashtagChars=regexSupplant(nonLatinHashtagChars.join(""));var latinAccentChars=[];addCharsToCharClass(latinAccentChars,192,214);addCharsToCharClass(latinAccentChars,216,246);addCharsToCharClass(latinAccentChars,248,255);addCharsToCharClass(latinAccentChars,256,591);addCharsToCharClass(latinAccentChars,595,596);addCharsToCharClass(latinAccentChars,598,599);addCharsToCharClass(latinAccentChars,
601,601);addCharsToCharClass(latinAccentChars,603,603);addCharsToCharClass(latinAccentChars,611,611);addCharsToCharClass(latinAccentChars,616,616);addCharsToCharClass(latinAccentChars,623,623);addCharsToCharClass(latinAccentChars,626,626);addCharsToCharClass(latinAccentChars,649,649);addCharsToCharClass(latinAccentChars,651,651);addCharsToCharClass(latinAccentChars,699,699);addCharsToCharClass(latinAccentChars,768,879);addCharsToCharClass(latinAccentChars,7680,7935);twttr.txt.regexen.latinAccentChars=
regexSupplant(latinAccentChars.join(""));twttr.txt.regexen.hashSigns=/[#\uff03]/;twttr.txt.regexen.hashtagAlpha=regexSupplant(/[a-z_#{latinAccentChars}#{nonLatinHashtagChars}]/i);twttr.txt.regexen.hashtagAlphaNumeric=regexSupplant(/[a-z0-9_#{latinAccentChars}#{nonLatinHashtagChars}]/i);twttr.txt.regexen.endHashtagMatch=regexSupplant(/^(?:#{hashSigns}|:\/\/)/);twttr.txt.regexen.hashtagBoundary=regexSupplant(/(?:^|$|[^&a-z0-9_#{latinAccentChars}#{nonLatinHashtagChars}])/);twttr.txt.regexen.validHashtag=
regexSupplant(/(#{hashtagBoundary})(#{hashSigns})(#{hashtagAlphaNumeric}*#{hashtagAlpha}#{hashtagAlphaNumeric}*)/gi);twttr.txt.regexen.validMentionPrecedingChars=/(?:^|[^a-zA-Z0-9_!#$%&*@\uff20]|RT:?)/;twttr.txt.regexen.atSigns=/[@\uff20]/;twttr.txt.regexen.validMentionOrList=regexSupplant("(#{validMentionPrecedingChars})"+"(#{atSigns})"+"([a-zA-Z0-9_]{1,20})"+"(/[a-zA-Z][a-zA-Z0-9_-]{0,24})?","g");twttr.txt.regexen.validReply=regexSupplant(/^(?:#{spaces})*#{atSigns}([a-zA-Z0-9_]{1,20})/);twttr.txt.regexen.endMentionMatch=
regexSupplant(/^(?:#{atSigns}|[#{latinAccentChars}]|:\/\/)/);twttr.txt.regexen.validUrlPrecedingChars=regexSupplant(/(?:[^A-Za-z0-9@\uff20$#\uff03#{invalid_chars_group}]|^)/);twttr.txt.regexen.invalidUrlWithoutProtocolPrecedingChars=/[-_.\/]$/;twttr.txt.regexen.invalidDomainChars=stringSupplant("#{punct}#{spaces_group}#{invalid_chars_group}",twttr.txt.regexen);twttr.txt.regexen.validDomainChars=regexSupplant(/[^#{invalidDomainChars}]/);twttr.txt.regexen.validSubdomain=regexSupplant(/(?:(?:#{validDomainChars}(?:[_-]|#{validDomainChars})*)?#{validDomainChars}\.)/);
twttr.txt.regexen.validDomainName=regexSupplant(/(?:(?:#{validDomainChars}(?:-|#{validDomainChars})*)?#{validDomainChars}\.)/);twttr.txt.regexen.validGTLD=regexSupplant(/(?:(?:aero|asia|biz|cat|com|coop|edu|gov|info|int|jobs|mil|mobi|museum|name|net|org|pro|tel|travel|xxx)(?=[^0-9a-zA-Z]|$))/);twttr.txt.regexen.validCCTLD=regexSupplant(RegExp("(?:(?:ac|ad|ae|af|ag|ai|al|am|an|ao|aq|ar|as|at|au|aw|ax|az|ba|bb|bd|be|bf|bg|bh|bi|bj|bm|bn|bo|br|bs|bt|bv|bw|by|bz|"+"ca|cc|cd|cf|cg|ch|ci|ck|cl|cm|cn|co|cr|cs|cu|cv|cx|cy|cz|dd|de|dj|dk|dm|do|dz|ec|ee|eg|eh|er|es|et|eu|fi|fj|fk|fm|fo|fr|"+
"ga|gb|gd|ge|gf|gg|gh|gi|gl|gm|gn|gp|gq|gr|gs|gt|gu|gw|gy|hk|hm|hn|hr|ht|hu|id|ie|il|im|in|io|iq|ir|is|it|je|jm|jo|jp|"+"ke|kg|kh|ki|km|kn|kp|kr|kw|ky|kz|la|lb|lc|li|lk|lr|ls|lt|lu|lv|ly|ma|mc|md|me|mg|mh|mk|ml|mm|mn|mo|mp|mq|mr|ms|mt|mu|mv|mw|mx|my|mz|"+"na|nc|ne|nf|ng|ni|nl|no|np|nr|nu|nz|om|pa|pe|pf|pg|ph|pk|pl|pm|pn|pr|ps|pt|pw|py|qa|re|ro|rs|ru|rw|"+"sa|sb|sc|sd|se|sg|sh|si|sj|sk|sl|sm|sn|so|sr|ss|st|su|sv|sx|sy|sz|tc|td|tf|tg|th|tj|tk|tl|tm|tn|to|tp|tr|tt|tv|tw|tz|"+"ua|ug|uk|us|uy|uz|va|vc|ve|vg|vi|vn|vu|wf|ws|ye|yt|za|zm|zw)(?=[^0-9a-zA-Z]|$))"));
twttr.txt.regexen.validPunycode=regexSupplant(/(?:xn--[0-9a-z]+)/);twttr.txt.regexen.validDomain=regexSupplant(/(?:#{validSubdomain}*#{validDomainName}(?:#{validGTLD}|#{validCCTLD}|#{validPunycode}))/);twttr.txt.regexen.validAsciiDomain=regexSupplant(/(?:(?:[\-a-z0-9#{latinAccentChars}]+)\.)+(?:#{validGTLD}|#{validCCTLD}|#{validPunycode})/gi);twttr.txt.regexen.invalidShortDomain=regexSupplant(/^#{validDomainName}#{validCCTLD}$/);twttr.txt.regexen.validPortNumber=regexSupplant(/[0-9]+/);twttr.txt.regexen.validGeneralUrlPathChars=
regexSupplant(/[a-z0-9!\*';:=\+,\.\$\/%#\[\]\-_~@|&#{latinAccentChars}]/i);twttr.txt.regexen.validUrlBalancedParens=regexSupplant(/\(#{validGeneralUrlPathChars}+\)/i);twttr.txt.regexen.validUrlPathEndingChars=regexSupplant(/[\+\-a-z0-9=_#\/#{latinAccentChars}]|(?:#{validUrlBalancedParens})/i);twttr.txt.regexen.validUrlPath=regexSupplant("(?:"+"(?:"+"#{validGeneralUrlPathChars}*"+"(?:#{validUrlBalancedParens}#{validGeneralUrlPathChars}*)*"+"#{validUrlPathEndingChars}"+")|(?:@#{validGeneralUrlPathChars}+/)"+
")","i");twttr.txt.regexen.validUrlQueryChars=/[a-z0-9!?\*'@\(\);:&=\+\$\/%#\[\]\-_\.,~|]/i;twttr.txt.regexen.validUrlQueryEndingChars=/[a-z0-9_&=#\/]/i;twttr.txt.regexen.extractUrl=regexSupplant("("+"(#{validUrlPrecedingChars})"+"("+"(https?:\\/\\/)?"+"(#{validDomain})"+"(?::(#{validPortNumber}))?"+"(\\/#{validUrlPath}*)?"+"(\\?#{validUrlQueryChars}*#{validUrlQueryEndingChars})?"+")"+")","gi");twttr.txt.regexen.validTcoUrl=/^https?:\/\/t\.co\/[a-z0-9]+/i;twttr.txt.regexen.urlHasProtocol=/^https?:\/\//i;
twttr.txt.regexen.urlHasHttps=/^https:\/\//i;twttr.txt.regexen.cashtag=/[a-z]{1,6}(?:[._][a-z]{1,2})?/i;twttr.txt.regexen.validCashtag=regexSupplant("(^|#{spaces})(\\$)(#{cashtag})(?=$|\\s|[#{punct}])","gi");twttr.txt.regexen.validateUrlUnreserved=/[a-z0-9\-._~]/i;twttr.txt.regexen.validateUrlPctEncoded=/(?:%[0-9a-f]{2})/i;twttr.txt.regexen.validateUrlSubDelims=/[!$&'()*+,;=]/i;twttr.txt.regexen.validateUrlPchar=regexSupplant("(?:"+"#{validateUrlUnreserved}|"+"#{validateUrlPctEncoded}|"+"#{validateUrlSubDelims}|"+
"[:|@]"+")","i");twttr.txt.regexen.validateUrlScheme=/(?:[a-z][a-z0-9+\-.]*)/i;twttr.txt.regexen.validateUrlUserinfo=regexSupplant("(?:"+"#{validateUrlUnreserved}|"+"#{validateUrlPctEncoded}|"+"#{validateUrlSubDelims}|"+":"+")*","i");twttr.txt.regexen.validateUrlDecOctet=/(?:[0-9]|(?:[1-9][0-9])|(?:1[0-9]{2})|(?:2[0-4][0-9])|(?:25[0-5]))/i;twttr.txt.regexen.validateUrlIpv4=regexSupplant(/(?:#{validateUrlDecOctet}(?:\.#{validateUrlDecOctet}){3})/i);twttr.txt.regexen.validateUrlIpv6=/(?:\[[a-f0-9:\.]+\])/i;
twttr.txt.regexen.validateUrlIp=regexSupplant("(?:"+"#{validateUrlIpv4}|"+"#{validateUrlIpv6}"+")","i");twttr.txt.regexen.validateUrlSubDomainSegment=/(?:[a-z0-9](?:[a-z0-9_\-]*[a-z0-9])?)/i;twttr.txt.regexen.validateUrlDomainSegment=/(?:[a-z0-9](?:[a-z0-9\-]*[a-z0-9])?)/i;twttr.txt.regexen.validateUrlDomainTld=/(?:[a-z](?:[a-z0-9\-]*[a-z0-9])?)/i;twttr.txt.regexen.validateUrlDomain=regexSupplant(/(?:(?:#{validateUrlSubDomainSegment]}\.)*(?:#{validateUrlDomainSegment]}\.)#{validateUrlDomainTld})/i);
twttr.txt.regexen.validateUrlHost=regexSupplant("(?:"+"#{validateUrlIp}|"+"#{validateUrlDomain}"+")","i");twttr.txt.regexen.validateUrlUnicodeSubDomainSegment=/(?:(?:[a-z0-9]|[^\u0000-\u007f])(?:(?:[a-z0-9_\-]|[^\u0000-\u007f])*(?:[a-z0-9]|[^\u0000-\u007f]))?)/i;twttr.txt.regexen.validateUrlUnicodeDomainSegment=/(?:(?:[a-z0-9]|[^\u0000-\u007f])(?:(?:[a-z0-9\-]|[^\u0000-\u007f])*(?:[a-z0-9]|[^\u0000-\u007f]))?)/i;twttr.txt.regexen.validateUrlUnicodeDomainTld=/(?:(?:[a-z]|[^\u0000-\u007f])(?:(?:[a-z0-9\-]|[^\u0000-\u007f])*(?:[a-z0-9]|[^\u0000-\u007f]))?)/i;
twttr.txt.regexen.validateUrlUnicodeDomain=regexSupplant(/(?:(?:#{validateUrlUnicodeSubDomainSegment}\.)*(?:#{validateUrlUnicodeDomainSegment}\.)#{validateUrlUnicodeDomainTld})/i);twttr.txt.regexen.validateUrlUnicodeHost=regexSupplant("(?:"+"#{validateUrlIp}|"+"#{validateUrlUnicodeDomain}"+")","i");twttr.txt.regexen.validateUrlPort=/[0-9]{1,5}/;twttr.txt.regexen.validateUrlUnicodeAuthority=regexSupplant("(?:(#{validateUrlUserinfo})@)?"+"(#{validateUrlUnicodeHost})"+"(?::(#{validateUrlPort}))?","i");
twttr.txt.regexen.validateUrlAuthority=regexSupplant("(?:(#{validateUrlUserinfo})@)?"+"(#{validateUrlHost})"+"(?::(#{validateUrlPort}))?","i");twttr.txt.regexen.validateUrlPath=regexSupplant(/(\/#{validateUrlPchar}*)*/i);twttr.txt.regexen.validateUrlQuery=regexSupplant(/(#{validateUrlPchar}|\/|\?)*/i);twttr.txt.regexen.validateUrlFragment=regexSupplant(/(#{validateUrlPchar}|\/|\?)*/i);twttr.txt.regexen.validateUrlUnencoded=regexSupplant("^"+"(?:"+"([^:/?#]+):\\/\\/"+")?"+"([^/?#]*)"+"([^?#]*)"+"(?:"+
"\\?([^#]*)"+")?"+"(?:"+"#(.*)"+")?$","i");var DEFAULT_LIST_CLASS="tweet-url list-slug";var DEFAULT_USERNAME_CLASS="tweet-url username";var DEFAULT_HASHTAG_CLASS="tweet-url hashtag";var DEFAULT_CASHTAG_CLASS="tweet-url cashtag";var OPTIONS_NOT_ATTRIBUTES={"urlClass":true,"listClass":true,"usernameClass":true,"hashtagClass":true,"cashtagClass":true,"usernameUrlBase":true,"listUrlBase":true,"hashtagUrlBase":true,"cashtagUrlBase":true,"usernameUrlBlock":true,"listUrlBlock":true,"hashtagUrlBlock":true,
"linkUrlBlock":true,"usernameIncludeSymbol":true,"suppressLists":true,"suppressNoFollow":true,"targetBlank":true,"suppressDataScreenName":true,"urlEntities":true,"symbolTag":true,"textWithSymbolTag":true,"urlTarget":true,"invisibleTagAttrs":true,"linkAttributeBlock":true,"linkTextBlock":true,"htmlEscapeNonEntities":true};var BOOLEAN_ATTRIBUTES={"disabled":true,"readonly":true,"multiple":true,"checked":true};function clone(o){var r={};for(var k in o)if(o.hasOwnProperty(k))r[k]=o[k];return r}twttr.txt.tagAttrs=
function(attributes){var htmlAttrs="";for(var k in attributes){var v=attributes[k];if(BOOLEAN_ATTRIBUTES[k])v=v?k:null;if(v==null)continue;htmlAttrs+=" "+twttr.txt.htmlEscape(k)+'="'+twttr.txt.htmlEscape(v.toString())+'"'}return htmlAttrs};twttr.txt.linkToText=function(entity,text,attributes,options){if(!options.suppressNoFollow)attributes.rel="nofollow";if(options.linkAttributeBlock)options.linkAttributeBlock(entity,attributes);if(options.linkTextBlock)text=options.linkTextBlock(entity,text);var d=
{text:text,attr:twttr.txt.tagAttrs(attributes)};return stringSupplant("<a#{attr}>#{text}</a>",d)};twttr.txt.linkToTextWithSymbol=function(entity,symbol,text,attributes,options){var taggedSymbol=options.symbolTag?"<"+options.symbolTag+">"+symbol+"</"+options.symbolTag+">":symbol;text=twttr.txt.htmlEscape(text);var taggedText=options.textWithSymbolTag?"<"+options.textWithSymbolTag+">"+text+"</"+options.textWithSymbolTag+">":text;if(options.usernameIncludeSymbol||!symbol.match(twttr.txt.regexen.atSigns))return twttr.txt.linkToText(entity,
taggedSymbol+taggedText,attributes,options);else return taggedSymbol+twttr.txt.linkToText(entity,taggedText,attributes,options)};twttr.txt.linkToHashtag=function(entity,text,options){var hash=text.substring(entity.indices[0],entity.indices[0]+1);var hashtag=twttr.txt.htmlEscape(entity.hashtag);var attrs=clone(options.htmlAttrs||{});attrs.href=options.hashtagUrlBase+hashtag;attrs.title="#"+hashtag;attrs["class"]=options.hashtagClass;if(hashtag.charAt(0).match(twttr.txt.regexen.rtl_chars))attrs["class"]+=
" rtl";if(options.targetBlank)attrs.target="_blank";return twttr.txt.linkToTextWithSymbol(entity,hash,hashtag,attrs,options)};twttr.txt.linkToCashtag=function(entity,text,options){var cashtag=twttr.txt.htmlEscape(entity.cashtag);var attrs=clone(options.htmlAttrs||{});attrs.href=options.cashtagUrlBase+cashtag;attrs.title="$"+cashtag;attrs["class"]=options.cashtagClass;if(options.targetBlank)attrs.target="_blank";return twttr.txt.linkToTextWithSymbol(entity,"$",cashtag,attrs,options)};twttr.txt.linkToMentionAndList=
function(entity,text,options){var at=text.substring(entity.indices[0],entity.indices[0]+1);var user=twttr.txt.htmlEscape(entity.screenName);var slashListname=twttr.txt.htmlEscape(entity.listSlug);var isList=entity.listSlug&&!options.suppressLists;var attrs=clone(options.htmlAttrs||{});attrs["class"]=isList?options.listClass:options.usernameClass;attrs.href=isList?options.listUrlBase+user+slashListname:options.usernameUrlBase+user;if(!isList&&!options.suppressDataScreenName)attrs["data-screen-name"]=
user;if(options.targetBlank)attrs.target="_blank";return twttr.txt.linkToTextWithSymbol(entity,at,isList?user+slashListname:user,attrs,options)};twttr.txt.linkToUrl=function(entity,text,options){var url=entity.url;var displayUrl=url;var linkText=twttr.txt.htmlEscape(displayUrl);var urlEntity=options.urlEntities&&options.urlEntities[url]||entity;if(urlEntity.display_url)linkText=twttr.txt.linkTextWithEntity(urlEntity,options);var attrs=clone(options.htmlAttrs||{});if(!url.match(twttr.txt.regexen.urlHasProtocol))url=
"http://"+url;attrs.href=url;if(options.targetBlank)attrs.target="_blank";if(options.urlClass)attrs["class"]=options.urlClass;if(options.urlTarget)attrs.target=options.urlTarget;if(!options.title&&urlEntity.display_url)attrs.title=urlEntity.expanded_url;return twttr.txt.linkToText(entity,linkText,attrs,options)};twttr.txt.linkTextWithEntity=function(entity,options){var displayUrl=entity.display_url;var expandedUrl=entity.expanded_url;var displayUrlSansEllipses=displayUrl.replace(/\u2026/g,"");if(expandedUrl.indexOf(displayUrlSansEllipses)!=
-1){var displayUrlIndex=expandedUrl.indexOf(displayUrlSansEllipses);var v={displayUrlSansEllipses:displayUrlSansEllipses,beforeDisplayUrl:expandedUrl.substr(0,displayUrlIndex),afterDisplayUrl:expandedUrl.substr(displayUrlIndex+displayUrlSansEllipses.length),precedingEllipsis:displayUrl.match(/^\u2026/)?"\u2026":"",followingEllipsis:displayUrl.match(/\u2026$/)?"\u2026":""};for(var k in v)if(v.hasOwnProperty(k))v[k]=twttr.txt.htmlEscape(v[k]);v["invisible"]=options.invisibleTagAttrs;return stringSupplant("<span class='tco-ellipsis'>#{precedingEllipsis}<span #{invisible}>&nbsp;</span></span><span #{invisible}>#{beforeDisplayUrl}</span><span class='js-display-url'>#{displayUrlSansEllipses}</span><span #{invisible}>#{afterDisplayUrl}</span><span class='tco-ellipsis'><span #{invisible}>&nbsp;</span>#{followingEllipsis}</span>",
v)}return displayUrl};twttr.txt.autoLinkEntities=function(text,entities,options){options=clone(options||{});options.hashtagClass=options.hashtagClass||DEFAULT_HASHTAG_CLASS;options.hashtagUrlBase=options.hashtagUrlBase||"https://twitter.com/#!/search?q=%23";options.cashtagClass=options.cashtagClass||DEFAULT_CASHTAG_CLASS;options.cashtagUrlBase=options.cashtagUrlBase||"https://twitter.com/#!/search?q=%24";options.listClass=options.listClass||DEFAULT_LIST_CLASS;options.usernameClass=options.usernameClass||
DEFAULT_USERNAME_CLASS;options.usernameUrlBase=options.usernameUrlBase||"https://twitter.com/";options.listUrlBase=options.listUrlBase||"https://twitter.com/";options.htmlAttrs=twttr.txt.extractHtmlAttrsFromOptions(options);options.invisibleTagAttrs=options.invisibleTagAttrs||"style='position:absolute;left:-9999px;'";var urlEntities,i,len;if(options.urlEntities){urlEntities={};for(i=0,len=options.urlEntities.length;i<len;i++)urlEntities[options.urlEntities[i].url]=options.urlEntities[i];options.urlEntities=
urlEntities}var result="";var beginIndex=0;entities.sort(function(a,b){return a.indices[0]-b.indices[0]});var nonEntity=options.htmlEscapeNonEntities?twttr.txt.htmlEscape:function(text){return text};for(var i=0;i<entities.length;i++){var entity=entities[i];result+=nonEntity(text.substring(beginIndex,entity.indices[0]));if(entity.url)result+=twttr.txt.linkToUrl(entity,text,options);else if(entity.hashtag)result+=twttr.txt.linkToHashtag(entity,text,options);else if(entity.screenName)result+=twttr.txt.linkToMentionAndList(entity,
text,options);else if(entity.cashtag)result+=twttr.txt.linkToCashtag(entity,text,options);beginIndex=entity.indices[1]}result+=nonEntity(text.substring(beginIndex,text.length));return result};twttr.txt.autoLinkWithJSON=function(text,json,options){var entities=[];for(var key in json)entities=entities.concat(json[key]);for(var i=0;i<entities.length;i++){entity=entities[i];if(entity.screen_name)entity.screenName=entity.screen_name;else if(entity.text)entity.hashtag=entity.text}twttr.txt.modifyIndicesFromUnicodeToUTF16(text,
entities);return twttr.txt.autoLinkEntities(text,entities,options)};twttr.txt.extractHtmlAttrsFromOptions=function(options){var htmlAttrs={};for(var k in options){var v=options[k];if(OPTIONS_NOT_ATTRIBUTES[k])continue;if(BOOLEAN_ATTRIBUTES[k])v=v?k:null;if(v==null)continue;htmlAttrs[k]=v}return htmlAttrs};twttr.txt.autoLink=function(text,options){var entities=twttr.txt.extractEntitiesWithIndices(text,{extractUrlsWithoutProtocol:false});return twttr.txt.autoLinkEntities(text,entities,options)};twttr.txt.autoLinkUsernamesOrLists=
function(text,options){var entities=twttr.txt.extractMentionsOrListsWithIndices(text);return twttr.txt.autoLinkEntities(text,entities,options)};twttr.txt.autoLinkHashtags=function(text,options){var entities=twttr.txt.extractHashtagsWithIndices(text);return twttr.txt.autoLinkEntities(text,entities,options)};twttr.txt.autoLinkCashtags=function(text,options){var entities=twttr.txt.extractCashtagsWithIndices(text);return twttr.txt.autoLinkEntities(text,entities,options)};twttr.txt.autoLinkUrlsCustom=
function(text,options){var entities=twttr.txt.extractUrlsWithIndices(text,{extractUrlsWithoutProtocol:false});return twttr.txt.autoLinkEntities(text,entities,options)};twttr.txt.removeOverlappingEntities=function(entities){entities.sort(function(a,b){return a.indices[0]-b.indices[0]});var prev=entities[0];for(var i=1;i<entities.length;i++)if(prev.indices[1]>entities[i].indices[0]){entities.splice(i,1);i--}else prev=entities[i]};twttr.txt.extractEntitiesWithIndices=function(text,options){var entities=
twttr.txt.extractUrlsWithIndices(text,options).concat(twttr.txt.extractMentionsOrListsWithIndices(text)).concat(twttr.txt.extractHashtagsWithIndices(text,{checkUrlOverlap:false})).concat(twttr.txt.extractCashtagsWithIndices(text));if(entities.length==0)return[];twttr.txt.removeOverlappingEntities(entities);return entities};twttr.txt.extractMentions=function(text){var screenNamesOnly=[],screenNamesWithIndices=twttr.txt.extractMentionsWithIndices(text);for(var i=0;i<screenNamesWithIndices.length;i++){var screenName=
screenNamesWithIndices[i].screenName;screenNamesOnly.push(screenName)}return screenNamesOnly};twttr.txt.extractMentionsWithIndices=function(text){var mentions=[],mentionOrList,mentionsOrLists=twttr.txt.extractMentionsOrListsWithIndices(text);for(var i=0;i<mentionsOrLists.length;i++){mentionOrList=mentionsOrLists[i];if(mentionOrList.listSlug=="")mentions.push({screenName:mentionOrList.screenName,indices:mentionOrList.indices})}return mentions};twttr.txt.extractMentionsOrListsWithIndices=function(text){if(!text||
!text.match(twttr.txt.regexen.atSigns))return[];var possibleNames=[],slashListname;text.replace(twttr.txt.regexen.validMentionOrList,function(match,before,atSign,screenName,slashListname,offset,chunk){var after=chunk.slice(offset+match.length);if(!after.match(twttr.txt.regexen.endMentionMatch)){slashListname=slashListname||"";var startPosition=offset+before.length;var endPosition=startPosition+screenName.length+slashListname.length+1;possibleNames.push({screenName:screenName,listSlug:slashListname,
indices:[startPosition,endPosition]})}});return possibleNames};twttr.txt.extractReplies=function(text){if(!text)return null;var possibleScreenName=text.match(twttr.txt.regexen.validReply);if(!possibleScreenName||RegExp.rightContext.match(twttr.txt.regexen.endMentionMatch))return null;return possibleScreenName[1]};twttr.txt.extractUrls=function(text,options){var urlsOnly=[],urlsWithIndices=twttr.txt.extractUrlsWithIndices(text,options);for(var i=0;i<urlsWithIndices.length;i++)urlsOnly.push(urlsWithIndices[i].url);
return urlsOnly};twttr.txt.extractUrlsWithIndices=function(text,options){if(!options)options={extractUrlsWithoutProtocol:true};if(!text||(options.extractUrlsWithoutProtocol?!text.match(/\./):!text.match(/:/)))return[];var urls=[];while(twttr.txt.regexen.extractUrl.exec(text)){var before=RegExp.$2,url=RegExp.$3,protocol=RegExp.$4,domain=RegExp.$5,path=RegExp.$7;var endPosition=twttr.txt.regexen.extractUrl.lastIndex,startPosition=endPosition-url.length;if(!protocol){if(!options.extractUrlsWithoutProtocol||
before.match(twttr.txt.regexen.invalidUrlWithoutProtocolPrecedingChars))continue;var lastUrl=null,lastUrlInvalidMatch=false,asciiEndPosition=0;domain.replace(twttr.txt.regexen.validAsciiDomain,function(asciiDomain){var asciiStartPosition=domain.indexOf(asciiDomain,asciiEndPosition);asciiEndPosition=asciiStartPosition+asciiDomain.length;lastUrl={url:asciiDomain,indices:[startPosition+asciiStartPosition,startPosition+asciiEndPosition]};lastUrlInvalidMatch=asciiDomain.match(twttr.txt.regexen.invalidShortDomain);
if(!lastUrlInvalidMatch)urls.push(lastUrl)});if(lastUrl==null)continue;if(path){if(lastUrlInvalidMatch)urls.push(lastUrl);lastUrl.url=url.replace(domain,lastUrl.url);lastUrl.indices[1]=endPosition}}else{if(url.match(twttr.txt.regexen.validTcoUrl)){url=RegExp.lastMatch;endPosition=startPosition+url.length}urls.push({url:url,indices:[startPosition,endPosition]})}}return urls};twttr.txt.extractHashtags=function(text){var hashtagsOnly=[],hashtagsWithIndices=twttr.txt.extractHashtagsWithIndices(text);
for(var i=0;i<hashtagsWithIndices.length;i++)hashtagsOnly.push(hashtagsWithIndices[i].hashtag);return hashtagsOnly};twttr.txt.extractHashtagsWithIndices=function(text,options){if(!options)options={checkUrlOverlap:true};if(!text||!text.match(twttr.txt.regexen.hashSigns))return[];var tags=[];text.replace(twttr.txt.regexen.validHashtag,function(match,before,hash,hashText,offset,chunk){var after=chunk.slice(offset+match.length);if(after.match(twttr.txt.regexen.endHashtagMatch))return;var startPosition=
offset+before.length;var endPosition=startPosition+hashText.length+1;tags.push({hashtag:hashText,indices:[startPosition,endPosition]})});if(options.checkUrlOverlap){var urls=twttr.txt.extractUrlsWithIndices(text);if(urls.length>0){var entities=tags.concat(urls);twttr.txt.removeOverlappingEntities(entities);tags=[];for(var i=0;i<entities.length;i++)if(entities[i].hashtag)tags.push(entities[i])}}return tags};twttr.txt.extractCashtags=function(text){var cashtagsOnly=[],cashtagsWithIndices=twttr.txt.extractCashtagsWithIndices(text);
for(var i=0;i<cashtagsWithIndices.length;i++)cashtagsOnly.push(cashtagsWithIndices[i].cashtag);return cashtagsOnly};twttr.txt.extractCashtagsWithIndices=function(text){if(!text||text.indexOf("$")==-1)return[];var tags=[];text.replace(twttr.txt.regexen.validCashtag,function(match,before,dollar,cashtag,offset,chunk){var startPosition=offset+before.length;var endPosition=startPosition+cashtag.length+1;tags.push({cashtag:cashtag,indices:[startPosition,endPosition]})});return tags};twttr.txt.modifyIndicesFromUnicodeToUTF16=
function(text,entities){twttr.txt.convertUnicodeIndices(text,entities,false)};twttr.txt.modifyIndicesFromUTF16ToUnicode=function(text,entities){twttr.txt.convertUnicodeIndices(text,entities,true)};twttr.txt.getUnicodeTextLength=function(text){return text.replace(twttr.txt.regexen.non_bmp_code_pairs," ").length};twttr.txt.convertUnicodeIndices=function(text,entities,indicesInUTF16){if(entities.length==0)return;var charIndex=0;var codePointIndex=0;entities.sort(function(a,b){return a.indices[0]-b.indices[0]});
var entityIndex=0;var entity=entities[0];while(charIndex<text.length){if(entity.indices[0]==(indicesInUTF16?charIndex:codePointIndex)){var len=entity.indices[1]-entity.indices[0];entity.indices[0]=indicesInUTF16?codePointIndex:charIndex;entity.indices[1]=entity.indices[0]+len;entityIndex++;if(entityIndex==entities.length)break;entity=entities[entityIndex]}var c=text.charCodeAt(charIndex);if(55296<=c&&c<=56319&&charIndex<text.length-1){c=text.charCodeAt(charIndex+1);if(56320<=c&&c<=57343)charIndex++}codePointIndex++;
charIndex++}};twttr.txt.splitTags=function(text){var firstSplits=text.split("<"),secondSplits,allSplits=[],split;for(var i=0;i<firstSplits.length;i+=1){split=firstSplits[i];if(!split)allSplits.push("");else{secondSplits=split.split(">");for(var j=0;j<secondSplits.length;j+=1)allSplits.push(secondSplits[j])}}return allSplits};twttr.txt.hitHighlight=function(text,hits,options){var defaultHighlightTag="em";hits=hits||[];options=options||{};if(hits.length===0)return text;var tagName=options.tag||defaultHighlightTag,
tags=["<"+tagName+">","</"+tagName+">"],chunks=twttr.txt.splitTags(text),i,j,result="",chunkIndex=0,chunk=chunks[0],prevChunksLen=0,chunkCursor=0,startInChunk=false,chunkChars=chunk,flatHits=[],index,hit,tag,placed,hitSpot;for(i=0;i<hits.length;i+=1)for(j=0;j<hits[i].length;j+=1)flatHits.push(hits[i][j]);for(index=0;index<flatHits.length;index+=1){hit=flatHits[index];tag=tags[index%2];placed=false;while(chunk!=null&&hit>=prevChunksLen+chunk.length){result+=chunkChars.slice(chunkCursor);if(startInChunk&&
hit===prevChunksLen+chunkChars.length){result+=tag;placed=true}if(chunks[chunkIndex+1])result+="<"+chunks[chunkIndex+1]+">";prevChunksLen+=chunkChars.length;chunkCursor=0;chunkIndex+=2;chunk=chunks[chunkIndex];chunkChars=chunk;startInChunk=false}if(!placed&&chunk!=null){hitSpot=hit-prevChunksLen;result+=chunkChars.slice(chunkCursor,hitSpot)+tag;chunkCursor=hitSpot;if(index%2===0)startInChunk=true;else startInChunk=false}else if(!placed){placed=true;result+=tag}}if(chunk!=null){if(chunkCursor<chunkChars.length)result+=
chunkChars.slice(chunkCursor);for(index=chunkIndex+1;index<chunks.length;index+=1)result+=index%2===0?chunks[index]:"<"+chunks[index]+">"}return result};var MAX_LENGTH=140;var INVALID_CHARACTERS=[fromCode(65534),fromCode(65279),fromCode(65535),fromCode(8234),fromCode(8235),fromCode(8236),fromCode(8237),fromCode(8238)];twttr.txt.getTweetLength=function(text,options){if(!options)options={short_url_length:22,short_url_length_https:23};var textLength=twttr.txt.getUnicodeTextLength(text),urlsWithIndices=
twttr.txt.extractUrlsWithIndices(text);twttr.txt.modifyIndicesFromUTF16ToUnicode(text,urlsWithIndices);for(var i=0;i<urlsWithIndices.length;i++){textLength+=urlsWithIndices[i].indices[0]-urlsWithIndices[i].indices[1];if(urlsWithIndices[i].url.toLowerCase().match(twttr.txt.regexen.urlHasHttps))textLength+=options.short_url_length_https;else textLength+=options.short_url_length}return textLength};twttr.txt.isInvalidTweet=function(text){if(!text)return"empty";if(twttr.txt.getTweetLength(text)>MAX_LENGTH)return"too_long";
for(var i=0;i<INVALID_CHARACTERS.length;i++)if(text.indexOf(INVALID_CHARACTERS[i])>=0)return"invalid_characters";return false};twttr.txt.isValidTweetText=function(text){return!twttr.txt.isInvalidTweet(text)};twttr.txt.isValidUsername=function(username){if(!username)return false;var extracted=twttr.txt.extractMentions(username);return extracted.length===1&&extracted[0]===username.slice(1)};var VALID_LIST_RE=regexSupplant(/^#{validMentionOrList}$/);twttr.txt.isValidList=function(usernameList){var match=
usernameList.match(VALID_LIST_RE);return!!(match&&match[1]==""&&match[4])};twttr.txt.isValidHashtag=function(hashtag){if(!hashtag)return false;var extracted=twttr.txt.extractHashtags(hashtag);return extracted.length===1&&extracted[0]===hashtag.slice(1)};twttr.txt.isValidUrl=function(url,unicodeDomains,requireProtocol){if(unicodeDomains==null)unicodeDomains=true;if(requireProtocol==null)requireProtocol=true;if(!url)return false;var urlParts=url.match(twttr.txt.regexen.validateUrlUnencoded);if(!urlParts||
urlParts[0]!==url)return false;var scheme=urlParts[1],authority=urlParts[2],path=urlParts[3],query=urlParts[4],fragment=urlParts[5];if(!((!requireProtocol||isValidMatch(scheme,twttr.txt.regexen.validateUrlScheme)&&scheme.match(/^https?$/i))&&isValidMatch(path,twttr.txt.regexen.validateUrlPath)&&isValidMatch(query,twttr.txt.regexen.validateUrlQuery,true)&&isValidMatch(fragment,twttr.txt.regexen.validateUrlFragment,true)))return false;return unicodeDomains&&isValidMatch(authority,twttr.txt.regexen.validateUrlUnicodeAuthority)||
!unicodeDomains&&isValidMatch(authority,twttr.txt.regexen.validateUrlAuthority)};function isValidMatch(string,regex,optional){if(!optional)return typeof string==="string"&&string.match(regex)&&RegExp["$&"]===string;return!string||string.match(regex)&&RegExp["$&"]===string}if(typeof module!="undefined"&&module.exports)module.exports=twttr.txt;if(typeof window!="undefined")if(window.twttr)for(var prop in twttr)window.twttr[prop]=twttr[prop];else window.twttr=twttr})();if(!this.JSON)this.JSON={};
(function(){function f(n){return n<10?"0"+n:n}if(typeof Date.prototype.toJSON!=="function"){Date.prototype.toJSON=function(key){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null};String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(key){return this.valueOf()}}var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,
escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;function quote(string){escapable.lastIndex=0;return escapable.test(string)?'"'+string.replace(escapable,function(a){var c=meta[a];return typeof c==="string"?c:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+string+'"'}function str(key,holder){var i,k,v,
length,mind=gap,partial,value=holder[key];if(value&&typeof value==="object"&&typeof value.toJSON==="function")value=value.toJSON(key);if(typeof rep==="function")value=rep.call(holder,key,value);switch(typeof value){case "string":return quote(value);case "number":return isFinite(value)?String(value):"null";case "boolean":case "null":return String(value);case "object":if(!value)return"null";gap+=indent;partial=[];if(Object.prototype.toString.apply(value)==="[object Array]"){length=value.length;for(i=
0;i<length;i+=1)partial[i]=str(i,value)||"null";v=partial.length===0?"[]":gap?"[\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"]":"["+partial.join(",")+"]";gap=mind;return v}if(rep&&typeof rep==="object"){length=rep.length;for(i=0;i<length;i+=1){k=rep[i];if(typeof k==="string"){v=str(k,value);if(v)partial.push(quote(k)+(gap?": ":":")+v)}}}else for(k in value)if(Object.hasOwnProperty.call(value,k)){v=str(k,value);if(v)partial.push(quote(k)+(gap?": ":":")+v)}v=partial.length===0?"{}":gap?"{\n"+gap+partial.join(",\n"+
gap)+"\n"+mind+"}":"{"+partial.join(",")+"}";gap=mind;return v}}if(typeof JSON.stringify!=="function")JSON.stringify=function(value,replacer,space){var i;gap="";indent="";if(typeof space==="number")for(i=0;i<space;i+=1)indent+=" ";else if(typeof space==="string")indent=space;rep=replacer;if(replacer&&typeof replacer!=="function"&&(typeof replacer!=="object"||typeof replacer.length!=="number"))throw new Error("JSON.stringify");return str("",{"":value})};if(typeof JSON.parse!=="function")JSON.parse=
function(text,reviver){var j;function walk(holder,key){var k,v,value=holder[key];if(value&&typeof value==="object")for(k in value)if(Object.hasOwnProperty.call(value,k)){v=walk(value,k);if(v!==undefined)value[k]=v;else delete value[k]}return reviver.call(holder,key,value)}cx.lastIndex=0;if(cx.test(text))text=text.replace(cx,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)});if(/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,
"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){j=eval("("+text+")");return typeof reviver==="function"?walk({"":j},""):j}throw new SyntaxError("JSON.parse");}})();
(function($){$.fn.qtip=function(options,blanket){var i,id,interfaces,opts,obj,command,config,api;if(typeof options=="string"){if(typeof $(this).data("qtip")!=="object")$.fn.qtip.log.error.call(self,1,$.fn.qtip.constants.NO_TOOLTIP_PRESENT,false);if(options=="api")return $(this).data("qtip").interfaces[$(this).data("qtip").current];else if(options=="interfaces")return $(this).data("qtip").interfaces}else{if(!options)options={};if(typeof options.content!=="object"||options.content.jquery&&options.content.length>
0)options.content={text:options.content};if(typeof options.content.title!=="object")options.content.title={text:options.content.title};if(typeof options.position!=="object")options.position={corner:options.position};if(typeof options.position.corner!=="object")options.position.corner={target:options.position.corner,tooltip:options.position.corner};if(typeof options.show!=="object")options.show={when:options.show};if(typeof options.show.when!=="object")options.show.when={event:options.show.when};if(typeof options.show.effect!==
"object")options.show.effect={type:options.show.effect};if(typeof options.hide!=="object")options.hide={when:options.hide};if(typeof options.hide.when!=="object")options.hide.when={event:options.hide.when};if(typeof options.hide.effect!=="object")options.hide.effect={type:options.hide.effect};if(typeof options.style!=="object")options.style={name:options.style};options.style=sanitizeStyle(options.style);opts=$.extend(true,{},$.fn.qtip.defaults,options);opts.style=buildStyle.call({options:opts},opts.style);
opts.user=$.extend(true,{},options)}return $(this).each(function(){if(typeof options=="string"){command=options.toLowerCase();interfaces=$(this).qtip("interfaces");if(typeof interfaces=="object")if(blanket===true&&command=="destroy")while(interfaces.length>0)interfaces[interfaces.length-1].destroy();else{if(blanket!==true)interfaces=[$(this).qtip("api")];for(i=0;i<interfaces.length;i++)if(command=="destroy")interfaces[i].destroy();else if(interfaces[i].status.rendered===true)if(command=="show")interfaces[i].show();
else if(command=="hide")interfaces[i].hide();else if(command=="focus")interfaces[i].focus();else if(command=="disable")interfaces[i].disable(true);else if(command=="enable")interfaces[i].disable(false)}}else{config=$.extend(true,{},opts);config.hide.effect.length=opts.hide.effect.length;config.show.effect.length=opts.show.effect.length;if(config.position.container===false)config.position.container=$(document.body);if(config.position.target===false)config.position.target=$(this);if(config.show.when.target===
false)config.show.when.target=$(this);if(config.hide.when.target===false)config.hide.when.target=$(this);id=$.fn.qtip.interfaces.length;for(i=0;i<id;i++)if(typeof $.fn.qtip.interfaces[i]=="undefined"){id=i;break}obj=new qTip($(this),config,id);$.fn.qtip.interfaces[id]=obj;if(typeof $(this).data("qtip")=="object"&&$(this).data("qtip")!=null){if(typeof $(this).attr("qtip")==="undefined")$(this).data("qtip").current=$(this).data("qtip").interfaces.length;$(this).data("qtip").interfaces.push(obj)}else $(this).data("qtip",
{current:0,interfaces:[obj]});if(config.content.prerender===false&&config.show.when.event!==false&&config.show.ready!==true)config.show.when.target.bind(config.show.when.event+".qtip-"+id+"-create",{qtip:id},function(event){api=$.fn.qtip.interfaces[event.data.qtip];api.options.show.when.target.unbind(api.options.show.when.event+".qtip-"+event.data.qtip+"-create");api.cache.mouse={x:event.pageX,y:event.pageY};construct.call(api);api.options.show.when.target.trigger(api.options.show.when.event)});else{obj.cache.mouse=
{x:config.show.when.target.offset().left,y:config.show.when.target.offset().top};construct.call(obj)}}})};function qTip(target,options,id){var self=this;self.id=id;self.options=options;self.status={animated:false,rendered:false,disabled:false,focused:false};self.elements={target:target.addClass(self.options.style.classes.target),tooltip:null,wrapper:null,content:null,contentWrapper:null,title:null,button:null,tip:null,bgiframe:null};self.cache={mouse:{},position:{},toggle:0};self.timers={};$.extend(self,
self.options.api,{show:function(event){var returned,solo;if(!self.status.rendered)return $.fn.qtip.log.error.call(self,2,$.fn.qtip.constants.TOOLTIP_NOT_RENDERED,"show");if(self.elements.tooltip.css("display")!=="none")return self;self.elements.tooltip.stop(true,false);returned=self.beforeShow.call(self,event);if(returned===false)return self;function afterShow(){if(self.options.position.type!=="static")self.focus();self.onShow.call(self,event);if($.browser.msie)self.elements.tooltip.get(0).style.removeAttribute("filter")}
self.cache.toggle=1;if(self.options.position.type!=="static")self.updatePosition(event,self.options.show.effect.length>0);if(typeof self.options.show.solo=="object")solo=$(self.options.show.solo);else if(self.options.show.solo===true)solo=$("div.qtip").not(self.elements.tooltip);if(solo)solo.each(function(){if($(this).qtip("api").status.rendered===true)$(this).qtip("api").hide()});if(typeof self.options.show.effect.type=="function"){self.options.show.effect.type.call(self.elements.tooltip,self.options.show.effect.length);
self.elements.tooltip.queue(function(){afterShow();$(this).dequeue()})}else{switch(self.options.show.effect.type.toLowerCase()){case "fade":self.elements.tooltip.fadeIn(self.options.show.effect.length,afterShow);break;case "slide":self.elements.tooltip.slideDown(self.options.show.effect.length,function(){afterShow();if(self.options.position.type!=="static")self.updatePosition(event,true)});break;case "grow":self.elements.tooltip.show(self.options.show.effect.length,afterShow);break;default:self.elements.tooltip.show(null,
afterShow);break}self.elements.tooltip.addClass(self.options.style.classes.active)}return $.fn.qtip.log.error.call(self,1,$.fn.qtip.constants.EVENT_SHOWN,"show")},hide:function(event){var returned;if(!self.status.rendered)return $.fn.qtip.log.error.call(self,2,$.fn.qtip.constants.TOOLTIP_NOT_RENDERED,"hide");else if(self.elements.tooltip.css("display")==="none")return self;clearTimeout(self.timers.show);self.elements.tooltip.stop(true,false);returned=self.beforeHide.call(self,event);if(returned===
false)return self;function afterHide(){self.onHide.call(self,event)}self.cache.toggle=0;if(typeof self.options.hide.effect.type=="function"){self.options.hide.effect.type.call(self.elements.tooltip,self.options.hide.effect.length);self.elements.tooltip.queue(function(){afterHide();$(this).dequeue()})}else{switch(self.options.hide.effect.type.toLowerCase()){case "fade":self.elements.tooltip.fadeOut(self.options.hide.effect.length,afterHide);break;case "slide":self.elements.tooltip.slideUp(self.options.hide.effect.length,
afterHide);break;case "grow":self.elements.tooltip.hide(self.options.hide.effect.length,afterHide);break;default:self.elements.tooltip.hide(null,afterHide);break}self.elements.tooltip.removeClass(self.options.style.classes.active)}return $.fn.qtip.log.error.call(self,1,$.fn.qtip.constants.EVENT_HIDDEN,"hide")},updatePosition:function(event,animate){var i,target,tooltip,coords,mapName,imagePos,newPosition,ieAdjust,ie6Adjust,borderAdjust,mouseAdjust,offset,curPosition,returned;if(!self.status.rendered)return $.fn.qtip.log.error.call(self,
2,$.fn.qtip.constants.TOOLTIP_NOT_RENDERED,"updatePosition");else if(self.options.position.type=="static")return $.fn.qtip.log.error.call(self,1,$.fn.qtip.constants.CANNOT_POSITION_STATIC,"updatePosition");target={position:{left:0,top:0},dimensions:{height:0,width:0},corner:self.options.position.corner.target};tooltip={position:self.getPosition(),dimensions:self.getDimensions(),corner:self.options.position.corner.tooltip};if(self.options.position.target!=="mouse"){if(self.options.position.target.get(0).nodeName.toLowerCase()==
"area"){coords=self.options.position.target.attr("coords").split(",");for(i=0;i<coords.length;i++)coords[i]=parseInt(coords[i]);mapName=self.options.position.target.parent("map").attr("name");imagePos=$('img[usemap="#'+mapName+'"]:first').offset();target.position={left:Math.floor(imagePos.left+coords[0]),top:Math.floor(imagePos.top+coords[1])};switch(self.options.position.target.attr("shape").toLowerCase()){case "rect":target.dimensions={width:Math.ceil(Math.abs(coords[2]-coords[0])),height:Math.ceil(Math.abs(coords[3]-
coords[1]))};break;case "circle":target.dimensions={width:coords[2]+1,height:coords[2]+1};break;case "poly":target.dimensions={width:coords[0],height:coords[1]};for(i=0;i<coords.length;i++)if(i%2==0){if(coords[i]>target.dimensions.width)target.dimensions.width=coords[i];if(coords[i]<coords[0])target.position.left=Math.floor(imagePos.left+coords[i])}else{if(coords[i]>target.dimensions.height)target.dimensions.height=coords[i];if(coords[i]<coords[1])target.position.top=Math.floor(imagePos.top+coords[i])}target.dimensions.width=
target.dimensions.width-(target.position.left-imagePos.left);target.dimensions.height=target.dimensions.height-(target.position.top-imagePos.top);break;default:return $.fn.qtip.log.error.call(self,4,$.fn.qtip.constants.INVALID_AREA_SHAPE,"updatePosition");break}target.dimensions.width-=2;target.dimensions.height-=2}else if(self.options.position.target.add(document.body).length===1){target.position={left:$(document).scrollLeft(),top:$(document).scrollTop()};target.dimensions={height:$(window).height(),
width:$(window).width()}}else{if(typeof self.options.position.target.attr("qtip")!=="undefined")target.position=self.options.position.target.qtip("api").cache.position;else target.position=self.options.position.target.offset();target.dimensions={height:self.options.position.target.outerHeight(),width:self.options.position.target.outerWidth()}}newPosition=$.extend({},target.position);if(target.corner.search(/right/i)!==-1)newPosition.left+=target.dimensions.width;if(target.corner.search(/bottom/i)!==
-1)newPosition.top+=target.dimensions.height;if(target.corner.search(/((top|bottom)Middle)|center/)!==-1)newPosition.left+=target.dimensions.width/2;if(target.corner.search(/((left|right)Middle)|center/)!==-1)newPosition.top+=target.dimensions.height/2}else{target.position=newPosition={left:self.cache.mouse.x,top:self.cache.mouse.y};target.dimensions={height:1,width:1}}if(tooltip.corner.search(/right/i)!==-1)newPosition.left-=tooltip.dimensions.width;if(tooltip.corner.search(/bottom/i)!==-1)newPosition.top-=
tooltip.dimensions.height;if(tooltip.corner.search(/((top|bottom)Middle)|center/)!==-1)newPosition.left-=tooltip.dimensions.width/2;if(tooltip.corner.search(/((left|right)Middle)|center/)!==-1)newPosition.top-=tooltip.dimensions.height/2;ieAdjust=$.browser.msie?1:0;ie6Adjust=$.browser.msie&&parseInt($.browser.version.charAt(0))===6?1:0;if(self.options.style.border.radius>0){if(tooltip.corner.search(/Left/)!==-1)newPosition.left-=self.options.style.border.radius;else if(tooltip.corner.search(/Right/)!==
-1)newPosition.left+=self.options.style.border.radius;if(tooltip.corner.search(/Top/)!==-1)newPosition.top-=self.options.style.border.radius;else if(tooltip.corner.search(/Bottom/)!==-1)newPosition.top+=self.options.style.border.radius}if(ieAdjust){if(tooltip.corner.search(/top/)!==-1)newPosition.top-=ieAdjust;else if(tooltip.corner.search(/bottom/)!==-1)newPosition.top+=ieAdjust;if(tooltip.corner.search(/left/)!==-1)newPosition.left-=ieAdjust;else if(tooltip.corner.search(/right/)!==-1)newPosition.left+=
ieAdjust;if(tooltip.corner.search(/leftMiddle|rightMiddle/)!==-1)newPosition.top-=1}if(self.options.position.adjust.screen===true)newPosition=screenAdjust.call(self,newPosition,target,tooltip);if(self.options.position.target==="mouse"&&self.options.position.adjust.mouse===true){if(self.options.position.adjust.screen===true&&self.elements.tip)mouseAdjust=self.elements.tip.attr("rel");else mouseAdjust=self.options.position.corner.tooltip;newPosition.left+=mouseAdjust.search(/right/i)!==-1?-6:6;newPosition.top+=
mouseAdjust.search(/bottom/i)!==-1?-6:6}if(!self.elements.bgiframe&&$.browser.msie&&parseInt($.browser.version.charAt(0))==6)$("select, object").each(function(){offset=$(this).offset();offset.bottom=offset.top+$(this).height();offset.right=offset.left+$(this).width();if(newPosition.top+tooltip.dimensions.height>=offset.top&&newPosition.left+tooltip.dimensions.width>=offset.left)bgiframe.call(self)});newPosition.left+=self.options.position.adjust.x;newPosition.top+=self.options.position.adjust.y;curPosition=
self.getPosition();if(newPosition.left!=curPosition.left||newPosition.top!=curPosition.top){returned=self.beforePositionUpdate.call(self,event);if(returned===false)return self;self.cache.position=newPosition;if(animate===true){self.status.animated=true;self.elements.tooltip.animate(newPosition,200,"swing",function(){self.status.animated=false})}else self.elements.tooltip.css(newPosition);self.onPositionUpdate.call(self,event);if(typeof event!=="undefined"&&event.type&&event.type!=="mousemove")$.fn.qtip.log.error.call(self,
1,$.fn.qtip.constants.EVENT_POSITION_UPDATED,"updatePosition")}return self},updateWidth:function(newWidth){var hidden;if(!self.status.rendered)return $.fn.qtip.log.error.call(self,2,$.fn.qtip.constants.TOOLTIP_NOT_RENDERED,"updateWidth");else if(newWidth&&typeof newWidth!=="number")return $.fn.qtip.log.error.call(self,2,"newWidth must be of type number","updateWidth");hidden=self.elements.contentWrapper.siblings().add(self.elements.tip).add(self.elements.button);if(!newWidth)if(typeof self.options.style.width.value==
"number")newWidth=self.options.style.width.value;else{self.elements.tooltip.css({width:"auto"});hidden.hide();if($.browser.msie)self.elements.wrapper.add(self.elements.contentWrapper.children()).css({zoom:"normal"});newWidth=self.getDimensions().width+1;if(!self.options.style.width.value){if(newWidth>self.options.style.width.max)newWidth=self.options.style.width.max;if(newWidth<self.options.style.width.min)newWidth=self.options.style.width.min}}if(newWidth%2!==0)newWidth-=1;self.elements.tooltip.width(newWidth);
hidden.show();if(self.options.style.border.radius)self.elements.tooltip.find(".qtip-betweenCorners").each(function(i){$(this).width(newWidth-self.options.style.border.radius*2)});if($.browser.msie){self.elements.wrapper.add(self.elements.contentWrapper.children()).css({zoom:"1"});self.elements.wrapper.width(newWidth);if(self.elements.bgiframe)self.elements.bgiframe.width(newWidth).height(self.getDimensions.height)}return $.fn.qtip.log.error.call(self,1,$.fn.qtip.constants.EVENT_WIDTH_UPDATED,"updateWidth")},
updateStyle:function(name){var tip,borders,context,corner,coordinates;if(!self.status.rendered)return $.fn.qtip.log.error.call(self,2,$.fn.qtip.constants.TOOLTIP_NOT_RENDERED,"updateStyle");else if(typeof name!=="string"||!$.fn.qtip.styles[name])return $.fn.qtip.log.error.call(self,2,$.fn.qtip.constants.STYLE_NOT_DEFINED,"updateStyle");self.options.style=buildStyle.call(self,$.fn.qtip.styles[name],self.options.user.style);self.elements.content.css(jQueryStyle(self.options.style));if(self.options.content.title.text!==
false)self.elements.title.css(jQueryStyle(self.options.style.title,true));self.elements.contentWrapper.css({borderColor:self.options.style.border.color});if(self.options.style.tip.corner!==false)if($("<canvas>").get(0).getContext){tip=self.elements.tooltip.find(".qtip-tip canvas:first");context=tip.get(0).getContext("2d");context.clearRect(0,0,300,300);corner=tip.parent("div[rel]:first").attr("rel");coordinates=calculateTip(corner,self.options.style.tip.size.width,self.options.style.tip.size.height);
drawTip.call(self,tip,coordinates,self.options.style.tip.color||self.options.style.border.color)}else if($.browser.msie){tip=self.elements.tooltip.find('.qtip-tip [nodeName="shape"]');tip.attr("fillcolor",self.options.style.tip.color||self.options.style.border.color)}if(self.options.style.border.radius>0){self.elements.tooltip.find(".qtip-betweenCorners").css({backgroundColor:self.options.style.border.color});if($("<canvas>").get(0).getContext){borders=calculateBorders(self.options.style.border.radius);
self.elements.tooltip.find(".qtip-wrapper canvas").each(function(){context=$(this).get(0).getContext("2d");context.clearRect(0,0,300,300);corner=$(this).parent("div[rel]:first").attr("rel");drawBorder.call(self,$(this),borders[corner],self.options.style.border.radius,self.options.style.border.color)})}else if($.browser.msie)self.elements.tooltip.find('.qtip-wrapper [nodeName="arc"]').each(function(){$(this).attr("fillcolor",self.options.style.border.color)})}return $.fn.qtip.log.error.call(self,1,
$.fn.qtip.constants.EVENT_STYLE_UPDATED,"updateStyle")},updateContent:function(content,reposition){var parsedContent,images,loadedImages;if(!self.status.rendered)return $.fn.qtip.log.error.call(self,2,$.fn.qtip.constants.TOOLTIP_NOT_RENDERED,"updateContent");else if(!content)return $.fn.qtip.log.error.call(self,2,$.fn.qtip.constants.NO_CONTENT_PROVIDED,"updateContent");parsedContent=self.beforeContentUpdate.call(self,content);if(typeof parsedContent=="string")content=parsedContent;else if(parsedContent===
false)return;if($.browser.msie)self.elements.contentWrapper.children().css({zoom:"normal"});if(content.jquery&&content.length>0)content.clone(true).appendTo(self.elements.content).show();else self.elements.content.html(content);images=self.elements.content.find("img[complete=false]");if(images.length>0){loadedImages=0;images.each(function(i){$('<img src="'+$(this).attr("src")+'" />').load(function(){if(++loadedImages==images.length)afterLoad()})})}else afterLoad();function afterLoad(){self.updateWidth();
if(reposition!==false){if(self.options.position.type!=="static")self.updatePosition(self.elements.tooltip.is(":visible"),true);if(self.options.style.tip.corner!==false)positionTip.call(self)}}self.onContentUpdate.call(self);return $.fn.qtip.log.error.call(self,1,$.fn.qtip.constants.EVENT_CONTENT_UPDATED,"loadContent")},loadContent:function(url,data,method){var returned;if(!self.status.rendered)return $.fn.qtip.log.error.call(self,2,$.fn.qtip.constants.TOOLTIP_NOT_RENDERED,"loadContent");returned=
self.beforeContentLoad.call(self);if(returned===false)return self;if(method=="post")$.post(url,data,setupContent);else $.get(url,data,setupContent);function setupContent(content){self.onContentLoad.call(self);$.fn.qtip.log.error.call(self,1,$.fn.qtip.constants.EVENT_CONTENT_LOADED,"loadContent");self.updateContent(content)}return self},updateTitle:function(content){if(!self.status.rendered)return $.fn.qtip.log.error.call(self,2,$.fn.qtip.constants.TOOLTIP_NOT_RENDERED,"updateTitle");else if(!content)return $.fn.qtip.log.error.call(self,
2,$.fn.qtip.constants.NO_CONTENT_PROVIDED,"updateTitle");returned=self.beforeTitleUpdate.call(self);if(returned===false)return self;if(self.elements.button)self.elements.button=self.elements.button.clone(true);self.elements.title.html(content);if(self.elements.button)self.elements.title.prepend(self.elements.button);self.onTitleUpdate.call(self);return $.fn.qtip.log.error.call(self,1,$.fn.qtip.constants.EVENT_TITLE_UPDATED,"updateTitle")},focus:function(event){var curIndex,newIndex,elemIndex,returned;
if(!self.status.rendered)return $.fn.qtip.log.error.call(self,2,$.fn.qtip.constants.TOOLTIP_NOT_RENDERED,"focus");else if(self.options.position.type=="static")return $.fn.qtip.log.error.call(self,1,$.fn.qtip.constants.CANNOT_FOCUS_STATIC,"focus");curIndex=parseInt(self.elements.tooltip.css("z-index"));newIndex=6E3+$("div.qtip[qtip]").length-1;if(!self.status.focused&&curIndex!==newIndex){returned=self.beforeFocus.call(self,event);if(returned===false)return self;$("div.qtip[qtip]").not(self.elements.tooltip).each(function(){if($(this).qtip("api").status.rendered===
true){elemIndex=parseInt($(this).css("z-index"));if(typeof elemIndex=="number"&&elemIndex>-1)$(this).css({zIndex:parseInt($(this).css("z-index"))-1});$(this).qtip("api").status.focused=false}});self.elements.tooltip.css({zIndex:newIndex});self.status.focused=true;self.onFocus.call(self,event);$.fn.qtip.log.error.call(self,1,$.fn.qtip.constants.EVENT_FOCUSED,"focus")}return self},disable:function(state){if(!self.status.rendered)return $.fn.qtip.log.error.call(self,2,$.fn.qtip.constants.TOOLTIP_NOT_RENDERED,
"disable");if(state)if(!self.status.disabled){self.status.disabled=true;$.fn.qtip.log.error.call(self,1,$.fn.qtip.constants.EVENT_DISABLED,"disable")}else $.fn.qtip.log.error.call(self,1,$.fn.qtip.constants.TOOLTIP_ALREADY_DISABLED,"disable");else if(self.status.disabled){self.status.disabled=false;$.fn.qtip.log.error.call(self,1,$.fn.qtip.constants.EVENT_ENABLED,"disable")}else $.fn.qtip.log.error.call(self,1,$.fn.qtip.constants.TOOLTIP_ALREADY_ENABLED,"disable");return self},destroy:function(){var i,
returned,interfaces;returned=self.beforeDestroy.call(self);if(returned===false)return self;if(self.status.rendered){self.options.show.when.target.unbind("mousemove.qtip",self.updatePosition);self.options.show.when.target.unbind("mouseout.qtip",self.hide);self.options.show.when.target.unbind(self.options.show.when.event+".qtip");self.options.hide.when.target.unbind(self.options.hide.when.event+".qtip");self.elements.tooltip.unbind(self.options.hide.when.event+".qtip");self.elements.tooltip.unbind("mouseover.qtip",
self.focus);self.elements.tooltip.remove()}else self.options.show.when.target.unbind(self.options.show.when.event+".qtip-create");if(typeof self.elements.target.data("qtip")=="object"){interfaces=self.elements.target.data("qtip").interfaces;if(typeof interfaces=="object"&&interfaces.length>0)for(i=0;i<interfaces.length-1;i++)if(interfaces[i].id==self.id)interfaces.splice(i,1)}delete $.fn.qtip.interfaces[self.id];if(typeof interfaces=="object"&&interfaces.length>0)self.elements.target.data("qtip").current=
interfaces.length-1;else self.elements.target.removeData("qtip");self.onDestroy.call(self);$.fn.qtip.log.error.call(self,1,$.fn.qtip.constants.EVENT_DESTROYED,"destroy");return self.elements.target},getPosition:function(){var show,offset;if(!self.status.rendered)return $.fn.qtip.log.error.call(self,2,$.fn.qtip.constants.TOOLTIP_NOT_RENDERED,"getPosition");show=self.elements.tooltip.css("display")!=="none"?false:true;if(show)self.elements.tooltip.css({visiblity:"hidden"}).show();offset=self.elements.tooltip.offset();
if(show)self.elements.tooltip.css({visiblity:"visible"}).hide();return offset},getDimensions:function(){var show,dimensions;if(!self.status.rendered)return $.fn.qtip.log.error.call(self,2,$.fn.qtip.constants.TOOLTIP_NOT_RENDERED,"getDimensions");show=!self.elements.tooltip.is(":visible")?true:false;if(show)self.elements.tooltip.css({visiblity:"hidden"}).show();dimensions={height:self.elements.tooltip.outerHeight(),width:self.elements.tooltip.outerWidth()};if(show)self.elements.tooltip.css({visiblity:"visible"}).hide();
return dimensions}})}function construct(){var self,adjust,content,url,data,method,tempLength;self=this;self.beforeRender.call(self);self.status.rendered=true;self.elements.tooltip='<div qtip="'+self.id+'" '+'class="qtip '+(self.options.style.classes.tooltip||self.options.style)+'"'+'style="display:none;'+"position:"+self.options.position.type+';">'+'  <div class="qtip-wrapper" style="position:relative; overflow:hidden; text-align:left;">'+'    <div class="qtip-contentWrapper" style="overflow:hidden;">'+
'       <div class="qtip-content '+self.options.style.classes.content+'"></div>'+"</div></div></div>";self.elements.tooltip=$(self.elements.tooltip);self.elements.tooltip.appendTo(self.options.position.container);self.elements.tooltip.data("qtip",{current:0,interfaces:[self]});self.elements.wrapper=self.elements.tooltip.children("div:first");self.elements.contentWrapper=self.elements.wrapper.children("div:first").css({background:self.options.style.background});self.elements.content=self.elements.contentWrapper.children("div:first").css(jQueryStyle(self.options.style));
if($.browser.msie)self.elements.wrapper.add(self.elements.content).css({zoom:1});if(self.options.hide.when.event=="unfocus")self.elements.tooltip.attr("unfocus",true);if(typeof self.options.style.width.value=="number")self.updateWidth();if($("<canvas>").get(0).getContext||$.browser.msie){if(self.options.style.border.radius>0)createBorder.call(self);else;if(self.options.style.tip.corner!==false)createTip.call(self)}else{self.elements.contentWrapper.css({border:self.options.style.border.width+"px solid "+
self.options.style.border.color});self.options.style.border.radius=0;self.options.style.tip.corner=false;$.fn.qtip.log.error.call(self,2,$.fn.qtip.constants.CANVAS_VML_NOT_SUPPORTED,"render")}if(typeof self.options.content.text=="string"&&self.options.content.text.length>0||self.options.content.text.jquery&&self.options.content.text.length>0)content=self.options.content.text;else if(typeof self.elements.target.attr("title")=="string"&&self.elements.target.attr("title").length>0){content=self.elements.target.attr("title").replace("\\n",
"<br />");self.elements.target.attr("title","")}else if(typeof self.elements.target.attr("alt")=="string"&&self.elements.target.attr("alt").length>0){content=self.elements.target.attr("alt").replace("\\n","<br />");self.elements.target.attr("alt","")}else{content=" ";$.fn.qtip.log.error.call(self,1,$.fn.qtip.constants.NO_VALID_CONTENT,"render")}if(self.options.content.title.text!==false)createTitle.call(self);self.updateContent(content);assignEvents.call(self);if(self.options.show.ready===true)self.show();
if(self.options.content.url!==false){url=self.options.content.url;data=self.options.content.data;method=self.options.content.method||"get";self.loadContent(url,data,method)}self.onRender.call(self);$.fn.qtip.log.error.call(self,1,$.fn.qtip.constants.EVENT_RENDERED,"render")}function createBorder(){var self,i,width,radius,color,coordinates,containers,size,betweenWidth,betweenCorners,borderTop,borderBottom,borderCoord,sideWidth,vertWidth;self=this;width=self.options.style.border.width;radius=self.options.style.border.radius;
color=self.options.style.border.color||self.options.style.tip.color;coordinates=calculateBorders(radius);containers={};for(i in coordinates){containers[i]='<div rel="'+i+'" style="'+(i.search(/Left/)!==-1?"left":"right")+":0; "+"position:absolute; height:"+radius+"px; width:"+radius+'px; overflow:hidden; line-height:0.1px; font-size:1px">';if($("<canvas>").get(0).getContext)containers[i]+='<canvas height="'+radius+'" width="'+radius+'" style="vertical-align: top"></canvas>';else if($.browser.msie){size=
radius*2+3;containers[i]+='<v:arc stroked="false" fillcolor="'+color+'" startangle="'+coordinates[i][0]+'" endangle="'+coordinates[i][1]+'" '+'style="width:'+size+"px; height:"+size+"px; margin-top:"+(i.search(/bottom/)!==-1?-2:-1)+"px; "+"margin-left:"+(i.search(/Right/)!==-1?coordinates[i][2]-3.5:-1)+"px; "+'vertical-align:top; display:inline-block; behavior:url(#default#VML)"></v:arc>'}containers[i]+="</div>"}betweenWidth=self.getDimensions().width-Math.max(width,radius)*2;betweenCorners='<div class="qtip-betweenCorners" style="height:'+
radius+"px; width:"+betweenWidth+"px; "+"overflow:hidden; background-color:"+color+'; line-height:0.1px; font-size:1px;">';borderTop='<div class="qtip-borderTop" dir="ltr" style="height:'+radius+"px; "+"margin-left:"+radius+'px; line-height:0.1px; font-size:1px; padding:0; display:none;">'+containers["topLeft"]+containers["topRight"]+betweenCorners;borderBottom='<div class="qtip-borderBottom" dir="ltr" style="height:'+radius+"px; "+"margin-left:"+radius+'px; line-height:0.1px; font-size:1px; padding:0; display: none;">'+
containers["bottomLeft"]+containers["bottomRight"]+betweenCorners;if($("<canvas>").get(0).getContext)self.elements.wrapper.find("canvas").each(function(){borderCoord=coordinates[$(this).parent("[rel]:first").attr("rel")];drawBorder.call(self,$(this),borderCoord,radius,color)});else if($.browser.msie)self.elements.tooltip.append('<v:image style="behavior:url(#default#VML);"></v:image>');sideWidth=Math.max(radius,radius+(width-radius));vertWidth=Math.max(width-radius,0);self.elements.contentWrapper.css({border:"0px solid "+
color,borderWidth:vertWidth+"px "+sideWidth+"px"})}function drawBorder(canvas,coordinates,radius,color){var context=canvas.get(0).getContext("2d");context.fillStyle=color;context.beginPath();context.arc(coordinates[0],coordinates[1],radius,0,Math.PI*2,false);context.fill()}function createTip(corner){var self,color,coordinates,coordsize,path;self=this;if(self.elements.tip!==null)self.elements.tip.remove();color=self.options.style.tip.color||self.options.style.border.color;if(self.options.style.tip.corner===
false)return;else if(!corner)corner=self.options.style.tip.corner;coordinates=calculateTip(corner,self.options.style.tip.size.width,self.options.style.tip.size.height);self.elements.tip='<div class="'+self.options.style.classes.tip+'" dir="ltr" rel="'+corner+'" style="position:absolute; '+"height:"+self.options.style.tip.size.height+"px; width:"+self.options.style.tip.size.width+"px; "+'margin:0 auto; line-height:0.1px; font-size:1px;">';if($("<canvas>").get(0).getContext)self.elements.tip+='<canvas height="'+
self.options.style.tip.size.height+'" width="'+self.options.style.tip.size.width+'"></canvas>';else if($.browser.msie){coordsize=self.options.style.tip.size.width+","+self.options.style.tip.size.height;path="m"+coordinates[0][0]+","+coordinates[0][1];path+=" l"+coordinates[1][0]+","+coordinates[1][1];path+=" "+coordinates[2][0]+","+coordinates[2][1];path+=" xe";self.elements.tip+='<v:shape fillcolor="'+color+'" stroked="false" filled="true" path="'+path+'" coordsize="'+coordsize+'" '+'style="width:'+
self.options.style.tip.size.width+"px; height:"+self.options.style.tip.size.height+"px; "+"line-height:0.1px; display:inline-block; behavior:url(#default#VML); "+"vertical-align:"+(corner.search(/top/)!==-1?"bottom":"top")+'"></v:shape>';self.elements.tip+='<v:image style="behavior:url(#default#VML);"></v:image>';self.elements.contentWrapper.css("position","relative")}self.elements.tooltip.prepend(self.elements.tip+"</div>");self.elements.tip=self.elements.tooltip.find("."+self.options.style.classes.tip).eq(0);
if($("<canvas>").get(0).getContext)drawTip.call(self,self.elements.tip.find("canvas:first"),coordinates,color);if(corner.search(/top/)!==-1&&$.browser.msie&&parseInt($.browser.version.charAt(0))===6)self.elements.tip.css({marginTop:-4});positionTip.call(self,corner)}function drawTip(canvas,coordinates,color){var context=canvas.get(0).getContext("2d");context.fillStyle=color;context.beginPath();context.moveTo(coordinates[0][0],coordinates[0][1]);context.lineTo(coordinates[1][0],coordinates[1][1]);
context.lineTo(coordinates[2][0],coordinates[2][1]);context.fill()}function positionTip(corner){var self,ieAdjust,paddingCorner,paddingSize,newMargin;self=this;if(self.options.style.tip.corner===false||!self.elements.tip)return;if(!corner)corner=self.elements.tip.attr("rel");ieAdjust=positionAdjust=$.browser.msie?1:0;self.elements.tip.css(corner.match(/left|right|top|bottom/)[0],0);if(corner.search(/top|bottom/)!==-1){if($.browser.msie)if(parseInt($.browser.version.charAt(0))===6)positionAdjust=corner.search(/top/)!==
-1?-3:1;else positionAdjust=corner.search(/top/)!==-1?1:2;if(corner.search(/Middle/)!==-1)self.elements.tip.css({left:"50%",marginLeft:-(self.options.style.tip.size.width/2)});else if(corner.search(/Left/)!==-1)self.elements.tip.css({left:self.options.style.border.radius-ieAdjust});else if(corner.search(/Right/)!==-1)self.elements.tip.css({right:self.options.style.border.radius+ieAdjust});if(corner.search(/top/)!==-1)self.elements.tip.css({top:"1px"});else self.elements.tip.css({bottom:positionAdjust})}else if(corner.search(/left|right/)!==
-1){if($.browser.msie)positionAdjust=parseInt($.browser.version.charAt(0))===6?1:corner.search(/left/)!==-1?1:2;if(corner.search(/Middle/)!==-1)self.elements.tip.css({top:"50%",marginTop:-(self.options.style.tip.size.height/2)});else if(corner.search(/Top/)!==-1)self.elements.tip.css({top:self.options.style.border.radius-ieAdjust});else if(corner.search(/Bottom/)!==-1)self.elements.tip.css({bottom:self.options.style.border.radius+ieAdjust});if(corner.search(/left/)!==-1)self.elements.tip.css({left:-positionAdjust});
else self.elements.tip.css({right:positionAdjust})}paddingCorner="padding-"+corner.match(/left|right|top|bottom/)[0];paddingSize=self.options.style.tip.size[paddingCorner.search(/left|right/)!==-1?"width":"height"];self.elements.tooltip.css("padding",0);self.elements.tooltip.css(paddingCorner,paddingSize);if($.browser.msie&&parseInt($.browser.version.charAt(0))==6){newMargin=parseInt(self.elements.tip.css("margin-top"))||0;newMargin+=parseInt(self.elements.content.css("margin-top"))||0;self.elements.tip.css({marginTop:newMargin})}}
function createTitle(){var self=this;if(self.elements.title!==null)self.elements.title.remove();self.elements.title=$('<div class="'+self.options.style.classes.title+'">').css(jQueryStyle(self.options.style.title,true)).css({zoom:$.browser.msie?1:0}).prependTo(self.elements.contentWrapper);if(self.options.content.title.text)self.updateTitle.call(self,self.options.content.title.text);if(self.options.content.title.button!==false&&typeof self.options.content.title.button=="string")self.elements.button=
$('<a class="'+self.options.style.classes.button+'" style="float:right; position: relative"></a>').css(jQueryStyle(self.options.style.button,true)).html(self.options.content.title.button).prependTo(self.elements.title).click(function(event){if(!self.status.disabled)self.hide(event)})}function assignEvents(){var self,showTarget,hideTarget,inactiveEvents;self=this;showTarget=self.options.show.when.target;hideTarget=self.options.hide.when.target;if(self.options.hide.fixed)hideTarget=hideTarget.add(self.elements.tooltip);
if(self.options.hide.when.event=="inactive"){inactiveEvents=["click","dblclick","mousedown","mouseup","mousemove","mouseout","mouseenter","mouseleave","mouseover"];function inactiveMethod(event){if(self.status.disabled===true)return;clearTimeout(self.timers.inactive);self.timers.inactive=setTimeout(function(){$(inactiveEvents).each(function(){hideTarget.unbind(this+".qtip-inactive");self.elements.content.unbind(this+".qtip-inactive")});self.hide(event)},self.options.hide.delay)}}else if(self.options.hide.fixed===
true)self.elements.tooltip.bind("mouseover.qtip",function(){if(self.status.disabled===true)return;clearTimeout(self.timers.hide)});function showMethod(event){if(self.status.disabled===true)return;if(self.options.hide.when.event=="inactive"){$(inactiveEvents).each(function(){hideTarget.bind(this+".qtip-inactive",inactiveMethod);self.elements.content.bind(this+".qtip-inactive",inactiveMethod)});inactiveMethod()}clearTimeout(self.timers.show);clearTimeout(self.timers.hide);self.timers.show=setTimeout(function(){self.show(event)},
self.options.show.delay)}function hideMethod(event){if(self.status.disabled===true)return;if(self.options.hide.fixed===true&&self.options.hide.when.event.search(/mouse(out|leave)/i)!==-1&&$(event.relatedTarget).parents("div.qtip[qtip]").length>0){event.stopPropagation();event.preventDefault();clearTimeout(self.timers.hide);return false}clearTimeout(self.timers.show);clearTimeout(self.timers.hide);self.elements.tooltip.stop(true,true);self.timers.hide=setTimeout(function(){self.hide(event)},self.options.hide.delay)}
if(self.options.show.when.target.add(self.options.hide.when.target).length===1&&self.options.show.when.event==self.options.hide.when.event&&self.options.hide.when.event!=="inactive"||self.options.hide.when.event=="unfocus"){self.cache.toggle=0;showTarget.bind(self.options.show.when.event+".qtip",function(event){if(self.cache.toggle==0)showMethod(event);else hideMethod(event)})}else{showTarget.bind(self.options.show.when.event+".qtip",showMethod);if(self.options.hide.when.event!=="inactive")hideTarget.bind(self.options.hide.when.event+
".qtip",hideMethod)}if(self.options.position.type.search(/(fixed|absolute)/)!==-1)self.elements.tooltip.bind("mouseover.qtip",self.focus);if(self.options.position.target==="mouse"&&self.options.position.type!=="static")showTarget.bind("mousemove.qtip",function(event){self.cache.mouse={x:event.pageX,y:event.pageY};if(self.status.disabled===false&&self.options.position.adjust.mouse===true&&self.options.position.type!=="static"&&self.elements.tooltip.css("display")!=="none")self.updatePosition(event)})}
function screenAdjust(position,target,tooltip){var self,adjustedPosition,adjust,newCorner,overflow,corner;self=this;if(tooltip.corner=="center")return target.position;adjustedPosition=$.extend({},position);newCorner={x:false,y:false};overflow={left:adjustedPosition.left<$.fn.qtip.cache.screen.scroll.left,right:adjustedPosition.left+tooltip.dimensions.width+2>=$.fn.qtip.cache.screen.width+$.fn.qtip.cache.screen.scroll.left,top:adjustedPosition.top<$.fn.qtip.cache.screen.scroll.top,bottom:adjustedPosition.top+
tooltip.dimensions.height+2>=$.fn.qtip.cache.screen.height+$.fn.qtip.cache.screen.scroll.top};adjust={left:overflow.left&&(tooltip.corner.search(/right/i)!=-1||tooltip.corner.search(/right/i)==-1&&!overflow.right),right:overflow.right&&(tooltip.corner.search(/left/i)!=-1||tooltip.corner.search(/left/i)==-1&&!overflow.left),top:overflow.top&&tooltip.corner.search(/top/i)==-1,bottom:overflow.bottom&&tooltip.corner.search(/bottom/i)==-1};if(adjust.left){if(self.options.position.target!=="mouse")adjustedPosition.left=
target.position.left+target.dimensions.width;else adjustedPosition.left=self.cache.mouse.x;newCorner.x="Left"}else if(adjust.right){if(self.options.position.target!=="mouse")adjustedPosition.left=target.position.left-tooltip.dimensions.width;else adjustedPosition.left=self.cache.mouse.x-tooltip.dimensions.width;newCorner.x="Right"}if(adjust.top){if(self.options.position.target!=="mouse")adjustedPosition.top=target.position.top+target.dimensions.height;else adjustedPosition.top=self.cache.mouse.y;
newCorner.y="top"}else if(adjust.bottom){if(self.options.position.target!=="mouse")adjustedPosition.top=target.position.top-tooltip.dimensions.height;else adjustedPosition.top=self.cache.mouse.y-tooltip.dimensions.height;newCorner.y="bottom"}if(adjustedPosition.left<0){adjustedPosition.left=position.left;newCorner.x=false}if(adjustedPosition.top<0){adjustedPosition.top=position.top;newCorner.y=false}if(self.options.style.tip.corner!==false){adjustedPosition.corner=new String(tooltip.corner);if(newCorner.x!==
false)adjustedPosition.corner=adjustedPosition.corner.replace(/Left|Right|Middle/,newCorner.x);if(newCorner.y!==false)adjustedPosition.corner=adjustedPosition.corner.replace(/top|bottom/,newCorner.y);if(adjustedPosition.corner!==self.elements.tip.attr("rel"))createTip.call(self,adjustedPosition.corner)}return adjustedPosition}function jQueryStyle(style,sub){var styleObj,i;styleObj=$.extend(true,{},style);for(i in styleObj)if(sub===true&&i.search(/(tip|classes)/i)!==-1)delete styleObj[i];else if(!sub&&
i.search(/(width|border|tip|title|classes|user)/i)!==-1)delete styleObj[i];return styleObj}function sanitizeStyle(style){if(typeof style.tip!=="object")style.tip={corner:style.tip};if(typeof style.tip.size!=="object")style.tip.size={width:style.tip.size,height:style.tip.size};if(typeof style.border!=="object")style.border={width:style.border};if(typeof style.width!=="object")style.width={value:style.width};if(typeof style.width.max=="string")style.width.max=parseInt(style.width.max.replace(/([0-9]+)/i,
"$1"));if(typeof style.width.min=="string")style.width.min=parseInt(style.width.min.replace(/([0-9]+)/i,"$1"));if(typeof style.tip.size.x=="number"){style.tip.size.width=style.tip.size.x;delete style.tip.size.x}if(typeof style.tip.size.y=="number"){style.tip.size.height=style.tip.size.y;delete style.tip.size.y}return style}function buildStyle(){var self,i,styleArray,styleExtend,finalStyle,ieAdjust;self=this;styleArray=[true,{}];for(i=0;i<arguments.length;i++)styleArray.push(arguments[i]);styleExtend=
[$.extend.apply($,styleArray)];while(typeof styleExtend[0].name=="string")styleExtend.unshift(sanitizeStyle($.fn.qtip.styles[styleExtend[0].name]));styleExtend.unshift(true,{classes:{tooltip:"qtip-"+(arguments[0].name||"defaults")}},$.fn.qtip.styles.defaults);finalStyle=$.extend.apply($,styleExtend);ieAdjust=$.browser.msie?1:0;finalStyle.tip.size.width+=ieAdjust;finalStyle.tip.size.height+=ieAdjust;if(finalStyle.tip.size.width%2>0)finalStyle.tip.size.width+=1;if(finalStyle.tip.size.height%2>0)finalStyle.tip.size.height+=
1;if(finalStyle.tip.corner===true)finalStyle.tip.corner=self.options.position.corner.tooltip==="center"?false:self.options.position.corner.tooltip;return finalStyle}function calculateTip(corner,width,height){var tips={bottomRight:[[0,0],[width,height],[width,0]],bottomLeft:[[0,0],[width,0],[0,height]],topRight:[[0,height],[width,0],[width,height]],topLeft:[[0,0],[0,height],[width,height]],topMiddle:[[0,height],[width/2,0],[width,height]],bottomMiddle:[[0,0],[width,0],[width/2,height]],rightMiddle:[[0,
0],[width,height/2],[0,height]],leftMiddle:[[width,0],[width,height],[0,height/2]]};tips.leftTop=tips.bottomRight;tips.rightTop=tips.bottomLeft;tips.leftBottom=tips.topRight;tips.rightBottom=tips.topLeft;return tips[corner]}function calculateBorders(radius){var borders;if($("<canvas>").get(0).getContext)borders={topLeft:[radius,radius],topRight:[0,radius],bottomLeft:[radius,0],bottomRight:[0,0]};else if($.browser.msie)borders={topLeft:[-90,90,0],topRight:[-90,90,-radius],bottomLeft:[90,270,0],bottomRight:[90,
270,-radius]};return borders}function bgiframe(){var self,html,dimensions;self=this;dimensions=self.getDimensions();html='<iframe class="qtip-bgiframe" frameborder="0" tabindex="-1" src="javascript:false" '+"style=\"display:block; position:absolute; z-index:-1; filter:alpha(opacity='0'); border: 1px solid red; "+"height:"+dimensions.height+"px; width:"+dimensions.width+'px" />';self.elements.bgiframe=self.elements.wrapper.prepend(html).children(".qtip-bgiframe:first")}$(document).ready(function(){$.fn.qtip.cache=
{screen:{scroll:{left:$(window).scrollLeft(),top:$(window).scrollTop()},width:$(window).width(),height:$(window).height()}};var adjustTimer;$(window).bind("resize scroll",function(event){clearTimeout(adjustTimer);adjustTimer=setTimeout(function(){if(event.type==="scroll")$.fn.qtip.cache.screen.scroll={left:$(window).scrollLeft(),top:$(window).scrollTop()};else{$.fn.qtip.cache.screen.width=$(window).width();$.fn.qtip.cache.screen.height=$(window).height()}for(i=0;i<$.fn.qtip.interfaces.length;i++){var api=
$.fn.qtip.interfaces[i];if(api)if(api.status.rendered===true&&(api.options.position.type!=="static"||api.options.position.adjust.scroll&&event.type==="scroll"||api.options.position.adjust.resize&&event.type==="resize"))api.updatePosition(event,true)}},100)});$(document).bind("mousedown.qtip",function(event){if($(event.target).parents("div.qtip").length===0)$(".qtip[unfocus]").each(function(){var api=$(this).qtip("api");if($(this).is(":visible")&&!api.status.disabled&&$(event.target).add(api.elements.target).length>
1)api.hide(event)})})});$.fn.qtip.interfaces=[];$.fn.qtip.log={error:function(){return this}};$.fn.qtip.constants={};$.fn.qtip.defaults={content:{prerender:false,text:false,url:false,data:null,title:{text:false,button:false}},position:{target:false,corner:{target:"bottomRight",tooltip:"topLeft"},adjust:{x:0,y:0,mouse:true,screen:false,scroll:true,resize:true},type:"absolute",container:false},show:{when:{target:false,event:"mouseover"},effect:{type:"fade",length:100},delay:140,solo:false,ready:false},
hide:{when:{target:false,event:"mouseout"},effect:{type:"fade",length:100},delay:0,fixed:false},api:{beforeRender:function(){},onRender:function(){},beforePositionUpdate:function(){},onPositionUpdate:function(){},beforeShow:function(){},onShow:function(){},beforeHide:function(){},onHide:function(){},beforeContentUpdate:function(){},onContentUpdate:function(){},beforeContentLoad:function(){},onContentLoad:function(){},beforeTitleUpdate:function(){},onTitleUpdate:function(){},beforeDestroy:function(){},
onDestroy:function(){},beforeFocus:function(){},onFocus:function(){}}};$.fn.qtip.styles={defaults:{background:"white",color:"#111",overflow:"hidden",textAlign:"left",width:{min:0,max:250},padding:"5px 9px",border:{width:1,radius:0,color:"#d3d3d3"},tip:{corner:false,color:false,size:{width:13,height:13},opacity:1},title:{background:"#e1e1e1",fontWeight:"bold",padding:"7px 12px"},button:{cursor:"pointer"},classes:{target:"",tip:"qtip-tip",title:"qtip-title",button:"qtip-button",content:"qtip-content",
active:"qtip-active"}},cream:{border:{width:3,radius:0,color:"#F9E98E"},title:{background:"#F0DE7D",color:"#A27D35"},background:"#FBF7AA",color:"#A27D35",classes:{tooltip:"qtip-cream"}},light:{border:{width:3,radius:0,color:"#E2E2E2"},title:{background:"#f1f1f1",color:"#454545"},background:"white",color:"#454545",classes:{tooltip:"qtip-light"}},dark:{border:{width:3,radius:0,color:"#303030"},title:{background:"#404040",color:"#f3f3f3"},background:"#000",color:"#f3f3f3",classes:{tooltip:"qtip-dark"}},
red:{border:{width:3,radius:0,color:"#CE6F6F"},title:{background:"#f28279",color:"#9C2F2F"},background:"#F79992",color:"#9C2F2F",classes:{tooltip:"qtip-red"}},green:{border:{width:3,radius:0,color:"#A9DB66"},title:{background:"#b9db8c",color:"#58792E"},background:"#CDE6AC",color:"#58792E",classes:{tooltip:"qtip-green"}},blue:{border:{width:3,radius:0,color:"#ADD9ED"},title:{background:"#D0E9F5",color:"#5E99BD"},background:"#E5F6FE",color:"#4D9FBF",classes:{tooltip:"qtip-blue"}}}})(jQuery);
$.fn.extend({typing_indicator:function(start_func,end_func,delay){var start_new=(new Date).getTime();if(start_new>$(this).data("idle.start_new"))setTimeout(start_func,250);if($(this).data("idle.timeout")){clearTimeout($(this).data("idle.timeout"));$(this).data("idle.timeout","")}else setTimeout(start_func,250);if(typeof end_func=="string"){$(this).data("idle.timeout",setTimeout(end_func,delay));$(this).data("idle.start_new",start_new+delay)}},typing_indicator_clear:function(){if($(this).data("idle.timeout"))clearTimeout($(this).data("idle.timeout"))}});
$.fn.extend({textarea_maxlength:function(){$(this).keypress(function(event){var key=event.which;if(key>=33||key==13){var maxLength=$(this).attr("maxlength");var length=this.value.length;if(maxLength>1&&length>=maxLength)event.preventDefault()}})}});
(function($){$.autolink=function(html,target){target=target||"_blank";html=html||"";var re_proto=/\b([\w+.:-]+:\/\/)|mailto:/i,re=new RegExp("(\\b(?:([\\w+.:-]+:)//|www.|mailto:)(([\\w.\\-+]+(:\\w+)?@)?[-\\w]+(?:\\.[-\\w]+)*(?::\\d+)?(?:/(?:[~\\w\\+@%=\\(\\)-]|(?:[,.;:#'][^\\s$]))*)*(?:\\?[\\w\\+@%&-=.;:/-\\[\\]]+)?(?:\\#[\\w\\-]*)?)([[^$.*+?=!:|\\/()[]{}]]|<|$|))","g");return html.replace(re,function(str){var href=str,a_target=target;if(!re_proto.test(str))href="http://"+href;else if(/mailto:/i.test(str))a_target=
"_self";return $("<a/>",{target:a_target,href:href}).html(str).outerHTML()})};$.fn.highlight=function(text,o){var safe_text=text.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&");return this.each(function(){var replace=o||'<span class="highlight">$1</span>';$(this).html($(this).html().replace(new RegExp("("+safe_text+'(?![\\w\\s?&.\\/;#~%"=-]*>))',"ig"),replace))})};$.fn.autolink_old=function(target){target=target||"_self";return this.each(function(){var re=/((http|https|ftp):\/\/[\w?=&.\/-;#~%-]+(?![\w\s?&.\/;#~%"=-]*>))/g;
$(this).html($(this).html().replace(re,'<a target="'+target+'" href="$1">$1</a> '))})};$.fn.mailto=function(){return this.each(function(){var re=/(([a-z0-9*._+]){1,}\@(([a-z0-9]+[-]?){1,}[a-z0-9]+\.){1,}([a-z]{2,4}|museum)(?![\w\s?&.\/;#~%"=-]*>))/g;$(this).html($(this).html().replace(re,'<a href="mailto:$1">$1</a>'))})};$.fn.autolink=function(target){return this.each(function(){var $this=$(this),html=$.autolink($this.html(),target);$this.html(html)})}})(jQuery);
jQuery.fn.DefaultValue=function(text,blur_class){return this.each(function(){if(this.type!="text"&&this.type!="password"&&this.type!="textarea")return;var fld_current=this;if(this.value==""){this.value=text;$(this).addClass(blur_class)}else;$(this).focus(function(){if(this.value==text||this.value==""){this.value="";$(this).removeClass(blur_class)}});$(this).blur(function(){if(this.value==text||this.value==""){this.value=text;$(this).addClass(blur_class)}});$(this).parents("form").each(function(){$(this).submit(function(){if(fld_current.value==
text)fld_current.value=""})})})};var tb_pathToImage="";$(document).ready(function(){tb_init("a.thickbox, area.thickbox, input.thickbox");imgLoader=new Image;imgLoader.src=tb_pathToImage});function tb_init(domChunk){$(domChunk).click(function(){var t=this.title||this.name||null;var a=this.href||this.alt;var g=this.rel||false;tb_show(t,a,g);this.blur();return false})}
function tb_show(caption,url,imageGroup){if(typeof document.body.style.maxHeight==="undefined"){$("body","html").css({height:"100%",width:"100%"});$("html").css("overflow","hidden");if(document.getElementById("TB_HideSelect")===null){$("body").append("<iframe id='TB_HideSelect'></iframe><div id='TB_overlay'></div><div id='TB_window'></div>");$("#TB_overlay").click(tb_remove)}}else if(document.getElementById("TB_overlay")===null){$("body").append("<div id='TB_overlay'></div><div id='TB_window'></div>");
$("#TB_overlay").click(tb_remove)}if(tb_detectMacXFF())$("#TB_overlay").addClass("TB_overlayMacFFBGHack");else $("#TB_overlay").addClass("TB_overlayBG");if(caption===null)caption="";$("body").append("<div id='TB_load'><img src='"+imgLoader.src+"' /></div>");$("#TB_load").show();var baseURL;if(url.indexOf("?")!==-1)baseURL=url.substr(0,url.indexOf("?"));else baseURL=url;var urlString=/\.jpg$|\.jpeg$|\.png$|\.gif$|\.bmp$/;var urlType=baseURL.toLowerCase().match(urlString);if(urlType==".jpg"||urlType==
".jpeg"||urlType==".png"||urlType==".gif"||urlType==".bmp"){TB_PrevCaption="";TB_PrevURL="";TB_PrevHTML="";TB_NextCaption="";TB_NextURL="";TB_NextHTML="";TB_imageCount="";TB_FoundURL=false;if(imageGroup){TB_TempArray=$("a[@rel="+imageGroup+"]").get();for(TB_Counter=0;TB_Counter<TB_TempArray.length&&TB_NextHTML==="";TB_Counter++){var urlTypeTemp=TB_TempArray[TB_Counter].href.toLowerCase().match(urlString);if(!(TB_TempArray[TB_Counter].href==url))if(TB_FoundURL){TB_NextCaption=TB_TempArray[TB_Counter].title;
TB_NextURL=TB_TempArray[TB_Counter].href;TB_NextHTML="<span id='TB_next'>&nbsp;&nbsp;<a href='#'>Next &gt;</a></span>"}else{TB_PrevCaption=TB_TempArray[TB_Counter].title;TB_PrevURL=TB_TempArray[TB_Counter].href;TB_PrevHTML="<span id='TB_prev'>&nbsp;&nbsp;<a href='#'>&lt; Prev</a></span>"}else{TB_FoundURL=true;TB_imageCount="Image "+(TB_Counter+1)+" of "+TB_TempArray.length}}}imgPreloader=new Image;imgPreloader.onload=function(){imgPreloader.onload=null;var pagesize=tb_getPageSize();var x=pagesize[0]-
150;var y=pagesize[1]-150;var imageWidth=imgPreloader.width;var imageHeight=imgPreloader.height;if(imageWidth>x){imageHeight=imageHeight*(x/imageWidth);imageWidth=x;if(imageHeight>y){imageWidth=imageWidth*(y/imageHeight);imageHeight=y}}else if(imageHeight>y){imageWidth=imageWidth*(y/imageHeight);imageHeight=y;if(imageWidth>x){imageHeight=imageHeight*(x/imageWidth);imageWidth=x}}TB_WIDTH=imageWidth+30;TB_HEIGHT=imageHeight+60;$("#TB_window").append("<a href='' id='TB_ImageOff' title='Close'><img id='TB_Image' src='"+
url+"' width='"+imageWidth+"' height='"+imageHeight+"' alt='"+caption+"'/></a>"+"<div id='TB_caption'>"+caption+"<div id='TB_secondLine'>"+TB_imageCount+TB_PrevHTML+TB_NextHTML+"</div></div><div id='TB_closeWindow'><a href='#' id='TB_closeWindowButton' title='Close'>close</a> or Esc Key</div>");$("#TB_closeWindowButton").click(tb_remove);if(!(TB_PrevHTML==="")){function goPrev(){if($(document).unbind("click",goPrev))$(document).unbind("click",goPrev);$("#TB_window").remove();$("body").append("<div id='TB_window'></div>");
tb_show(TB_PrevCaption,TB_PrevURL,imageGroup);return false}$("#TB_prev").click(goPrev)}if(!(TB_NextHTML==="")){function goNext(){$("#TB_window").remove();$("body").append("<div id='TB_window'></div>");tb_show(TB_NextCaption,TB_NextURL,imageGroup);return false}$("#TB_next").click(goNext)}document.onkeydown=function(e){if(e==null)keycode=event.keyCode;else keycode=e.which;if(keycode==27)tb_remove();else if(keycode==190){if(!(TB_NextHTML=="")){document.onkeydown="";goNext()}}else if(keycode==188)if(!(TB_PrevHTML==
"")){document.onkeydown="";goPrev()}};tb_position();$("#TB_load").remove();$("#TB_ImageOff").click(tb_remove);$("#TB_window").css({display:"block"})};imgPreloader.src=url}else{var queryString=url.replace(/^[^\?]+\??/,"");var params=tb_parseQuery(queryString);TB_WIDTH=params["width"]*1+30||630;TB_HEIGHT=params["height"]*1+40||440;ajaxContentW=TB_WIDTH-30;ajaxContentH=TB_HEIGHT-45;if(url.indexOf("TB_iframe")!=-1){urlNoQuery=url.split("TB_");$("#TB_iframeContent").remove();if(params["modal"]!="true")$("#TB_window").append("<div id='TB_title'><div id='TB_ajaxWindowTitle'>"+
caption+"</div><div id='TB_closeAjaxWindow'><a href='#' id='TB_closeWindowButton' title='Close'>close</a> or Esc Key</div></div><iframe frameborder='0' hspace='0' src='"+urlNoQuery[0]+"' id='TB_iframeContent' name='TB_iframeContent"+Math.round(Math.random()*1E3)+"' onload='tb_showIframe()' style='width:"+(ajaxContentW+29)+"px;height:"+(ajaxContentH+17)+"px;' > </iframe>");else{$("#TB_overlay").unbind();$("#TB_window").append("<iframe frameborder='0' hspace='0' src='"+urlNoQuery[0]+"' id='TB_iframeContent' name='TB_iframeContent"+
Math.round(Math.random()*1E3)+"' onload='tb_showIframe()' style='width:"+(ajaxContentW+29)+"px;height:"+(ajaxContentH+17)+"px;'> </iframe>")}}else if($("#TB_window").css("display")!="block")if(params["modal"]!="true")$("#TB_window").append("<div id='TB_title'><div id='TB_ajaxWindowTitle'>"+caption+"</div><div id='TB_closeAjaxWindow'><a href='#' id='TB_closeWindowButton'>close</a> or Esc Key</div></div><div id='TB_ajaxContent' style='width:"+ajaxContentW+"px;height:"+ajaxContentH+"px'></div>");else{$("#TB_overlay").unbind();
$("#TB_window").append("<div id='TB_ajaxContent' class='TB_modal' style='width:"+TB_WIDTH+"px;height:"+ajaxContentH+"px;'></div>")}else{$("#TB_ajaxContent").width(ajaxContentW);$("#TB_ajaxContent").height(ajaxContentH);$("#TB_ajaxContent").scrollTop(0);$("#TB_ajaxWindowTitle").html(caption)}$("#TB_closeWindowButton").click(tb_remove);if(url.indexOf("TB_inline")!=-1){$("#TB_ajaxContent").append($("#"+params["inlineId"]).children());$("#TB_window").unload(function(event){$("#"+params["inlineId"]).append($("#TB_ajaxContent").children())});
tb_position();$("#TB_load").remove();$("#TB_window").css({display:"block"})}else if(url.indexOf("TB_iframe")!=-1){tb_position();if($.browser.safari){$("#TB_load").remove();$("#TB_window").css({display:"block"})}}else $("#TB_ajaxContent").load(url+="&random="+(new Date).getTime(),function(){tb_position();$("#TB_load").remove();tb_init("#TB_ajaxContent a.thickbox");$("#TB_window").css({display:"block"})})}if(!params["modal"])document.onkeyup=function(e){if(e==null)keycode=event.keyCode;else keycode=
e.which;if(keycode==27)tb_remove()};$("body").trigger("tb_show")}function tb_showIframe(){$("#TB_load").remove();$("#TB_window").css({display:"block"})}
function tb_remove(){$("#TB_imageOff").unbind("click");$("#TB_closeWindowButton").unbind("click");$("#TB_overlay").bind("unload",function(e){e.stopPropagation()});var unloadEvent=jQuery.Event("unload");$("#TB_window").fadeOut("fast",function(){$("#TB_window,#TB_overlay,#TB_HideSelect").trigger(unloadEvent).unbind().remove()});$("#TB_load").remove();if(typeof document.body.style.maxHeight=="undefined"){$("body","html").css({height:"auto",width:"auto"});$("html").css("overflow","")}document.onkeydown=
"";document.onkeyup="";return false}function tb_position(){$("#TB_window").css({marginLeft:"-"+parseInt(TB_WIDTH/2,10)+"px",width:TB_WIDTH+"px"});if(!(jQuery.browser.msie&&jQuery.browser.version<7))$("#TB_window").css({marginTop:"-"+parseInt(TB_HEIGHT/2,10)+"px"})}
function tb_parseQuery(query){var Params={};if(!query)return Params;var Pairs=query.split(/[;&]/);for(var i=0;i<Pairs.length;i++){var KeyVal=Pairs[i].split("=");if(!KeyVal||KeyVal.length!=2)continue;var key=unescape(KeyVal[0]);var val=unescape(KeyVal[1]);val=val.replace(/\+/g," ");Params[key]=val}return Params}
function tb_getPageSize(){var de=document.documentElement;var w=window.innerWidth||self.innerWidth||de&&de.clientWidth||document.body.clientWidth;var h=window.innerHeight||self.innerHeight||de&&de.clientHeight||document.body.clientHeight;arrayPageSize=[w,h];return arrayPageSize}function tb_detectMacXFF(){var userAgent=navigator.userAgent.toLowerCase();if(userAgent.indexOf("mac")!=-1&&userAgent.indexOf("firefox")!=-1)return true}
(function($){var proto=$.ui.autocomplete.prototype,initSource=proto._initSource;function filter(array,term){var matcher=new RegExp($.ui.autocomplete.escapeRegex(term),"i");return $.grep(array,function(value){return matcher.test($("<div>").html(value.label||value.value||value).text())})}$.extend(proto,{_initSource:function(){if((this.options.html!="undefined"||this.options.html)&&$.isArray(this.options.source))this.source=function(request,response){response(filter(this.options.source,request.term))};
else initSource.call(this)},_renderItem:function(ul,item){return $("<li></li>").data("item.autocomplete",item).append($("<a></a>")[this.options.html!="undefined"||this.options.html?"html":"text"](item.label)).appendTo(ul)}})})(jQuery);
(function($){if(/1\.(0|1|2)\.(0|1|2)/.test($.fn.jquery)||/^1.1/.test($.fn.jquery)){alert("blockUI requires jQuery v1.2.3 or later!  You are using v"+$.fn.jquery);return}$.fn._fadeIn=$.fn.fadeIn;var noOp=function(){};var mode=document.documentMode||0;var setExpr=$.browser.msie&&($.browser.version<8&&!mode||mode<8);var ie6=$.browser.msie&&/MSIE 6.0/.test(navigator.userAgent)&&!mode;$.blockUI=function(opts){install(window,opts)};$.unblockUI=function(opts){remove(window,opts)};$.growlUI=function(title,
message,timeout,onClose){var $m=$('<div class="growlUI"></div>');if(title)$m.append("<h1>"+title+"</h1>");if(message)$m.append("<h2>"+message+"</h2>");if(timeout==undefined)timeout=3E3;$.blockUI({message:$m,fadeIn:700,fadeOut:1E3,centerY:false,timeout:timeout,showOverlay:false,onUnblock:onClose,css:$.blockUI.defaults.growlCSS})};$.fn.block=function(opts){return this.unblock({fadeOut:0}).each(function(){if($.css(this,"position")=="static")this.style.position="relative";if($.browser.msie)this.style.zoom=
1;install(this,opts)})};$.fn.unblock=function(opts){return this.each(function(){remove(this,opts)})};$.blockUI.version=2.35;$.blockUI.defaults={message:"<h1>Please wait...</h1>",title:null,draggable:true,theme:false,css:{padding:0,margin:0,width:"30%",top:"40%",left:"35%",textAlign:"center",color:"#000",border:"3px solid #aaa",backgroundColor:"#fff",cursor:"wait"},themedCSS:{width:"30%",top:"40%",left:"35%"},overlayCSS:{backgroundColor:"#000",opacity:0.6,cursor:"wait"},growlCSS:{width:"350px",top:"10px",
left:"",right:"10px",border:"none",padding:"5px",opacity:0.6,cursor:"default",color:"#fff",backgroundColor:"#000","-webkit-border-radius":"10px","-moz-border-radius":"10px","border-radius":"10px"},iframeSrc:/^https/i.test(window.location.href||"")?"javascript:false":"about:blank",forceIframe:false,baseZ:1E3,centerX:true,centerY:true,allowBodyStretch:true,bindEvents:true,constrainTabKey:true,fadeIn:200,fadeOut:400,timeout:0,showOverlay:true,focusInput:true,applyPlatformOpacityRules:true,onBlock:null,
onUnblock:null,quirksmodeOffsetHack:4,blockMsgClass:"blockMsg"};var pageBlock=null;var pageBlockEls=[];function install(el,opts){var full=el==window;var msg=opts&&opts.message!==undefined?opts.message:undefined;opts=$.extend({},$.blockUI.defaults,opts||{});opts.overlayCSS=$.extend({},$.blockUI.defaults.overlayCSS,opts.overlayCSS||{});var css=$.extend({},$.blockUI.defaults.css,opts.css||{});var themedCSS=$.extend({},$.blockUI.defaults.themedCSS,opts.themedCSS||{});msg=msg===undefined?opts.message:
msg;if(full&&pageBlock)remove(window,{fadeOut:0});if(msg&&typeof msg!="string"&&(msg.parentNode||msg.jquery)){var node=msg.jquery?msg[0]:msg;var data={};$(el).data("blockUI.history",data);data.el=node;data.parent=node.parentNode;data.display=node.style.display;data.position=node.style.position;if(data.parent)data.parent.removeChild(node)}var z=opts.baseZ;var lyr1=$.browser.msie||opts.forceIframe?$('<iframe class="blockUI" style="z-index:'+z++ +';display:none;border:none;margin:0;padding:0;position:absolute;width:100%;height:100%;top:0;left:0" src="'+
opts.iframeSrc+'"></iframe>'):$('<div class="blockUI" style="display:none"></div>');var lyr2=$('<div class="blockUI blockOverlay" style="z-index:'+z++ +';display:none;border:none;margin:0;padding:0;width:100%;height:100%;top:0;left:0"></div>');var lyr3,s;if(opts.theme&&full)s='<div class="blockUI '+opts.blockMsgClass+' blockPage ui-dialog ui-widget ui-corner-all" style="z-index:'+z+';display:none;position:fixed">'+'<div class="ui-widget-header ui-dialog-titlebar ui-corner-all blockTitle">'+(opts.title||
"&nbsp;")+"</div>"+'<div class="ui-widget-content ui-dialog-content"></div>'+"</div>";else if(opts.theme)s='<div class="blockUI '+opts.blockMsgClass+' blockElement ui-dialog ui-widget ui-corner-all" style="z-index:'+z+';display:none;position:absolute">'+'<div class="ui-widget-header ui-dialog-titlebar ui-corner-all blockTitle">'+(opts.title||"&nbsp;")+"</div>"+'<div class="ui-widget-content ui-dialog-content"></div>'+"</div>";else if(full)s='<div class="blockUI '+opts.blockMsgClass+' blockPage" style="z-index:'+
z+';display:none;position:fixed"></div>';else s='<div class="blockUI '+opts.blockMsgClass+' blockElement" style="z-index:'+z+';display:none;position:absolute"></div>';lyr3=$(s);if(msg)if(opts.theme){lyr3.css(themedCSS);lyr3.addClass("ui-widget-content")}else lyr3.css(css);if(!opts.applyPlatformOpacityRules||!($.browser.mozilla&&/Linux/.test(navigator.platform)))lyr2.css(opts.overlayCSS);lyr2.css("position",full?"fixed":"absolute");if($.browser.msie||opts.forceIframe)lyr1.css("opacity",0);var layers=
[lyr1,lyr2,lyr3],$par=full?$("body"):$(el);$.each(layers,function(){this.appendTo($par)});if(opts.theme&&opts.draggable&&$.fn.draggable)lyr3.draggable({handle:".ui-dialog-titlebar",cancel:"li"});var expr=setExpr&&(!$.boxModel||$("object,embed",full?null:el).length>0);if(ie6||expr){if(full&&opts.allowBodyStretch&&$.boxModel)$("html,body").css("height","100%");if((ie6||!$.boxModel)&&!full){var t=sz(el,"borderTopWidth"),l=sz(el,"borderLeftWidth");var fixT=t?"(0 - "+t+")":0;var fixL=l?"(0 - "+l+")":0}$.each([lyr1,
lyr2,lyr3],function(i,o){var s=o[0].style;s.position="absolute";if(i<2){full?s.setExpression("height","Math.max(document.body.scrollHeight, document.body.offsetHeight) - (jQuery.boxModel?0:"+opts.quirksmodeOffsetHack+') + "px"'):s.setExpression("height",'this.parentNode.offsetHeight + "px"');full?s.setExpression("width",'jQuery.boxModel && document.documentElement.clientWidth || document.body.clientWidth + "px"'):s.setExpression("width",'this.parentNode.offsetWidth + "px"');if(fixL)s.setExpression("left",
fixL);if(fixT)s.setExpression("top",fixT)}else if(opts.centerY){if(full)s.setExpression("top",'(document.documentElement.clientHeight || document.body.clientHeight) / 2 - (this.offsetHeight / 2) + (blah = document.documentElement.scrollTop ? document.documentElement.scrollTop : document.body.scrollTop) + "px"');s.marginTop=0}else if(!opts.centerY&&full){var top=opts.css&&opts.css.top?parseInt(opts.css.top):0;var expression="((document.documentElement.scrollTop ? document.documentElement.scrollTop : document.body.scrollTop) + "+
top+') + "px"';s.setExpression("top",expression)}})}if(msg){if(opts.theme)lyr3.find(".ui-widget-content").append(msg);else lyr3.append(msg);if(msg.jquery||msg.nodeType)$(msg).show()}if(($.browser.msie||opts.forceIframe)&&opts.showOverlay)lyr1.show();if(opts.fadeIn){var cb=opts.onBlock?opts.onBlock:noOp;var cb1=opts.showOverlay&&!msg?cb:noOp;var cb2=msg?cb:noOp;if(opts.showOverlay)lyr2._fadeIn(opts.fadeIn,cb1);if(msg)lyr3._fadeIn(opts.fadeIn,cb2)}else{if(opts.showOverlay)lyr2.show();if(msg)lyr3.show();
if(opts.onBlock)opts.onBlock()}bind(1,el,opts);if(full){pageBlock=lyr3[0];pageBlockEls=$(":input:enabled:visible",pageBlock);if(opts.focusInput)setTimeout(focus,20)}else center(lyr3[0],opts.centerX,opts.centerY);if(opts.timeout){var to=setTimeout(function(){full?$.unblockUI(opts):$(el).unblock(opts)},opts.timeout);$(el).data("blockUI.timeout",to)}}function remove(el,opts){var full=el==window;var $el=$(el);var data=$el.data("blockUI.history");var to=$el.data("blockUI.timeout");if(to){clearTimeout(to);
$el.removeData("blockUI.timeout")}opts=$.extend({},$.blockUI.defaults,opts||{});bind(0,el,opts);var els;if(full)els=$("body").children().filter(".blockUI").add("body > .blockUI");else els=$(".blockUI",el);if(full)pageBlock=pageBlockEls=null;if(opts.fadeOut){els.fadeOut(opts.fadeOut);setTimeout(function(){reset(els,data,opts,el)},opts.fadeOut)}else reset(els,data,opts,el)}function reset(els,data,opts,el){els.each(function(i,o){if(this.parentNode)this.parentNode.removeChild(this)});if(data&&data.el){data.el.style.display=
data.display;data.el.style.position=data.position;if(data.parent)data.parent.appendChild(data.el);$(el).removeData("blockUI.history")}if(typeof opts.onUnblock=="function")opts.onUnblock(el,opts)}function bind(b,el,opts){var full=el==window,$el=$(el);if(!b&&(full&&!pageBlock||!full&&!$el.data("blockUI.isBlocked")))return;if(!full)$el.data("blockUI.isBlocked",b);if(!opts.bindEvents||b&&!opts.showOverlay)return;var events="mousedown mouseup keydown keypress";b?$(document).bind(events,opts,handler):$(document).unbind(events,
handler)}function handler(e){if(e.keyCode&&e.keyCode==9)if(pageBlock&&e.data.constrainTabKey){var els=pageBlockEls;var fwd=!e.shiftKey&&e.target==els[els.length-1];var back=e.shiftKey&&e.target==els[0];if(fwd||back){setTimeout(function(){focus(back)},10);return false}}var opts=e.data;if($(e.target).parents("div."+opts.blockMsgClass).length>0)return true;return $(e.target).parents().children().filter("div.blockUI").length==0}function focus(back){if(!pageBlockEls)return;var e=pageBlockEls[back===true?
pageBlockEls.length-1:0];if(e)e.focus()}function center(el,x,y){var p=el.parentNode,s=el.style;var l=(p.offsetWidth-el.offsetWidth)/2-sz(p,"borderLeftWidth");var t=(p.offsetHeight-el.offsetHeight)/2-sz(p,"borderTopWidth");if(x)s.left=l>0?l+"px":"0";if(y)s.top=t>0?t+"px":"0"}function sz(el,p){return parseInt($.css(el,p))||0}})(jQuery);
jQuery.fn.autoSave=function(fcn,settings){$daemach=typeof $daemach!=="undefined"?$daemach:{};if(typeof $daemach.autoSave=="undefined"){$daemach.autoSave=new Object;$daemach.autoSave["timer"]=new Array;$daemach.autoSave["fn"]=new Array}var _as=$daemach.autoSave;settings=jQuery.extend({delay:5E3,doClassChange:true,beforeClass:"asBefore",afterClass:"asAfter",onChange:null,preSave:null,postSave:null,minLength:0},settings);if(settings.doClassChange){if(settings.beforeClass=="asBefore")createCSSClass(".asBefore",
"background-color:#FFdddd");if(settings.afterClass=="asAfter")createCSSClass(".asAfter","background-color:#ddFFdd")}return this.each(function(){var p=this.id;if(typeof _as["fn"][p]=="undefined"){_as["fn"][p]=new Array;_as["fn"][p][0]=null}var bindType;var initialState;switch(this.type){case "text":bindType="keyup";initialState=this.value;break;case "hidden":bindType="keyup";initialState=this.value;break;case "textarea":bindType="keyup";initialState=this.value;break;case "password":bindType="keyup";
initialState=this.value;break;case "select-one":bindType="change";initialState=this.value;break;case "select-multiple":bindType="change";initialState=this.value;break;case "radio":bindType="click";initialState=this.value;break;case "checkbox":bindType="click";initialState=this.checked;break;default:bindType="keyup";initialState=this.value;break}if(bindType=="keyup")_as["timer"][p]=null;if(this.type!=="radio"||this.type=="radio"&&this.checked)_as["fn"][p][0]=initialState;_as["fn"][p][1]=function(e){if(e&&
e.type=="blur"&&_as["fn"][p][2]);if(_as["fn"][p][2])if(_as["fn"][p][0]!==this.value||this.type=="checkbox"){if(settings.preSave){_as["fn"][p][2]=false;var proceed=settings.preSave.apply(this);if(!(typeof proceed=="boolean"&&proceed==false))_as["fn"][p][2]=true}if(_as["fn"][p][2]){fcn.apply(this);_as["fn"][p][0]=this.value}else if(this.type=="checkbox")this.checked=_as["fn"][p][0];else this.value=_as["fn"][p][0];if(settings.postSave)settings.postSave.apply(this);if(settings.doClassChange)jQuery(this).removeClass(settings.beforeClass).addClass(settings.afterClass)}};
_as["fn"][p][2]=true;jQuery(this).bind(bindType=="keyup"?"keyup paste cut focus input":bindType,function(){if(_as["fn"][p][0]!==this.value||this.type=="checkbox"){if(settings.onChange){_as["fn"][p][2]=false;var proceed=settings.onChange.apply(this);if(!(typeof proceed=="boolean"&&proceed==false))_as["fn"][p][2]=true}if(settings.doClassChange){var ele=jQuery(this);if(ele.is("."+settings.afterClass))ele.removeClass(settings.afterClass);if(!ele.is("."+settings.beforeClass))ele.addClass(settings.beforeClass)}var me=
this;if(bindType=="keyup"){if(this.value.length>=settings.minLength){if(_as["timer"][p])window.clearTimeout(_as["timer"][p]);_as["timer"][p]=window.setTimeout(function(){_as["fn"][p][1].apply(me)},settings.delay)}}else _as["fn"][p][1].apply(me)}});if(bindType=="keyup")jQuery(this).blur(function(){if(this.value.length>=settings.minLength)_as["fn"][p][1]});if(bindType=="keyup")jQuery(this).keydown(function(){if(_as["timer"][p])window.clearTimeout(_as["timer"][p])})})};
if(typeof createCSSClass=="undefined"){function createCSSClass(selector,style){if(!document.styleSheets)return;if(document.getElementsByTagName("head").length==0)return;var stylesheet;var mediaType;if(document.styleSheets.length>0)for(var i=0;i<document.styleSheets.length;i++){if(document.styleSheets[i].disabled)continue;var media=document.styleSheets[i].media;mediaType=typeof media;if(mediaType=="string"){if(media==""||media.indexOf("screen")!=-1)styleSheet=document.styleSheets[i]}else if(mediaType==
"object")if(media.mediaText==""||media.mediaText.indexOf("screen")!=-1)styleSheet=document.styleSheets[i];if(typeof styleSheet!="undefined")break}if(typeof styleSheet=="undefined"){var styleSheetElement=document.createElement("style");styleSheetElement.type="text/css";document.getElementsByTagName("head")[0].appendChild(styleSheetElement);for(var i=0;i<document.styleSheets.length;i++){if(document.styleSheets[i].disabled)continue;styleSheet=document.styleSheets[i]}var media=styleSheet.media;mediaType=
typeof media}if(mediaType=="string"){for(var i=0;i<styleSheet.rules.length;i++)if(styleSheet.rules[i].selectorText.toLowerCase()==selector.toLowerCase()){styleSheet.rules[i].style.cssText=style;return}styleSheet.addRule(selector,style)}else if(mediaType=="object"){for(i=0;i<styleSheet.cssRules.length;i++)if(styleSheet.cssRules[i].selectorText.toLowerCase()==selector.toLowerCase()){styleSheet.cssRules[i].style.cssText=style;return}styleSheet.insertRule(selector+"{"+style+"}",styleSheet.cssRules.length)}}
}String.prototype.trim=function(){return this.replace(/^\s*/,"").replace(/\s*$/,"")};
$(document).ajaxComplete(function(event,request,ajaxOptions,thrownError){try{if(request.responseText.trim()!=""&&request.responseText.match(/^(.*\"errors\":\[\[.*)$/)){var response=eval(request.responseText);$(".error").removeClass("error");$(".error_message").remove();if(response.object)if(response.errors)$.each(response.errors,function(idx,error){var element=$("."+response.object+"_"+error[0].replace(/\./,"_"));if(element){element.addClass("error");element.parent().append("<div class='error_message'>"+
error[1]+"</div>")}})}}catch(e){}});$.fn.extend({disableSelection:function(){this.each(function(){if(typeof this.onselectstart!="undefined")this.onselectstart=function(){return false};else if(typeof this.style.MozUserSelect!="undefined")this.style.MozUserSelect="none";else this.onmousedown=function(){return false}})}});var allUIMenus=[];
$.fn.fgmenu=function(options){var caller=this;var options=options;var m=new Menu(caller,options);allUIMenus.push(m);$(this).mousedown(function(){if(!m.menuOpen)m.showLoading()}).click(function(){if(m.menuOpen==false)m.showMenu();else m.kill();return false})};$.fn.fgmenu.closeAll=function(){$.each(allUIMenus,function(i){if(allUIMenus[i].menuOpen)allUIMenus[i].kill()})};
function Menu(caller,options){var menu=this;var caller=$(caller);var $options_content=$(options.content);$options_content.find("script").remove();var clean_options_content=$options_content.wrap("<div>").parent().html();var container=$('<div class="fg-menu-container ui-widget ui-widget-content ui-corner-all">'+clean_options_content+"</div>");if($.browser.msie&&$.browser.version<9)var bodyOverflow=$("body").css("overflow");this.menuOpen=false;this.menuExists=false;var options=jQuery.extend({content:null,
width:180,maxHeight:180,positionOpts:{posX:"left",posY:"bottom",offsetX:0,offsetY:0,directionH:"right",directionV:"down",detectH:true,detectV:true,linkToFront:false},showSpeed:200,callerOnState:"ui-state-active",loadingState:"ui-state-loading",linkHover:"ui-state-hover",linkHoverSecondary:"li-hover",crossSpeed:200,crumbDefaultText:"Choose an option:",backLink:true,backLinkText:"Back",flyOut:false,flyOutOnState:"ui-state-default",nextMenuLink:"ui-icon-triangle-1-e",topLinkText:"All",nextCrumbLink:"ui-icon-carat-1-e",
callback:{select:function(ITEM){}}},options);var fgMenuKeyDownListener=function(event){var e;if(event.which!="")e=event.which;else if(event.charCode!="")e=event.charCode;else if(event.keyCode!="")e=event.keyCode;var menuType=$(event.target).parents("div").is(".fg-menu-flyout")?"flyout":"ipod";switch(e){case 37:if(menuType=="flyout"){$(event.target).trigger("mouseout");if($("."+options.flyOutOnState).size()>0)$("."+options.flyOutOnState).trigger("mouseover")}if(menuType=="ipod"){$(event.target).trigger("mouseout");
if($(".fg-menu-footer").find("a").size()>0)$(".fg-menu-footer").find("a").trigger("click");if($(".fg-menu-header").find("a").size()>0)$(".fg-menu-current-crumb").prev().find("a").trigger("click");if($(".fg-menu-current").prev().is(".fg-menu-indicator"))$(".fg-menu-current").prev().trigger("mouseover")}return false;break;case 38:if($(event.target).is("."+options.linkHover)){var prevLink=$(event.target).parent().prev().find("a:eq(0)");if(prevLink.size()>0){$(event.target).trigger("mouseout");prevLink.trigger("mouseover")}}else container.find("a:eq(0)").trigger("mouseover");
return false;break;case 39:if($(event.target).is(".fg-menu-indicator"))if(menuType=="flyout")$(event.target).next().find("a:eq(0)").trigger("mouseover");else if(menuType=="ipod"){$(event.target).trigger("click");setTimeout(function(){$(event.target).next().find("a:eq(0)").trigger("mouseover")},options.crossSpeed)}return false;break;case 40:if($(event.target).hasClass(options.linkHover)){var nextLink=$(event.target).parent().next().find("a:eq(0)");if(nextLink.size()>0){$(event.target).trigger("mouseout");
nextLink.trigger("mouseover")}}else container.find("a:eq(0)").trigger("mouseover");return false;break;case 27:killAllMenus();break;case 13:if($(event.target).is(".fg-menu-indicator")&&menuType=="ipod"){$(event.target).trigger("click");setTimeout(function(){$(event.target).next().find("a:eq(0)").trigger("mouseover")},options.crossSpeed)}break}};var killAllMenus=function(){$.each(allUIMenus,function(i){if(allUIMenus[i].menuOpen)allUIMenus[i].kill()})};this.kill=function(){caller.removeClass(options.loadingState).removeClass("fg-menu-open").removeClass(options.callerOnState);
container.find("li").removeClass(options.linkHoverSecondary).find("a").removeClass(options.linkHover);if(options.flyOutOnState)container.find("li a").removeClass(options.flyOutOnState);if(options.callerOnState)caller.removeClass(options.callerOnState);if(container.is(".fg-menu-ipod"))menu.resetDrilldownMenu();if(container.is(".fg-menu-flyout"))menu.resetFlyoutMenu();container.parent().hide();menu.menuOpen=false;$(document).unbind("click",killAllMenus);$(document).unbind("keydown",fgMenuKeyDownListener);
if($.browser.msie&&$.browser.version<9)$("body").css("overflow",bodyOverflow)};this.showLoading=function(){caller.addClass(options.loadingState)};this.showMenu=function(){killAllMenus();if(!menu.menuExists)menu.create();caller.addClass("fg-menu-open").addClass(options.callerOnState);container.parent().show().click(function(){menu.kill();return false});container.hide().slideDown(options.showSpeed).find(".fg-menu:eq(0)");menu.menuOpen=true;caller.removeClass(options.loadingState);$(document).click(killAllMenus);
if($.browser.msie&&$.browser.version<9)$("body").css("overflow","hidden");$(document).keydown(fgMenuKeyDownListener)};this.create=function(){container.css({width:options.width}).appendTo("body").find("ul:first").not(".fg-menu-breadcrumb").addClass("fg-menu");container.find("ul, li a").addClass("ui-corner-all");container.find("ul").attr("role","menu").eq(0).attr("aria-activedescendant","active-menuitem").attr("aria-labelledby",caller.attr("id"));container.find("li").attr("role","menuitem");container.find("li:has(ul)").attr("aria-haspopup",
"true").find("ul").attr("aria-expanded","false");container.find("a").attr("tabindex","-1");if(container.find("ul").size()>1)if(options.flyOut)menu.flyout(container,options);else menu.drilldown(container,options);else menu.drilldown(container,options);if(options.linkHover){var allLinks=container.find(".fg-menu li a");allLinks.hover(function(){var menuitem=$(this);$("."+options.linkHover).removeClass(options.linkHover).blur().parent().removeAttr("id");$(this).addClass(options.linkHover).focus().parent().attr("id",
"active-menuitem")},function(){$(this).removeClass(options.linkHover).blur().parent().removeAttr("id")})}if(options.linkHoverSecondary)container.find(".fg-menu li").hover(function(){$(this).siblings("li").removeClass(options.linkHoverSecondary);if(options.flyOutOnState)$(this).siblings("li").find("a").removeClass(options.flyOutOnState);$(this).addClass(options.linkHoverSecondary)},function(){$(this).removeClass(options.linkHoverSecondary)});menu.setPosition(container,caller,options);menu.menuExists=
true};this.chooseItem=function(item){menu.kill();options.callback.select.call(menu,item)}}
Menu.prototype.flyout=function(container,options){var menu=this;this.resetFlyoutMenu=function(){var allLists=container.find("ul ul");allLists.removeClass("ui-widget-content").hide()};container.addClass("fg-menu-flyout").find("li:has(ul)").each(function(){var linkWidth=container.width();var showTimer,hideTimer;var allSubLists=$(this).find("ul");allSubLists.css({left:linkWidth,width:linkWidth}).hide();$(this).find("a:eq(0)").addClass("fg-menu-indicator").html("<span>"+$(this).find("a:eq(0)").text()+
'</span><span class="ui-icon '+options.nextMenuLink+'"></span>').hover(function(){clearTimeout(hideTimer);var subList=$(this).next();if(!fitVertical(subList,$(this).offset().top))subList.css({top:"auto",bottom:0});if(!fitHorizontal(subList,$(this).offset().left+100))subList.css({left:"auto",right:linkWidth,"z-index":999});showTimer=setTimeout(function(){subList.addClass("ui-widget-content").show(options.showSpeed).attr("aria-expanded","true")},300)},function(){clearTimeout(showTimer);var subList=
$(this).next();hideTimer=setTimeout(function(){subList.removeClass("ui-widget-content").hide(options.showSpeed).attr("aria-expanded","false")},400)});$(this).find("ul a").hover(function(){clearTimeout(hideTimer);if($(this).parents("ul").prev().is("a.fg-menu-indicator"))$(this).parents("ul").prev().addClass(options.flyOutOnState)},function(){hideTimer=setTimeout(function(){allSubLists.hide(options.showSpeed);container.find(options.flyOutOnState).removeClass(options.flyOutOnState)},500)})});container.find("a").click(function(){menu.chooseItem(this);
return false})};
Menu.prototype.drilldown=function(container,options){var menu=this;var topList=container.find(".fg-menu");var breadcrumb=$('<ul class="fg-menu-breadcrumb ui-widget-header ui-corner-all ui-helper-clearfix"></ul>');var crumbDefaultHeader=$('<li class="fg-menu-breadcrumb-text">'+options.crumbDefaultText+"</li>");var firstCrumbText=options.backLink?options.backLinkText:options.topLinkText;var firstCrumbClass=options.backLink?"fg-menu-prev-list":"fg-menu-all-lists";var firstCrumbLinkClass=options.backLink?
"ui-state-default ui-corner-all":"";var firstCrumbIcon=options.backLink?'<span class="ui-icon ui-icon-triangle-1-w"></span>':"";var firstCrumb=$('<li class="'+firstCrumbClass+'"><a href="#" class="'+firstCrumbLinkClass+'">'+firstCrumbIcon+firstCrumbText+"</a></li>");var scrollPos=0;var parentUl=null;container.addClass("fg-menu-ipod");if(options.backLink)breadcrumb.addClass("fg-menu-footer").appendTo(container).hide();else breadcrumb.addClass("fg-menu-header").prependTo(container);breadcrumb.append(crumbDefaultHeader);
var checkMenuHeight=function(el){if(el.height()>options.maxHeight)el.addClass("fg-menu-scroll");el.css({height:options.maxHeight})};var resetChildMenu=function(el){el.removeClass("fg-menu-scroll").removeClass("fg-menu-current").height("auto")};var scrollStopper=function(event,delta){var posy=Math.abs($(".fg-menu-current").scrollTop());if(delta<0&&posy>=options.maxHeight){event.preventDefault();event.stopPropagation();return false}};this.resetDrilldownMenu=function(){$(".fg-menu-current").removeClass("fg-menu-current");
topList.animate({left:0},options.crossSpeed,function(){$(this).find("ul").each(function(){$(this).hide();resetChildMenu($(this))});topList.addClass("fg-menu-current");topList.scrollTop(scrollPos);if(parentUl)parentUl.unmousewheel()});$(".fg-menu-all-lists").find("span").remove();breadcrumb.empty().append(crumbDefaultHeader);$(".fg-menu-footer").empty().hide();checkMenuHeight(topList)};topList.addClass("fg-menu-content fg-menu-current ui-widget-content ui-helper-clearfix").css({width:container.width()}).find("ul").css({width:container.width(),
left:container.width()}).addClass("ui-widget-content").hide();checkMenuHeight(topList);topList.find("a").each(function(){if($(this).next().is("ul"))$(this).addClass("fg-menu-indicator").each(function(){$(this).html('<span style="float:left;">'+$(this).text()+'</span><span class="ui-icon '+options.nextMenuLink+'" style="float:right;"></span>')}).click(function(){var nextList=$(this).next();parentUl=$(this).parents("ul:eq(0)");var parentLeft=parentUl.is(".fg-menu-content")?0:parseFloat(topList.css("left"));
var nextLeftVal=Math.round(parentLeft-parseFloat(container.width()));var footer=$(".fg-menu-footer");scrollPos=$(".fg-menu-current").scrollTop();$(".fg-menu-current").scrollTop(0);resetChildMenu(parentUl);checkMenuHeight(nextList);topList.animate({left:nextLeftVal},options.crossSpeed,function(){$("."+options.linkHover).removeClass(options.linkHover);parentUl.mousewheel(scrollStopper)});nextList.show().addClass("fg-menu-current").attr("aria-expanded","true");var setPrevMenu=function(backlink){var b=
backlink;var c=$(".fg-menu-current");var prevList=c.parents("ul:eq(0)");c.hide().attr("aria-expanded","false");resetChildMenu(c);checkMenuHeight(prevList);prevList.addClass("fg-menu-current").attr("aria-expanded","true");if(prevList.hasClass("fg-menu-content")){b.remove();footer.hide()}};$(".fg-menu-ipod").css("height",options.height+34+"px");if(options.backLink){if(footer.find("a").size()==0){footer.show();$('<a href="#"><span class="ui-icon ui-icon-triangle-1-w"></span> <span>Back</span></a>').appendTo(footer).click(function(){var b=
$(this);var prevLeftVal=parseFloat(topList.css("left"))+container.width();topList.animate({left:prevLeftVal},options.crossSpeed,function(){setPrevMenu(b)});return false})}}else{if(breadcrumb.find("li").size()==1){breadcrumb.empty().append(firstCrumb);$(".fg-menu-breadcrumb:has(a)").css({"cursor":"pointer"}).click(function(){$(".fg-menu-breadcrumb").css({"cursor":"auto"});menu.resetDrilldownMenu();return false})}$(".fg-menu-current-crumb").removeClass("fg-menu-current-crumb")}return false});else $(this).click(function(){menu.chooseItem(this);
return false})})};
Menu.prototype.setPosition=function(widget,caller,options){var el=widget;var referrer=caller;var dims={refX:referrer.offset().left,refY:referrer.offset().top,refW:referrer.getTotalWidth(),refH:referrer.getTotalHeight()};var options=options;var xVal;var yVal;var helper=$('<div class="positionHelper"></div>');helper.css({position:"absolute",left:dims.refX,top:dims.refY,width:dims.refW,height:dims.refH});el.wrap(helper);switch(options.positionOpts.posX){case "left":xVal=0;break;case "center":xVal=dims.refW/
2;break;case "right":xVal=dims.refW;break}switch(options.positionOpts.posY){case "top":yVal=0;break;case "center":yVal=dims.refH/2;break;case "bottom":yVal=dims.refH;break}xVal+=options.positionOpts.offsetX;yVal+=options.positionOpts.offsetY;if(xVal===NaN)xVal=0;if(yVal===NaN)yVal=0;if(options.positionOpts.directionV=="up"){el.css({top:"auto",bottom:yVal});if(options.positionOpts.detectV&&!fitVertical(el))el.css({bottom:"auto",top:yVal})}else{el.css({bottom:"auto",top:yVal});if(options.positionOpts.detectV&&
!fitVertical(el))el.css({top:"auto",bottom:yVal})}if(options.positionOpts.directionH=="left"){el.css({left:"auto",right:xVal});if(options.positionOpts.detectH&&!fitHorizontal(el))el.css({right:"auto",left:xVal})}else{el.css({right:"auto",left:xVal});if(options.positionOpts.detectH&&!fitHorizontal(el))el.css({left:"auto",right:xVal})}if(options.positionOpts.linkToFront)referrer.clone().addClass("linkClone").css({position:"absolute",top:0,right:"auto",bottom:"auto",left:0,width:referrer.width(),height:referrer.height()}).insertAfter(el)};
function sortBigToSmall(a,b){return b-a}jQuery.fn.getTotalWidth=function(){return $(this).width()+parseInt($(this).css("paddingRight"))+parseInt($(this).css("paddingLeft"))+parseInt($(this).css("borderRightWidth"))+parseInt($(this).css("borderLeftWidth"))};jQuery.fn.getTotalHeight=function(){return $(this).height()+parseInt($(this).css("paddingTop"))+parseInt($(this).css("paddingBottom"))+parseInt($(this).css("borderTopWidth"))+parseInt($(this).css("borderBottomWidth"))};
function getScrollTop(){return self.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop}function getScrollLeft(){return self.pageXOffset||document.documentElement.scrollLeft||document.body.scrollLeft}function getWindowHeight(){var de=document.documentElement;return self.innerHeight||de&&de.clientHeight||document.body.clientHeight}function getWindowWidth(){var de=document.documentElement;return self.innerWidth||de&&de.clientWidth||document.body.clientWidth}
function fitHorizontal(el,leftOffset){var leftVal=parseInt(leftOffset)||$(el).offset().left;return leftVal+$(el).width()<=getWindowWidth()+getScrollLeft()&&leftVal-getScrollLeft()>=0}function fitVertical(el,topOffset){var topVal=parseInt(topOffset)||$(el).offset().top;return topVal+$(el).height()<=getWindowHeight()+getScrollTop()&&topVal-getScrollTop()>=0}
Number.prototype.pxToEm=String.prototype.pxToEm=function(settings){settings=jQuery.extend({scope:"body",reverse:false},settings);var pxVal=this==""?0:parseFloat(this);var scopeVal;var getWindowWidth=function(){var de=document.documentElement;return self.innerWidth||de&&de.clientWidth||document.body.clientWidth};if(settings.scope=="body"&&$.browser.msie&&($.browser.version<9)(parseFloat($("body").css("font-size"))/getWindowWidth()).toFixed(1)>0){var calcFontSize=function(){return(parseFloat($("body").css("font-size"))/
getWindowWidth()).toFixed(3)*16};scopeVal=calcFontSize()}else scopeVal=parseFloat(jQuery(settings.scope).css("font-size"));var result=settings.reverse==true?(pxVal*scopeVal).toFixed(2)+"px":(pxVal/scopeVal).toFixed(2)+"em";return result};
(function($){$.widget("ui.labelbox",{options:{readonly:false,disabled:false,allowNewLabelCreation:true,inputWidth:null,useLocalData:false,label_list_class:"ticket_labels",button_text:"Add Label",current_label_form_name:"UNDEFINED_ERROR",new_label_form_name:"UNDEFINED_ERROR",placeholder:false,onLabelExists:function(){alert("Label is already assigned.")},onLabelSelected:function(){},onLabelRemoved:function(){}},select:null,label_ul_display:null,input_current_labels:null,input_new_labels:null,useLocalData:false,
parent_div:null,onLabelExists:null,onLabelSelected:null,onLabelRemoved:null,input:null,disabled:false,allowNewLabelCreation:true,_create:function(){this.disabled=this.options.disabled;this.allowNewLabelCreation=this.options.allowNewLabelCreation;var self=this;if(this.options.onLabelExists)this.onLabelExists=this.options.onLabelExists;if(this.options.onLabelSelected)this.onLabelSelected=this.options.onLabelSelected;if(this.options.onLabelRemoved)this.onLabelRemoved=this.options.onLabelRemoved;this.useLocalData=
this.options.useLocalData;this.select=this.element.hide();this.parent_div=$("<div>").addClass("ui-widget").addClass("ui-labelbox").css("display","inline-block").css("zoom","1").css("*display","inline").css("hasLayout","1").insertAfter(this.select);$.fn.clickaway({clickaway:function(){$(".label_popup_menu").autocomplete("close")}});this.chooseLabel=function(id,value){if(self.labelExists(parseInt(id),value)){if(self.onLabelExists)self.onLabelExists();$(this).focus();setTimeout(function(){self.input.val("")},
250);return false}self.select.labelbox("add_label",id,value,false);$(this).focus();setTimeout(function(){self.input.val("")},250);$(this).trigger("assistly.labelbox.labelSelected");if(self.onLabelSelected)self.onLabelSelected()};this.removeInvalidChars=function(term){if(term==="undefined")return;return $.trim(term.replace(/[\x21-\x2C\x3A-\x40\x5B-\x5E\x60\x7B-\x7F]/g,""))};if(!this.options.readonly){this.select_wrapper=$('<div class="ui-labelbox-select"></div>');this.input=$("<input id='a-content-label-input' class='label_popup_menu'>").alphanumeric({allow:".-_ /",
allow_wide:true}).appendTo(this.select_wrapper).autocomplete({selectFirst:true,html:true,source:function(request,response){try{var matcher=new RegExp(request.term,"i");results=[];perfect_match=false;lower_case_request_term=$.trim(request.term).toLowerCase();if(self.useLocalData)jQuery.map(Assistly.labels.cases.array,function(label){if(!label.active||label.deleted)return;if($.trim(label.name).toLowerCase()==lower_case_request_term||lower_case_request_term=="")perfect_match=true;if(!request.term||matcher.test(label.name))results.push({id:label.id,
label:label.name.replace(new RegExp("(?![^&;]+;)(?!<[^<>]*)("+$.ui.autocomplete.escapeRegex(request.term)+")(?![^<>]*>)(?![^&;]+;)","gi"),"<strong>$1</strong>"),value:label.name})});else self.select.children("option").map(function(){var text=$(this).text();if($.trim(text).toLowerCase()==lower_case_request_term||lower_case_request_term=="")perfect_match=true;if(!request.term||matcher.test(text))results.push({id:$(this).val(),label:text.replace(new RegExp("(?![^&;]+;)(?!<[^<>]*)("+$.ui.autocomplete.escapeRegex(request.term)+
")(?![^<>]*>)(?![^&;]+;)","gi"),"<strong>$1</strong>"),value:text})});if(!perfect_match&&self.allowNewLabelCreation){var cleanSearchTerm=self.removeInvalidChars(request.term);results.push({id:-1,label:"'<strong>"+cleanSearchTerm+"</strong>' (Create New)",value:cleanSearchTerm})}response(results);if(!perfect_match&&self.allowNewLabelCreation)self.input.data("autocomplete").menu.element.children("li").last().addClass("menu-item-create-new")}catch(e){}},delay:0,select:function(e,ui){if(!ui.item){$(this).val("");
return false}self.chooseLabel.call(this,ui.item.id,ui.item.value)},open:function(event,ui){self.input.data("autocomplete").menu.element.css("width",self.input.width()+self.button.width()+"px")},minLength:0}).addClass("ui-widget ui-widget-content ui-corner-left").prop("disabled",this.disabled?"disabled":"").prop("placeholder",this.options.placeholder||"");self.input.data("autocomplete").menu.element.bind("clickoutside",function(event){self.input.autocomplete("close")});this.button=$("<button>"+this.options.button_text+
"</button>").appendTo(this.select_wrapper).button({icons:{primary:"ui-icon-triangle-1-s"},text:false}).removeClass("ui-corner-all").addClass("ui-corner-right ui-button-icon").position({my:"left center",at:"right center",of:self.input,offset:"0 0"}).css("top","").css("left","").css("float",this.options.inputWidth?"":"right").css("height","22px").css("width","22px").css("position","relative").prop("disabled",this.disabled?"disabled":"").click(function(){if(self.input.autocomplete("widget").is(":visible")){self.input.autocomplete("close");
return false}self.input.focus();self.input.autocomplete("search","");return false});this.parent_div.append(this.select_wrapper)}var isFilter=self.parent_div.closest("#a-section-header");if(isFilter.prop("id")=="a-section-header"){this.label_ul_display=$("<ul class='"+this.options.label_list_class+" a-list-filter hide'></ul>");isFilter.after(this.label_ul_display)}else this.label_ul_display=$("<ul class='"+this.options.label_list_class+"'></ul>").appendTo(self.parent_div);this.input_current_labels=
$("<input type='hidden' name='"+this.options.current_label_form_name+"' value='' />").appendTo(self.parent_div);this.input_new_labels=$("<input type='hidden' name='"+this.options.new_label_form_name+"' value='' />\t").appendTo(self.parent_div);if(this.disabled||this.options.readonly){this.input_current_labels.prop("disabled",true);this.input_new_labels.prop("disabled",true)}},add_label:function(id,value,changed_from_macro){var self=this;var label_text=$.trim(value);var labels=[];var label_color="default";
if(!self.select.labelbox("labelExists",id,label_text)){if(id>0){var text_value=this.input_current_labels.val();labels=this._add_label_prep(text_value,id,labels);this.input_current_labels.val(labels.join(","));if(self.useLocalData)if(typeof Assistly.labels.cases.get(id)!="undefined")label_color=Assistly.labels.cases.get(id).label_color}else{var text_value=this.input_new_labels.val();labels=this._add_label_prep(text_value,label_text,labels);this.input_new_labels.val(labels.join(","))}var close_button=
$("<span style='"+(this.options.readonly||this.disabled?"display:none":"")+"' class='token-input-delete-token-facebook'>x</span>").click(function(){self.select.labelbox("remove_label",id,$.trim(value))});$("<li class='token-input-token-facebook a-label-color-"+label_color+(changed_from_macro?" macro_changed ":"")+(id<0?" new_label":"")+"'><p>"+label_text+"</p></li>").data("label_name",label_text).append(close_button).appendTo(this.label_ul_display);this.label_ul_display.removeClass("hide");this.label_ul_display.find("li").sort(function(a,
b){return $(a).data("label_name")>$(b).data("label_name")}).prependTo(this.label_ul_display)}},_add_label_prep:function(text_value,arr_data,labels){if(text_value!="")labels=text_value.split(",");labels.push(arr_data);return labels},remove_label:function(id,value){if(id>0){labels=[];labels=this.input_current_labels.val().split(",");for(var i=0;i<labels.length;i++)if(parseInt($.trim(labels[i]))==id){labels.splice(i,1);i--}this.input_current_labels.val(labels.join(","));this.label_ul_display.find("li").each(function(i){if($.trim($(this).find("p").text())==
$.trim(value))$(this).remove()})}else{labels=[];labels=this.input_new_labels.val().split(",");for(var i=0;i<labels.length;i++)if($.trim(labels[i])==$.trim(value)){labels.splice(i,1);i--}this.input_new_labels.val(labels.join(","));this.label_ul_display.find("li").each(function(i){if($.trim($(this).find("p").text())==$.trim(value))$(this).remove()})}$(this.input).trigger("assistly.labelbox.labelUnselected");if(this.onLabelRemoved)this.onLabelRemoved();if(this.label_ul_display.find("li").length===0)this.label_ul_display.addClass("hide")},
reset:function(){this.input_current_labels.val("");this.input_new_labels.val("");this.label_ul_display.html("")},toggleState:function(){this.label_ul_display.find(".token-input-delete-token-facebook").toggle();if(this.disabled){this.input.removeProp("disabled");this.button.removeProp("disabled");this.input_current_labels.removeProp("disabled");this.input_new_labels.removeProp("disabled");this.disabled=false}else{this.input.prop("disabled","disabled");this.button.prop("disabled","disabled");this.input_current_labels.prop("disabled",
true);this.input_new_labels.prop("disabled",true);this.disabled=true}},current_labels_value:function(){return this.input_current_labels.val()},new_labels_value:function(){return this.input_new_labels.val()},labelExists:function(label_id,label_text){var labels=[];if(label_id>0){labels=this.input_current_labels.val().split(",");for(var i=0;i<labels.length;i++)if(parseInt(labels[i])==label_id)return true;return false}else{labels=this.input_new_labels.val().split(",");for(var i=0;i<labels.length;i++)if($.trim(labels[i])==
$.trim(label_text))return true;return false}}})})(jQuery);
(function($){$.widget("ui.macrobox",{options:{data_elem_sel:"",label:"select",width:250,offsetX:0,offsetY:0,menuHeaderText:"Choose",menuBackText:"Back",onAutoCompleteOpen:function(){},onSelect:function(){}},_create:function(){var self=this;var wrapper=$('<div class="ui-macrobox" />');var select_wrapper=$('<div class="ui-macrobox-select" />');var select=this.element.hide();var input=$("<input class='label_popup_menu'>");var button=$("<button>"+self.options.label+"</button>");$(select_wrapper).append(input,
button).appendTo(wrapper);$(wrapper).insertAfter(select);input.alphanumeric({allow:".-_`~!@#%&={}|;:'\",<>/ ",allow_wide:true}).blur(function(){input.val("")}).autocomplete({selectFirst:true,html:true,position:{my:"left bottom",at:"left top",collision:"none"},source:function(request,response){try{if(request.term.length==0){$(".ui-autocomplete").hide();response([]);return}var matcher=new RegExp(request.term,"i");response($.map($(self.options.data_elem_sel+" a"),function(value){var item_id=$(value).attr("itemid");
if(!item_id)return;if(!request.term)return;var labelFindConfirm=false;var hltLabel=null;var aLabel=$(value).attr("label");if(aLabel&&matcher.test(aLabel)){hltLabel=aLabel.replace(new RegExp("(?![^&;]+;)(?!<[^<>]*)("+request.term.replace(/([\^\$\(\)\[\]\{\}\*\.\+\?\|\\])/gi,"\\$1")+")(?![^<>]*>)(?![^&;]+;)","gi"),"<strong>$1</strong>");labelFindConfirm=true}var textFindConfirm=false;var hltText=$(value).text().html_encode();if(matcher.test(hltText)){hltText=hltText.replace(new RegExp("(?![^&;]+;)(?!<[^<>]*)("+
request.term.replace(/([\^\$\(\)\[\]\{\}\*\.\+\?\|\\])/gi,"\\$1")+")(?![^<>]*>)(?![^&;]+;)","gi"),"<strong>$1</strong>");textFindConfirm=true}if(labelFindConfirm===true||textFindConfirm===true)return{id:item_id,label:renderLabel(),value:$(value).text()};function renderLabel(){var tempLabel=hltLabel?hltLabel+" &gt; "+hltText:hltText;if(typeof aLabel!=="undefined"&&!labelFindConfirm)tempLabel=$(value).attr("label")+" &gt; "+tempLabel;return tempLabel}}))}catch(e){}},delay:0,select:function(e,ui){if(!ui.item){$(this).val("");
return false}$(this).focus();self.options.onSelect.call(self,ui.item.id)},open:function(event,ui){input.data("autocomplete").menu.element.css("width",input.width()+4+"px")},minLength:0}).addClass("ui-widget ui-widget-content ui-corner-left").css("width",self.options.width+"px");if($.browser.msie&&$.browser.version=="8.0")input.css("position","relative").css("top","-1px");input.data("autocomplete").menu.element.bind("clickoutside",function(event){input.autocomplete("close")});button.button({icons:{primary:"ui-icon-triangle-1-s"},
text:false}).removeClass("ui-corner-all").addClass("ui-corner-right ui-button-icon").position({my:"left center",at:"right center",of:input,offset:"-1 0"}).css("top","").css("float",this.options.inputWidth?"":"right").css("position","relative").css("left","0px").fgmenu({content:$(self.options.data_elem_sel).html(),width:self.options.width-4,backLink:false,height:320,maxHeight:320,crumbDefaultText:self.options.menuHeaderText,topLinkText:self.options.menuBackText,crossSpeed:100,showSpeed:10,positionOpts:{posX:"left",
posY:"bottom",offsetX:-(self.options.offsetX+$(select_wrapper).width()-$(button).width()),offsetY:self.options.offsetY,directionH:"right",directionV:"up",detectH:false,detectV:false,linkToFront:false},callback:{select:function(ITEM){var item_id=$(ITEM).attr("itemid");if(!item_id)return;input.val($(ITEM).text());input.focus();self.options.onSelect.call(self,item_id)}}});$.fn.clickaway({clickaway:function(){$.fn.fgmenu.closeAll();$(".label_popup_menu").autocomplete("close")}})}})})(jQuery);
jQuery.fn.putCursorAtEnd=function(){return this.each(function(){if($(this).is(":visible")){$(this).focus();if(this.setSelectionRange){var len=$(this).val().length*2;this.setSelectionRange(len,len)}else $(this).val($(this).val());this.scrollTop=999999}})};
(function($){var types=["DOMMouseScroll","mousewheel"];$.event.special.mousewheel={setup:function(){if(this.addEventListener)for(var i=types.length;i;)this.addEventListener(types[--i],handler,false);else this.onmousewheel=handler},teardown:function(){if(this.removeEventListener)for(var i=types.length;i;)this.removeEventListener(types[--i],handler,false);else this.onmousewheel=null}};$.fn.extend({mousewheel:function(fn){return fn?this.bind("mousewheel",fn):this.trigger("mousewheel")},unmousewheel:function(fn){return this.unbind("mousewheel",
fn)}});function handler(event){var args=[].slice.call(arguments,1),delta=0,returnValue=true;event=$.event.fix(event||window.event);event.type="mousewheel";if(event.wheelDelta)delta=event.wheelDelta/120;if(event.detail)delta=-event.detail/3;args.unshift(event,delta);return $.event.handle.apply(this,args)}})(jQuery);
(function($,doc,outside){"$:nomunge";$.map("click dblclick mousemove mousedown mouseup mouseover mouseout change select submit keydown keypress keyup".split(" "),function(event_name){jq_addOutsideEvent(event_name)});jq_addOutsideEvent("focusin","focus"+outside);jq_addOutsideEvent("focusout","blur"+outside);$.addOutsideEvent=jq_addOutsideEvent;function jq_addOutsideEvent(event_name,outside_event_name){outside_event_name=outside_event_name||event_name+outside;var elems=$(),event_namespaced=event_name+
"."+outside_event_name+"-special-event";$.event.special[outside_event_name]={setup:function(){elems=elems.add(this);if(elems.length===1)$(doc).bind(event_namespaced,handle_event)},teardown:function(){elems=elems.not(this);if(elems.length===0)$(doc).unbind(event_namespaced)},add:function(handleObj){var old_handler=handleObj.handler;handleObj.handler=function(event,elem){event.target=elem;old_handler.apply(this,arguments)}}};function handle_event(event){$(elems).each(function(){var elem=$(this);if(this!==
event.target&&!elem.has(event.target).length)elem.triggerHandler(outside_event_name,[event.target])})}}})(jQuery,document,"outside");(function($){$.fn.clickaway=function(options){var me=this;var opts=$.extend({},$.fn.clickaway.defaults,options);$("ul.ui-tabs-nav *, a[id^='ticket']",document).click(function(){opts.clickaway.call(me)});$.fn.clickaway.defaults={clickaway:function(){}}}})(jQuery);
(function(){var fieldSelection={getSelection:function(){var e=this.jquery?this[0]:this;return("selectionStart"in e&&function(){var l=e.selectionEnd-e.selectionStart;return{start:e.selectionStart,end:e.selectionEnd,length:l,text:e.value.substr(e.selectionStart,l)}}||document.selection&&function(){e.focus();var r=document.selection.createRange();if(r==null)return{start:0,end:e.value.length,length:0};var re=e.createTextRange();var rc=re.duplicate();re.moveToBookmark(r.getBookmark());rc.setEndPoint("EndToStart",
re);var rcLen=rc.text.length,i,rcLenOut=rcLen;for(i=0;i<rcLen;i++)if(rc.text.charCodeAt(i)==13)rcLenOut--;var rLen=r.text.length,rLenOut=rLen;for(i=0;i<rLen;i++)if(r.text.charCodeAt(i)==13)rLenOut--;return{start:rcLenOut,end:rcLenOut+rLenOut,length:rLenOut,text:r.text}}||function(){return{start:0,end:e.value.length,length:0}})()},setSelection:function(start,end){var e=document.getElementById($(this).prop("id"));if(!e)return $(this);else if(e.setSelectionRange){e.focus();e.setSelectionRange(start,
end)}else if(e.createTextRange){var range=e.createTextRange();range.collapse(true);range.moveEnd("character",end);range.moveStart("character",start);range.select()}else if(e.selectionStart){e.selectionStart=start;e.selectionEnd=end}return $(this)},replaceSelection:function(){var e=this.jquery?this[0]:this;var text=arguments[0]||"";return("selectionStart"in e&&function(){e.value=e.value.substr(0,e.selectionStart)+text+e.value.substr(e.selectionEnd,e.value.length);return this}||document.selection&&
function(){e.focus();document.selection.createRange().text=text;return this}||function(){e.value+=text;return this})()}};jQuery.each(fieldSelection,function(i){jQuery.fn[i]=this})})();
(function($){$.fn.addressBookAutocomplete=function(options){options=typeof options!="undefined"?options:{};var cache={};var matches=[];var className="address-book-autocomplete";var sourceElementClassName="ui-"+className;var remoteMinLength=2;var autocompleteUrl="/api/v2/address_books/autocomplete";var customerOptions={addCustomers:false,filterByCompany:false,companyId:null};var defaults={maxResults:6,minLength:2,remoteEnabled:false,customerOptions:customerOptions,caching:false};var localSources=typeof Assistly.users==
"object"?Assistly.users.array:[];var additionalSources=typeof options.additionalSources!="undefined"?options.additionalSources:[];options=$.extend(defaults,options);if(options.remoteEnabled){options.customerOptions.addCustomers=true;options.customerOptions.filterByCompany=true;options.customerOptions.companyId=options.companyId}if(options.minLength>remoteMinLength)remoteMinLength=options.minLength;localSources=localSources.concat(additionalSources);function split(value){return value.split(/\s*,\s*/)}
function hasMatch(string,term){return string.toLowerCase().indexOf(term.toLowerCase())==0}function hasMatchOnName(name,term){var names=name.split(" ");names.push(name);for(var i=0;i<names.length;i++)if(hasMatch(names[i],term))return true;return false}function matchLabel(match){var label="<div>"+matchAvatar(match)+" <b>"+match.name+"</b></div>";label+="<div>"+match.email+"</div>";return label}function matchAvatar(match){var size="16";var defaultImage=encodeURIComponent("https://cdn.desk.com/assets/unknown_user_16-29d1c36e8f9de4782ebc5b442eab5581.png");
var useSsl=true;var avatar,user,helper,idOrObject;if(match.type==="Customer"){match.email_MD5=hex_md5(match.email);idOrObject=match;helper=Handlebars.helpers.customerThumb}else{idOrObject=match.id;helper=Handlebars.helpers.agentThumb}return helper(idOrObject,size,defaultImage,useSsl)}function extractLast(term){return split(term).pop()}function handledEmptyTerm(term,response){var _handledEmptyTerm=false;if(term===""||term===" "){response([]);_handledEmptyTerm=true}return _handledEmptyTerm}function validTermFor(term){var re=
/(\w+)\s[a-zA-Z0-9 ]$/;term=term.replace(re,"$1");return term}function matchesFromResources(resources,term,existing){var i,length,resource=null;var matches=[];for(i=0,length=resources.length;i<length;i++){resource=resources[i];if(hasMatchOnName(resource.name,term)||hasMatch(resource.email,term)){var notPresent=$.inArray(resource.email,existing)==-1;if(notPresent)matches.push(resource)}}return matches}function formatMatches(matches){matches=matches.slice(0,options.maxResults);return $.map(matches,
function(match){return{value:match.email,label:matchLabel(match)}})}function splitTerm(term){return term.split(/[a-z]+, */)}function source(request,response){var term=request.term;var validTerm=term;var existing=[];var resource,matches=[];var handler=options.remoteEnabled?remoteSource:localSource;if(handledEmptyTerm(term,response))return;else{existing=splitTerm(term);term=extractLast(term).toLowerCase();if(handledEmptyTerm(term,response))return}if(options.remoteEnabled)validTerm=validTermFor(term);
handler(term,validTerm,response,existing)}function localSource(term,validTerm,response,existing){var resources=localSources;matches=matchesFromResources(resources,term,existing);matches=formatMatches(matches);response(matches)}function responseWithMatches(term,validTerm,response,existing,resources){matches=matchesFromResources(resources,term,existing);response(matches)}function remoteSource(term,validTerm,response,existing){var foundInCache=false;var caching=options.caching;if(term.length<remoteMinLength){localSource(term,
response,existing);return}if(caching){var resources=[];var remoteSources=cache[validTerm];if(remoteSources&&remoteSources.length>0){foundInCache=true;resources=remoteSources;if(options.localEnabled)resources=localSources.concat(remoteSources);matches=matchesFromResources(resources,term,existing);matches=formatMatches(matches);response(matches)}}function buildAutocompleteUrl(){var data={q:validTerm};var companyId=options.customerOptions.companyId;if(companyId)data.company_id=companyId;return autocompleteUrl+
"?"+$.param(data)}function success(data){if(caching&&data.total_entries<1)cache[validTerm]=[];var remoteSources=data.results;remoteSources=$.map(remoteSources,function(d){var id=d.id;var name=d.name;var email=d.email;var companyId=d.company_id;return{id:id,name:name,email:email,companyId:companyId,type:"Customer"}});if(caching)cache[validTerm]=remoteSources;resources=options.localEnabled?localSources.concat(remoteSources):remoteSources;matches=matchesFromResources(resources,term,existing);matches=
formatMatches(matches);response(matches)}if(caching&&foundInCache)return;$.ajax({url:buildAutocompleteUrl(),dataType:"json",type:"GET",success:success})}var autocompletes=this.autocomplete({minLength:options.minLength,source:source,focus:function(){return false},select:function(event,ui){var terms=split(this.value);terms.pop();terms.push(ui.item.value);terms.push("");this.value=terms.join(", ");return false}}).autocomplete("widget").addClass(className);this.addClass(sourceElementClassName);return autocompletes}})(jQuery);
(function(g){var i="ui-state-active",s="ui-state-hover",e="ui-state-disabled",k=g.ui.keyCode,m=k.UP,n=k.DOWN,r=k.RIGHT,f=k.LEFT,j=k.PAGE_UP,p=k.PAGE_DOWN,q=k.HOME,d=k.END,l=g.browser.msie,c=g.browser.mozilla?"DOMMouseScroll":"mousewheel",o=".uispinner",a=[m,n,r,f,j,p,q,d,k.BACKSPACE,k.DELETE,k.TAB],b,h;g.widget("ui.spinner",{_create:function(){var u=this,t=u.element,v=t.attr("type");if(!t.is("input")||v!="text"&&v!="number"){console.error("Invalid target for ui.spinner");return}u._procOptions(true);
u._createButtons(t);if(!t.is(":enabled"))u.disable()},_createButtons:function(E){function D(W){return W=="auto"?0:parseInt(W)}var H=this,x=H.options,v=x.className,N=x.width,y=x.showOn,C=g.support.boxModel,I=E.outerHeight(),R=H.oMargin=D(E.css("margin-right")),A=H.wrapper=E.css({width:(H.oWidth=C?E.width():E.outerWidth())-N,marginRight:R+N,textAlign:"right"}).after('<span class="ui-spinner ui-widget"></span>').next(),L=H.btnContainer=g('<div class="ui-spinner-buttons"><div class="ui-spinner-up ui-spinner-button ui-state-default ui-corner-tr"><span class="ui-icon '+
x.upIconClass+'">&nbsp;</span></div><div class="ui-spinner-down ui-spinner-button ui-state-default ui-corner-br"><span class="ui-icon '+x.downIconClass+'">&nbsp;</span></div></div>'),w,u,Q,V,F,B,G,P,J,O,z=E[0].dir=="rtl";if(v)A.addClass(v);A.append(L.css({height:I,left:-N-R,top:E.offset().top-A.offset().top+"px"}));Q=H.buttons=L.find(".ui-spinner-button");Q.css({width:N-(C?Q.outerWidth()-Q.width():0),height:I/2-(C?Q.outerHeight()-Q.height():0)});w=Q[0];u=Q[1];V=Q.find(".ui-icon");V.css({marginLeft:(Q.innerWidth()-
V.width())/2,marginTop:(Q.innerHeight()-V.height())/2});L.width(Q.outerWidth());if(y!="always")L.css("opacity",0);if(y=="hover"||y=="both")Q.add(E).bind("mouseenter"+o,function(){T(function(){G=true;if(!H.focused||y=="hover")H.showButtons()})}).bind("mouseleave"+o,function K(){T(function(){G=false;if(!H.focused||y=="hover")H.hideButtons()})});Q.hover(function(){H.buttons.removeClass(s);if(!x.disabled)g(this).addClass(s)},function(){g(this).removeClass(s)}).mousedown(U).mouseup(S).mouseout(S);if(l)Q.dblclick(function(){if(!x.disabled){H._change();
H._doSpin((this===w?1:-1)*x.step)}return false}).bind("selectstart",function(){return false});E.bind("keydown"+o,function(aa){var X,Y,W,Z=aa.keyCode;if(aa.ctrl||aa.alt)return true;if(t(Z))J=true;if(P)return false;switch(Z){case m:case j:X=1;Y=Z==j;break;case n:case p:X=-1;Y=Z==p;break;case r:case f:X=Z==r^z?1:-1;break;case q:W=H.options.min;if(W!=null)H._setValue(W);return false;case d:W=H.options.max;W=H.options.max;if(W!=null)H._setValue(W);return false}if(X){if(!P&&!x.disabled){keyDir=X;g(X>0?
w:u).addClass(i);P=true;H._startSpin(X,Y)}return false}}).bind("keyup"+o,function(W){if(W.ctrl||W.alt)return true;if(t(k))J=false;switch(W.keyCode){case m:case r:case j:case n:case f:case p:Q.removeClass(i);H._stopSpin();P=false;return false}}).bind("keypress"+o,function(W){if(M(W.keyCode,W.charCode))return false}).bind("change"+o,function(){H._change()}).bind("focus"+o,function(){function W(){H.element.select()}l?W():setTimeout(W,0);H.focused=true;b=H;if(!G&&(y=="focus"||y=="both"))H.showButtons()}).bind("blur"+
o,function(){H.focused=false;if(!G&&(y=="focus"||y=="both"))H.hideButtons()});function t(X){for(var W=0;W<a.length;W++)if(a[W]==X)return true;return false}function M(Z,W){if(J)return false;var Y=String.fromCharCode(W||Z),X=H.options;if(Y>="0"&&Y<="9"||Y=="-")return false;if(H.places>0&&Y==X.point||Y==X.group)return false;return true}function T(X){if(F){if(X===B)return;clearTimeout(F)}B=X;F=setTimeout(W,100);function W(){F=0;X()}}function U(){if(!x.disabled){var W=H.element[0],X=this===w?1:-1;W.focus();
W.select();g(this).addClass(i);O=true;H._startSpin(X)}return false}function S(){if(O){g(this).removeClass(i);H._stopSpin();O=false}return false}},_procOptions:function(A){var B=this,y=B.element,C=B.options,w=C.min,x=C.max,v=C.step,t=C.places,u=-1,z;if(C.increment=="slow")C.increment=[{count:1,mult:1,delay:250},{count:3,mult:1,delay:100},{count:0,mult:1,delay:50}];else if(C.increment=="fast")C.increment=[{count:1,mult:1,delay:250},{count:19,mult:1,delay:100},{count:80,mult:1,delay:20},{count:100,mult:10,
delay:20},{count:0,mult:100,delay:20}];if(w==null&&(z=y.attr("min"))!=null)w=parseFloat(z);if(x==null&&(z=y.attr("max"))!=null)x=parseFloat(z);if(!v&&(z=y.attr("step"))!=null)if(z!="any"){v=parseFloat(z);C.largeStep*=v}C.step=v=v||C.defaultStep;if(t==null&&(z=v+"").indexOf(".")!=-1)t=z.length-z.indexOf(".")-1;B.places=t;if(x!=null&&w!=null){if(w>x)w=x;u=Math.max(Math.max(u,C.format(x,t,y).length),C.format(w,t,y).length)}if(A)B.inputMaxLength=y[0].maxLength;z=B.inputMaxLength;if(z>0){u=u>0?Math.min(z,
u):z;z=Math.pow(10,u)-1;if(x==null||x>z)x=z;z=-(z+1)/10+1;if(w==null||w<z)w=z}if(u>0)y.attr("maxlength",u);C.min=w;C.max=x;B._change();y.unbind(c+o);if(C.mouseWheel)y.bind(c+o,B._mouseWheel)},_mouseWheel:function(u){var t=g.data(this,"spinner");if(!t.options.disabled&&t.focused&&b===t){t._change();t._doSpin(((u.wheelDelta||-u.detail)>0?1:-1)*t.options.step);return false}},_setTimer:function(v,u,x){var t=this;t._stopSpin();t.timer=setInterval(w,v);function w(){t._spin(u,x)}},_stopSpin:function(){if(this.timer){clearInterval(this.timer);
this.timer=0}},_startSpin:function(w,x){var u=this,v=u.options,t=v.increment;u._change();u._doSpin(w*(x?u.options.largeStep:u.options.step));if(t&&t.length>0){u.counter=0;u.incCounter=0;u._setTimer(t[0].delay,w,x)}},_spin:function(v,w){var u=this,t=u.options.increment,x=t[u.incCounter];u._doSpin(v*x.mult*(w?u.options.largeStep:u.options.step));u.counter++;if(u.counter>x.count&&u.incCounter<t.length-1){u.counter=0;x=t[++u.incCounter];u._setTimer(x.delay,v,w)}},_doSpin:function(u){var t=this,v=t.curvalue;
if(v==null)v=(u>0?t.options.min:t.options.max)||0;t._setValue(v+u)},_parseValue:function(){var t=this.element.val();return t?this.options.parse(t,this.element):null},_validate:function(w){var u=this.options,v=u.min,t=u.max;if(w==null&&!u.allowNull)w=this.curvalue!=null?this.curvalue:v||t||0;if(t!=null&&w>t)return t;else if(v!=null&&w<v)return v;else return w},_change:function(){var u=this,w=u._parseValue(),v=u.options.min,t=u.options.max;if(u.selfChange)return;if(isNaN(w))w=u.curvalue;u._setValue(w)},
_setOptions:function(t,u){g.Widget.prototype._setOptions.call(this,t,u);this._procOptions()},increment:function(){this._doSpin(this.options.step)},decrement:function(){this._doSpin(-this.options.step)},showButtons:function(u){var t=this.btnContainer.stop();if(u)t.css("opacity",1);else t.fadeTo("fast",1)},hideButtons:function(u){var t=this.btnContainer.stop();if(u)t.css("opacity",0);else t.fadeTo("fast",0);this.buttons.removeClass(s)},_setValue:function(u){var t=this;t.curvalue=u=t._validate(u);t.selfChange=
true;t.element.val(u!=null?t.options.format(u,t.places,t.element):"").change();t.selfChange=false},value:function(t){if(arguments.length){this._setValue(t);return this.element}return this.curvalue},enable:function(){this.buttons.removeClass(e);this.element[0].disabled=false;g.Widget.prototype.enable.call(this)},disable:function(){this.buttons.addClass(e).removeClass(s);this.element[0].disabled=true;g.Widget.prototype.disable.call(this)},destroy:function(t){this.wrapper.remove();this.element.unbind(o).css({width:this.oWidth,
marginRight:this.oMargin});g.Widget.prototype.destroy.call(this)}});h=g.extend(g.ui.spinner.prototype,{version:"1.11",getter:"value",options:{min:null,max:null,allowNull:false,group:"",point:".",prefix:"",suffix:"",places:null,defaultStep:1,largeStep:10,mouseWheel:true,increment:"slow",className:null,showOn:"always",width:16,upIconClass:"ui-icon-triangle-1-n",downIconClass:"ui-icon-triangle-1-s",format:function(w,v){var u=this,x=/(\d+)(\d{3})/,t=(isNaN(w)?0:Math.abs(w)).toFixed(v)+"";for(t=t.replace(".",
u.point);x.test(t)&&u.group;t=t.replace(x,"$1"+u.group+"$2"));return(w<0?"-":"")+u.prefix+t+u.suffix},parse:function(u){var t=this;if(t.group==".")u=u.replace(".","");if(t.point!=".")u=u.replace(t.point,".");return parseFloat(u.replace(/[^0-9\-\.]/g,""))}}})})(jQuery);
(function($){$(".ui-autocomplete-input").live("autocompleteopen",function(){var autocomplete=$(this).data("autocomplete"),menu=autocomplete.menu;if(!autocomplete.options.selectFirst)return;menu.activate($.Event({type:"mouseenter"}),menu.element.children().first())})})(jQuery);
jQuery.fn.print=function(){if(this.size()>1){this.eq(0).print();return}else if(!this.size())return;var strFrameName="printer-"+(new Date).getTime();var jFrame=$("<iframe name='"+strFrameName+"'>");jFrame.css("width","1px").css("height","1px").css("position","fixed").css("left","-9999px").appendTo($("body:first"));var objFrame=window.frames[strFrameName];var objDoc=objFrame.document;var jStyleDiv=$("<div>").append($("style").clone());objDoc.open();objDoc.write('<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">');
objDoc.write("<html>");objDoc.write("<body>");objDoc.write("<head>");objDoc.write("<title>");objDoc.write(document.title);objDoc.write("</title>");$("link",document).filter(function(){return $(this).attr("rel").toLowerCase()=="stylesheet"}).each(function(){objDoc.write('<link type="text/css" rel="stylesheet" href="'+$(this).attr("href")+'" media="'+$(this).attr("media")+'" >')});objDoc.write("<script type='text/javascript'>");objDoc.write("function printPage() { print(); }");objDoc.write("\x3c/script>");
objDoc.write(jStyleDiv.html());objDoc.write("</head>");objDoc.write(this.html());objDoc.write("</body>");objDoc.write("</html>");objDoc.close();setTimeout(function(){var iframe=window.frames?window.frames[strFrameName]:document.getElementById(strFrameName);var ifWin=iframe.contentWindow||iframe;iframe.focus();ifWin.printPage()},1E3);setTimeout(function(){jFrame.remove()},60*1E3)};if(typeof assistly==="undefined")assistly={};
assistly.uploader=function(params){var fileUploadCallBack=params.fileUploadCallBack;var dropbox=params.dropbox;var domFileElem=params.fileElem;var fileElem=$(domFileElem);var addAttachLink=params.addAttachLink;var maxSize=params.maxSize;var extraParamsToSubmit=params.extraParamsToSubmit;var postUrl=params.postUrl;var fileParamName=params.fileParamName;var uploadForm=params.uploadForm;var progressDiv=params.progressDiv;var winoObj=params.winObj?params.winObj:window;csrf_token=$("meta[name=csrf-token]",
window.parent.document).prop("content");csrf_param=$("meta[name=csrf-param]",window.parent.document).prop("content");if(csrf_param!==undefined&&csrf_token!==undefined)extraParamsToSubmit[csrf_param]=csrf_token;var fileApiSuport=function(){if(window&&window.FormData)return true;else return false};var setupDragAndDrop=function(){var db;if(dropbox instanceof Array)for(var i=0;i<dropbox.length;i++){db=dropbox[i].get(0);db.addEventListener("drop",drop,false);db.addEventListener("dragover",dragover,false)}else{db=
dropbox.get(0);db.addEventListener("drop",drop,false);db.addEventListener("dragover",dragover,false)}};var drop=function(evt){evt.stopPropagation();evt.preventDefault();var files=evt.dataTransfer.files;var count=files.length;if(count>0)filesSelected(files)};var dragover=function(evt){evt.preventDefault()};var filesSelected=function(files){progressDiv.show();for(var i=0;i<files.length;i++){var file=files[i];var fileSize=0;var shortFileName;var fileNameParts;if(file.name.length>0){fileNameParts=file.name.split("/");
shortFileName=fileNameParts[fileNameParts.length-1];if(shortFileName.length>18)shortFileName=shortFileName.substring(0,16)+I18n.translate("common.uploader.ellipsis")}else shortFileName="";if(file.size>1024*1024)fileSize=(Math.round(file.size*100/(1024*1024))/100).toString()+I18n.translate("common.uploader.mb");else fileSize=(Math.round(file.size*100/1024)/100).toString()+I18n.translate("common.uploader.kb");if(file.size>maxSize){var tempDiv=winoObj.$("<div class='uploadifyQueueItem'></div>");tempDiv.append("<span class='fileName'>"+
shortFileName+" ("+fileSize+")</span>");var percentageContainer=winoObj.$('<span class="uploadError"> '+I18n.translate("common.uploader.file_too_big")+"</span>");tempDiv.append(percentageContainer);progressDiv.append(tempDiv);tempDiv.fadeOut(2500,function(){percentageContainer.parent().remove()});winoObj.$("#flash .agent_notifier_msg").removeClass().addClass("agent_notifier_msg flash_error");notify(handlebarsUploadMaxSizeError({size:"20MB"}),true,5E3)}else{var tempDiv=winoObj.$("<div class='uploadifyQueueItem'></div>");
tempDiv.append("<span class='fileName'>"+shortFileName+" ("+fileSize+")</span>");var percentageContainer=winoObj.$('<span class="percentage"> - 0%</span>');tempDiv.append(percentageContainer);var cancelImage=winoObj.$('<img alt="Delete" src="https://cdn.desk.com/assets/delete-ae81875d0715e9c820e3421c50ef9d7f.png" style="float:right;margin-left:5px" />');tempDiv.append(cancelImage);var statusBar=winoObj.$('<div class="outterProgressContainer"><div class="innerProgressContainer"></div></div>');tempDiv.append(statusBar);
progressDiv.append(tempDiv);uploadFile(file,percentageContainer,statusBar,cancelImage)}}};var uploadFile=function(file,percentageContainer,statusBar,cancelImage){var fd=new FormData;for(var i in extraParamsToSubmit)fd.append(i,extraParamsToSubmit[i]);fd.append(fileParamName,file);var xhr=new XMLHttpRequest;xhr.upload.addEventListener("progress",function(evt){if(evt.lengthComputable){var percentComplete=Math.round(evt.loaded*100/evt.total);statusBar.children().first().css("width",parseInt(statusBar.css("width"))*
(percentComplete/100));if(percentComplete<98)percentageContainer.text(" - "+percentComplete.toString()+"%");else percentageContainer.text(" - 100% - "+I18n.translate("common.uploader.saving"))}},false);xhr.addEventListener("load",function(){if(xhr.status==200){fileUploadCallBack(xhr);statusBar.children().first().css("width",statusBar.css("width"));percentageContainer.text(" - 100% - "+I18n.translate("common.uploader.saved"));percentageContainer.parent().fadeOut(1E3,function(){percentageContainer.parent().remove()})}else if(xhr.status==
422){percentageContainer.removeClass("percentage").addClass("uploadError").text(I18n.translate("common.uploader.upload_failed")).parent().fadeOut(2500,function(){percentageContainer.parent().remove()});var resp=$.parseJSON(xhr.responseText);var err_msg="";$.each(resp.errors,function(index,value){if($.isArray(value)){var err_arr_len=value.length;for(var i=0;i<err_arr_len;i++)err_msg+="<p>"+value[i]+"</p>"}else err_msg+="<p>"+value+"</p>"});winoObj.$("#flash .agent_notifier_msg").removeClass().addClass("agent_notifier_msg flash_error");
notify(err_msg,true,5E3)}else{percentageContainer.removeClass("percentage").addClass("uploadError").text(I18n.translate("common.uploader.upload_failed")).parent().fadeOut(2500,function(){percentageContainer.parent().remove()});winoObj.$("#flash .agent_notifier_msg").removeClass().addClass("agent_notifier_msg flash_error");notify(I18n.translate("common.uploader.upload_failed"),true,5E3)}},false);xhr.addEventListener("error",function(){percentageContainer.removeClass("percentage").addClass("uploadError").text(I18n.translate("common.uploader.upload_failed")).parent().fadeOut(2500,
function(){percentageContainer.parent().remove()});winoObj.$("#flash .agent_notifier_msg").removeClass().addClass("agent_notifier_msg flash_error");notify(I18n.translate("common.uploader.upload_failed"),true,5E3)},false);xhr.addEventListener("abort",function(){percentageContainer.removeClass("percentage").addClass("uploadError").text(I18n.translate("common.uploader.upload_aborted")).parent().fadeOut(2500,function(){percentageContainer.parent().remove()});winoObj.$("#flash .agent_notifier_msg").removeClass().addClass("agent_notifier_msg flash_error");
notify(I18n.translate("common.uploader.upload_aborted"),true,5E3)},false);xhr.open("POST",postUrl);var token=$('meta[name="csrf-token"]',window.parent.document).prop("content");if(token)xhr.setRequestHeader("X-CSRF-Token",token);xhr.send(fd);cancelImage.bind("click",function(){xhr.abort()})};var getInternetExplorerVersion=function(){var rv=-1;if(navigator.appName=="Microsoft Internet Explorer"){var ua=navigator.userAgent;var re=new RegExp("MSIE ([0-9]{1,}[.0-9]{0,})");if(re.exec(ua)!=null)rv=parseFloat(RegExp.$1)}return rv};
if(fileApiSuport()){setupDragAndDrop();domFileElem.className="hiddenInputFile";addAttachLink.bind("click",function(){domFileElem.click()});domFileElem.addEventListener("change",function(){filesSelected(this.files);fileElem.val("")},true)}else{fileElem.removeProp("multiple");fileElem.addClass("uploadFileElement");if(dropbox instanceof Array)dropbox=dropbox[0];addAttachLink.removeClass().addClass("file_upload_link_hidden");var inChangeEvent=false;fileElem.bind("change",function(evt){if(inChangeEvent===
true)return;inChangeEvent=true;if(dropbox.find(".a-ticket-reply-footer.a-more").is(":hidden"))dropbox.find(".a-more-link").trigger("click");if(fileElem.val().length<=0){alert(I18n.translate("common.uploader.no_file_selected_message"));return}var fileNameParts=fileElem.val().split("\\");var shortFileName=fileNameParts[fileNameParts.length-1];if(shortFileName.length>18)shortFileName=shortFileName.substring(0,16)+I18n.translate("common.uploader.ellipsis");progressDiv.show();var tempDiv=winoObj.$('<div class="uploadifyQueueItem"> </div>');
tempDiv.append("<span class='fileName'>"+I18n.translate("common.uploader.uploading")+" "+shortFileName+" </span>");var percentageContainer=winoObj.$('<span class="percentage"> - '+I18n.translate("common.uploader.please_wait")+"</span>");tempDiv.append(percentageContainer);var imageTag=winoObj.$('<img alt="Ajax-loader-small" src="https://cdn.desk.com/assets/ajax-loader-small-3f8fbce778680378474e2cd9c2a1991b.gif" style="margin-left:2px;" />');tempDiv.append(imageTag);progressDiv.append(tempDiv);var d=
new Date;var hiddenFrame=winoObj.$("<iframe name='hiddenFrame_"+d.getTime()+"' id='hiddenFrame_"+d.getTime()+"' src='javascript:void(0);' class='hiddenFrame'></iframe>");dropbox.append(hiddenFrame);hiddenFrame.bind("load",function(){var responseTitle;try{responseTitle=hiddenFrame.get(0).contentWindow.document.title}catch(e){responseTitle=I18n.translate("common.uploader.upload_failed")}if(responseTitle.length>0){percentageContainer.removeClass("percentage").addClass("uploadError").text(I18n.translate("common.uploader.upload_failed"));
tempDiv.fadeOut(2500,function(){tempDiv.remove();if(progressDiv.html().length==0)progressDiv.hide()});winoObj.$("#flash .agent_notifier_msg").removeClass().addClass("agent_notifier_msg flash_error");notify(I18n.translate("common.uploader.upload_failed"),true,5E3)}else{percentageContainer.text(I18n.translate("common.uploader.saved"));var content=$(hiddenFrame.get(0).contentWindow.document).find("body").text();fileUploadCallBack({responseText:content});tempDiv.fadeOut(1E3,function(){tempDiv.remove();
if(progressDiv.html().length==0)progressDiv.hide()})}hiddenFrame.remove()});uploadForm.prop("target","hiddenFrame_"+d.getTime());uploadForm.submit();fileElem.val("");var newFileElem=$(this).clone(true,true);$(this).parent().append(newFileElem);$(this).remove();fileElem=newFileElem;inChangeEvent=false})}};
(function($){$.extend($.fn,{livequery:function(type,fn,fn2){var self=this,q;if($.isFunction(type))fn2=fn,fn=type,type=undefined;$.each($.livequery.queries,function(i,query){if(self.selector==query.selector&&self.context==query.context&&type==query.type&&(!fn||fn.$lqguid==query.fn.$lqguid)&&(!fn2||fn2.$lqguid==query.fn2.$lqguid))return(q=query)&&false});q=q||new $.livequery(this.selector,this.context,type,fn,fn2);q.stopped=false;q.run();return this},expire:function(type,fn,fn2){var self=this;if($.isFunction(type))fn2=
fn,fn=type,type=undefined;$.each($.livequery.queries,function(i,query){if(self.selector==query.selector&&self.context==query.context&&(!type||type==query.type)&&(!fn||fn.$lqguid==query.fn.$lqguid)&&(!fn2||fn2.$lqguid==query.fn2.$lqguid)&&!this.stopped)$.livequery.stop(query.id)});return this}});$.livequery=function(selector,context,type,fn,fn2){this.selector=selector;this.context=context||document;this.type=type;this.fn=fn;this.fn2=fn2;this.elements=[];this.stopped=false;this.id=$.livequery.queries.push(this)-
1;fn.$lqguid=fn.$lqguid||$.livequery.guid++;if(fn2)fn2.$lqguid=fn2.$lqguid||$.livequery.guid++;return this};$.livequery.prototype={stop:function(){var query=this;if(this.type)this.elements.unbind(this.type,this.fn);else if(this.fn2)this.elements.each(function(i,el){query.fn2.apply(el)});this.elements=[];this.stopped=true},run:function(){if(this.stopped)return;var query=this;var oEls=this.elements,els=$(this.selector,this.context),nEls=els.not(oEls);this.elements=els;if(this.type){nEls.bind(this.type,
this.fn);if(oEls.length>0)$.each(oEls,function(i,el){if($.inArray(el,els)<0)$.event.remove(el,query.type,query.fn)})}else{nEls.each(function(){query.fn.apply(this)});if(this.fn2&&oEls.length>0)$.each(oEls,function(i,el){if($.inArray(el,els)<0)query.fn2.apply(el)})}}};$.extend($.livequery,{guid:0,queries:[],queue:[],running:false,timeout:null,checkQueue:function(){if($.livequery.running&&$.livequery.queue.length){var length=$.livequery.queue.length;while(length--)$.livequery.queries[$.livequery.queue.shift()].run()}},
pause:function(){$.livequery.running=false},play:function(){$.livequery.running=true;$.livequery.run()},registerPlugin:function(){$.each(arguments,function(i,n){if(!$.fn[n])return;var old=$.fn[n];$.fn[n]=function(){var r=old.apply(this,arguments);$.livequery.run();return r}})},run:function(id){if(id!=undefined){if($.inArray(id,$.livequery.queue)<0)$.livequery.queue.push(id)}else $.each($.livequery.queries,function(id){if($.inArray(id,$.livequery.queue)<0)$.livequery.queue.push(id)});if($.livequery.timeout)clearTimeout($.livequery.timeout);
$.livequery.timeout=setTimeout($.livequery.checkQueue,20)},stop:function(id){if(id!=undefined)$.livequery.queries[id].stop();else $.each($.livequery.queries,function(id){$.livequery.queries[id].stop()})}});$.livequery.registerPlugin("append","prepend","after","before","wrap","attr","removeAttr","addClass","removeClass","toggleClass","empty","remove");$(function(){$.livequery.play()});var init=$.prototype.init;$.prototype.init=function(a,c){var r=init.apply(this,arguments);if(a&&a.selector)r.context=
a.context,r.selector=a.selector;if(typeof a=="string")r.context=c||document,r.selector=a;return r};$.prototype.init.prototype=$.prototype})(jQuery);
$(document).ready(function(){if($.livequery){$(".custom_field_date").livequery(function(){if($.ui.datepicker)$(this).datepicker({format:"mm/dd/yy",changeYear:true,yearRange:"1900:c+100"})});$(".custom_field_datetime").livequery(function(){if($.ui.timepicker)$(this).datetimepicker({format:"mm/dd/yy",changeYear:true,yearRange:"1900:c+100",ampm:true})});$(".custom_field_integer").livequery(function(){if($.numeric)$(this).numeric();if($.ui.spinner)$(this).spinner({max:9999999999,min:0})})}else{if($.ui.datepicker)$(".custom_field_date").datepicker({format:"mm/dd/yy",
changeYear:true,yearRange:"1900:c+100"});if($.ui.timepicker)$(".custom_field_datetime").datetimepicker({format:"mm/dd/yy",changeYear:true,yearRange:"1900:c+100",ampm:true});$(".custom_field_integer").each(function(){if($.numeric)$(this).numeric();if($.ui.spinner)$(this).spinner({max:9999999999,min:0})})}});
var buzz={defaults:{autoplay:false,duration:5E3,formats:[],loop:false,placeholder:"--",preload:"metadata",volume:80},types:{"mp3":"audio/mpeg","ogg":"audio/ogg","wav":"audio/wav","aac":"audio/aac","m4a":"audio/x-m4a"},sounds:[],el:document.createElement("audio"),sound:function(src,options){options=options||{};var pid=0,events=[],eventsOnce={},supported=buzz.isSupported();this.load=function(){if(!supported)return this;this.sound.load();return this};this.play=function(){if(!supported)return this;this.sound.play();
return this};this.togglePlay=function(){if(!supported)return this;if(this.sound.paused)this.sound.play();else this.sound.pause();return this};this.pause=function(){if(!supported)return this;this.sound.pause();return this};this.isPaused=function(){if(!supported)return null;return this.sound.paused};this.stop=function(){if(!supported)return this;this.setTime(this.getDuration());this.sound.pause();return this};this.isEnded=function(){if(!supported)return null;return this.sound.ended};this.loop=function(){if(!supported)return this;
this.sound.loop="loop";this.bind("ended.buzzloop",function(){this.currentTime=0;this.play()});return this};this.unloop=function(){if(!supported)return this;this.sound.removeAttribute("loop");this.unbind("ended.buzzloop");return this};this.mute=function(){if(!supported)return this;this.sound.muted=true;return this};this.unmute=function(){if(!supported)return this;this.sound.muted=false;return this};this.toggleMute=function(){if(!supported)return this;this.sound.muted=!this.sound.muted;return this};
this.isMuted=function(){if(!supported)return null;return this.sound.muted};this.setVolume=function(volume){if(!supported)return this;if(volume<0)volume=0;if(volume>100)volume=100;this.volume=volume;this.sound.volume=volume/100;return this};this.getVolume=function(){if(!supported)return this;return this.volume};this.increaseVolume=function(value){return this.setVolume(this.volume+(value||1))};this.decreaseVolume=function(value){return this.setVolume(this.volume-(value||1))};this.setTime=function(time){if(!supported)return this;
this.whenReady(function(){this.sound.currentTime=time});return this};this.getTime=function(){if(!supported)return null;var time=Math.round(this.sound.currentTime*100)/100;return isNaN(time)?buzz.defaults.placeholder:time};this.setPercent=function(percent){if(!supported)return this;return this.setTime(buzz.fromPercent(percent,this.sound.duration))};this.getPercent=function(){if(!supported)return null;var percent=Math.round(buzz.toPercent(this.sound.currentTime,this.sound.duration));return isNaN(percent)?
buzz.defaults.placeholder:percent};this.setSpeed=function(duration){if(!supported)return this;this.sound.playbackRate=duration};this.getSpeed=function(){if(!supported)return null;return this.sound.playbackRate};this.getDuration=function(){if(!supported)return null;var duration=Math.round(this.sound.duration*100)/100;return isNaN(duration)?buzz.defaults.placeholder:duration};this.getPlayed=function(){if(!supported)return null;return timerangeToArray(this.sound.played)};this.getBuffered=function(){if(!supported)return null;
return timerangeToArray(this.sound.buffered)};this.getSeekable=function(){if(!supported)return null;return timerangeToArray(this.sound.seekable)};this.getErrorCode=function(){if(supported&&this.sound.error)return this.sound.error.code;return 0};this.getErrorMessage=function(){if(!supported)return null;switch(this.getErrorCode()){case 1:return"MEDIA_ERR_ABORTED";case 2:return"MEDIA_ERR_NETWORK";case 3:return"MEDIA_ERR_DECODE";case 4:return"MEDIA_ERR_SRC_NOT_SUPPORTED";default:return null}};this.getStateCode=
function(){if(!supported)return null;return this.sound.readyState};this.getStateMessage=function(){if(!supported)return null;switch(this.getStateCode()){case 0:return"HAVE_NOTHING";case 1:return"HAVE_METADATA";case 2:return"HAVE_CURRENT_DATA";case 3:return"HAVE_FUTURE_DATA";case 4:return"HAVE_ENOUGH_DATA";default:return null}};this.getNetworkStateCode=function(){if(!supported)return null;return this.sound.networkState};this.getNetworkStateMessage=function(){if(!supported)return null;switch(this.getNetworkStateCode()){case 0:return"NETWORK_EMPTY";
case 1:return"NETWORK_IDLE";case 2:return"NETWORK_LOADING";case 3:return"NETWORK_NO_SOURCE";default:return null}};this.set=function(key,value){if(!supported)return this;this.sound[key]=value;return this};this.get=function(key){if(!supported)return null;return key?this.sound[key]:this.sound};this.bind=function(types,func){if(!supported)return this;types=types.split(" ");var that=this,efunc=function(e){func.call(that,e)};for(var t=0;t<types.length;t++){var type=types[t],idx=type;type=idx.split(".")[0];
events.push({idx:idx,func:efunc});this.sound.addEventListener(type,efunc,true)}return this};this.unbind=function(types){if(!supported)return this;types=types.split(" ");for(var t=0;t<types.length;t++){var idx=types[t],type=idx.split(".")[0];for(var i=0;i<events.length;i++){var namespace=events[i].idx.split(".");if(events[i].idx==idx||namespace[1]&&namespace[1]==idx.replace(".","")){this.sound.removeEventListener(type,events[i].func,true);delete events[i]}}}return this};this.bindOnce=function(type,
func){if(!supported)return this;var that=this;eventsOnce[pid++]=false;this.bind(pid+type,function(){if(!eventsOnce[pid]){eventsOnce[pid]=true;func.call(that)}that.unbind(pid+type)})};this.trigger=function(types){if(!supported)return this;types=types.split(" ");for(var t=0;t<types.length;t++){var idx=types[t];for(var i=0;i<events.length;i++){var eventType=events[i].idx.split(".");if(events[i].idx==idx||eventType[0]&&eventType[0]==idx.replace(".","")){var evt=document.createEvent("HTMLEvents");evt.initEvent(eventType[0],
false,true);this.sound.dispatchEvent(evt)}}}return this};this.fadeTo=function(to,duration,callback){if(!supported)return this;if(duration instanceof Function){callback=duration;duration=buzz.defaults.duration}else duration=duration||buzz.defaults.duration;var from=this.volume,delay=duration/Math.abs(from-to),that=this;this.play();function doFade(){setTimeout(function(){if(from<to&&that.volume<to){that.setVolume(that.volume+=1);doFade()}else if(from>to&&that.volume>to){that.setVolume(that.volume-=
1);doFade()}else if(callback instanceof Function)callback.apply(that)},delay)}this.whenReady(function(){doFade()});return this};this.fadeIn=function(duration,callback){if(!supported)return this;return this.setVolume(0).fadeTo(100,duration,callback)};this.fadeOut=function(duration,callback){if(!supported)return this;return this.fadeTo(0,duration,callback)};this.fadeWith=function(sound,duration){if(!supported)return this;this.fadeOut(duration,function(){this.stop()});sound.play().fadeIn(duration);return this};
this.whenReady=function(func){if(!supported)return null;var that=this;if(this.sound.readyState===0)this.bind("canplay.buzzwhenready",function(){func.call(that)});else func.call(that)};function timerangeToArray(timeRange){var array=[],length=timeRange.length-1;for(var i=0;i<=length;i++)array.push({start:timeRange.start(length),end:timeRange.end(length)});return array}function getExt(filename){return filename.split(".").pop()}function addSource(sound,src){var source=document.createElement("source");
source.src=src;if(buzz.types[getExt(src)])source.type=buzz.types[getExt(src)];sound.appendChild(source)}if(supported){for(var i in buzz.defaults)if(buzz.defaults.hasOwnProperty(i))options[i]=options[i]||buzz.defaults[i];this.sound=document.createElement("audio");if(src instanceof Array)for(var j in src){if(src.hasOwnProperty(j))addSource(this.sound,src[j])}else if(options.formats.length)for(var k in options.formats){if(options.formats.hasOwnProperty(k))addSource(this.sound,src+"."+options.formats[k])}else addSource(this.sound,
src);if(options.loop)this.loop();if(options.autoplay)this.sound.autoplay="autoplay";if(options.preload===true)this.sound.preload="auto";else if(options.preload===false)this.sound.preload="none";else this.sound.preload=options.preload;this.setVolume(options.volume);buzz.sounds.push(this)}},group:function(sounds){sounds=argsToArray(sounds,arguments);this.getSounds=function(){return sounds};this.add=function(soundArray){soundArray=argsToArray(soundArray,arguments);for(var a=0;a<soundArray.length;a++)sounds.push(soundArray[a])};
this.remove=function(soundArray){soundArray=argsToArray(soundArray,arguments);for(var a=0;a<soundArray.length;a++)for(var i=0;i<sounds.length;i++)if(sounds[i]==soundArray[a]){delete sounds[i];break}};this.load=function(){fn("load");return this};this.play=function(){fn("play");return this};this.togglePlay=function(){fn("togglePlay");return this};this.pause=function(time){fn("pause",time);return this};this.stop=function(){fn("stop");return this};this.mute=function(){fn("mute");return this};this.unmute=
function(){fn("unmute");return this};this.toggleMute=function(){fn("toggleMute");return this};this.setVolume=function(volume){fn("setVolume",volume);return this};this.increaseVolume=function(value){fn("increaseVolume",value);return this};this.decreaseVolume=function(value){fn("decreaseVolume",value);return this};this.loop=function(){fn("loop");return this};this.unloop=function(){fn("unloop");return this};this.setTime=function(time){fn("setTime",time);return this};this.setduration=function(duration){fn("setduration",
duration);return this};this.set=function(key,value){fn("set",key,value);return this};this.bind=function(type,func){fn("bind",type,func);return this};this.unbind=function(type){fn("unbind",type);return this};this.bindOnce=function(type,func){fn("bindOnce",type,func);return this};this.trigger=function(type){fn("trigger",type);return this};this.fade=function(from,to,duration,callback){fn("fade",from,to,duration,callback);return this};this.fadeIn=function(duration,callback){fn("fadeIn",duration,callback);
return this};this.fadeOut=function(duration,callback){fn("fadeOut",duration,callback);return this};function fn(){var args=argsToArray(null,arguments),func=args.shift();for(var i=0;i<sounds.length;i++)sounds[i][func].apply(sounds[i],args)}function argsToArray(array,args){return array instanceof Array?array:Array.prototype.slice.call(args)}},all:function(){return new buzz.group(buzz.sounds)},isSupported:function(){return!!buzz.el.canPlayType},isOGGSupported:function(){return!!buzz.el.canPlayType&&buzz.el.canPlayType('audio/ogg; codecs="vorbis"')},
isWAVSupported:function(){return!!buzz.el.canPlayType&&buzz.el.canPlayType('audio/wav; codecs="1"')},isMP3Supported:function(){return!!buzz.el.canPlayType&&buzz.el.canPlayType("audio/mpeg;")},isAACSupported:function(){return!!buzz.el.canPlayType&&(buzz.el.canPlayType("audio/x-m4a;")||buzz.el.canPlayType("audio/aac;"))},toTimer:function(time,withHours){var h,m,s;h=Math.floor(time/3600);h=isNaN(h)?"--":h>=10?h:"0"+h;m=withHours?Math.floor(time/60%60):Math.floor(time/60);m=isNaN(m)?"--":m>=10?m:"0"+
m;s=Math.floor(time%60);s=isNaN(s)?"--":s>=10?s:"0"+s;return withHours?h+":"+m+":"+s:m+":"+s},fromTimer:function(time){var splits=time.toString().split(":");if(splits&&splits.length==3)time=parseInt(splits[0],10)*3600+parseInt(splits[1],10)*60+parseInt(splits[2],10);if(splits&&splits.length==2)time=parseInt(splits[0],10)*60+parseInt(splits[1],10);return time},toPercent:function(value,total,decimal){var r=Math.pow(10,decimal||0);return Math.round(value*100/total*r)/r},fromPercent:function(percent,
total,decimal){var r=Math.pow(10,decimal||0);return Math.round(total/100*percent*r)/r}};
(function(){window.soundManager={sounds:{},supported:function(){return buzz.isSupported()===true},createSound:function(options){var sound=new buzz.sound(options.url,{formats:["ogg","mp3"],preload:options.autoLoad,autoplay:options.autoPlay});sound.setVolume(options.volume);soundManager.sounds[options.id]=sound;return sound},play:function(id){var sound=soundManager.sounds[id];if(sound)sound.play()},stop:function(id){var sound=soundManager.sounds[id];if(sound)sound.stop()}}})();
(function(){var SelectParser;SelectParser=function(){function SelectParser(){this.options_index=0;this.parsed=[]}SelectParser.prototype.add_node=function(child){if(child.nodeName==="OPTGROUP")return this.add_group(child);else return this.add_option(child)};SelectParser.prototype.add_group=function(group){var group_position,option,_i,_len,_ref,_results;group_position=this.parsed.length;this.parsed.push({array_index:group_position,group:true,label:group.label,children:0,disabled:group.disabled});_ref=
group.childNodes;_results=[];for(_i=0,_len=_ref.length;_i<_len;_i++){option=_ref[_i];_results.push(this.add_option(option,group_position,group.disabled))}return _results};SelectParser.prototype.add_option=function(option,group_position,group_disabled){if(option.nodeName==="OPTION"){if(option.text!==""){if(group_position!=null)this.parsed[group_position].children+=1;this.parsed.push({array_index:this.parsed.length,options_index:this.options_index,value:option.value,text:option.text,html:option.innerHTML,
selected:option.selected,disabled:group_disabled===true?group_disabled:option.disabled,group_array_index:group_position,classes:option.className,style:option.style.cssText})}else this.parsed.push({array_index:this.parsed.length,options_index:this.options_index,empty:true});return this.options_index+=1}};return SelectParser}();SelectParser.select_to_array=function(select){var child,parser,_i,_len,_ref;parser=new SelectParser;_ref=select.childNodes;for(_i=0,_len=_ref.length;_i<_len;_i++){child=_ref[_i];
parser.add_node(child)}return parser.parsed};this.SelectParser=SelectParser}).call(this);
(function(){var AbstractChosen,root;root=this;AbstractChosen=function(){function AbstractChosen(form_field,options){this.form_field=form_field;this.options=options!=null?options:{};this.set_default_values();this.is_multiple=this.form_field.multiple;this.set_default_text();this.setup();this.set_up_html();this.register_observers();this.finish_setup()}AbstractChosen.prototype.set_default_values=function(){var _this=this;this.click_test_action=function(evt){return _this.test_active_click(evt)};this.activate_action=
function(evt){return _this.activate_field(evt)};this.active_field=false;this.mouse_on_container=false;this.results_showing=false;this.result_highlighted=null;this.result_single_selected=null;this.allow_single_deselect=this.options.allow_single_deselect!=null&&this.form_field.options[0]!=null&&this.form_field.options[0].text===""?this.options.allow_single_deselect:false;this.disable_search_threshold=this.options.disable_search_threshold||0;this.search_contains=this.options.search_contains||false;this.choices=
0;this.single_backstroke_delete=this.options.single_backstroke_delete||false;return this.max_selected_options=this.options.max_selected_options||Infinity};AbstractChosen.prototype.set_default_text=function(){if(this.form_field.getAttribute("data-placeholder"))this.default_text=this.form_field.getAttribute("data-placeholder");else if(this.is_multiple)this.default_text=this.options.placeholder_text_multiple||this.options.placeholder_text||"Select Some Options";else this.default_text=this.options.placeholder_text_single||
this.options.placeholder_text||"Select an Option";return this.results_none_found=this.form_field.getAttribute("data-no_results_text")||this.options.no_results_text||"No results match"};AbstractChosen.prototype.mouse_enter=function(){return this.mouse_on_container=true};AbstractChosen.prototype.mouse_leave=function(){return this.mouse_on_container=false};AbstractChosen.prototype.input_focus=function(evt){var _this=this;if(!this.active_field)return setTimeout(function(){return _this.container_mousedown()},
50)};AbstractChosen.prototype.input_blur=function(evt){var _this=this;if(!this.mouse_on_container){this.active_field=false;return setTimeout(function(){return _this.blur_test()},100)}};AbstractChosen.prototype.result_add_option=function(option){var classes,style;if(!option.disabled){option.dom_id=this.container_id+"_o_"+option.array_index;classes=option.selected&&this.is_multiple?[]:["active-result"];if(option.selected)classes.push("result-selected");if(option.group_array_index!=null)classes.push("group-option");
if(option.classes!=="")classes.push(option.classes);style=option.style.cssText!==""?' style="'+option.style+'"':"";return'<li id="'+option.dom_id+'" class="'+classes.join(" ")+'"'+style+">"+option.html+"</li>"}else return""};AbstractChosen.prototype.results_update_field=function(){if(!this.is_multiple)this.results_reset_cleanup();this.result_clear_highlight();this.result_single_selected=null;return this.results_build()};AbstractChosen.prototype.results_toggle=function(){if(this.results_showing)return this.results_hide();
else return this.results_show()};AbstractChosen.prototype.results_search=function(evt){if(this.results_showing)return this.winnow_results();else return this.results_show()};AbstractChosen.prototype.keyup_checker=function(evt){var stroke,_ref;stroke=(_ref=evt.which)!=null?_ref:evt.keyCode;this.search_field_scale();switch(stroke){case 8:if(this.is_multiple&&this.backstroke_length<1&&this.choices>0)return this.keydown_backstroke();else if(!this.pending_backstroke){this.result_clear_highlight();return this.results_search()}break;
case 13:evt.preventDefault();if(this.results_showing)return this.result_select(evt);break;case 27:if(this.results_showing)this.results_hide();return true;case 9:case 38:case 40:case 16:case 91:case 17:break;default:return this.results_search()}};AbstractChosen.prototype.generate_field_id=function(){var new_id;new_id=this.generate_random_id();this.form_field.id=new_id;return new_id};AbstractChosen.prototype.generate_random_char=function(){var chars,newchar,rand;chars="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ";
rand=Math.floor(Math.random()*chars.length);return newchar=chars.substring(rand,rand+1)};return AbstractChosen}();root.AbstractChosen=AbstractChosen}).call(this);
(function(){var $,Chosen,get_side_border_padding,root,__hasProp=Object.prototype.hasOwnProperty,__extends=function(child,parent){for(var key in parent)if(__hasProp.call(parent,key))child[key]=parent[key];function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child};root=this;$=jQuery;$.fn.extend({chosen:function(options){if($.browser.msie&&($.browser.version==="6.0"||$.browser.version==="7.0"))return this;return this.each(function(input_field){var $this;
$this=$(this);if(!$this.hasClass("chzn-done"))return $this.data("chosen",new Chosen(this,options))})}});Chosen=function(_super){__extends(Chosen,_super);function Chosen(){Chosen.__super__.constructor.apply(this,arguments)}Chosen.prototype.setup=function(){this.form_field_jq=$(this.form_field);this.current_value=this.form_field_jq.val();return this.is_rtl=this.form_field_jq.hasClass("chzn-rtl")};Chosen.prototype.finish_setup=function(){return this.form_field_jq.addClass("chzn-done")};Chosen.prototype.set_up_html=
function(){var container_div,dd_top,dd_width,sf_width;this.container_id=this.form_field.id.length?this.form_field.id.replace(/[^\w]/g,"_"):this.generate_field_id();this.container_id+="_chzn";this.f_width=this.form_field_jq.outerWidth();container_div=$("<div />",{id:this.container_id,"class":"chzn-container"+(this.is_rtl?" chzn-rtl":""),style:"width: "+this.f_width+"px;"});if(this.is_multiple)container_div.html('<ul class="chzn-choices"><li class="search-field"><input type="text" value="'+this.default_text+
'" class="default" autocomplete="off" style="width:25px;" /></li></ul><div class="chzn-drop" style="left:-9000px;"><ul class="chzn-results"></ul></div>');else container_div.html('<a href="javascript:void(0)" class="chzn-single chzn-default"><span>'+this.default_text+'</span><div><b></b></div></a><div class="chzn-drop" style="left:-9000px;"><div class="chzn-search"><input type="text" autocomplete="off" /></div><ul class="chzn-results"></ul></div>');this.form_field_jq.hide().after(container_div);this.container=
$("#"+this.container_id);this.container.addClass("chzn-container-"+(this.is_multiple?"multi":"single"));this.dropdown=this.container.find("div.chzn-drop").first();dd_top=this.container.height();dd_width=this.f_width-get_side_border_padding(this.dropdown);this.dropdown.css({"width":dd_width+"px","top":dd_top+"px"});this.search_field=this.container.find("input").first();this.search_results=this.container.find("ul.chzn-results").first();this.search_field_scale();this.search_no_results=this.container.find("li.no-results").first();
if(this.is_multiple){this.search_choices=this.container.find("ul.chzn-choices").first();this.search_container=this.container.find("li.search-field").first()}else{this.search_container=this.container.find("div.chzn-search").first();this.selected_item=this.container.find(".chzn-single").first();sf_width=dd_width-get_side_border_padding(this.search_container)-get_side_border_padding(this.search_field);this.search_field.css({"width":sf_width+"px"})}this.results_build();this.set_tab_index();return this.form_field_jq.trigger("liszt:ready",
{chosen:this})};Chosen.prototype.register_observers=function(){var _this=this;this.container.mousedown(function(evt){return _this.container_mousedown(evt)});this.container.mouseup(function(evt){return _this.container_mouseup(evt)});this.container.mouseenter(function(evt){return _this.mouse_enter(evt)});this.container.mouseleave(function(evt){return _this.mouse_leave(evt)});this.search_results.mouseup(function(evt){return _this.search_results_mouseup(evt)});this.search_results.mouseover(function(evt){return _this.search_results_mouseover(evt)});
this.search_results.mouseout(function(evt){return _this.search_results_mouseout(evt)});this.form_field_jq.bind("liszt:updated",function(evt){return _this.results_update_field(evt)});this.search_field.blur(function(evt){return _this.input_blur(evt)});this.search_field.keyup(function(evt){return _this.keyup_checker(evt)});this.search_field.keydown(function(evt){return _this.keydown_checker(evt)});if(this.is_multiple){this.search_choices.click(function(evt){return _this.choices_click(evt)});return this.search_field.focus(function(evt){return _this.input_focus(evt)})}else return this.container.click(function(evt){return evt.preventDefault()})};
Chosen.prototype.search_field_disabled=function(){this.is_disabled=this.form_field_jq[0].disabled;if(this.is_disabled){this.container.addClass("chzn-disabled");this.search_field[0].disabled=true;if(!this.is_multiple)this.selected_item.unbind("focus",this.activate_action);return this.close_field()}else{this.container.removeClass("chzn-disabled");this.search_field[0].disabled=false;if(!this.is_multiple)return this.selected_item.bind("focus",this.activate_action)}};Chosen.prototype.container_mousedown=
function(evt){var target_closelink;if(!this.is_disabled){target_closelink=evt!=null?$(evt.target).hasClass("search-choice-close"):false;if(evt&&evt.type==="mousedown"&&!this.results_showing)evt.stopPropagation();if(!this.pending_destroy_click&&!target_closelink){if(!this.active_field){if(this.is_multiple)this.search_field.val("");$(document).click(this.click_test_action);this.results_show()}else if(!this.is_multiple&&evt&&($(evt.target)[0]===this.selected_item[0]||$(evt.target).parents("a.chzn-single").length)){evt.preventDefault();
this.results_toggle()}return this.activate_field()}else return this.pending_destroy_click=false}};Chosen.prototype.container_mouseup=function(evt){if(evt.target.nodeName==="ABBR"&&!this.is_disabled)return this.results_reset(evt)};Chosen.prototype.blur_test=function(evt){if(!this.active_field&&this.container.hasClass("chzn-container-active"))return this.close_field()};Chosen.prototype.close_field=function(){$(document).unbind("click",this.click_test_action);if(!this.is_multiple){this.selected_item.attr("tabindex",
this.search_field.attr("tabindex"));this.search_field.attr("tabindex",-1)}this.active_field=false;this.results_hide();this.container.removeClass("chzn-container-active");this.winnow_results_clear();this.clear_backstroke();this.show_search_field_default();return this.search_field_scale()};Chosen.prototype.activate_field=function(){if(!this.is_multiple&&!this.active_field){this.search_field.attr("tabindex",this.selected_item.attr("tabindex"));this.selected_item.attr("tabindex",-1)}this.container.addClass("chzn-container-active");
this.active_field=true;this.search_field.val(this.search_field.val());return this.search_field.focus()};Chosen.prototype.test_active_click=function(evt){if($(evt.target).parents("#"+this.container_id).length)return this.active_field=true;else return this.close_field()};Chosen.prototype.results_build=function(){var content,data,_i,_len,_ref;this.parsing=true;this.results_data=root.SelectParser.select_to_array(this.form_field);if(this.is_multiple&&this.choices>0){this.search_choices.find("li.search-choice").remove();
this.choices=0}else if(!this.is_multiple){this.selected_item.addClass("chzn-default").find("span").text(this.default_text);if(this.form_field.options.length<=this.disable_search_threshold)this.container.addClass("chzn-container-single-nosearch");else this.container.removeClass("chzn-container-single-nosearch")}content="";_ref=this.results_data;for(_i=0,_len=_ref.length;_i<_len;_i++){data=_ref[_i];if(data.group)content+=this.result_add_group(data);else if(!data.empty){content+=this.result_add_option(data);
if(data.selected&&this.is_multiple)this.choice_build(data);else if(data.selected&&!this.is_multiple){this.selected_item.removeClass("chzn-default").find("span").text(data.text);if(this.allow_single_deselect)this.single_deselect_control_build()}}}this.search_field_disabled();this.show_search_field_default();this.search_field_scale();this.search_results.html(content);return this.parsing=false};Chosen.prototype.result_add_group=function(group){if(!group.disabled){group.dom_id=this.container_id+"_g_"+
group.array_index;return'<li id="'+group.dom_id+'" class="group-result">'+$("<div />").text(group.label).html()+"</li>"}else return""};Chosen.prototype.result_do_highlight=function(el){var high_bottom,high_top,maxHeight,visible_bottom,visible_top;if(el.length){this.result_clear_highlight();this.result_highlight=el;this.result_highlight.addClass("highlighted");maxHeight=parseInt(this.search_results.css("maxHeight"),10);visible_top=this.search_results.scrollTop();visible_bottom=maxHeight+visible_top;
high_top=this.result_highlight.position().top+this.search_results.scrollTop();high_bottom=high_top+this.result_highlight.outerHeight();if(high_bottom>=visible_bottom)return this.search_results.scrollTop(high_bottom-maxHeight>0?high_bottom-maxHeight:0);else if(high_top<visible_top)return this.search_results.scrollTop(high_top)}};Chosen.prototype.result_clear_highlight=function(){if(this.result_highlight)this.result_highlight.removeClass("highlighted");return this.result_highlight=null};Chosen.prototype.results_show=
function(){var dd_top;if(!this.is_multiple){this.selected_item.addClass("chzn-single-with-drop");if(this.result_single_selected)this.result_do_highlight(this.result_single_selected)}else if(this.max_selected_options<=this.choices){this.form_field_jq.trigger("liszt:maxselected",{chosen:this});return false}dd_top=this.is_multiple?this.container.height():this.container.height()-1;this.form_field_jq.trigger("liszt:showing_dropdown",{chosen:this});this.dropdown.css({"top":dd_top+"px","left":0});this.results_showing=
true;this.search_field.focus();this.search_field.val(this.search_field.val());return this.winnow_results()};Chosen.prototype.results_hide=function(){if(!this.is_multiple)this.selected_item.removeClass("chzn-single-with-drop");this.result_clear_highlight();this.form_field_jq.trigger("liszt:hiding_dropdown",{chosen:this});this.dropdown.css({"left":"-9000px"});return this.results_showing=false};Chosen.prototype.set_tab_index=function(el){var ti;if(this.form_field_jq.attr("tabindex")){ti=this.form_field_jq.attr("tabindex");
this.form_field_jq.attr("tabindex",-1);if(this.is_multiple)return this.search_field.attr("tabindex",ti);else{this.selected_item.attr("tabindex",ti);return this.search_field.attr("tabindex",-1)}}};Chosen.prototype.show_search_field_default=function(){if(this.is_multiple&&this.choices<1&&!this.active_field){this.search_field.val(this.default_text);return this.search_field.addClass("default")}else{this.search_field.val("");return this.search_field.removeClass("default")}};Chosen.prototype.search_results_mouseup=
function(evt){var target;target=$(evt.target).hasClass("active-result")?$(evt.target):$(evt.target).parents(".active-result").first();if(target.length){this.result_highlight=target;return this.result_select(evt)}};Chosen.prototype.search_results_mouseover=function(evt){var target;target=$(evt.target).hasClass("active-result")?$(evt.target):$(evt.target).parents(".active-result").first();if(target)return this.result_do_highlight(target)};Chosen.prototype.search_results_mouseout=function(evt){if($(evt.target).hasClass("active-result"||
$(evt.target).parents(".active-result").first()))return this.result_clear_highlight()};Chosen.prototype.choices_click=function(evt){evt.preventDefault();if(this.active_field&&!$(evt.target).hasClass("search-choice"||$(evt.target).parents(".search-choice").first)&&!this.results_showing)return this.results_show()};Chosen.prototype.choice_build=function(item){var choice_id,link,_this=this;if(this.is_multiple&&this.max_selected_options<=this.choices){this.form_field_jq.trigger("liszt:maxselected",{chosen:this});
return false}choice_id=this.container_id+"_c_"+item.array_index;this.choices+=1;this.search_container.before('<li class="search-choice" id="'+choice_id+'"><span>'+item.html+'</span><a href="javascript:void(0)" class="search-choice-close" rel="'+item.array_index+'"></a></li>');link=$("#"+choice_id).find("a").first();return link.click(function(evt){return _this.choice_destroy_link_click(evt)})};Chosen.prototype.choice_destroy_link_click=function(evt){evt.preventDefault();if(!this.is_disabled){this.pending_destroy_click=
true;return this.choice_destroy($(evt.target))}else return evt.stopPropagation};Chosen.prototype.choice_destroy=function(link){this.choices-=1;this.show_search_field_default();if(this.is_multiple&&this.choices>0&&this.search_field.val().length<1)this.results_hide();this.result_deselect(link.attr("rel"));return link.parents("li").first().remove()};Chosen.prototype.results_reset=function(){this.form_field.options[0].selected=true;this.selected_item.find("span").text(this.default_text);if(!this.is_multiple)this.selected_item.addClass("chzn-default");
this.show_search_field_default();this.results_reset_cleanup();this.form_field_jq.trigger("change");if(this.active_field)return this.results_hide()};Chosen.prototype.results_reset_cleanup=function(){return this.selected_item.find("abbr").remove()};Chosen.prototype.result_select=function(evt){var high,high_id,item,position;if(this.result_highlight){high=this.result_highlight;high_id=high.attr("id");this.result_clear_highlight();if(this.is_multiple)this.result_deactivate(high);else{this.search_results.find(".result-selected").removeClass("result-selected");
this.result_single_selected=high;this.selected_item.removeClass("chzn-default")}high.addClass("result-selected");position=high_id.substr(high_id.lastIndexOf("_")+1);item=this.results_data[position];item.selected=true;this.form_field.options[item.options_index].selected=true;if(this.is_multiple)this.choice_build(item);else{this.selected_item.find("span").first().text(item.text);if(this.allow_single_deselect)this.single_deselect_control_build()}if(!(evt.metaKey&&this.is_multiple))this.results_hide();
this.search_field.val("");if(this.is_multiple||this.form_field_jq.val()!==this.current_value)this.form_field_jq.trigger("change",{"selected":this.form_field.options[item.options_index].value});this.current_value=this.form_field_jq.val();return this.search_field_scale()}};Chosen.prototype.result_activate=function(el){return el.addClass("active-result")};Chosen.prototype.result_deactivate=function(el){return el.removeClass("active-result")};Chosen.prototype.result_deselect=function(pos){var result,
result_data;result_data=this.results_data[pos];result_data.selected=false;this.form_field.options[result_data.options_index].selected=false;result=$("#"+this.container_id+"_o_"+pos);result.removeClass("result-selected").addClass("active-result").show();this.result_clear_highlight();this.winnow_results();this.form_field_jq.trigger("change",{deselected:this.form_field.options[result_data.options_index].value});return this.search_field_scale()};Chosen.prototype.single_deselect_control_build=function(){if(this.allow_single_deselect&&
this.selected_item.find("abbr").length<1)return this.selected_item.find("span").first().after('<abbr class="search-choice-close"></abbr>')};Chosen.prototype.winnow_results=function(){var found,option,part,parts,regex,regexAnchor,result,result_id,results,searchText,startpos,text,zregex,_i,_j,_len,_len2,_ref;this.no_results_clear();results=0;searchText=this.search_field.val()===this.default_text?"":$("<div/>").text($.trim(this.search_field.val())).html();regexAnchor=this.search_contains?"":"^";regex=
new RegExp(regexAnchor+searchText.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"),"i");zregex=new RegExp(searchText.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"),"i");_ref=this.results_data;for(_i=0,_len=_ref.length;_i<_len;_i++){option=_ref[_i];if(!option.disabled&&!option.empty)if(option.group)$("#"+option.dom_id).css("display","none");else if(!(this.is_multiple&&option.selected)){found=false;result_id=option.dom_id;result=$("#"+result_id);if(regex.test(option.html)){found=true;results+=1}else if(option.html.indexOf(" ")>=
0||option.html.indexOf("[")===0){parts=option.html.replace(/\[|\]/g,"").split(" ");if(parts.length)for(_j=0,_len2=parts.length;_j<_len2;_j++){part=parts[_j];if(regex.test(part)){found=true;results+=1}}}if(found){if(searchText.length){startpos=option.html.search(zregex);text=option.html.substr(0,startpos+searchText.length)+"</em>"+option.html.substr(startpos+searchText.length);text=text.substr(0,startpos)+"<em>"+text.substr(startpos)}else text=option.html;result.html(text);this.result_activate(result);
if(option.group_array_index!=null)$("#"+this.results_data[option.group_array_index].dom_id).css("display","list-item")}else{if(this.result_highlight&&result_id===this.result_highlight.attr("id"))this.result_clear_highlight();this.result_deactivate(result)}}}if(results<1&&searchText.length)return this.no_results(searchText);else return this.winnow_results_set_highlight()};Chosen.prototype.winnow_results_clear=function(){var li,lis,_i,_len,_results;this.search_field.val("");lis=this.search_results.find("li");
_results=[];for(_i=0,_len=lis.length;_i<_len;_i++){li=lis[_i];li=$(li);if(li.hasClass("group-result"))_results.push(li.css("display","auto"));else if(!this.is_multiple||!li.hasClass("result-selected"))_results.push(this.result_activate(li));else _results.push(void 0)}return _results};Chosen.prototype.winnow_results_set_highlight=function(){var do_high,selected_results;if(!this.result_highlight){selected_results=!this.is_multiple?this.search_results.find(".result-selected.active-result"):[];do_high=
selected_results.length?selected_results.first():this.search_results.find(".active-result").first();if(do_high!=null)return this.result_do_highlight(do_high)}};Chosen.prototype.no_results=function(terms){var no_results_html;no_results_html=$('<li class="no-results">'+this.results_none_found+' "<span></span>"</li>');no_results_html.find("span").first().html(terms);return this.search_results.append(no_results_html)};Chosen.prototype.no_results_clear=function(){return this.search_results.find(".no-results").remove()};
Chosen.prototype.keydown_arrow=function(){var first_active,next_sib;if(!this.result_highlight){first_active=this.search_results.find("li.active-result").first();if(first_active)this.result_do_highlight($(first_active))}else if(this.results_showing){next_sib=this.result_highlight.nextAll("li.active-result").first();if(next_sib)this.result_do_highlight(next_sib)}if(!this.results_showing)return this.results_show()};Chosen.prototype.keyup_arrow=function(){var prev_sibs;if(!this.results_showing&&!this.is_multiple)return this.results_show();
else if(this.result_highlight){prev_sibs=this.result_highlight.prevAll("li.active-result");if(prev_sibs.length)return this.result_do_highlight(prev_sibs.first());else{if(this.choices>0)this.results_hide();return this.result_clear_highlight()}}};Chosen.prototype.keydown_backstroke=function(){if(this.pending_backstroke){this.choice_destroy(this.pending_backstroke.find("a").first());return this.clear_backstroke()}else{this.pending_backstroke=this.search_container.siblings("li.search-choice").last();
if(this.single_backstroke_delete)return this.keydown_backstroke();else return this.pending_backstroke.addClass("search-choice-focus")}};Chosen.prototype.clear_backstroke=function(){if(this.pending_backstroke)this.pending_backstroke.removeClass("search-choice-focus");return this.pending_backstroke=null};Chosen.prototype.keydown_checker=function(evt){var stroke,_ref;stroke=(_ref=evt.which)!=null?_ref:evt.keyCode;this.search_field_scale();if(stroke!==8&&this.pending_backstroke)this.clear_backstroke();
switch(stroke){case 8:this.backstroke_length=this.search_field.val().length;break;case 9:if(this.results_showing&&!this.is_multiple)this.result_select(evt);this.mouse_on_container=false;break;case 13:evt.preventDefault();break;case 38:evt.preventDefault();this.keyup_arrow();break;case 40:this.keydown_arrow();break}};Chosen.prototype.search_field_scale=function(){var dd_top,div,h,style,style_block,styles,w,_i,_len;if(this.is_multiple){h=0;w=0;style_block="position:absolute; left: -1000px; top: -1000px; display:none;";
styles=["font-size","font-style","font-weight","font-family","line-height","text-transform","letter-spacing"];for(_i=0,_len=styles.length;_i<_len;_i++){style=styles[_i];style_block+=style+":"+this.search_field.css(style)+";"}div=$("<div />",{"style":style_block});div.text(this.search_field.val());$("body").append(div);w=div.width()+25;div.remove();if(w>this.f_width-10)w=this.f_width-10;this.search_field.css({"width":w+"px"});dd_top=this.container.height();return this.dropdown.css({"top":dd_top+"px"})}};
Chosen.prototype.generate_random_id=function(){var string;string="sel"+this.generate_random_char()+this.generate_random_char()+this.generate_random_char();while($("#"+string).length>0)string+=this.generate_random_char();return string};return Chosen}(AbstractChosen);get_side_border_padding=function(elmt){var side_border_padding;return side_border_padding=elmt.outerWidth()-elmt.width()};root.get_side_border_padding=get_side_border_padding}).call(this);
(function($){Desk=window.Desk||{};$(document).on("click",".advanced-search-form-wrapper .a-remove-button-box",function(){Desk.AdvancedSearch.removeFilter(this)});$(document).on("change",".a-advanced-search-form .search-by-section select",function(){Desk.AdvancedSearch.addFilter($(this).val())});$(document).on("change","#a-advanced-search-form .date-search-operators",function(){Desk.AdvancedSearch.showOrHideDateOperators($(this).val(),$(this).parent().parent())});$(document).on("change","select.filter-select",
function(){Desk.AdvancedSearch.resetFilterOperators($(this))});$(document).on("keyup","#a-advanced-search-form input, #a-advanced-search-form select",function(e){if(e.which==13){e.preventDefault();Desk.AdvancedSearch.performSearch()}});$(document).on("change",".date-search-operators",function(){Desk.AdvancedSearch.resetFilterOperators($(this))});$(document).on("focus",".fancy-search-form #search_q",function(){$(this).width(Desk.AdvancedSearch.setSearchFieldWidth())});$(document).on("resize",".fancy-search-form #search_q",
function(){$(this).width(Desk.AdvancedSearch.setSearchFieldWidth())});Desk.AdvancedSearch={settings:{"parentElem":".a-advanced-search-form","searchObjectType":null},searchObjects:{caseSearchObj:{"caseid":{"name":"Case ID","type":"textFields","dataType":"number"},"casesubject":{"name":"Subject","type":"textFields","dataType":"text"},"casedesc":{"name":"Description","type":"textFields","dataType":"text"},"messages":{"name":"Message Count","type":"textFields","dataType":"number"},"note":{"name":"Note",
"type":"textFields","dataType":"text"},"attachment":{"name":"Attachment","type":"textFields","dataType":"text"},"created":{"name":"Date Created","type":"dateRangeFields","dataType":"text"},"updated":{"name":"Date Updated","type":"dateRangeFields","dataType":"text","dataType":"text"},"group":{"name":"Group","vals":"","type":"labelFields","dataType":"text"},"priority":{"name":"Priority","vals":"","type":"labelFields","dataType":"text"},"labelsAll":{"name":"Labels (all)","vals":"","type":"labelFields",
"dataType":"text"},"labelsAny":{"name":"Labels (any)","vals":"","type":"labelFields","dataType":"text"},"status":{"name":"Status","vals":"","type":"labelFields","dataType":"text"},"assigned":{"name":"Assigned","vals":"","type":"labelFields","dataType":"text"},"channel":{"name":"Channel","vals":"","type":"labelFields","dataType":"text"}},customerSearchObj:{"customer":{"name":"Full Name","type":"textFields","dataType":"text"},"firstname":{"name":"First Name","type":"textFields","dataType":"text"},"lastname":{"name":"Last Name",
"type":"textFields","dataType":"text"},"email":{"name":"Email","type":"textFields","dataType":"email"},"phone":{"name":"Phone","type":"textFields","dataType":"text"},"company":{"name":"Company","type":"textFields","dataType":"text"}},companySearchObj:{"company":{"name":"Company Name","type":"textFields","dataType":"text"}}},init:function(caseLabelItems,textCustomFields){if(typeof caseLabelItems=="object")$.extend(true,Desk.AdvancedSearch.searchObjects.caseSearchObj,caseLabelItems);if(textCustomFields&&
typeof textCustomFields==="string"){var validCustomFields=function(){try{JSON.parse(textCustomFields)}catch(e){return false}return JSON.parse(textCustomFields)}();if(validCustomFields)$.extend(true,Desk.AdvancedSearch.searchObjects,validCustomFields)}Desk.AdvancedSearch.buildFilterSelect();$(".a-advanced-seach-toggle").on("click",function(){Desk.AdvancedSearch.toggleForm()});$(".a-advanced-search-form .search-by-section select").chosen();$("#search_search_object_type_id").on("change",function(){Desk.AdvancedSearch.resetForm()});
$(".a-advanced-search-form .cancel-form").on("click",function(){Desk.AdvancedSearch.cancelForm()});$("#agent_advanced_search_results_save_search").on("click",function(e){e.preventDefault();Desk.AdvancedSearch.saveSearch()});$(".a-advanced-search-form .adv_search_submit").on("click",function(e){e.preventDefault();Desk.AdvancedSearch.performSearch()})},esEscape:function(value){value=value.trim().replace(/\s{2,}/g," ");value=value.replace(/[\<\>\=\~\+\-\!\[\]\/\{\}\*\:\?\"\\\^\$\|]/g,"\\$&");value=value.replace(/[\(\)]/g,
"");return value},regexEscape:function(value){return value.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")},defineSearchObject:function(){var searchObjType=$("#search_search_object_type_id").val();if(searchObjType=="100")return Desk.AdvancedSearch.searchObjects.caseSearchObj;else if(searchObjType=="200")return Desk.AdvancedSearch.searchObjects.customerSearchObj;else return Desk.AdvancedSearch.searchObjects.companySearchObj},sortFilterItems:function(){var opts=[];$.each(Desk.AdvancedSearch.settings.searchObjectType,
function(key,val){opts.push(val.name+"|"+key)});return opts.sort()},buildFilterSelect:function(){$(".a-advanced-search-form optgroup.filter-option-group").remove();Desk.AdvancedSearch.settings.searchObjectType=Desk.AdvancedSearch.defineSearchObject();var opts_sorted=Desk.AdvancedSearch.sortFilterItems();var opts=[];for(var i=0;i<opts_sorted.length;i++){var tempOptSplit=opts_sorted[i].split("|");opts.push('<option value="'+Desk.AdvancedSearch.settings.searchObjectType[tempOptSplit[1]]["type"]+":"+
tempOptSplit[1]+'">'+tempOptSplit[0]+"</option>")}$(".a-advanced-search-form .search-by-section select").html("<option></option>"+opts.join("")).trigger("liszt:updated")},addFilter:function(filterName,operatorName,searchFilterVal,populateFields,skipDupeTest){if(filterName=="Search By"||filterName==""||typeof filterName=="undefined")return;var filterNameArray=filterName.split(":");var selectedGroup=filterNameArray[0];var selectedVal=filterNameArray[1];var skipDupeTest=skipDupeTest||false;if(typeof Desk.AdvancedSearch.settings.searchObjectType[selectedVal]==
"undefined")return;var objHTMLContent="";var opts=[];var operatorName=operatorName||"";var searchFilterVal=searchFilterVal||"";var populateFields=populateFields||false;if(Desk.AdvancedSearch.duplicateFilter(selectedVal)&&selectedVal.indexOf("custom")==-1&&skipDupeTest==false){notify("The "+Desk.AdvancedSearch.settings.searchObjectType[selectedVal]["name"]+" "+I18n.translate("agent.advanced_search.duplicate_filter"),true,2500);return}if(selectedVal=="labelsAll"&&$("input:hidden[value='labelsAll']").length>
0){Desk.AdvancedSearch.appendFieldValues(selectedGroup,operatorName,searchFilterVal,"labelsAll");$(".a-advanced-search-form .search-by-section select").val("").trigger("liszt:updated");return}objHTMLContent+="<span class='search-form-label advanced-search-select'>"+Desk.AdvancedSearch.settings.searchObjectType[selectedVal]["name"]+"<input type='hidden' value='"+selectedVal+"'/></span>";var searchOperators=Desk.AdvancedSearch.searchOperators(Desk.AdvancedSearch.settings.searchObjectType[selectedVal]["type"],
selectedVal,operatorName,searchFilterVal);var filterContent="<div class='a-advanced-search-section advanced-form-row a-filter-row "+selectedGroup+"-filter-row "+Desk.AdvancedSearch.settings.searchObjectType[selectedVal]["search_type"]+"'>"+objHTMLContent+searchOperators+"<span class='a-remove-button-box'></span></div>";$(".a-advanced-search-form .search-by-section").before(filterContent);if(selectedGroup=="labelFields")$(".a-advanced-search-form select.label-operator").chosen();if(populateFields)Desk.AdvancedSearch.appendFieldValues(selectedGroup,
operatorName,searchFilterVal);$(".a-advanced-search-form .search-by-section select").val("").trigger("liszt:updated")},duplicateFilter:function(selectedVal){return $("#a-advanced-search-form input:hidden[value='"+selectedVal+"']").length},removeFilter:function(elem){$(elem).parents(".a-advanced-search-section").remove()},searchOperators:function(filterObj,filterName,operatorName,searchFilterVal){if(typeof filterObj=="undefined")return;var searchOperatorData="";if(filterObj=="textFields")searchOperatorData=
Desk.AdvancedSearch.renderTextOperators(filterName,operatorName,searchFilterVal);else if(filterObj=="labelFields")searchOperatorData="<span class='a-select advanced-search-select label-operator-select'><select class='label-operator chzn-select search-operator' data-placeholder='Choose "+Desk.AdvancedSearch.settings.searchObjectType[filterName]["name"]+"' placeholder='Choose "+Desk.AdvancedSearch.settings.searchObjectType[filterName]["name"]+"' multiple>"+Desk.AdvancedSearch.renderLabelOperators(filterName)+
"</select></span>";else{var last_hour=filterName.match(/^custom_/)?"":"<option>Last Hour</option>";searchOperatorData="<span class='a-select advanced-search-select a-select-small'><select class='date-search-operators search-operator'>"+last_hour+"<option>Today</option><option>This Week</option><option>This Month</option><option>This Year</option><option>This Date</option><option>After</option><option>Before</option><option>Between</option></select></span><input type='text' class='advFormDatePicker hidden datePickerA search-operator'/><span class='additional-text hidden'>and</span><input type='text' class='advFormDatePicker hidden datePickerB search-operator'/></span>"}return searchOperatorData},
renderLabelOperators:function(filterName){if(typeof filterName=="undefined"||typeof filterName!="string")return;var opts=filterName=="group"||filterName=="assigned"?['<option value="NONE">(none)</option>']:[];var arrayVals=Desk.AdvancedSearch.settings.searchObjectType[filterName].vals;for(var i=0;i<arrayVals.length;i++)opts.push('<option value="'+arrayVals[i]+'">'+arrayVals[i].toString().replace(/_/g," ")+"</option>");return opts.join("")},renderTextOperators:function(filterName,operatorName,searchFilterVal){var searchFilterVal=
searchFilterVal||"";if(filterName=="custom"){var opts=[];var customTextVals=Desk.AdvancedSearch.settings.searchObjectType[filterName].vals;var customOperatorVal="<span class='text-search-operator-container'><span class='a-select advanced-search-select a-select-small'><select class='search-operator'>";for(var i=0;i<customTextVals.length;i++)opts.push('<option value="'+customTextVals[i]+'">'+customTextVals[i]+"</option>");customOperatorVal+=opts.join("")+"</select></span><input type='text' class='med-form-search-field search-operator' name='"+
filterName+"-filter'/></span>";return customOperatorVal}else if(Desk.AdvancedSearch.settings.searchObjectType[filterName]["dataType"]=="text")var customOperatorVal="<span class='text-search-operator-container'><span class='a-select advanced-search-select a-select-small'><select class='search-operator'><option val='is'>is</option><option val='contains'>contains</option></select></span><input type='text' value='"+searchFilterVal+"' class='med-form-search-field search-operator' name='"+filterName+"-filter'/></span>";
else var customOperatorVal="<span class='text-search-operator-container'><input type='text' value='"+searchFilterVal+"' class='med-form-search-field search-operator' name='"+filterName+"-filter'/></span>";return customOperatorVal},showOrHideDateOperators:function(selectedVal,parentElem){if(typeof selectedVal=="undefined"||typeof parentElem=="undefined")return;if(selectedVal==="After"||selectedVal==="Before"||selectedVal=="This Date"){parentElem.children(".datePickerA").removeClass("hidden");parentElem.children(".datePickerB, .additional-text").addClass("hidden");
$(".advFormDatePicker").datepicker()}else if(selectedVal==="Between"){parentElem.children(".datePickerA, .datePickerB, .additional-text").removeClass("hidden");Desk.AdvancedSearch.resetDatePicker(parentElem)}else parentElem.children(".datePickerA, .datePickerB, .additional-text").addClass("hidden")},resetDatePicker:function(parentElem){parentElem.children(".datePickerA, .datePickerB").datepicker({onClose:function(date,inst){var lowDate=parentElem.children(".datePickerA").datepicker("getDate");var highDate=
parentElem.children(".datePickerB").datepicker("getDate");if(lowDate!=null&&highDate!=null)if(lowDate>highDate){notify(I18n.translate("agent.advanced_search.invalid_date_range"),true,2500);$("#"+inst.id).val("")}}})},resetFilterOperators:function(elem){if(typeof elem=="undefined")return;if(elem.hasClass("labelFields"))elem.parents(".advanced-form-row").find("select.label-operator").html(Desk.AdvancedSearch.renderLabelOperators(elem.val())).trigger("liszt:updated");else if(elem.hasClass("textFields"))elem.parents(".advanced-form-row").find(".text-search-operator-container").replaceWith(Desk.AdvancedSearch.renderTextOperators(elem.val()));
else{var parentDiv=elem.parents(".advanced-form-row");parentDiv.find("input.search-operator").val("")}},clearFilters:function(){$(".a-advanced-search-form .a-filter-row").remove()},clearAll:function(){Desk.AdvancedSearch.clearFilters();$(".a-advanced-search-form .static-row input").val("")},resetForm:function(){Desk.AdvancedSearch.clearAll();Desk.AdvancedSearch.buildFilterSelect()},toggleForm:function(){if($("#a-advanced-search-form").is(":visible")){$("#a-advanced-search-form").hide().find(".advanced-form-row input, .advanced-form-row select").prop("disabled",
true);$(".advanced-search-form-wrapper .input_wrapper>:submit").prop("disabled",false)}else{if($("#search_q").val()!=""&&($(".a-advanced-search-form .static-row").val()!=""||$(".a-advanced-search-form .a-filter-row").length<1))Desk.AdvancedSearch.buildFromTextSearch();$("#a-advanced-search-form").show().find(".advanced-form-row input, .advanced-form-row select").prop("disabled",false);$(".advanced-search-form-wrapper .input_wrapper>:submit").prop("disabled",true)}},cancelForm:function(){Desk.AdvancedSearch.resetForm();
Desk.AdvancedSearch.toggleForm()},datePickerToUnixTime:function(node,pickerClass,offsetMinutes){return Math.round(new Date(node.find(pickerClass).datepicker("getDate"))/1E3+offsetMinutes*60)},buildQuery:function(){var advSearchQuery="";var advLuceneQuery=new Array;var typeFilters=$(".textFields-filter-row, .dateRangeFields-filter-row, .labelFields-filter-row");$.each(typeFilters,function(){var self=$(this);var filterName=self.find(".search-form-label input:hidden").val();var searchOpType=self.find(".search-operator").val()||
null;var searchOpVal=$.trim(self.find('input[name$="-filter"]').val());if(self.hasClass("textFields-filter-row"))if(searchOpVal!=""){advSearchQuery+=" ";if(Desk.AdvancedSearch.settings.searchObjectType[filterName]["dataType"]=="text")switch(searchOpType){case "is":advSearchQuery+=filterName+":";advSearchQuery+=searchOpVal.indexOf(" ")>-1?'("'+searchOpVal+'")':'"'+searchOpVal+'"';break;case "contains":advSearchQuery+=" "+filterName+":";advSearchQuery+=searchOpVal.indexOf(" ")>-1?"("+searchOpVal+")":
searchOpVal;break;case null:break;default:advSearchQuery+=" custom_"+searchOpType+":";advSearchQuery+=searchOpVal.indexOf(" ")>-1?"("+searchOpVal+")":searchOpVal;break}else advSearchQuery+=filterName+":"+searchOpVal}if(self.hasClass("dateRangeFields-filter-row")){var currentTime=new Date;var offsetMinutes=self.hasClass("custom-field")?(currentTime.getTimezoneOffset()+Desk.AdvancedSearch.offset_minutes)*-1:0;var currentUnixTime=Math.round(currentTime.getTime()/1E3);advSearchQuery+=" ";switch(searchOpType){case "Last Hour":advSearchQuery+=
filterName+":";advSearchQuery+="last_hour ";break;case "Today":advSearchQuery+=filterName+":";advSearchQuery+="today ";break;case "This Week":advSearchQuery+=filterName+":";advSearchQuery+="week ";break;case "This Month":advSearchQuery+=filterName+":";advSearchQuery+="month ";break;case "This Year":advSearchQuery+=filterName+":";advSearchQuery+="year ";break;case "This Date":var range_string=Math.round(new Date(self.find(".datePickerA").datepicker("getDate").setHours(0,offsetMinutes,0,0))/1E3)+" TO "+
Math.round(new Date(self.find(".datePickerA").datepicker("getDate").setHours(23,59+offsetMinutes,59,999))/1E3);if(self.hasClass("custom-field"))advSearchQuery+=filterName+":("+range_string+") ";else advLuceneQuery.push("ticket_customer."+filterName+"_at:["+range_string+"]");break;case "After":var range_string=Desk.AdvancedSearch.datePickerToUnixTime(self,".datePickerA",offsetMinutes)+" TO "+Math.round((new Date).setYear(currentTime.getFullYear()+100)/1E3);if(self.hasClass("custom-field"))advSearchQuery+=
filterName+":("+range_string+") ";else advLuceneQuery.push("ticket_customer."+filterName+"_at:["+range_string+"]");break;case "Before":var range_string="1 TO "+Desk.AdvancedSearch.datePickerToUnixTime(self,".datePickerA",offsetMinutes);if(self.hasClass("custom-field"))advSearchQuery+=filterName+":("+range_string+") ";else advLuceneQuery.push("ticket_customer."+filterName+"_at:["+range_string+"]");break;case "Between":var range_string=Desk.AdvancedSearch.datePickerToUnixTime(self,".datePickerA",offsetMinutes)+
" TO "+Desk.AdvancedSearch.datePickerToUnixTime(self,".datePickerB",offsetMinutes);if(self.hasClass("custom-field"))advSearchQuery+=filterName+":("+range_string+") ";else advLuceneQuery.push("ticket_customer."+filterName+"_at:["+range_string+"]");break}}if(self.hasClass("labelFields-filter-row")&&searchOpType!=null){if(filterName!="labelsAny"&&filterName!="labelsAll")advSearchQuery+=" "+filterName+":";if(filterName=="labelsAny")advSearchQuery+=" label:";if(filterName=="labelsAll")for(var i=0;i<searchOpType.length;i++)advSearchQuery+=
' label:"'+searchOpType[i]+'"';else{var advSearchQueryValue=searchOpType.join(",");if($.inArray(filterName,["priority","status","channel"])==-1)advSearchQuery+='"'+advSearchQueryValue+'"';else advSearchQuery+=advSearchQueryValue}}});var containsFieldVal=Desk.AdvancedSearch.esEscape($(".a-advanced-search-form input.contains").val());var containsAnyFieldVal=$(".a-advanced-search-form input.contains-any").val();var containsExactFieldVal=$(".a-advanced-search-form input.contains-exact").val();if(containsFieldVal!=
"")advLuceneQuery=advLuceneQuery.concat(containsFieldVal.split(" "));if(containsAnyFieldVal!="")advSearchQuery+=" "+containsAnyFieldVal;if(containsExactFieldVal!="")advLuceneQuery.push('"'+containsExactFieldVal+'"');var advLuceneQueryString="";if(advLuceneQuery.length>0)advLuceneQueryString="("+advLuceneQuery.join(" AND ")+")";return Desk.StringUtils.removeXSSVals(advLuceneQueryString+advSearchQuery)},saveSearch:function(){var elem=$("#agent_advanced_search_results_save_search");var advQuery=Desk.AdvancedSearch.buildQuery().replace("+",
"%2B");if(Desk.AdvancedSearch.testSearchLength(advQuery))$.post(elem.attr("href")+"?search_object_type_id=100&query="+advQuery);else{notify(I18n.translate("agent.advanced_search.long_query"));return false}},performSearch:function(){var builtQuery=Desk.AdvancedSearch.buildQuery();if(Desk.AdvancedSearch.testSearchLength(builtQuery)){$("#search_q").val(builtQuery);$("form.fancy-search-form").submit();Desk.AdvancedSearch.toggleForm()}else notify(I18n.translate("agent.advanced_search.long_query"))},testSearchLength:function(query){if(typeof query==
"undefined")return false;if(query.length>255)return false;else return true},buildFromTextSearch:function(){var allWordsVals="",exactWordsVals="",anyWordsVal="";var textFilterPatt=/(caseid|(^case$)|case_id|display_id|displayid|ticket_id|ticketid|casesubject|casedesc|messages|note|attachment|customer|firstname|lastname|email|phone|company|^name$)/i;var caseIDFilter=/(caseid|(^case$)|case_id|display_id|displayid|ticket_id|ticketid)/i;var dateFilterPatt=/(created|updated)/i;var labelFilterPatt=/(group|priority|label|status|assigned|channel|state|responsible|^agent$)/i;
var customFilterPatt=/custom_/i;var currentSearchQuery=$(".a-search-results-text .results_text_pre").is(":visible")?$.trim($("#interpreted_search_query").text()):"";currentSearchQuery=currentSearchQuery.replace(/\) OR/g,"|OR");currentSearchQuery=currentSearchQuery.replace(/ AND |' OR /g,"|");currentSearchQuery=currentSearchQuery.replace(/ AND/g,"|AND");currentSearchQuery=currentSearchQuery.replace(/ ticket_customer.|\(ticket_customer./g,"|ticket_customer.");var advSearchItems=currentSearchQuery.split(/\|/);
var searchQueryVal=$("#search_q").val();console.log("currentSearchQuery",currentSearchQuery);for(var i=0;i<advSearchItems.length;i++){advSearchItems[i]=advSearchItems[i].replace(/\(|\)|\[|\]/g,"");var filterName="";var operatorName="";var filterSearchVal="";if(advSearchItems[i].indexOf(":")!=-1&&advSearchItems[i].indexOf(" AND ")==-1){var searchTermSplit=advSearchItems[i].split(":");if(customFilterPatt.test(searchTermSplit[0])){filterName="custom";operatorName=searchTermSplit[0].toLowerCase().replace(/\'|\s|custom_/g,
"");filterSearchVal=searchTermSplit[1].replace(/\'|\s/g,"");Desk.AdvancedSearch.addFilter("textFields:"+filterName,operatorName,filterSearchVal,true)}else if(dateFilterPatt.test(searchTermSplit[0])){if(searchTermSplit[1].indexOf(" TO ")!=-1){filterSearchVal=searchTermSplit[1].split(" TO ");operatorName=Number(filterSearchVal[1])-Number(filterSearchVal[0])===3600?"last_hour":"between"}else operatorName=searchTermSplit[1].replace(/\'|\s/g,"");filterName=searchTermSplit[0];if(filterName.indexOf("ticket_customer.")>
-1)filterName=filterName.split(".")[1];filterName=filterName.toLowerCase().replace(/\'|\s|_at/g,"");Desk.AdvancedSearch.addFilter("dateRangeFields:"+filterName,operatorName,filterSearchVal,true)}else if(labelFilterPatt.test(searchTermSplit[0])){searchTermSplit[1].replace(/\"/g,"");searchTermSplit[0]=searchTermSplit[0].toLowerCase().replace(/\'|\s/g,"");filterSearchVal=searchTermSplit[1].indexOf(" OR ")>-1?searchTermSplit[1].split(" OR "):[searchTermSplit[1]];var skipDupeTest=false;if(/label/ig.test(searchTermSplit[0])){filterName=
filterSearchVal.length>1?"labelsAny":"labelsAll";skipDupeTest=true}else if(/assigned|responsible|agent/ig.test(searchTermSplit[0]))filterName="assigned";else if(searchTermSplit[0]=="state")filterName="status";else filterName=searchTermSplit[0];filterSearchVal=searchTermSplit[1].indexOf(" OR ")>-1?searchTermSplit[1].split(" OR "):[searchTermSplit[1]];Desk.AdvancedSearch.addFilter("labelFields:"+filterName,operatorName,filterSearchVal,true,skipDupeTest)}else{var regex=new RegExp(Desk.AdvancedSearch.regexEscape(searchTermSplit[0]),
"gi");var queryTestPos=searchQueryVal.search(regex)+searchTermSplit[0].length;if(searchQueryVal.charAt(queryTestPos+1)=='"'||searchQueryVal.charAt(queryTestPos+2)=='"')operatorName="is";else operatorName="contains";searchTermSplit[0]=searchTermSplit[0].toLowerCase();if(caseIDFilter.test(searchTermSplit[0]))filterName="caseid";else if(searchTermSplit[0]=="name")filterName="customer";else if(searchTermSplit[0]=="subject")filterName="casesubject";else if(searchTermSplit[0]=="threads")filterName="messages";
else filterName=searchTermSplit[0].toLowerCase().replace(/\'|\s/g,"");filterSearchVal=searchTermSplit[1].replace(/\'/g,"");Desk.AdvancedSearch.addFilter("textFields:"+filterName,operatorName,filterSearchVal,true)}}else{var staticFieldVals=advSearchItems[i];if(/^["].*["]$/.test(staticFieldVals))exactWordsVals+=(staticFieldVals+" ").replace(/\"/g,"");else if(staticFieldVals.indexOf("OR ")>-1)anyWordsVal+=staticFieldVals.replace(/(.)?OR /g," ");else allWordsVals+=staticFieldVals+" ";$(".a-advanced-search-form .static-row:first input").val($.trim(allWordsVals));
$(".a-advanced-search-form .static-row:last input").val($.trim(exactWordsVals));$(".a-advanced-search-form .static-row input").eq(1).val($.trim(anyWordsVal))}}},appendFieldValues:function(selectedGroup,operatorName,filterSearchVal,filterName){var filterName=filterName||false;var targetElem=$("."+selectedGroup+"-filter-row:last");if(selectedGroup=="textFields"){targetElem.find("select.search-operator").val(operatorName);targetElem.find("input.search-operator").val(filterSearchVal)}if(selectedGroup==
"dateRangeFields")switch(operatorName){case "between":targetElem.find("select.search-operator").val("Between");targetElem.find("input.datePickerA").removeClass("hidden").datepicker().datepicker("setDate",new Date(Number(filterSearchVal[0])*1E3));targetElem.find("input.datePickerB").removeClass("hidden").datepicker().datepicker("setDate",new Date(Number(filterSearchVal[1])*1E3));break;case "today":targetElem.find("select.search-operator").val("Today");break;case "week":targetElem.find("select.search-operator").val("This Week");
break;case "month":targetElem.find("select.search-operator").val("This Month");break;case "year":targetElem.find("select.search-operator").val("This Year");break;case "last_hour":targetElem.find("select.search-operator").val("Last Hour");break}if(selectedGroup=="labelFields"){if(filterName=="labelsAll"){var labelsAllVals=targetElem.find("select.search-operator").val();labelsAllVals.push(filterSearchVal);filterSearchVal=labelsAllVals}targetElem.find("select.search-operator").val(filterSearchVal).trigger("liszt:updated")}},
setSearchFieldWidth:function(){var outerContainer=$(".advanced-search-form-wrapper .input_wrapper");var dropDownContainer=outerContainer.children(".a-advanced-seach-toggle");var searchTypeContainer=outerContainer.children(".search-type");var searchButtonContainer=outerContainer.find(".a-button");return outerContainer.width()-dropDownContainer.outerWidth(true)-searchTypeContainer.outerWidth(true)-searchButtonContainer.outerWidth(true)-10}}})(jQuery);var hexcase=0;var b64pad="";
function hex_md5(s){return rstr2hex(rstr_md5(str2rstr_utf8(s)))}function b64_md5(s){return rstr2b64(rstr_md5(str2rstr_utf8(s)))}function any_md5(s,e){return rstr2any(rstr_md5(str2rstr_utf8(s)),e)}function hex_hmac_md5(k,d){return rstr2hex(rstr_hmac_md5(str2rstr_utf8(k),str2rstr_utf8(d)))}function b64_hmac_md5(k,d){return rstr2b64(rstr_hmac_md5(str2rstr_utf8(k),str2rstr_utf8(d)))}function any_hmac_md5(k,d,e){return rstr2any(rstr_hmac_md5(str2rstr_utf8(k),str2rstr_utf8(d)),e)}
function md5_vm_test(){return hex_md5("abc").toLowerCase()=="900150983cd24fb0d6963f7d28e17f72"}function rstr_md5(s){return binl2rstr(binl_md5(rstr2binl(s),s.length*8))}
function rstr_hmac_md5(key,data){var bkey=rstr2binl(key);if(bkey.length>16)bkey=binl_md5(bkey,key.length*8);var ipad=Array(16),opad=Array(16);for(var i=0;i<16;i++){ipad[i]=bkey[i]^909522486;opad[i]=bkey[i]^1549556828}var hash=binl_md5(ipad.concat(rstr2binl(data)),512+data.length*8);return binl2rstr(binl_md5(opad.concat(hash),512+128))}
function rstr2hex(input){try{hexcase}catch(e){hexcase=0}var hex_tab=hexcase?"0123456789ABCDEF":"0123456789abcdef";var output="";var x;for(var i=0;i<input.length;i++){x=input.charCodeAt(i);output+=hex_tab.charAt(x>>>4&15)+hex_tab.charAt(x&15)}return output}
function rstr2b64(input){try{b64pad}catch(e){b64pad=""}var tab="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";var output="";var len=input.length;for(var i=0;i<len;i+=3){var triplet=input.charCodeAt(i)<<16|(i+1<len?input.charCodeAt(i+1)<<8:0)|(i+2<len?input.charCodeAt(i+2):0);for(var j=0;j<4;j++)if(i*8+j*6>input.length*8)output+=b64pad;else output+=tab.charAt(triplet>>>6*(3-j)&63)}return output}
function rstr2any(input,encoding){var divisor=encoding.length;var i,j,q,x,quotient;var dividend=Array(Math.ceil(input.length/2));for(i=0;i<dividend.length;i++)dividend[i]=input.charCodeAt(i*2)<<8|input.charCodeAt(i*2+1);var full_length=Math.ceil(input.length*8/(Math.log(encoding.length)/Math.log(2)));var remainders=Array(full_length);for(j=0;j<full_length;j++){quotient=Array();x=0;for(i=0;i<dividend.length;i++){x=(x<<16)+dividend[i];q=Math.floor(x/divisor);x-=q*divisor;if(quotient.length>0||q>0)quotient[quotient.length]=
q}remainders[j]=x;dividend=quotient}var output="";for(i=remainders.length-1;i>=0;i--)output+=encoding.charAt(remainders[i]);return output}
function str2rstr_utf8(input){var output="";var i=-1;var x,y;while(++i<input.length){x=input.charCodeAt(i);y=i+1<input.length?input.charCodeAt(i+1):0;if(55296<=x&&x<=56319&&56320<=y&&y<=57343){x=65536+((x&1023)<<10)+(y&1023);i++}if(x<=127)output+=String.fromCharCode(x);else if(x<=2047)output+=String.fromCharCode(192|x>>>6&31,128|x&63);else if(x<=65535)output+=String.fromCharCode(224|x>>>12&15,128|x>>>6&63,128|x&63);else if(x<=2097151)output+=String.fromCharCode(240|x>>>18&7,128|x>>>12&63,128|x>>>
6&63,128|x&63)}return output}function str2rstr_utf16le(input){var output="";for(var i=0;i<input.length;i++)output+=String.fromCharCode(input.charCodeAt(i)&255,input.charCodeAt(i)>>>8&255);return output}function str2rstr_utf16be(input){var output="";for(var i=0;i<input.length;i++)output+=String.fromCharCode(input.charCodeAt(i)>>>8&255,input.charCodeAt(i)&255);return output}
function rstr2binl(input){var output=Array(input.length>>2);for(var i=0;i<output.length;i++)output[i]=0;for(var i=0;i<input.length*8;i+=8)output[i>>5]|=(input.charCodeAt(i/8)&255)<<i%32;return output}function binl2rstr(input){var output="";for(var i=0;i<input.length*32;i+=8)output+=String.fromCharCode(input[i>>5]>>>i%32&255);return output}
function binl_md5(x,len){x[len>>5]|=128<<len%32;x[(len+64>>>9<<4)+14]=len;var a=1732584193;var b=-271733879;var c=-1732584194;var d=271733878;for(var i=0;i<x.length;i+=16){var olda=a;var oldb=b;var oldc=c;var oldd=d;a=md5_ff(a,b,c,d,x[i+0],7,-680876936);d=md5_ff(d,a,b,c,x[i+1],12,-389564586);c=md5_ff(c,d,a,b,x[i+2],17,606105819);b=md5_ff(b,c,d,a,x[i+3],22,-1044525330);a=md5_ff(a,b,c,d,x[i+4],7,-176418897);d=md5_ff(d,a,b,c,x[i+5],12,1200080426);c=md5_ff(c,d,a,b,x[i+6],17,-1473231341);b=md5_ff(b,c,
d,a,x[i+7],22,-45705983);a=md5_ff(a,b,c,d,x[i+8],7,1770035416);d=md5_ff(d,a,b,c,x[i+9],12,-1958414417);c=md5_ff(c,d,a,b,x[i+10],17,-42063);b=md5_ff(b,c,d,a,x[i+11],22,-1990404162);a=md5_ff(a,b,c,d,x[i+12],7,1804603682);d=md5_ff(d,a,b,c,x[i+13],12,-40341101);c=md5_ff(c,d,a,b,x[i+14],17,-1502002290);b=md5_ff(b,c,d,a,x[i+15],22,1236535329);a=md5_gg(a,b,c,d,x[i+1],5,-165796510);d=md5_gg(d,a,b,c,x[i+6],9,-1069501632);c=md5_gg(c,d,a,b,x[i+11],14,643717713);b=md5_gg(b,c,d,a,x[i+0],20,-373897302);a=md5_gg(a,
b,c,d,x[i+5],5,-701558691);d=md5_gg(d,a,b,c,x[i+10],9,38016083);c=md5_gg(c,d,a,b,x[i+15],14,-660478335);b=md5_gg(b,c,d,a,x[i+4],20,-405537848);a=md5_gg(a,b,c,d,x[i+9],5,568446438);d=md5_gg(d,a,b,c,x[i+14],9,-1019803690);c=md5_gg(c,d,a,b,x[i+3],14,-187363961);b=md5_gg(b,c,d,a,x[i+8],20,1163531501);a=md5_gg(a,b,c,d,x[i+13],5,-1444681467);d=md5_gg(d,a,b,c,x[i+2],9,-51403784);c=md5_gg(c,d,a,b,x[i+7],14,1735328473);b=md5_gg(b,c,d,a,x[i+12],20,-1926607734);a=md5_hh(a,b,c,d,x[i+5],4,-378558);d=md5_hh(d,
a,b,c,x[i+8],11,-2022574463);c=md5_hh(c,d,a,b,x[i+11],16,1839030562);b=md5_hh(b,c,d,a,x[i+14],23,-35309556);a=md5_hh(a,b,c,d,x[i+1],4,-1530992060);d=md5_hh(d,a,b,c,x[i+4],11,1272893353);c=md5_hh(c,d,a,b,x[i+7],16,-155497632);b=md5_hh(b,c,d,a,x[i+10],23,-1094730640);a=md5_hh(a,b,c,d,x[i+13],4,681279174);d=md5_hh(d,a,b,c,x[i+0],11,-358537222);c=md5_hh(c,d,a,b,x[i+3],16,-722521979);b=md5_hh(b,c,d,a,x[i+6],23,76029189);a=md5_hh(a,b,c,d,x[i+9],4,-640364487);d=md5_hh(d,a,b,c,x[i+12],11,-421815835);c=md5_hh(c,
d,a,b,x[i+15],16,530742520);b=md5_hh(b,c,d,a,x[i+2],23,-995338651);a=md5_ii(a,b,c,d,x[i+0],6,-198630844);d=md5_ii(d,a,b,c,x[i+7],10,1126891415);c=md5_ii(c,d,a,b,x[i+14],15,-1416354905);b=md5_ii(b,c,d,a,x[i+5],21,-57434055);a=md5_ii(a,b,c,d,x[i+12],6,1700485571);d=md5_ii(d,a,b,c,x[i+3],10,-1894986606);c=md5_ii(c,d,a,b,x[i+10],15,-1051523);b=md5_ii(b,c,d,a,x[i+1],21,-2054922799);a=md5_ii(a,b,c,d,x[i+8],6,1873313359);d=md5_ii(d,a,b,c,x[i+15],10,-30611744);c=md5_ii(c,d,a,b,x[i+6],15,-1560198380);b=md5_ii(b,
c,d,a,x[i+13],21,1309151649);a=md5_ii(a,b,c,d,x[i+4],6,-145523070);d=md5_ii(d,a,b,c,x[i+11],10,-1120210379);c=md5_ii(c,d,a,b,x[i+2],15,718787259);b=md5_ii(b,c,d,a,x[i+9],21,-343485551);a=safe_add(a,olda);b=safe_add(b,oldb);c=safe_add(c,oldc);d=safe_add(d,oldd)}return Array(a,b,c,d)}function md5_cmn(q,a,b,x,s,t){return safe_add(bit_rol(safe_add(safe_add(a,q),safe_add(x,t)),s),b)}function md5_ff(a,b,c,d,x,s,t){return md5_cmn(b&c|~b&d,a,b,x,s,t)}
function md5_gg(a,b,c,d,x,s,t){return md5_cmn(b&d|c&~d,a,b,x,s,t)}function md5_hh(a,b,c,d,x,s,t){return md5_cmn(b^c^d,a,b,x,s,t)}function md5_ii(a,b,c,d,x,s,t){return md5_cmn(c^(b|~d),a,b,x,s,t)}function safe_add(x,y){var lsw=(x&65535)+(y&65535);var msw=(x>>16)+(y>>16)+(lsw>>16);return msw<<16|lsw&65535}function bit_rol(num,cnt){return num<<cnt|num>>>32-cnt}
var guiders=function($){var guiders={};guiders.version="1.2.8";guiders._defaultSettings={attachTo:null,autoFocus:false,buttons:null,buttonCustomHTML:"",classString:null,closeOnEscape:true,description:null,highlight:null,isHashable:true,offset:{top:null,left:null},onClose:null,onHide:null,onShow:null,skipStep:function(){return false},overlay:false,position:0,title:null,width:250,sequenceId:null,sequenceLength:null,xButton:false};guiders._htmlSkeleton=["<div class='ds-popover'>","  <div class='ds-popover-content'>",
"    <h1 class='ds-popover-title'></h1>","    <div class='ds-popover-close'></div>","    <p class='ds-popover-description'></p>","    <span class='ds-popover-sequence-id'></span>","  </div>","  <div class='ds-popover-arrow'>","  </div>","</div>"].join("");guiders._arrowSize=22;guiders._backButtonTitle="Back";guiders._buttonElement="<a></a>";guiders._buttonAttributes={"href":"javascript:void(0);"};guiders._closeButtonTitle="Close";guiders._currentGuiderID=null;guiders._guiders={};guiders._lastCreatedGuiderID=
null;guiders._nextButtonTitle="Next";guiders._offsetNameMapping={"topLeft":11,"top":12,"topRight":1,"rightTop":2,"right":3,"rightBottom":4,"bottomRight":5,"bottom":6,"bottomLeft":7,"leftBottom":8,"left":9,"leftTop":10};guiders._windowHeight=0;guiders._addButtons=function(myGuider){if(myGuider.buttons===null||myGuider.buttons.length===0)return;var guiderButtonsContainer=$("<div class='ds-popover-buttons'>").appendTo(myGuider.elem.find(".ds-popover-content"));for(var i=myGuider.buttons.length-1;i>=
0;i--){var thisButton=myGuider.buttons[i];var thisButtonElem=$(guiders._buttonElement,$.extend({"class":"ds-popover-button","html":thisButton.name},guiders._buttonAttributes,thisButton.html||{}));if(typeof thisButton.classString!=="undefined"&&thisButton.classString!==null)thisButtonElem.addClass(thisButton.classString);guiderButtonsContainer.append(thisButtonElem);var thisButtonName=thisButton.name.toLowerCase();if(thisButton.onclick)thisButtonElem.bind("click",thisButton.onclick);else switch(thisButtonName){case guiders._closeButtonTitle.toLowerCase():thisButtonElem.bind("click",
function(){guiders.hideAll();if(myGuider.onClose)myGuider.onClose(myGuider,false)});break;case guiders._nextButtonTitle.toLowerCase():thisButtonElem.bind("click",function(){!myGuider.elem.data("locked")&&guiders.next()});break;case guiders._backButtonTitle.toLowerCase():thisButtonElem.bind("click",function(){!myGuider.elem.data("locked")&&guiders.prev()});break}}if(myGuider.buttonCustomHTML!==""){var myCustomHTML=$(myGuider.buttonCustomHTML);myGuider.elem.find(".ds-popover-buttons").append(myCustomHTML)}if(myGuider.buttons.length===
0)guiderButtonsContainer.remove()};guiders._addXButton=function(myGuider){var xButtonContainer=myGuider.elem.find(".ds-popover-close");var xButton=$("<div></div>",{"class":"ds-xbutton","role":"button"});xButtonContainer.append(xButton);xButton.click(function(){guiders.hideAll();if(myGuider.onClose)myGuider.onClose(myGuider,true)})};guiders._wireEscape=function(myGuider){$(document).keydown(function(event){if(event.keyCode==27||event.which==27){guiders.hideAll();if(myGuider.onClose)myGuider.onClose(myGuider,
true);return false}})};guiders._unWireEscape=function(myGuider){$(document).unbind("keydown")};guiders._attach=function(myGuider){if(typeof myGuider!=="object")return;var attachTo=$(myGuider.attachTo);var myHeight=myGuider.elem.innerHeight();var myWidth=myGuider.elem.innerWidth();if(myGuider.position===0||attachTo.length===0){myGuider.elem.css("position","fixed");myGuider.elem.css("top",($(window).height()-myHeight)/3+"px");myGuider.elem.css("left",($(window).width()-myWidth)/2+"px");return}var base=
attachTo.offset();var top=base.top;var left=base.left;var topMarginOfBody=$("body").outerHeight(true)-$("body").outerHeight(false);top-=topMarginOfBody;if(guiders._offsetNameMapping[myGuider.position])myGuider.position=guiders._offsetNameMapping[myGuider.position];var attachToHeight=attachTo.innerHeight();var attachToWidth=attachTo.innerWidth();var bufferOffset=0.9*guiders._arrowSize;var offsetMap={1:[-bufferOffset-myHeight,attachToWidth-myWidth+guiders._arrowSize/2],2:[-guiders._arrowSize/2,bufferOffset+
attachToWidth],3:[attachToHeight/2-myHeight/2,bufferOffset+attachToWidth],4:[attachToHeight-myHeight+guiders._arrowSize/2,bufferOffset+attachToWidth],5:[bufferOffset+attachToHeight,attachToWidth-myWidth+guiders._arrowSize/2],6:[bufferOffset+attachToHeight,attachToWidth/2-myWidth/2],7:[bufferOffset+attachToHeight,-guiders._arrowSize/2],8:[attachToHeight-myHeight+guiders._arrowSize/2,-myWidth-bufferOffset],9:[attachToHeight/2-myHeight/2,-myWidth-bufferOffset],10:[-guiders._arrowSize/2,-myWidth-bufferOffset],
11:[-bufferOffset-myHeight,-guiders._arrowSize/2],12:[-bufferOffset-myHeight,attachToWidth/2-myWidth/2]};var offset=offsetMap[myGuider.position];top+=offset[0];left+=offset[1];var positionType="absolute";if(attachTo.css("position")=="fixed"){positionType="fixed";top-=$(window).scrollTop();left-=$(window).scrollLeft()}if(myGuider.offset.top!==null)top+=myGuider.offset.top;if(myGuider.offset.left!==null)left+=myGuider.offset.left;return myGuider.elem.css({"position":positionType,"top":top,"left":left})};
guiders._guiderById=function(id){if(typeof guiders._guiders[id]==="undefined")throw"Cannot find guider with id "+id;return guiders._guiders[id]};guiders._showOverlay=function(){$("#ds-popover-overlay").fadeIn("fast",function(){if(this.style.removeAttribute)this.style.removeAttribute("filter")})};guiders._highlightElement=function(selector){$(selector).addClass("ds-popover-highlight")};guiders._dehighlightElement=function(selector){$(selector).removeClass("ds-popover-highlight")};guiders._hideOverlay=
function(){$("#ds-popover-overlay").fadeOut("fast")};guiders._initializeOverlay=function(){if($("#ds-popover-overlay").length===0)$('<div id="ds-popover-overlay"></div>').hide().appendTo("body")};guiders._styleArrow=function(myGuider){var position=myGuider.position||0;if(!position)return;var myGuiderArrow=$(myGuider.elem.find(".ds-popover-arrow"));var newClass={1:"ds-popover-arrow-down",2:"ds-popover-arrow-left",3:"ds-popover-arrow-left",4:"ds-popover-arrow-left",5:"ds-popover-arrow-up",6:"ds-popover-arrow-up",
7:"ds-popover-arrow-up",8:"ds-popover-arrow-right",9:"ds-popover-arrow-right",10:"ds-popover-arrow-right",11:"ds-popover-arrow-down",12:"ds-popover-arrow-down"};myGuiderArrow.addClass(newClass[position]);var myHeight=myGuider.elem.innerHeight();var myWidth=myGuider.elem.innerWidth();var arrowSize=guiders._arrowSize;var positionMap={1:["right",arrowSize],2:["top",arrowSize],3:["top",myHeight/2-arrowSize/2],4:["bottom",arrowSize],5:["right",arrowSize],6:["left",myWidth/2-arrowSize/2],7:["left",arrowSize],
8:["bottom",arrowSize],9:["top",myHeight/2-arrowSize/2],10:["top",arrowSize],11:["left",arrowSize],12:["left",myWidth/2-arrowSize/2]};var position=positionMap[myGuider.position];myGuiderArrow.css(position[0],position[1]+"px")};guiders._showIfHashed=function(myGuider){var GUIDER_HASH_TAG="guider=";var hashIndex=window.location.hash.indexOf(GUIDER_HASH_TAG);if(hashIndex!==-1){var hashGuiderId=window.location.hash.substr(hashIndex+GUIDER_HASH_TAG.length);if(myGuider.id.toLowerCase()===hashGuiderId.toLowerCase())guiders.show(myGuider.id)}};
guiders.reposition=function(){var currentGuider=guiders._guiders[guiders._currentGuiderID];guiders._attach(currentGuider)};guiders.next=function(){var currentGuider=guiders._guiders[guiders._currentGuiderID];if(typeof currentGuider==="undefined")return;currentGuider.elem.data("locked",true);var nextGuiderId=currentGuider.next||null;if(nextGuiderId!==null&&nextGuiderId!==""){var myGuider=guiders._guiderById(nextGuiderId);var omitHidingOverlay=myGuider.overlay?true:false;guiders.hideAll(omitHidingOverlay,
true);if(currentGuider&&currentGuider.highlight)guiders._dehighlightElement(currentGuider.highlight);guiders.show(nextGuiderId)}};guiders.prev=function(){var currentGuider=guiders._guiders[guiders._currentGuiderID];if(typeof currentGuider==="undefined")return;if(currentGuider.prev===null)return;var prevGuider=guiders._guiders[currentGuider.prev];prevGuider.elem.data("locked",true);var prevGuiderId=prevGuider.id||null;if(prevGuiderId!==null&&prevGuiderId!==""){var myGuider=guiders._guiderById(prevGuiderId);
var omitHidingOverlay=myGuider.overlay?true:false;guiders.hideAll(omitHidingOverlay,true);if(prevGuider&&prevGuider.highlight)guiders._dehighlightElement(prevGuider.highlight);guiders.show(prevGuiderId)}};guiders.createGuider=function(passedSettings){if(passedSettings===null||passedSettings===undefined)passedSettings={};$("#"+passedSettings.id).remove();myGuider=$.extend({},guiders._defaultSettings,passedSettings);myGuider.id=myGuider.id||String(Math.floor(Math.random()*1E3));var guiderElement=$(guiders._htmlSkeleton);
myGuider.elem=guiderElement;if(typeof myGuider.classString!=="undefined"&&myGuider.classString!==null)myGuider.elem.addClass(myGuider.classString);myGuider.elem.css("width",myGuider.width+"px");var guiderTitleContainer=guiderElement.find(".ds-popover-title");if(typeof myGuider.title!=="undefined"&&myGuider.title!==null)guiderTitleContainer.html(myGuider.title);else guiderTitleContainer.hide();var guiderSequenceIdContainer=guiderElement.find(".ds-popover-sequence-id");if(typeof myGuider.sequenceId!==
"undefined"&&typeof myGuider.sequenceLength!=="undefined"&&myGuider.sequenceId!==null&&myGuider.sequenceLength!==null&&myGuider.sequenceId!==false)guiderSequenceIdContainer.html(myGuider.sequenceId+"/"+myGuider.sequenceLength);else guiderSequenceIdContainer.hide();var guiderDescContainer=guiderElement.find(".ds-popover-description");if(typeof myGuider.description!=="undefined"&&myGuider.description!==null)guiderDescContainer.html(myGuider.description);else guiderDescContainer.hide();guiders._addButtons(myGuider);
if(myGuider.xButton)guiders._addXButton(myGuider);guiderElement.hide();guiderElement.appendTo("body");guiderElement.attr("id",myGuider.id);if(typeof myGuider.attachTo!=="undefined"&&myGuider!==null)guiders._attach(myGuider)&&guiders._styleArrow(myGuider);guiders._initializeOverlay();guiders._guiders[myGuider.id]=myGuider;if(guiders._lastCreatedGuiderID!=null)myGuider.prev=guiders._lastCreatedGuiderID;guiders._lastCreatedGuiderID=myGuider.id;if(myGuider.isHashable)guiders._showIfHashed(myGuider);return guiders};
guiders.hideAll=function(omitHidingOverlay,next){next=next||false;$(".ds-popover:visible").each(function(index,elem){var myGuider=guiders._guiderById($(elem).attr("id"));if(myGuider.onHide)myGuider.onHide(myGuider,next)});$(".ds-popover").fadeOut("fast");var currentGuider=guiders._guiders[guiders._currentGuiderID];if(currentGuider&&currentGuider.highlight)guiders._dehighlightElement(currentGuider.highlight);if(typeof omitHidingOverlay!=="undefined"&&omitHidingOverlay===true);else guiders._hideOverlay();
return guiders};guiders.show=function(id){if(!id&&guiders._lastCreatedGuiderID)id=guiders._lastCreatedGuiderID;var myGuider=guiders._guiderById(id);if(typeof myGuider.delay==="number"){setTimeout(function(){guiders.show(id)},myGuider.delay,myGuider);return}else if(typeof myGuider.delay==="function"&&!myGuider.delay()){var interval_id,delay;interval_id=setInterval(function(){delay=myGuider.delay.call(myGuider);if(typeof delay==="number"){setTimeout(function(){guiders.show(id)},delay);clearInterval(interval_id)}},
100);return}if(myGuider.overlay){guiders._showOverlay();if(myGuider.highlight)guiders._highlightElement(myGuider.highlight)}if(myGuider.closeOnEscape)guiders._wireEscape(myGuider);else guiders._unWireEscape(myGuider);guiders._currentGuiderID=id;var scrollParent=$(myGuider.attachTo).scrollParent()||$(window);var parentHeight=scrollParent.height();var parentOffset=scrollParent.offset()||{top:0,left:0};var scrollHeight=scrollParent.scrollTop();var guiderOffset=myGuider.elem.offset();var guiderElemHeight=
myGuider.elem.height();var isGuiderBelow=scrollHeight+parentHeight+parentOffset.top<guiderOffset.top+guiderElemHeight;var isGuiderAbove=guiderOffset.top<scrollHeight+parentOffset.top;if(typeof myGuider.skipStep!=="undefined"&&myGuider.skipStep()==true)guiders.next();else{var show=function(){if(myGuider.onShow)myGuider.onShow(myGuider);guiders._attach(myGuider);guiders._styleArrow(myGuider);myGuider.elem.fadeIn("fast").data("locked",false);$(myGuider.elem).trigger("guiders.show")};if(myGuider.autoFocus&&
(isGuiderBelow||isGuiderAbove))setTimeout(guiders.scrollToCurrent,10,scrollParent,show);else show()}return guiders};guiders.scrollToCurrent=function(scrollParent,onComplete){var currentGuider=guiders._guiders[guiders._currentGuiderID];if(typeof currentGuider==="undefined")return;var parentHeight=scrollParent.height();var scrollHeight=scrollParent.scrollTop();var guiderOffset=currentGuider.elem.offset();var guiderElemHeight=currentGuider.elem.height();var scrollToHeight=Math.round(Math.max(guiderOffset.top+
guiderElemHeight/2-parentHeight/2,0));scrollParent.animate({scrollTop:scrollToHeight},250,null,onComplete)};var _resizing=undefined;$(window).resize(function(){if(typeof _resizing!=="undefined")clearTimeout(_resizing);_resizing=setTimeout(function(){_resizing=undefined;if(typeof guiders!=="undefined")guiders.reposition()},20)});return guiders}.call(this,jQuery);
(function($){var defaults={className:"autosizejs",append:"",callback:false},hidden="hidden",borderBox="border-box",lineHeight="lineHeight",copy='<textarea tabindex="-1" style="position:absolute; top:-9999px; left:-9999px; right:auto; bottom:auto; border:0; -moz-box-sizing:content-box; -webkit-box-sizing:content-box; box-sizing:content-box; word-wrap:break-word; height:0 !important; min-height:0 !important; overflow:hidden;"/>',copyStyle=["fontFamily","fontSize","fontWeight","fontStyle","letterSpacing",
"textTransform","wordSpacing","textIndent"],oninput="oninput",onpropertychange="onpropertychange",mirrored,mirror=$(copy).data("autosize",true)[0];mirror.style.lineHeight="99px";if($(mirror).css(lineHeight)==="99px")copyStyle.push(lineHeight);mirror.style.lineHeight="";$.fn.autosize=function(options){options=$.extend({},defaults,options||{});if(mirror.parentNode!==document.body)$(document.body).append(mirror);return this.each(function(){var ta=this,$ta=$(ta),minHeight=$ta.height(),active,resize,boxOffset=
0,callback=$.isFunction(options.callback);if($ta.data("autosize"))return;if($ta.css("box-sizing")===borderBox||$ta.css("-moz-box-sizing")===borderBox||$ta.css("-webkit-box-sizing")===borderBox)boxOffset=$ta.outerHeight()-$ta.height();resize=$ta.css("resize")==="none"||$ta.css("resize")==="vertical"?"none":"horizontal";$ta.css({overflow:hidden,overflowY:hidden,wordWrap:"break-word",resize:resize}).data("autosize",true);function initMirror(){mirrored=ta;mirror.className=options.className;$.each(copyStyle,
function(i,val){mirror.style[val]=$ta.css(val)})}function adjust(){var height,overflow,original;if(mirrored!==ta)initMirror();if(!active){active=true;mirror.value=ta.value+options.append;mirror.style.overflowY=ta.style.overflowY;original=parseInt(ta.style.height,10);mirror.style.width=$ta.width()+"px";mirror.scrollTop=0;mirror.scrollTop=9E4;height=mirror.scrollTop;var maxHeight=parseInt($ta.css("maxHeight"),10);maxHeight=maxHeight&&maxHeight>0?maxHeight:9E4;if(height>maxHeight){height=maxHeight;overflow=
"scroll"}else if(height<minHeight)height=minHeight;height+=boxOffset;ta.style.overflowY=overflow||hidden;if(original!==height){ta.style.height=height+"px";if(callback)options.callback.call(ta)}setTimeout(function(){active=false},1)}}if(onpropertychange in ta)if(oninput in ta)ta[oninput]=ta.onkeyup=adjust;else ta[onpropertychange]=adjust;else ta[oninput]=adjust;$(window).resize(adjust);$ta.bind("autosize",adjust);adjust()})}})(window.jQuery||window.Zepto);
(function($){Desk=window.Desk||{};Desk.TextHelpers={setCaretPosValue:function(start,end){var e=this.jquery?this:$(this);if(typeof e==="undefined")return;if(typeof start==="undefined")var start=e.text().length;if(typeof end==="undefined")var end=e.text().length;if(typeof e.data("caretSelection")==="undefined")e.data("caretSelection",{});e.data("caretSelection").start=start;e.data("caretSelection").end=end}};jQuery.fn.setCaretPosValue=Desk.TextHelpers.setCaretPosValue})();
(function($){Desk=window.Desk||{};$(document).on("click",".a-like-button-container a.a-like-link",function(){var self=$(this);if(!self.hasClass("ajax-running")){self.addClass("ajax-running");var parent=self.parent();Desk.FBJSApi.fbLike(self,self.text(),parent.attr("data-attr"),parent.attr("data-local-id"))}});Desk.FBJSApi={fbLike:function(elem,current_like_val,fb_obj_id,local_fb_obj_id){if(typeof local_fb_obj_id==="undefined")return;var url_to_post="/agent/facebooks/"+local_fb_obj_id+"/like";function updateLikeStatus(url,
req_type,elem){$.ajax({url:url,cache:false,dataType:"JSON",type:req_type,success:function(data,textStatus,jqXHR){var like_counter=elem.siblings(".a-like-counter");if(current_like_val==="Like"){Desk.FBJSApi.renderLikeCount(like_counter,Number(like_counter.text())+1);Desk.FBJSApi.renderLikeStatus(elem,"Unlike")}else{Desk.FBJSApi.renderLikeCount(like_counter,Number(like_counter.text())-1);Desk.FBJSApi.renderLikeStatus(elem,"Like")}},error:function(data,textStatus,jqXHR){var err=JSON.parse(data.responseText);
notify(err.message,true,8E3)},complete:function(){elem.removeClass("ajax-running")}})}if(current_like_val==="Like")updateLikeStatus(url_to_post,"post",elem);else updateLikeStatus(url_to_post,"delete",elem)},renderFBLikeCountAndStatus:function(elem,current_ticket_like_elems){if(typeof elem=="undefined")return;var fb_obj_id=elem.attr("data-attr");var parent_id=elem.attr("data-local-id");if(typeof parent_id==="undefined")return;$.ajax({url:"/agent/facebooks/"+parent_id+"/like",cache:false,dataType:"JSON",
type:"GET",success:function(resp,textStatus,jqXHR){if(!resp.error)for(var i=0;i<resp.data.length;i++)$.each(resp.data[i],function(k,v){var fb_elem=$("[data-attr='"+k+"']");Desk.FBJSApi.renderLikeCount(fb_elem.find(".a-like-counter"),v.like_count);Desk.FBJSApi.renderLikeStatus(fb_elem.find(".a-like-link"),v.page_likes?"Unlike":"Like");current_ticket_like_elems.removeClass("loading-small")});else{notify(I18n.translate("agent.tickets.facebook.errors."+resp.error),true,8E3);current_ticket_like_elems.hide()}},
error:function(resp,textStatus,jqXHR){switch(resp.status){case 400:notify(I18n.translate("agent.tickets.facebook.errors.400"),true,8E3);break;case 404:notify(I18n.translate("agent.tickets.facebook.errors.404"),true,8E3);current_ticket_like_elems.hide();break;case 500:notify(I18n.translate("agent.tickets.facebook.errors.500"),true,8E3);break;default:notify(I18n.translate("agent.tickets.facebook.errors.general"),true,8E3);break}}})},renderLikeCount:function(elem,like_count){if(typeof elem=="undefined")return;
if(like_count>0)elem.text(like_count).removeClass("hidden");else elem.text(0).addClass("hidden")},renderLikeStatus:function(elem,like_status){if(typeof elem=="undefined"||like_status=="undefined")return;elem.text(like_status)}}})(jQuery);
(function($){$.fn.serializeObject=function(){var obj={};var arr=this.serializeArray();$.each(arr,function(){if(obj[this.name]!==undefined){if(!obj[this.name].push)obj[this.name]=[obj[this.name]];obj[this.name].push(this.value||"")}else obj[this.name]=this.value||""});return obj}})(jQuery);
(function(){var root=this;var previousUnderscore=root._;var breaker={};var ArrayProto=Array.prototype,ObjProto=Object.prototype,FuncProto=Function.prototype;var push=ArrayProto.push,slice=ArrayProto.slice,concat=ArrayProto.concat,toString=ObjProto.toString,hasOwnProperty=ObjProto.hasOwnProperty;var nativeForEach=ArrayProto.forEach,nativeMap=ArrayProto.map,nativeReduce=ArrayProto.reduce,nativeReduceRight=ArrayProto.reduceRight,nativeFilter=ArrayProto.filter,nativeEvery=ArrayProto.every,nativeSome=
ArrayProto.some,nativeIndexOf=ArrayProto.indexOf,nativeLastIndexOf=ArrayProto.lastIndexOf,nativeIsArray=Array.isArray,nativeKeys=Object.keys,nativeBind=FuncProto.bind;var _=function(obj){if(obj instanceof _)return obj;if(!(this instanceof _))return new _(obj);this._wrapped=obj};if(typeof exports!=="undefined"){if(typeof module!=="undefined"&&module.exports)exports=module.exports=_;exports._=_}else root._=_;_.VERSION="1.4.4";var each=_.each=_.forEach=function(obj,iterator,context){if(obj==null)return;
if(nativeForEach&&obj.forEach===nativeForEach)obj.forEach(iterator,context);else if(obj.length===+obj.length)for(var i=0,l=obj.length;i<l;i++){if(iterator.call(context,obj[i],i,obj)===breaker)return}else for(var key in obj)if(_.has(obj,key))if(iterator.call(context,obj[key],key,obj)===breaker)return};_.map=_.collect=function(obj,iterator,context){var results=[];if(obj==null)return results;if(nativeMap&&obj.map===nativeMap)return obj.map(iterator,context);each(obj,function(value,index,list){results.push(iterator.call(context,
value,index,list))});return results};var reduceError="Reduce of empty array with no initial value";_.reduce=_.foldl=_.inject=function(obj,iterator,memo,context){var initial=arguments.length>2;if(obj==null)obj=[];if(nativeReduce&&obj.reduce===nativeReduce){if(context)iterator=_.bind(iterator,context);return initial?obj.reduce(iterator,memo):obj.reduce(iterator)}each(obj,function(value,index,list){if(!initial){memo=value;initial=true}else memo=iterator.call(context,memo,value,index,list)});if(!initial)throw new TypeError(reduceError);
return memo};_.reduceRight=_.foldr=function(obj,iterator,memo,context){var initial=arguments.length>2;if(obj==null)obj=[];if(nativeReduceRight&&obj.reduceRight===nativeReduceRight){if(context)iterator=_.bind(iterator,context);return initial?obj.reduceRight(iterator,memo):obj.reduceRight(iterator)}var length=obj.length;if(length!==+length){var keys=_.keys(obj);length=keys.length}each(obj,function(value,index,list){index=keys?keys[--length]:--length;if(!initial){memo=obj[index];initial=true}else memo=
iterator.call(context,memo,obj[index],index,list)});if(!initial)throw new TypeError(reduceError);return memo};_.find=_.detect=function(obj,iterator,context){var result;any(obj,function(value,index,list){if(iterator.call(context,value,index,list)){result=value;return true}});return result};_.filter=_.select=function(obj,iterator,context){var results=[];if(obj==null)return results;if(nativeFilter&&obj.filter===nativeFilter)return obj.filter(iterator,context);each(obj,function(value,index,list){if(iterator.call(context,
value,index,list))results.push(value)});return results};_.reject=function(obj,iterator,context){return _.filter(obj,function(value,index,list){return!iterator.call(context,value,index,list)},context)};_.every=_.all=function(obj,iterator,context){iterator||(iterator=_.identity);var result=true;if(obj==null)return result;if(nativeEvery&&obj.every===nativeEvery)return obj.every(iterator,context);each(obj,function(value,index,list){if(!(result=result&&iterator.call(context,value,index,list)))return breaker});
return!!result};var any=_.some=_.any=function(obj,iterator,context){iterator||(iterator=_.identity);var result=false;if(obj==null)return result;if(nativeSome&&obj.some===nativeSome)return obj.some(iterator,context);each(obj,function(value,index,list){if(result||(result=iterator.call(context,value,index,list)))return breaker});return!!result};_.contains=_.include=function(obj,target){if(obj==null)return false;if(nativeIndexOf&&obj.indexOf===nativeIndexOf)return obj.indexOf(target)!=-1;return any(obj,
function(value){return value===target})};_.invoke=function(obj,method){var args=slice.call(arguments,2);var isFunc=_.isFunction(method);return _.map(obj,function(value){return(isFunc?method:value[method]).apply(value,args)})};_.pluck=function(obj,key){return _.map(obj,function(value){return value[key]})};_.where=function(obj,attrs,first){if(_.isEmpty(attrs))return first?void 0:[];return _[first?"find":"filter"](obj,function(value){for(var key in attrs)if(attrs[key]!==value[key])return false;return true})};
_.findWhere=function(obj,attrs){return _.where(obj,attrs,true)};_.max=function(obj,iterator,context){if(!iterator&&_.isArray(obj)&&obj[0]===+obj[0]&&obj.length<65535)return Math.max.apply(Math,obj);if(!iterator&&_.isEmpty(obj))return-Infinity;var result={computed:-Infinity,value:-Infinity};each(obj,function(value,index,list){var computed=iterator?iterator.call(context,value,index,list):value;computed>=result.computed&&(result={value:value,computed:computed})});return result.value};_.min=function(obj,
iterator,context){if(!iterator&&_.isArray(obj)&&obj[0]===+obj[0]&&obj.length<65535)return Math.min.apply(Math,obj);if(!iterator&&_.isEmpty(obj))return Infinity;var result={computed:Infinity,value:Infinity};each(obj,function(value,index,list){var computed=iterator?iterator.call(context,value,index,list):value;computed<result.computed&&(result={value:value,computed:computed})});return result.value};_.shuffle=function(obj){var rand;var index=0;var shuffled=[];each(obj,function(value){rand=_.random(index++);
shuffled[index-1]=shuffled[rand];shuffled[rand]=value});return shuffled};var lookupIterator=function(value){return _.isFunction(value)?value:function(obj){return obj[value]}};_.sortBy=function(obj,value,context){var iterator=lookupIterator(value);return _.pluck(_.map(obj,function(value,index,list){return{value:value,index:index,criteria:iterator.call(context,value,index,list)}}).sort(function(left,right){var a=left.criteria;var b=right.criteria;if(a!==b){if(a>b||a===void 0)return 1;if(a<b||b===void 0)return-1}return left.index<
right.index?-1:1}),"value")};var group=function(obj,value,context,behavior){var result={};var iterator=lookupIterator(value==null?_.identity:value);each(obj,function(value,index){var key=iterator.call(context,value,index,obj);behavior(result,key,value)});return result};_.groupBy=function(obj,value,context){return group(obj,value,context,function(result,key,value){(_.has(result,key)?result[key]:result[key]=[]).push(value)})};_.countBy=function(obj,value,context){return group(obj,value,context,function(result,
key){if(!_.has(result,key))result[key]=0;result[key]++})};_.sortedIndex=function(array,obj,iterator,context){iterator=iterator==null?_.identity:lookupIterator(iterator);var value=iterator.call(context,obj);var low=0,high=array.length;while(low<high){var mid=low+high>>>1;iterator.call(context,array[mid])<value?low=mid+1:high=mid}return low};_.toArray=function(obj){if(!obj)return[];if(_.isArray(obj))return slice.call(obj);if(obj.length===+obj.length)return _.map(obj,_.identity);return _.values(obj)};
_.size=function(obj){if(obj==null)return 0;return obj.length===+obj.length?obj.length:_.keys(obj).length};_.first=_.head=_.take=function(array,n,guard){if(array==null)return void 0;return n!=null&&!guard?slice.call(array,0,n):array[0]};_.initial=function(array,n,guard){return slice.call(array,0,array.length-(n==null||guard?1:n))};_.last=function(array,n,guard){if(array==null)return void 0;if(n!=null&&!guard)return slice.call(array,Math.max(array.length-n,0));else return array[array.length-1]};_.rest=
_.tail=_.drop=function(array,n,guard){return slice.call(array,n==null||guard?1:n)};_.compact=function(array){return _.filter(array,_.identity)};var flatten=function(input,shallow,output){each(input,function(value){if(_.isArray(value)||_.isArguments(value))shallow?push.apply(output,value):flatten(value,shallow,output);else output.push(value)});return output};_.flatten=function(array,shallow){return flatten(array,shallow,[])};_.without=function(array){return _.difference(array,slice.call(arguments,
1))};_.uniq=_.unique=function(array,isSorted,iterator,context){if(_.isFunction(isSorted)){context=iterator;iterator=isSorted;isSorted=false}var initial=iterator?_.map(array,iterator,context):array;var results=[];var seen=[];each(initial,function(value,index){if(isSorted?!index||seen[seen.length-1]!==value:!_.contains(seen,value)){seen.push(value);results.push(array[index])}});return results};_.union=function(){return _.uniq(_.flatten(arguments,true))};_.intersection=function(array){var rest=slice.call(arguments,
1);return _.filter(_.uniq(array),function(item){return _.every(rest,function(other){return _.indexOf(other,item)>=0})})};_.difference=function(array){var rest=concat.apply(ArrayProto,slice.call(arguments,1));return _.filter(array,function(value){return!_.contains(rest,value)})};_.zip=function(){return _.unzip(slice.call(arguments))};_.unzip=function(list){var length=_.max(_.pluck(list,"length").concat(0));var results=new Array(length);for(var i=0;i<length;i++)results[i]=_.pluck(list,""+i);return results};
_.object=function(list,values){if(list==null)return{};var result={};for(var i=0,l=list.length;i<l;i++)if(values)result[list[i]]=values[i];else result[list[i][0]]=list[i][1];return result};_.indexOf=function(array,item,isSorted){if(array==null)return-1;var i=0,l=array.length;if(isSorted)if(typeof isSorted=="number")i=isSorted<0?Math.max(0,l+isSorted):isSorted;else{i=_.sortedIndex(array,item);return array[i]===item?i:-1}if(nativeIndexOf&&array.indexOf===nativeIndexOf)return array.indexOf(item,isSorted);
for(;i<l;i++)if(array[i]===item)return i;return-1};_.lastIndexOf=function(array,item,from){if(array==null)return-1;var hasIndex=from!=null;if(nativeLastIndexOf&&array.lastIndexOf===nativeLastIndexOf)return hasIndex?array.lastIndexOf(item,from):array.lastIndexOf(item);var i=hasIndex?from:array.length;while(i--)if(array[i]===item)return i;return-1};_.range=function(start,stop,step){if(arguments.length<=1){stop=start||0;start=0}step=arguments[2]||1;var len=Math.max(Math.ceil((stop-start)/step),0);var idx=
0;var range=new Array(len);while(idx<len){range[idx++]=start;start+=step}return range};var ctor=function(){};_.bind=function(func,context){var args,bound;if(func.bind===nativeBind&&nativeBind)return nativeBind.apply(func,slice.call(arguments,1));if(!_.isFunction(func))throw new TypeError;args=slice.call(arguments,2);return bound=function(){if(!(this instanceof bound))return func.apply(context,args.concat(slice.call(arguments)));ctor.prototype=func.prototype;var self=new ctor;ctor.prototype=null;var result=
func.apply(self,args.concat(slice.call(arguments)));if(Object(result)===result)return result;return self}};_.partial=function(func){var args=slice.call(arguments,1);return function(){return func.apply(this,args.concat(slice.call(arguments)))}};_.bindAll=function(obj){var funcs=slice.call(arguments,1);if(funcs.length===0)throw new Error("bindAll must be passed function names");each(funcs,function(f){obj[f]=_.bind(obj[f],obj)});return obj};_.memoize=function(func,hasher){var memo={};hasher||(hasher=
_.identity);return function(){var key=hasher.apply(this,arguments);return _.has(memo,key)?memo[key]:memo[key]=func.apply(this,arguments)}};_.delay=function(func,wait){var args=slice.call(arguments,2);return setTimeout(function(){return func.apply(null,args)},wait)};_.defer=function(func){return _.delay.apply(_,[func,1].concat(slice.call(arguments,1)))};_.throttle=function(func,wait,immediate){var context,args,timeout,result;var previous=0;var later=function(){previous=new Date;timeout=null;result=
func.apply(context,args)};return function(){var now=new Date;if(!previous&&immediate===false)previous=now;var remaining=wait-(now-previous);context=this;args=arguments;if(remaining<=0){clearTimeout(timeout);timeout=null;previous=now;result=func.apply(context,args)}else if(!timeout)timeout=setTimeout(later,remaining);return result}};_.debounce=function(func,wait,immediate){var timeout,result;return function(){var context=this,args=arguments;var later=function(){timeout=null;if(!immediate)result=func.apply(context,
args)};var callNow=immediate&&!timeout;clearTimeout(timeout);timeout=setTimeout(later,wait);if(callNow)result=func.apply(context,args);return result}};_.once=function(func){var ran=false,memo;return function(){if(ran)return memo;ran=true;memo=func.apply(this,arguments);func=null;return memo}};_.wrap=function(func,wrapper){return function(){var args=[func];push.apply(args,arguments);return wrapper.apply(this,args)}};_.compose=function(){var funcs=arguments;return function(){var args=arguments;for(var i=
funcs.length-1;i>=0;i--)args=[funcs[i].apply(this,args)];return args[0]}};_.after=function(times,func){if(times<=0)return func();return function(){if(--times<1)return func.apply(this,arguments)}};_.keys=nativeKeys||function(obj){if(obj!==Object(obj))throw new TypeError("Invalid object");var keys=[];for(var key in obj)if(_.has(obj,key))keys.push(key);return keys};_.values=function(obj){var values=[];for(var key in obj)if(_.has(obj,key))values.push(obj[key]);return values};_.pairs=function(obj){var pairs=
[];for(var key in obj)if(_.has(obj,key))pairs.push([key,obj[key]]);return pairs};_.invert=function(obj){var result={};for(var key in obj)if(_.has(obj,key))result[obj[key]]=key;return result};_.functions=_.methods=function(obj){var names=[];for(var key in obj)if(_.isFunction(obj[key]))names.push(key);return names.sort()};_.extend=function(obj){each(slice.call(arguments,1),function(source){if(source)for(var prop in source)obj[prop]=source[prop]});return obj};_.pick=function(obj){var copy={};var keys=
concat.apply(ArrayProto,slice.call(arguments,1));each(keys,function(key){if(key in obj)copy[key]=obj[key]});return copy};_.omit=function(obj){var copy={};var keys=concat.apply(ArrayProto,slice.call(arguments,1));for(var key in obj)if(!_.contains(keys,key))copy[key]=obj[key];return copy};_.defaults=function(obj){each(slice.call(arguments,1),function(source){if(source)for(var prop in source)if(obj[prop]===void 0)obj[prop]=source[prop]});return obj};_.clone=function(obj){if(!_.isObject(obj))return obj;
return _.isArray(obj)?obj.slice():_.extend({},obj)};_.tap=function(obj,interceptor){interceptor(obj);return obj};var eq=function(a,b,aStack,bStack){if(a===b)return a!==0||1/a==1/b;if(a==null||b==null)return a===b;if(a instanceof _)a=a._wrapped;if(b instanceof _)b=b._wrapped;var className=toString.call(a);if(className!=toString.call(b))return false;switch(className){case "[object String]":return a==String(b);case "[object Number]":return a!=+a?b!=+b:a==0?1/a==1/b:a==+b;case "[object Date]":case "[object Boolean]":return+a==
+b;case "[object RegExp]":return a.source==b.source&&a.global==b.global&&a.multiline==b.multiline&&a.ignoreCase==b.ignoreCase}if(typeof a!="object"||typeof b!="object")return false;var length=aStack.length;while(length--)if(aStack[length]==a)return bStack[length]==b;aStack.push(a);bStack.push(b);var size=0,result=true;if(className=="[object Array]"){size=a.length;result=size==b.length;if(result)while(size--)if(!(result=eq(a[size],b[size],aStack,bStack)))break}else{var aCtor=a.constructor,bCtor=b.constructor;
if(aCtor!==bCtor&&!(_.isFunction(aCtor)&&aCtor instanceof aCtor&&_.isFunction(bCtor)&&bCtor instanceof bCtor))return false;for(var key in a)if(_.has(a,key)){size++;if(!(result=_.has(b,key)&&eq(a[key],b[key],aStack,bStack)))break}if(result){for(key in b)if(_.has(b,key)&&!size--)break;result=!size}}aStack.pop();bStack.pop();return result};_.isEqual=function(a,b){return eq(a,b,[],[])};_.isEmpty=function(obj){if(obj==null)return true;if(_.isArray(obj)||_.isString(obj))return obj.length===0;for(var key in obj)if(_.has(obj,
key))return false;return true};_.isElement=function(obj){return!!(obj&&obj.nodeType===1)};_.isArray=nativeIsArray||function(obj){return toString.call(obj)=="[object Array]"};_.isObject=function(obj){return obj===Object(obj)};each(["Arguments","Function","String","Number","Date","RegExp"],function(name){_["is"+name]=function(obj){return toString.call(obj)=="[object "+name+"]"}});if(!_.isArguments(arguments))_.isArguments=function(obj){return!!(obj&&_.has(obj,"callee"))};if(typeof/./!=="function")_.isFunction=
function(obj){return typeof obj==="function"};_.isFinite=function(obj){return isFinite(obj)&&!isNaN(parseFloat(obj))};_.isNaN=function(obj){return _.isNumber(obj)&&obj!=+obj};_.isBoolean=function(obj){return obj===true||obj===false||toString.call(obj)=="[object Boolean]"};_.isNull=function(obj){return obj===null};_.isUndefined=function(obj){return obj===void 0};_.has=function(obj,key){return hasOwnProperty.call(obj,key)};_.noConflict=function(){root._=previousUnderscore;return this};_.identity=function(value){return value};
_.times=function(n,iterator,context){var accum=Array(Math.max(0,n));for(var i=0;i<n;i++)accum[i]=iterator.call(context,i);return accum};_.random=function(min,max){if(max==null){max=min;min=0}return min+Math.floor(Math.random()*(max-min+1))};var entityMap={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;"}};entityMap.unescape=_.invert(entityMap.escape);var entityRegexes={escape:new RegExp("["+_.keys(entityMap.escape).join("")+"]","g"),unescape:new RegExp("("+_.keys(entityMap.unescape).join("|")+
")","g")};_.each(["escape","unescape"],function(method){_[method]=function(string){if(string==null)return"";return(""+string).replace(entityRegexes[method],function(match){return entityMap[method][match]})}});_.result=function(object,property){if(object==null)return void 0;var value=object[property];return _.isFunction(value)?value.call(object):value};_.mixin=function(obj){each(_.functions(obj),function(name){var func=_[name]=obj[name];_.prototype[name]=function(){var args=[this._wrapped];push.apply(args,
arguments);return result.call(this,func.apply(_,args))}})};var idCounter=0;_.uniqueId=function(prefix){var id=++idCounter+"";return prefix?prefix+id:id};_.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var noMatch=/(.)^/;var escapes={"'":"'","\\":"\\","\r":"r","\n":"n","\t":"t","\u2028":"u2028","\u2029":"u2029"};var escaper=/\\|'|\r|\n|\t|\u2028|\u2029/g;_.template=function(text,data,settings){var render;settings=_.defaults({},settings,_.templateSettings);
var matcher=new RegExp([(settings.escape||noMatch).source,(settings.interpolate||noMatch).source,(settings.evaluate||noMatch).source].join("|")+"|$","g");var index=0;var source="__p+='";text.replace(matcher,function(match,escape,interpolate,evaluate,offset){source+=text.slice(index,offset).replace(escaper,function(match){return"\\"+escapes[match]});if(escape)source+="'+\n((__t=("+escape+"))==null?'':_.escape(__t))+\n'";if(interpolate)source+="'+\n((__t=("+interpolate+"))==null?'':__t)+\n'";if(evaluate)source+=
"';\n"+evaluate+"\n__p+='";index=offset+match.length;return match});source+="';\n";if(!settings.variable)source="with(obj||{}){\n"+source+"}\n";source="var __t,__p='',__j=Array.prototype.join,"+"print=function(){__p+=__j.call(arguments,'');};\n"+source+"return __p;\n";try{render=new Function(settings.variable||"obj","_",source)}catch(e){e.source=source;throw e;}if(data)return render(data,_);var template=function(data){return render.call(this,data,_)};template.source="function("+(settings.variable||
"obj")+"){\n"+source+"}";return template};_.chain=function(obj){return _(obj).chain()};var result=function(obj){return this._chain?_(obj).chain():obj};_.mixin(_);each(["pop","push","reverse","shift","sort","splice","unshift"],function(name){var method=ArrayProto[name];_.prototype[name]=function(){var obj=this._wrapped;method.apply(obj,arguments);if((name=="shift"||name=="splice")&&obj.length===0)delete obj[0];return result.call(this,obj)}});each(["concat","join","slice"],function(name){var method=
ArrayProto[name];_.prototype[name]=function(){return result.call(this,method.apply(this._wrapped,arguments))}});_.extend(_.prototype,{chain:function(){this._chain=true;return this},value:function(){return this._wrapped}})}).call(this);
(function($){var caretClass="textarea-helper-caret",dataKey="textarea-helper",mirrorStyles=["box-sizing","height","width","padding-bottom","padding-left","padding-right","padding-top","font-family","font-size","font-style","font-variant","font-weight","word-spacing","letter-spacing","line-height","text-decoration","text-indent","text-transform","direction"];var TextareaHelper=function(elem){if(elem.nodeName.toLowerCase()!=="textarea"&&elem.nodeName.toLowerCase()!=="input")return;this.$text=$(elem);
this.$mirror=$("<div/>").css({"position":"absolute","overflow":"auto","white-space":"pre-wrap","word-wrap":"break-word","top":0,"left":-9999}).insertAfter(this.$text)};(function(){this.update=function(){var styles={};for(var i=0,style;style=mirrorStyles[i];i++)styles[style]=this.$text.css(style);this.$mirror.css(styles).empty();var caretPos=this.getOriginalCaretPos(),str=this.$text.val(),pre=document.createTextNode(str.substring(0,caretPos)),post=document.createTextNode(str.substring(caretPos)),$car=
$("<span/>").addClass(caretClass).html("&nbsp;");this.$mirror.append(pre,$car,post).scrollTop(this.$text.scrollTop())};this.destroy=function(){this.$mirror.remove();this.$text.removeData(dataKey);return null};this.caretPos=function(){this.update();var $caret=this.$mirror.find("."+caretClass),pos=$caret.position();if(this.$text.css("direction")==="rtl"){pos.right=this.$mirror.innerWidth()-pos.left-$caret.width();pos.left="auto"}return pos};this.height=function(){this.update();this.$mirror.css("height",
"");return this.$mirror.height()};this.getOriginalCaretPos=function(){var text=this.$text[0];if(text.selectionStart!==undefined)return text.selectionStart;else if(document.selection){text.focus();var r=document.selection.createRange();if(r==null)return 0;var re=text.createTextRange(),rc=re.duplicate();re.moveToBookmark(r.getBookmark());rc.setEndPoint("EndToStart",re);return rc.text.length}return 0}}).call(TextareaHelper.prototype);$.fn.textareaHelper=function(method){this.each(function(){var $this=
$(this),instance=$this.data(dataKey);if(!instance){instance=new TextareaHelper(this);$this.data(dataKey,instance)}});if(method){var instance=this.first().data(dataKey);return instance[method]()}else return this}})(jQuery);
(function($){if(typeof window.desk==="undefined")window.desk={};desk.InlineMenu=function(){if(this instanceof desk.InlineMenu===false)return new desk.InlineMenu;var escapeKeyCode=27;var upArrowKeyCode=38;var downArrowKeyCode=40;var enterKeyCode=13;var backspaceKeyCode=8;var xPos=0,yPos=0;var doc=$(document);var body=$("body");var macroDiv,macroItems,textarea,symbol,dropDownLimit,itemAppliedCallback,startingLettersLength,callbackScope,elementDataId,removeSymbolWhenItemIsApplied;this.createOrUpdateDomReferences=
function(obj){macroDiv=$(obj.dropDownSelector);macroItems=$("ul li",macroDiv);textarea=$(obj.textAreaSelctor)};this.setupInlineMenu=function(obj){this.createOrUpdateDomReferences(obj);symbol=obj.symbol||"##";dropDownLimit=obj.dropDownLimit||5;startingLettersLength=obj.startingLettersLength||2;itemAppliedCallback=obj.itemAppliedCallback;callbackScope=obj.callbackScope;elementDataId=obj.elementDataId;removeSymbolWhenItemIsApplied=obj.removeSymbolWhenItemIsApplied||true;macroDiv.addClass("inlineMenuConatiner");
textarea.addClass("theTextArea");doc.click(documentClickHandler);macroDiv.click(macroDivClickHandler);macroItems.mouseover(macroDivMouseOverHandler);textarea.keydown(keyDownOnTextArea);textarea.keyup(keyUpOnTextArea);textarea.blur(hideMacroOnTextAreaBlurAfterDelay)};var hideMacroOnTextAreaBlurAfterDelay=function(e){window.setTimeout(function(){hideMacros()},250)};var addDropDownToBody=function(){macroDiv.remove().appendTo("body")};var keyUpOnTextArea=function(evtObj){if(shouldWeShowDropDown()===true){if(macroDiv.is(":hidden")&&
evtObj.keyCode!==escapeKeyCode&&evtObj.keyCode!=enterKeyCode)showMacros();filterResults();if(macroDiv.is(":visible"))moveMacrosToCursor()}else if(macroDiv.is(":visible"))hideMacros()};var keyDownOnTextArea=function(evtObj){if(macroDiv.is(":hidden"))return;if(evtObj.keyCode==downArrowKeyCode){downArrowHandler();evtObj.preventDefault()}if(evtObj.keyCode==upArrowKeyCode){upArrowHandler();evtObj.preventDefault()}if(evtObj.keyCode==enterKeyCode){enterKeyHandler(evtObj);evtObj.preventDefault()}if(evtObj.keyCode==
escapeKeyCode){hideMacros();evtObj.preventDefault()}};var filterResults=function(){var lastWord=stringAfterSymbolTillCursor();var lettersToFilterBy=escapeRegExp(lastWord.substring(symbol.length));var patt=new RegExp("[\\s(-]"+lettersToFilterBy,"i");macroItems.each(function(idx,itm){itm=$(itm);var macrosText=" "+itm.find("span:last").text().trim();if(patt.test(macrosText)===true)itm.show();else itm.hide()});if(macroDiv.is(":visible")&&macroItems.filter(":visible").length===0)hideMacros();rePositionSelection();
showFewMacroItems(dropDownLimit)};var shouldWeShowDropDown=function(){var lastWord=stringAfterSymbolTillCursor();if(lastWord.indexOf(symbol)===0)if(lastWord.length>=symbol.length+startingLettersLength)return true;else return false;else return false};var enterKeyHandler=function(evt){var selected=getSelectedMacro();applyMacro(selected)};var stringAfterSymbolTillCursor=function(){var textareaVal=textarea.val();var caretPos=textarea.textareaHelper("getOriginalCaretPos");var textareaValTillCursor=textareaVal.substring(0,
caretPos);var indexOfLastSymbolInVal=textareaValTillCursor.lastIndexOf(symbol);var strAfterSymbol=textareaValTillCursor.substring(indexOfLastSymbolInVal);return strAfterSymbol};var removeAppliedSymbol=function(){var textareaVal=textarea.val();var caretPos=textarea.textareaHelper("getOriginalCaretPos");var textareaValTillCursor=textareaVal.substring(0,caretPos);var textareaValAfterCursor=textareaVal.substring(caretPos);var indexOfLastSymbolInVal=textareaValTillCursor.lastIndexOf(symbol);var textareaValTillLastSymbol=
textareaVal.substring(0,indexOfLastSymbolInVal);var valWithoutSymbol=textareaValTillLastSymbol+textareaValAfterCursor;textarea.val(valWithoutSymbol);setSelectionRange(textarea.get(0),indexOfLastSymbolInVal,indexOfLastSymbolInVal);if(typeof textarea.setCaretPosValue!=="undefined")textarea.setCaretPosValue(indexOfLastSymbolInVal,indexOfLastSymbolInVal)};var applyMacro=function(macroElem){hideMacros();if(removeSymbolWhenItemIsApplied===true)removeAppliedSymbol();itemAppliedCallback.call(callbackScope,
macroElem.data(elementDataId))};var downArrowHandler=function(){var firstMacroElem=macroDiv.find("li:visible:eq(0)");var selected=getSelectedMacro();if(selected.length===0)selectMacro(firstMacroElem);else if(nextEl(selected).length===0){unselectMacro(selected);selectMacro(firstMacroElem)}else{unselectMacro(selected);selectMacro(nextEl(selected))}};var upArrowHandler=function(){var lastMacroElem=macroDiv.find("li:visible:last");var selected=getSelectedMacro();if(selected.length===0)selectMacro(lastMacroElem);
else if(prevEl(selected).length===0){unselectMacro(selected);selectMacro(lastMacroElem)}else{unselectMacro(selected);selectMacro(prevEl(selected))}};var getSelectedMacro=function(){var selected=macroDiv.find("li[data-selected=true]");return selected};var getClickedMacro=function(evtObj){return $(evtObj.target).closest("li[data-macro]")};var selectFirstMacro=function(){var alreadySelectedMacro=getSelectedMacro();unselectMacro(alreadySelectedMacro);var firstMacroItem=$("li:visible",macroDiv).first();
selectMacro(firstMacroItem)};var selectMacro=function(elem){elem.addClass("selected");elem.attr("data-selected","true")};var unselectMacro=function(elem){elem.removeClass("selected");elem.removeAttr("data-selected")};var rePositionSelection=function(){var alreadySelectedMacro=getSelectedMacro();if(alreadySelectedMacro.length===0||alreadySelectedMacro.is(":hidden"))selectFirstMacro()};var hideMacros=function(){var selected=getSelectedMacro();unselectMacro(selected);macroDiv.hide()};var nextEl=function(el){var n=
el.nextAll(":visible").first();return n};var prevEl=function(el){var n=el.prevAll(":visible").first();return n};var showMacros=function(){macroDiv.data("lastUsedBy",textarea.attr("id"));macroDiv.show();selectFirstMacro()};var moveMacrosToCursor=function(){var caretLoc=textarea.textareaHelper("caretPos");var textareaLoc=textarea.offset();var lineHeight=parseInt(textarea.css("font-size"),10);var extraVerticalDistance=5;if(textareaLoc.top+caretLoc.top+lineHeight+extraVerticalDistance+macroDiv.height()>
getWindowSize().h)yPos=textareaLoc.top+caretLoc.top-extraVerticalDistance-macroDiv.height();else yPos=textareaLoc.top+caretLoc.top+lineHeight+extraVerticalDistance;if(textareaLoc.left+caretLoc.left+macroDiv.width()>getWindowSize().w)xPos=textareaLoc.left+caretLoc.left-macroDiv.width();else xPos=textareaLoc.left+caretLoc.left;if(xPos<0)xPos=0;macroDiv.css("top",yPos);macroDiv.css("left",xPos)};var showFewMacroItems=function(num){num=parseInt(num,10);var macroItems=$("ul li:visible",macroDiv);if(macroItems.length>
num)macroItems.filter(":gt("+(num-1)+")").hide()};var documentClickHandler=function(evt){hideMacros()};var wasMacroDivLastUsedByOurTexArea=function(){if(macroDiv.data("lastUsedBy")===textarea.attr("id"))return true;else return false};var macroDivClickHandler=function(evtObj){if(wasMacroDivLastUsedByOurTexArea()===true){var selected=getSelectedMacro();unselectMacro(selected);var clickedMacro=getClickedMacro(evtObj);selectMacro(clickedMacro);applyMacro(clickedMacro);evtObj.stopPropagation()}};var macroDivMouseOverHandler=
function(evtObj){var selected=getSelectedMacro();unselectMacro(selected);var hoverdMacro=$(evtObj.currentTarget);selectMacro(hoverdMacro)};var setSelectionRange=function(input,selectionStart,selectionEnd){if(input.setSelectionRange){input.focus();input.setSelectionRange(selectionStart,selectionEnd)}else if(input.createTextRange){var range=input.createTextRange();range.collapse(true);range.moveEnd("character",selectionEnd);range.moveStart("character",selectionStart);range.select()}};var escapeRegExp=
function(string){return string.replace(/([.*+?^=!:${}()|[\]\/\\])/g,"\\$1")};var getWindowSize=function(){var myWidth=0,myHeight=0;if(typeof window.innerWidth=="number"){myWidth=window.innerWidth;myHeight=window.innerHeight}else if(document.documentElement&&(document.documentElement.clientWidth||document.documentElement.clientHeight)){myWidth=document.documentElement.clientWidth;myHeight=document.documentElement.clientHeight}else if(document.body&&(document.body.clientWidth||document.body.clientHeight)){myWidth=
document.body.clientWidth;myHeight=document.body.clientHeight}return{"w":myWidth,"h":myHeight}}}})(jQuery);
function AssistlyCollection(prefix){this.array=[];this.assocative_array={};this.prefix=prefix;if(this.prefix===undefined)this.prefix="item_";this.set=function(arr){this.array=arr;this.assocative_array=convertArrayToAssociativeArray(this.array,this.prefix)};this.get=function(key){return this.assocative_array[this.prefix+key]};var convertArrayToAssociativeArray=function(arr,prefix){var len=arr.length;var assocative_array=[];for(var i=0;i<len;i++)assocative_array[prefix+arr[i].id]=arr[i];return assocative_array}}
(function(a){function E(a,b,c,d){var e=c.lang();return e[a].call?e[a](c,d):e[a][b]}function F(a,b){return function(c){return K(a.call(this,c),b)}}function G(a){return function(b){var c=a.call(this,b);return c+this.lang().ordinal(c)}}function H(a,b,c){this._d=a,this._isUTC=!!b,this._a=a._a||null,this._lang=c||!1}function I(a){var b=this._data={},c=a.years||a.y||0,d=a.months||a.M||0,e=a.weeks||a.w||0,f=a.days||a.d||0,g=a.hours||a.h||0,h=a.minutes||a.m||0,i=a.seconds||a.s||0,j=a.milliseconds||a.ms||
0;this._milliseconds=j+i*1E3+h*6E4+g*36E5,this._days=f+e*7,this._months=d+c*12,b.milliseconds=j%1E3,i+=J(j/1E3),b.seconds=i%60,h+=J(i/60),b.minutes=h%60,g+=J(h/60),b.hours=g%24,f+=J(g/24),f+=e*7,b.days=f%30,d+=J(f/30),b.months=d%12,c+=J(d/12),b.years=c,this._lang=!1}function J(a){return a<0?Math.ceil(a):Math.floor(a)}function K(a,b){var c=a+"";while(c.length<b)c="0"+c;return c}function L(a,b,c){var d=b._milliseconds,e=b._days,f=b._months,g;d&&a._d.setTime(+a+d*c),e&&a.date(a.date()+e*c),f&&(g=a.date(),
a.date(1).month(a.month()+f*c).date(Math.min(g,a.daysInMonth())))}function M(a){return Object.prototype.toString.call(a)==="[object Array]"}function N(a,b){var c=Math.min(a.length,b.length),d=Math.abs(a.length-b.length),e=0,f;for(f=0;f<c;f++)~~a[f]!==~~b[f]&&e++;return e+d}function O(a,b,c,d){var e,f,g=[];for(e=0;e<7;e++)g[e]=a[e]=a[e]==null?e===2?1:0:a[e];return a[7]=g[7]=b,a[8]!=null&&(g[8]=a[8]),a[3]+=c||0,a[4]+=d||0,f=new Date(0),b?(f.setUTCFullYear(a[0],a[1],a[2]),f.setUTCHours(a[3],a[4],a[5],
a[6])):(f.setFullYear(a[0],a[1],a[2]),f.setHours(a[3],a[4],a[5],a[6])),f._a=g,f}function P(a,c){var d,e,g=[];!c&&h&&(c=require("./lang/"+a));for(d=0;d<i.length;d++)c[i[d]]=c[i[d]]||f.en[i[d]];for(d=0;d<12;d++)e=b([2E3,d]),g[d]=new RegExp("^"+(c.months[d]||c.months(e,""))+"|^"+(c.monthsShort[d]||c.monthsShort(e,"")).replace(".",""),"i");return c.monthsParse=c.monthsParse||g,f[a]=c,c}function Q(a){var c=typeof a=="string"&&a||a&&a._lang||null;return c?f[c]||P(c):b}function R(a){return a.match(/\[.*\]/)?
a.replace(/^\[|\]$/g,""):a.replace(/\\/g,"")}function S(a){var b=a.match(k),c,d;for(c=0,d=b.length;c<d;c++)D[b[c]]?b[c]=D[b[c]]:b[c]=R(b[c]);return function(e){var f="";for(c=0;c<d;c++)f+=typeof b[c].call=="function"?b[c].call(e,a):b[c];return f}}function T(a,b){function d(b){return a.lang().longDateFormat[b]||b}var c=5;while(c--&&l.test(b))b=b.replace(l,d);return A[b]||(A[b]=S(b)),A[b](a)}function U(a){switch(a){case "DDDD":return p;case "YYYY":return q;case "S":case "SS":case "SSS":case "DDD":return o;
case "MMM":case "MMMM":case "dd":case "ddd":case "dddd":case "a":case "A":return r;case "Z":case "ZZ":return s;case "T":return t;case "MM":case "DD":case "YY":case "HH":case "hh":case "mm":case "ss":case "M":case "D":case "d":case "H":case "h":case "m":case "s":return n;default:return new RegExp(a.replace("\\",""))}}function V(a,b,c,d){var e,f;switch(a){case "M":case "MM":c[1]=b==null?0:~~b-1;break;case "MMM":case "MMMM":for(e=0;e<12;e++)if(Q().monthsParse[e].test(b)){c[1]=e,f=!0;break}f||(c[8]=!1);
break;case "D":case "DD":case "DDD":case "DDDD":b!=null&&(c[2]=~~b);break;case "YY":c[0]=~~b+(~~b>70?1900:2E3);break;case "YYYY":c[0]=~~Math.abs(b);break;case "a":case "A":d.isPm=(b+"").toLowerCase()==="pm";break;case "H":case "HH":case "h":case "hh":c[3]=~~b;break;case "m":case "mm":c[4]=~~b;break;case "s":case "ss":c[5]=~~b;break;case "S":case "SS":case "SSS":c[6]=~~(("0."+b)*1E3);break;case "Z":case "ZZ":d.isUTC=!0,e=(b+"").match(x),e&&e[1]&&(d.tzh=~~e[1]),e&&e[2]&&(d.tzm=~~e[2]),e&&e[0]==="+"&&
(d.tzh=-d.tzh,d.tzm=-d.tzm)}b==null&&(c[8]=!1)}function W(a,b){var c=[0,0,1,0,0,0,0],d={tzh:0,tzm:0},e=b.match(k),f,g;for(f=0;f<e.length;f++)g=(U(e[f]).exec(a)||[])[0],g&&(a=a.slice(a.indexOf(g)+g.length)),D[e[f]]&&V(e[f],g,c,d);return d.isPm&&c[3]<12&&(c[3]+=12),d.isPm===!1&&c[3]===12&&(c[3]=0),O(c,d.isUTC,d.tzh,d.tzm)}function X(a,b){var c,d=a.match(m)||[],e,f=99,g,h,i;for(g=0;g<b.length;g++)h=W(a,b[g]),e=T(new H(h),b[g]).match(m)||[],i=N(d,e),i<f&&(f=i,c=h);return c}function Y(a){var b="YYYY-MM-DDT",
c;if(u.exec(a)){for(c=0;c<4;c++)if(w[c][1].exec(a)){b+=w[c][0];break}return s.exec(a)?W(a,b+" Z"):W(a,b)}return new Date(a)}function Z(a,b,c,d,e){var f=e.relativeTime[a];return typeof f=="function"?f(b||1,!!c,a,d):f.replace(/%d/i,b||1)}function $(a,b,c){var e=d(Math.abs(a)/1E3),f=d(e/60),g=d(f/60),h=d(g/24),i=d(h/365),j=e<45&&["s",e]||f===1&&["m"]||f<45&&["mm",f]||g===1&&["h"]||g<22&&["hh",g]||h===1&&["d"]||h<=25&&["dd",h]||h<=45&&["M"]||h<345&&["MM",d(h/30)]||i===1&&["y"]||["yy",i];return j[2]=b,
j[3]=a>0,j[4]=c,Z.apply({},j)}function _(a,c){b.fn[a]=function(a){var b=this._isUTC?"UTC":"";return a!=null?(this._d["set"+b+c](a),this):this._d["get"+b+c]()}}function ab(a){b.duration.fn[a]=function(){return this._data[a]}}function bb(a,c){b.duration.fn["as"+a]=function(){return+this/c}}var b,c="1.7.2",d=Math.round,e,f={},g="en",h=typeof module!="undefined"&&module.exports,i="months|monthsShort|weekdays|weekdaysShort|weekdaysMin|longDateFormat|calendar|relativeTime|ordinal|meridiem".split("|"),j=
/^\/?Date\((\-?\d+)/i,k=/(\[[^\[]*\])|(\\)?(Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|YYYY|YY|a|A|hh?|HH?|mm?|ss?|SS?S?|zz?|ZZ?|.)/g,l=/(\[[^\[]*\])|(\\)?(LT|LL?L?L?)/g,m=/([0-9a-zA-Z\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+)/gi,n=/\d\d?/,o=/\d{1,3}/,p=/\d{3}/,q=/\d{1,4}/,r=/[0-9a-z\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+/i,s=/Z|[\+\-]\d\d:?\d\d/i,t=/T/i,u=/^\s*\d{4}-\d\d-\d\d(T(\d\d(:\d\d(:\d\d(\.\d\d?\d?)?)?)?)?([\+\-]\d\d:?\d\d)?)?/,v="YYYY-MM-DDTHH:mm:ssZ",w=[["HH:mm:ss.S",/T\d\d:\d\d:\d\d\.\d{1,3}/],
["HH:mm:ss",/T\d\d:\d\d:\d\d/],["HH:mm",/T\d\d:\d\d/],["HH",/T\d\d/]],x=/([\+\-]|\d\d)/gi,y="Month|Date|Hours|Minutes|Seconds|Milliseconds".split("|"),z={Milliseconds:1,Seconds:1E3,Minutes:6E4,Hours:36E5,Days:864E5,Months:2592E6,Years:31536E6},A={},B="DDD w M D d".split(" "),C="M D H h m s w".split(" "),D={M:function(){return this.month()+1},MMM:function(a){return E("monthsShort",this.month(),this,a)},MMMM:function(a){return E("months",this.month(),this,a)},D:function(){return this.date()},DDD:function(){var a=
new Date(this.year(),this.month(),this.date()),b=new Date(this.year(),0,1);return~~((a-b)/864E5+1.5)},d:function(){return this.day()},dd:function(a){return E("weekdaysMin",this.day(),this,a)},ddd:function(a){return E("weekdaysShort",this.day(),this,a)},dddd:function(a){return E("weekdays",this.day(),this,a)},w:function(){var a=new Date(this.year(),this.month(),this.date()-this.day()+5),b=new Date(a.getFullYear(),0,4);return~~((a-b)/864E5/7+1.5)},YY:function(){return K(this.year()%100,2)},YYYY:function(){return K(this.year(),
4)},a:function(){return this.lang().meridiem(this.hours(),this.minutes(),!0)},A:function(){return this.lang().meridiem(this.hours(),this.minutes(),!1)},H:function(){return this.hours()},h:function(){return this.hours()%12||12},m:function(){return this.minutes()},s:function(){return this.seconds()},S:function(){return~~(this.milliseconds()/100)},SS:function(){return K(~~(this.milliseconds()/10),2)},SSS:function(){return K(this.milliseconds(),3)},Z:function(){var a=-this.zone(),b="+";return a<0&&(a=
-a,b="-"),b+K(~~(a/60),2)+":"+K(~~a%60,2)},ZZ:function(){var a=-this.zone(),b="+";return a<0&&(a=-a,b="-"),b+K(~~(10*a/6),4)}};while(B.length)e=B.pop(),D[e+"o"]=G(D[e]);while(C.length)e=C.pop(),D[e+e]=F(D[e],2);D.DDDD=F(D.DDD,3),b=function(c,d){if(c===null||c==="")return null;var e,f;return b.isMoment(c)?new H(new Date(+c._d),c._isUTC,c._lang):(d?M(d)?e=X(c,d):e=W(c,d):(f=j.exec(c),e=c===a?new Date:f?new Date(+f[1]):c instanceof Date?c:M(c)?O(c):typeof c=="string"?Y(c):new Date(c)),new H(e))},b.utc=
function(a,c){return M(a)?new H(O(a,!0),!0):(typeof a=="string"&&!s.exec(a)&&(a+=" +0000",c&&(c+=" Z")),b(a,c).utc())},b.unix=function(a){return b(a*1E3)},b.duration=function(a,c){var d=b.isDuration(a),e=typeof a=="number",f=d?a._data:e?{}:a,g;return e&&(c?f[c]=a:f.milliseconds=a),g=new I(f),d&&(g._lang=a._lang),g},b.humanizeDuration=function(a,c,d){return b.duration(a,c===!0?null:c).humanize(c===!0?!0:d)},b.version=c,b.defaultFormat=v,b.lang=function(a,c){var d;if(!a)return g;(c||!f[a])&&P(a,c);
if(f[a]){for(d=0;d<i.length;d++)b[i[d]]=f[a][i[d]];b.monthsParse=f[a].monthsParse,g=a}},b.langData=Q,b.isMoment=function(a){return a instanceof H},b.isDuration=function(a){return a instanceof I},b.lang("en",{months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),monthsShort:"Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),weekdaysShort:"Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),
weekdaysMin:"Su_Mo_Tu_We_Th_Fr_Sa".split("_"),longDateFormat:{LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D YYYY",LLL:"MMMM D YYYY LT",LLLL:"dddd, MMMM D YYYY LT"},meridiem:function(a,b,c){return a>11?c?"pm":"PM":c?"am":"AM"},calendar:{sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[last] dddd [at] LT",sameElse:"L"},relativeTime:{future:"in %s",past:"%s ago",s:"a few seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",
dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"},ordinal:function(a){var b=a%10;return~~(a%100/10)===1?"th":b===1?"st":b===2?"nd":b===3?"rd":"th"}}),b.fn=H.prototype={clone:function(){return b(this)},valueOf:function(){return+this._d},unix:function(){return Math.floor(+this._d/1E3)},toString:function(){return this._d.toString()},toDate:function(){return this._d},toArray:function(){var a=this;return[a.year(),a.month(),a.date(),a.hours(),a.minutes(),a.seconds(),a.milliseconds(),!!this._isUTC]},
isValid:function(){return this._a?this._a[8]!=null?!!this._a[8]:!N(this._a,(this._a[7]?b.utc(this._a):b(this._a)).toArray()):!isNaN(this._d.getTime())},utc:function(){return this._isUTC=!0,this},local:function(){return this._isUTC=!1,this},format:function(a){return T(this,a?a:b.defaultFormat)},add:function(a,c){var d=c?b.duration(+c,a):b.duration(a);return L(this,d,1),this},subtract:function(a,c){var d=c?b.duration(+c,a):b.duration(a);return L(this,d,-1),this},diff:function(a,c,e){var f=this._isUTC?
b(a).utc():b(a).local(),g=(this.zone()-f.zone())*6E4,h=this._d-f._d-g,i=this.year()-f.year(),j=this.month()-f.month(),k=this.date()-f.date(),l;return c==="months"?l=i*12+j+k/30:c==="years"?l=i+(j+k/30)/12:l=c==="seconds"?h/1E3:c==="minutes"?h/6E4:c==="hours"?h/36E5:c==="days"?h/864E5:c==="weeks"?h/6048E5:h,e?l:d(l)},from:function(a,c){return b.duration(this.diff(a)).lang(this._lang).humanize(!c)},fromNow:function(a){return this.from(b(),a)},calendar:function(){var a=this.diff(b().sod(),"days",!0),
c=this.lang().calendar,d=c.sameElse,e=a<-6?d:a<-1?c.lastWeek:a<0?c.lastDay:a<1?c.sameDay:a<2?c.nextDay:a<7?c.nextWeek:d;return this.format(typeof e=="function"?e.apply(this):e)},isLeapYear:function(){var a=this.year();return a%4===0&&a%100!==0||a%400===0},isDST:function(){return this.zone()<b([this.year()]).zone()||this.zone()<b([this.year(),5]).zone()},day:function(a){var b=this._isUTC?this._d.getUTCDay():this._d.getDay();return a==null?b:this.add({d:a-b})},startOf:function(a){switch(a.replace(/s$/,
"")){case "year":this.month(0);case "month":this.date(1);case "day":this.hours(0);case "hour":this.minutes(0);case "minute":this.seconds(0);case "second":this.milliseconds(0)}return this},endOf:function(a){return this.startOf(a).add(a.replace(/s?$/,"s"),1).subtract("ms",1)},sod:function(){return this.clone().startOf("day")},eod:function(){return this.clone().endOf("day")},zone:function(){return this._isUTC?0:this._d.getTimezoneOffset()},daysInMonth:function(){return b.utc([this.year(),this.month()+
1,0]).date()},lang:function(b){return b===a?Q(this):(this._lang=b,this)}};for(e=0;e<y.length;e++)_(y[e].toLowerCase(),y[e]);_("year","FullYear"),b.duration.fn=I.prototype={weeks:function(){return J(this.days()/7)},valueOf:function(){return this._milliseconds+this._days*864E5+this._months*2592E6},humanize:function(a){var b=+this,c=this.lang().relativeTime,d=$(b,!a,this.lang()),e=b<=0?c.past:c.future;return a&&(typeof e=="function"?d=e(d):d=e.replace(/%s/i,d)),d},lang:b.fn.lang};for(e in z)z.hasOwnProperty(e)&&
(bb(e,z[e]),ab(e.toLowerCase()));bb("Weeks",6048E5),h&&(module.exports=b),typeof ender=="undefined"&&(this.moment=b),typeof define=="function"&&define.amd&&define("moment",[],function(){return b})}).call(this);
(function(window,document,$,undefined){var prefix;var property;var eventName;var prefixes=["webkit","o","ms","moz",""];var $support=$.support;var $event=$.event;while((prefix=prefixes.pop())!=undefined){property=(prefix?prefix+"H":"h")+"idden";if($support.pageVisibility=typeof document[property]=="boolean"){eventName=prefix+"visibilitychange";break}}if(eventName!=undefined)$(document).on(eventName,function(event){var type=event.type;var originalEvent=event.originalEvent;if(!originalEvent)return;var toElement=
originalEvent.toElement;if(toElement==undefined&&originalEvent.fromElement==undefined&&originalEvent.relatedTarget==undefined)$event.trigger((property&&document[property]||/^(?:blur|focusout)$/.test(type)?"hide":"show")+".visibility")})})(this,document,jQuery);
!function(a,b){var c,d;if(a.uaMatch=function(a){a=a.toLowerCase();var b=/(opr)[\/]([\w.]+)/.exec(a)||/(chrome)[ \/]([\w.]+)/.exec(a)||/(version)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/.exec(a)||/(webkit)[ \/]([\w.]+)/.exec(a)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(a)||/(msie) ([\w.]+)/.exec(a)||a.indexOf("trident")>=0&&/(rv)(?::| )([\w.]+)/.exec(a)||a.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(a)||[],c=/(ipad)/.exec(a)||/(iphone)/.exec(a)||/(android)/.exec(a)||/(windows phone)/.exec(a)||
/(win)/.exec(a)||/(mac)/.exec(a)||/(linux)/.exec(a)||[];return{browser:b[3]||b[1]||"",version:b[2]||"0",platform:c[0]||""}},c=a.uaMatch(b.navigator.userAgent),d={},c.browser&&(d[c.browser]=!0,d.version=c.version,d.versionNumber=parseFloat(c.version,10)),c.platform&&(d[c.platform]=!0),(d.chrome||d.opr||d.safari)&&(d.webkit=!0),d.rv){var e="msie";c.browser=e,d[e]=!0}if(d.opr){var f="opera";c.browser=f,d[f]=!0}d.name=c.browser,d.platform=c.platform,a.browser=d}(jQuery,window);
SUPPORTED_BROWSERS=Object.create({"msie":{"min":10,"max":11,"minEOSDate":"12/31/2015","recommended":false},"chrome":{"min":30,"max":31,"minEOSDate":"12/31/2015","recommended":true},"mozilla":{"min":23,"max":25,"minEOSDate":"12/31/2015","recommended":false},"safari":{"min":6,"max":7,"minEOSDate":"12/31/2015","recommended":false}});
(function($){Object.freeze(SUPPORTED_BROWSERS);Desk=window.Desk||{};Desk.BrowserVersionCheck={NOTIFY_BROWSER_SUPPORT_EXPIRY_PERIOD:30,browserUnsupported:false,browserSupportEnding:false,getContainer:function(){var container=$("#browserNotSupported");if(container.length===0)container=$("<div/>",{id:"browserNotSupported"}).hide().appendTo("body");return container},browser:$.browser.name,version:$.browser.versionNumber,setModalReadFlag:function(flagName){if(typeof flagName=="undefined"||typeof sessionStorage==
"undefined")return;sessionStorage.setItem(flagName,true)},readModalReadFlag:function(flagName){if(typeof flagName=="undefined"||typeof sessionStorage=="undefined")return false;return sessionStorage.getItem(flagName)},setupCloseModalEvent:function(){$("#browserNotSupportedModal .close_modal").click(function(){tb_remove()})},init:function(){var browser=Desk.BrowserVersionCheck.browser;var version=Desk.BrowserVersionCheck.version;if(window.location.href.match(/(\?|&)skip_browser_version_check=true/))return null;
if(typeof SUPPORTED_BROWSERS[browser]=="undefined"||version<SUPPORTED_BROWSERS[browser].min){if(!Desk.BrowserVersionCheck.readModalReadFlag("browserUnsupported")){Desk.BrowserVersionCheck.browserUnsupported=true;var container=Desk.BrowserVersionCheck.getContainer();container.template("common/browser_version/unsupportedBrowser",SUPPORTED_BROWSERS);tb_show("unsupported_browser","#TB_inline?height=520&width=600&inlineId=browserNotSupported&modal=true");Desk.BrowserVersionCheck.setModalReadFlag("browserUnsupported");
Desk.BrowserVersionCheck.setupCloseModalEvent()}}else if(SUPPORTED_BROWSERS[browser].min===version&&moment(SUPPORTED_BROWSERS[browser].minEOSDate).diff(moment(),"days")<=Desk.BrowserVersionCheck.NOTIFY_BROWSER_SUPPORT_EXPIRY_PERIOD)if(!Desk.BrowserVersionCheck.readModalReadFlag("browserSupportEnding")){Desk.BrowserVersionCheck.browserSupportEnding=true;var container=Desk.BrowserVersionCheck.getContainer();container.template("common/browser_version/unsupportedBrowser",SUPPORTED_BROWSERS);tb_show("unsupported_browser",
"#TB_inline?height=520&width=600&inlineId=browserNotSupported&modal=true");Desk.BrowserVersionCheck.setModalReadFlag("browserSupportEnding");Desk.BrowserVersionCheck.setupCloseModalEvent()}}};$(document).ready(function(){Desk.BrowserVersionCheck.init()})})(jQuery);
Handlebars.registerHelper("browserVersionMessage",function(){var obj={name:Assistly.current_user.name};if(Desk.BrowserVersionCheck.browserUnsupported)return I18n.translate("common.browserVersionCheck.browserUnsupported",obj);else if(Desk.BrowserVersionCheck.browserSupportEnding){obj["date"]=SUPPORTED_BROWSERS[Desk.BrowserVersionCheck.browser].minEOSDate;return I18n.translate("common.browserVersionCheck.browserSupportEnding",obj)}});
Handlebars.registerHelper("browserRecommended",function(browser){if(SUPPORTED_BROWSERS[browser].recommended)return"("+I18n.translate("common.browserVersionCheck.labels.recommended")+")"});function htmlEntities(str){return String(str).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/,"&apos;")}
function show_company_history_toolbar_current_case(){$("#main_company_history_view_tid_"+current_tab_id).hide();$("#main_company_history_view_current_case_tid_"+current_tab_id).show();$("#main_company_history_view_tid_"+current_tab_id+" .pagination").hide();$("#tabs-tid_"+current_tab_id+" .customer_history_toggle .ticket_toolbar_current_view").show();$("#tabs-tid_"+current_tab_id+" .customer_history_toggle .ticket_toolbar_all_view").hide()}
function show_company_history_toolbar_all_cases(){$("#main_company_history_view_tid_"+current_tab_id).show();$("#main_company_history_view_current_case_tid_"+current_tab_id).hide();$("#main_company_history_view_tid_"+current_tab_id+" .pagination").show();$("#tabs-tid_"+current_tab_id+" .customer_history_toggle .ticket_toolbar_all_view").show();$("#tabs-tid_"+current_tab_id+" .customer_history_toggle .ticket_toolbar_current_view").hide()}
function show_customer_history_toolbar_current_case(){$("#main_customer_history_view_tid_"+current_tab_id).hide();$("#main_customer_history_view_current_case_tid_"+current_tab_id).show();$("#main_customer_history_view_tid_"+current_tab_id+" .pagination").hide();$("#tabs-tid_"+current_tab_id+" .customer_history_toggle .ticket_toolbar_current_view").show();$("#tabs-tid_"+current_tab_id+" .customer_history_toggle .ticket_toolbar_all_view").hide()}
function show_customer_history_toolbar_all_cases(goToTicket){$("#main_customer_history_view_tid_"+current_tab_id).show();$("#main_customer_history_view_current_case_tid_"+current_tab_id).hide();if(typeof goToTicket!="undefined"&&goToTicket==true&&!$("#main_customer_history_view_tid_"+current_tab_id).hasClass("loaded")&&$("#main_customer_history_view_tid_"+current_tab_id+" .customer_history_case_center").length>0){$("#main_customer_history_view_tid_"+current_tab_id).children(".history_interactions_container").css("visibility",
"hidden");$("#main_customer_history_view_tid_"+current_tab_id).parent().animate({scrollTop:0},80,function(){$("#main_customer_history_view_tid_"+current_tab_id).children(".a-spinner-wrapper").show()})}$("#main_customer_history_view_tid_"+current_tab_id+" .pagination").show();$("#tabs-tid_"+current_tab_id+" .customer_history_toggle .ticket_toolbar_all_view").show();$("#tabs-tid_"+current_tab_id+" .customer_history_toggle .ticket_toolbar_current_view").hide()}TAB_WIDTH=90;
function _tabbar_working_area(){var $last=$("#tabs ul.ui-tabs-nav li:visible:last");if($("#tabs ul.ui-tabs-nav li:first").offset().top!=$last.offset().top)return-1;var buttonOffSet;if($("#tabs ul.ui-tabs-nav").hasClass("hidden-mode"))buttonOffSet=$("#a-tabs-more .a-more-button").offset();else buttonOffSet=$("#a-new-case .new_case_button").offset();if(buttonOffSet&&$last.offset())return buttonOffSet.left-$last.offset().left-$last.width();else return 100}
function adjust_tabbar_open(resizing){if(!$(".top_tab_customer_name").hasClass("a-shrink"))adjust_top_tabbar_customer_name();if(!$(".top_tab_customer_name").hasClass("a-shrink"))return false;var working_area=TAB_WIDTH;if(resizing)working_area=0;if(!$("#tabs ul.ui-tabs-nav").hasClass("hidden-mode")&&_tabbar_working_area()<=working_area){$("#tabs ul.ui-tabs-nav").addClass("hidden-mode");$("#a-tabs-more .a-more-container").show();$("#a-tabs-more .a-more-button").show()}if($("#tabs ul.ui-tabs-nav").hasClass("hidden-mode")&&
_tabbar_working_area()<=working_area){$tab=$("#tabs ul.ui-tabs-nav li:visible:last");$tab.hide().find(".top_tab_customer_name").addClass("a-shrink");if(resizing){var tab_id=$tab.find("span.tab_closer").prop("id").slice(0,-7);adjust_tabbar_populate(tab_id,true)}return true}return false}
function adjust_tabbar_populate(tab_id,push){var $tab=$("#tabs ul.ui-tabs-nav li a[href='#"+tab_id+"']").parent("li");if($tab.is(":hidden")){if($("#a-tabs-more ul li[tab-id='"+tab_id+"']").length>0){adjust_tabbar_select(tab_id);return}var li=$('<li tab-id="'+tab_id+'"></li>');var icon=$('<span class="icon"/>').append($tab.find(".top_tab_icon img").clone());var customer=$('<span class="customer"/>').append($tab.find(".top_tab_customer_name").text().html_encode());li.append('<span class="closer"></span>');
li.append(icon).append(customer);push=push||false;if(push)li.prependTo($("#a-tabs-more ul"));else li.appendTo($("#a-tabs-more ul"))}else adjust_top_tabbar_customer_name()}function adjust_tabbar_select(tab_id){$("#a-tabs-more ul li").removeClass("selected");$("#a-tabs-more ul li[tab-id='"+tab_id+"']").addClass("selected")}
function adjust_tabbar_remove(){if(!$(".top_tab_customer_name").hasClass("a-shrink"))return false;if(!$("#tabs ul.ui-tabs-nav").hasClass("hidden-mode")){adjust_top_tabbar_customer_name();return false}if(_tabbar_working_area()<=TAB_WIDTH)return false;var $first=$("#a-tabs-more .a-more-container ul li:first");var tabid=$first.attr("tab-id");$first.remove();var $tab=$("#tabs ul.ui-tabs-nav li a[href='#"+tabid+"']").parent("li");$tab.find(".top_tab_customer_name").addClass("a-shrink");$tab.show();if($("#a-tabs-more ul li").length==
0){$("#tabs ul.ui-tabs-nav").removeClass("hidden-mode");$("#a-tabs-more .a-more-container").hide();$("#a-tabs-more .a-more-button").hide()}return true}function adjust_tabbar_resize(){var popped=false;while(adjust_tabbar_remove())popped=true;if(popped)return;var pushed=false;while(adjust_tabbar_open(true))pushed=true}
function adjust_top_tabbar_customer_name(){var $last=$("#tabs ul:first li:visible:last");if($last.length>0)if($("#tabs ul.ui-tabs-nav").hasClass("hidden-mode")||$last.prev().hasClass("a-shrink")||_tabbar_working_area()<10)$(".top_tab_customer_name").addClass("a-shrink");else{$(".top_tab_customer_name").removeClass("a-shrink");if(_tabbar_working_area()<10)$(".top_tab_customer_name").addClass("a-shrink")}}
function renderTicketFilterList(data){$(".toolbar_ticket_filter_list").html(generateHandlebarsTicketFilterList(data))}function generateHandlebarsTicketFilterList(data){return handlebarsTicketFilters(data)}function generateHandlebarsTicketFilterItemTableHTML(data){return handlebarsTicketFilterItemTable(data)}function generateHandlebarsTicketFilterItemFullHTML(data){return handlebarsTicketFilterItemFull(data)}
function generateHandlebarsTicketShow(uuid,reuseTab){return handlebarsTicketShow({uuid:uuid,reuseTab:reuseTab})}function bindFilterPagination(){$("div#tab-ticket-filter-pagination > div.pagination a").bind("click",function(event){event.preventDefault();current_ticket_filter_id=0;current_ticket_filter_page_num=1;blockTicketFilterList();$("#right_tabs_ticket_panel_blank").show();$("#ticket_filter_list_items_data_div").hide();$.get(this)})}
function changeTicketFilterView(e,tf_id,obj){if($(e.target).hasClass("routing-controls")||$(e.target).hasClass("routing-control-btn"))return false;Assistly.polling.ticket_filters.next_update=(new Date).getTime();override_ticket_filter_sort_order_combined_id=getLocalStoragePrefs("assistly.lastSortOrderTicketFilter"+tf_id);if(!override_ticket_filter_sort_order_combined_id)override_ticket_filter_sort_order_combined_id=-1;blockTicketFilterList();$(".toolbar_ticket_filter_list").children().removeClass("ticket_filter_highlight");
obj.addClass("ticket_filter_highlight");current_ticket_filter_items="";current_ticket_filter_id=tf_id;selected_ticket_filter_id=tf_id;last_ticket_filter_id=-1;current_ticket_filter_page_num=1;ticket_filter_page_change=1;remove_ticket_filter_spinners=1;poll_ticket_filter_at_warp_speed=true;$("#right_tabs_ticket_panel_blank").show();removeTicketFilterBulkManageWindow();$("#ticket_filter_list_items_data_div").hide()}
function removeTicketFilterBulkManageWindow(){$("#right_tabs_ticket_panel").removeClass("bulk_manage_mode").addClass("cols_100_height");$("#ticket_filter_items_manage_menu").removeClass("loaded").hide()}function updateTicketFilterCounts(tf_id,cnt){var obj=$(".tab-ticket-filter-total-count-"+tf_id);obj.html($.format(cnt,"n0"));if(cnt<1)$("#tab-ticket-filter-"+tf_id).addClass("ticket_filter_row_empty");else $("#tab-ticket-filter-"+tf_id).removeClass("ticket_filter_row_empty")}
function submitBulkTicketFilterOpenTickets(mode,viewType){var viewType=viewType||"/edit";selected_tickets=getSelectedTicketFilterItemsIds(mode).split(",");if(selected_tickets.length>0&&selected_tickets!=""){for(ticket in selected_tickets)jQuery.ajax({dataType:"script",type:"get",url:"/agent/tickets/"+selected_tickets[ticket]+viewType});showBulkTicketLoad();resetTicketFilterItemSelctions(mode);toggleTicketFilterManageMenu(mode)}}
function handleTicketFilterApplyToAllClick(that,mode){var base_ticket_manage_parent=-1;if(mode==0)base_ticket_manage_parent=$("#ticket_filter_items_manage_menu");if(mode==1)base_ticket_manage_parent=$("#search_manage_menu");updateBulkTicketFilterQuickReply(mode);if($(that).prop("checked")){base_ticket_manage_parent.find("#bulk_change_apply_to_all_interaction_type_id").removeProp("disabled");base_ticket_manage_parent.find("#ticket_filter_bulk_open_button").prop("disabled",true)}else{base_ticket_manage_parent.find("#bulk_change_apply_to_all_interaction_type_id").prop("disabled",
true);base_ticket_manage_parent.find("#ticket_filter_bulk_open_button").removeProp("disabled")}}
function resetTicketFilterItemSelctions(mode){var base_ticket_parent=-1;if(mode==0)base_ticket_parent=$ticket_filter_list_items;if(mode==1)base_ticket_parent=$("#agent_search_results");var base_ticket_manage_parent=-1;if(mode==0)base_ticket_manage_parent=$("#ticket_filter_items_manage_menu");if(mode==1)base_ticket_manage_parent=$("#search_manage_menu");base_ticket_parent.find(".ticket_filter_item").removeClass("ticket_filter_item_main_selected",1500).find(".ticket_filter_check_box").prop("checked",
false);base_ticket_manage_parent.removeClass("loaded")}
function selectAllTicketFilterItems(mode){var base_ticket_parent=-1;if(mode==0)base_ticket_parent=$ticket_filter_list_items;if(mode==1)base_ticket_parent=$("#agent_search_results");base_ticket_parent.find(".ticket_filter_item").not(".ticket_filter_item_non_selectable").find(".ticket_filter_check_box").prop("checked",true);base_ticket_parent.find(".ticket_filter_item").not(".ticket_filter_item_non_selectable").addClass("ticket_filter_item_main_selected");toggleTicketFilterManageMenu(mode);if(mode===
0)$("#select_all_tickets_check_box").attr("onclick","deselectAllTicketFilterItems(0)").children("input").prop("checked",true)}
function deselectAllTicketFilterItems(mode){var base_ticket_parent=-1;if(mode==0)base_ticket_parent=$ticket_filter_list_items;if(mode==1)base_ticket_parent=$("#agent_search_results");base_ticket_parent.find(".ticket_filter_check_box").not(".ticket_filter_item_non_selectable").prop("checked",false);base_ticket_parent.find(".ticket_filter_item").not(".ticket_filter_item_non_selectable").removeClass("ticket_filter_item_main_selected");if(mode==0)$("#ticket_filter_items_manage_menu").removeClass("loaded");
if(mode==1)$("#search_manage_menu").removeClass("loaded");toggleTicketFilterManageMenu(mode);if(mode===0)$("#select_all_tickets_check_box").attr("onclick","selectAllTicketFilterItems(0)").children("input").prop("checked",false)}
function getSelectedTicketFilterItemsIds(mode){var base_ticket_parent=-1;if(mode==0)base_ticket_parent=$ticket_filter_list_items;if(mode==1)base_ticket_parent=$("#agent_search_results");arr=[];base_ticket_parent.find(":checked").each(function(i,selected){arr.push(selected.id.replace("ticket_filter_item_",""))});return arr.join(",")}
function closeTab(tab_id,ignore_no_tab_warning){if(ignore_no_tab_warning===undefined)ignore_no_tab_warning=false;tab=findTicketIdFromTabId(tab_id);if(tab)Desk.AppliedArticles.removeAll(tab);var atab=$('a[href="#tabs-tid_'+tab_id+'"]');if(atab.length==0)return;destroyTooltip(atab);$tabs.tabs("select",last_tab_index);$("#tabs-tid_"+tab_id).hide();$("#tabs-tid_"+tab_id+"-closer").closest("li").hide();$tabs.tabs("remove",$("#tabs ul li").index(atab.parent()));if($tabs.find("ul li").length==0){if(!ignore_no_tab_warning)showNoTabsPopup();
ready_to_poll=false}else if(Assistly.routing.online){poll_force_route_ticket=true;poll_agent_at_warp_speed=true}}function closeTabByTicketId(ticket_id){var tab_id="";tab_id=$(".ticket_id_"+ticket_id).prop("id");if(tab_id&&tab_id!="")closeTab(tab_id.substring(9))}function loopSound(soundID){window.setTimeout(function(){soundManager.play(soundID,{onfinish:function(){loopSound(soundID)}})},1)}function resetDocumentTitle(ms){setTimeout(function(){document.title=ORIGINAL_TITLE},ms)}
function blockTicketFilterList(){$("#toolbar_ticket_filter_list_blocker").show()}function unblockTicketFilterList(){$("#toolbar_ticket_filter_list_blocker").hide()}function blockTwitterSearchList(){$("#toolbar_twitter_search_list_blocker").show()}function unblockTwitterSearchList(){$("#toolbar_twitter_search_list_blocker").hide()}
function setTweetSearchRetweetTruncationMessage(){if(countTweetLength($("#tweet_retweet_queue_item_text").val())>140)$("#tweet_retweet_truncation_warn").show();else $("#tweet_retweet_truncation_warn").hide()}function setTweetRetweetTruncationMessage(tweet_id){if($("#tweet_retweet_text_"+tweet_id).val().length>140)$("#tweet_retweet_truncation_warn_"+tweet_id).show();else $("#tweet_retweet_truncation_warn_"+tweet_id).hide()}
function kbArticleOnSearch(tab_id){var kb_tab=tab_id==0||tab_id==""?$("#tabs-kb"):$("#tabs-tid_"+tab_id);kb_tab.find(".agent_kb_search_main_browse_right_data").hide();kb_tab.find(".agent_kb_search_main_browse_right_data_header").hide();kb_tab.find(".agent_kb_search_main_browse_right_spinner").show()}
function highlightTweetSearchTerms(query){$.each(query.split("OR"),function(index,value){$("#twitter_search_list_items .tweet_search_item_tweet").highlight(value,'<span class="highlight">$1</span>')});$.each(query.split("AND"),function(index,value){$("#twitter_search_list_items .tweet_search_item_tweet").highlight(value,'<span class="highlight">$1</span>')})}
function collapseTicketFilters(){$("#tabs_ticket_panel").addClass("expanded");$("#left_tabs_ticket_panel").hide();$("#right_tabs_ticket_panel").animate({left:"10px"},250,function(){$("#ticket_filter_minimized_div").show();$(".ticket_filter_expand_button").show();$("#ticket_filter_grouping_div").addClass("ticket_filter_grouping_div_centered")});refreshRoutingControls();$("#ticket_filter_items_manage_menu").animate({left:"10px"},250)}
function expandTicketFilters(){$("#tabs_ticket_panel").removeClass("expanded");$("#ticket_filter_minimized_div").hide();$("#right_tabs_ticket_panel").animate({left:"305px"},250,function(){$("#left_tabs_ticket_panel").show();$(".ticket_filter_expand_button").hide();$("#ticket_filter_grouping_div").removeClass("ticket_filter_grouping_div_centered")});refreshRoutingControls();$("#ticket_filter_items_manage_menu").animate({left:"305px"},250)}
function redrawTicketFilterView(){if($("#tabs_ticket_panel").hasClass("expanded")){$("#ticket_filter_minimized_div").show();$(".ticket_filter_expand_button").show();$("#ticket_filter_grouping_div").addClass("ticket_filter_grouping_div_centered")}}function collapseTwitterSearches(){$("#tabs_twitter_searches_panel").addClass("expanded");$("#left_tabs_twitter_search_panel").hide();$("#right_tabs_twitter_search_panel").animate({left:"0"},250,function(){$(".twitter_expand_button").show()})}
function expandTwitterSearches(){$("#tabs_twitter_searches_panel").removeClass("expanded");$(".twitter_expand_button").hide();$("#toolbar_twitter_search").show();$("#right_tabs_twitter_search_panel").animate({left:"305px"},250,function(){$("#left_tabs_twitter_search_panel").show()})}
function changeTicketFilterViewMode(){blockTicketFilterList();$("#ticket_filter_list_items_blank_div").show();$("#ticket_filter_list_items_data_div").hide();$("#ticket_filter_list_header").hide();remove_ticket_filter_spinners=1;poll_ticket_filter_at_warp_speed=true;$("#right_tabs_ticket_panel").removeClass("bulk_manage_mode").addClass("cols_100_height");$("#ticket_filter_items_manage_menu").removeClass("loaded").hide()}
function changeTicketFilterSortOrder(sort_order){setLocalStoragePrefs("assistly.lastSortOrderTicketFilter"+current_ticket_filter_id,sort_order);current_ticket_filter_items="";ticket_filter_page_change=1;current_ticket_filter_page_num=1;current_ticket_filter_sort_order_combined_id=sort_order;changeTicketFilterViewMode()}
function ticketFilterUpdateCompletion(ticket_filter_id,table_view){last_ticket_filter_id=current_ticket_filter_id;redrawTicketFilterView();$(".toolbar_ticket_filter_list").children().removeClass("ticket_filter_highlight");$("#tab-ticket-filter-"+ticket_filter_id).addClass("ticket_filter_highlight");unblockTicketFilterList();if(remove_ticket_filter_spinners){$("#right_tabs_ticket_panel_blank").hide();$("#ticket_filter_list_items_data_div").show();$("#ticket_filter_list_items_blank_div").hide();if(table_view)$("#ticket_filter_list_header").show();
$("#ticket_filter_list_items_data_div").show();remove_ticket_filter_spinners=0}}
function ticketFilterItemClick(that,event,mode){var base_ticket_parent=-1;var selected_item=null;if(!$(that).hasClass("ticket_filter_item")){var focus_checkbox=that;that=$(that).parents(".ticket_filter_item")}if(mode==0){base_ticket_parent=$ticket_filter_list_items;selected_item=current_ticket_filter_selected_item}if(mode==1){base_ticket_parent=$("#agent_search_results");selected_item=current_search_selected_item}$(that).find(".a-row-hover:visible").hide();if(event.shiftKey)if(selected_item.nextAll("#"+
$(that).prop("id")).filter(":not('.ticket_filter_item_non_selectable')").length==0)selected_item.prevUntil("#"+$(that).prop("id")).add($(that)).filter(":not('.ticket_filter_item_non_selectable')").addClass("ticket_filter_item_main_selected").find(".ticket_filter_check_box").prop("checked",true);else if(selected_item.prevAll("#"+$(that).prop("id")).filter(":not('.ticket_filter_item_non_selectable')").length==0)selected_item.nextUntil("#"+$(that).prop("id")).add($(that)).filter(":not('.ticket_filter_item_non_selectable')").addClass("ticket_filter_item_main_selected").find(".ticket_filter_check_box").prop("checked",
true);else;else{if(mode==0){current_ticket_filter_selected_item=$(that);selected_item=current_ticket_filter_selected_item}if(mode==1){current_search_selected_item=$(that);selected_item=current_search_selected_item}base_ticket_parent.find(".ticket_filter_item_current_selected").removeClass("ticket_filter_item_current_selected");selected_item.addClass("ticket_filter_item_current_selected");if($(that).hasClass("ticket_filter_item_main_selected")){$(that).removeClass("ticket_filter_item_main_selected");
if(typeof focus_checkbox!="undefined")$(focus_checkbox).prop("checked",false)}else{$(that).addClass("ticket_filter_item_main_selected");if(typeof focus_checkbox!="undefined")$(focus_checkbox).prop("checked",true)}}if(isIe7())Ie7TicketFilterHack(mode);toggleTicketFilterManageMenu(mode);updateBulkTicketFilterQuickReply(mode)}
function toggleTicketFilterBulkLink(mode){if(mode==0)if($("#ticket_filter_list_items :checked").length>0)if(!$("#ticket_filter_items_manage_menu").is(":visible"))$("#ticket_filter_bulk_manage_label").show();else $("#ticket_filter_bulk_manage_label").hide();else{$("#ticket_filter_bulk_manage_label").hide();$("#ticket_filter_items_manage_menu").hide();$("#right_tabs_ticket_panel").removeClass("bulk_manage_mode").addClass("cols_100_height")}if(mode==1)if($("#agent_search_results :checked").length>0)if(!$("#search_manage_menu").is(":visible"))$("#a-search-bulk-label").show();
else $("#a-search-bulk-label").hide();else{$("#a-search-bulk-label").hide();$("#search_manage_menu").hide();$("#agent_search_tab").removeClass("bulk_manage_mode").addClass("cols_100_height")}}
function toggleTicketFilterManageMenu(mode){var checkedTickets,adjustScrollPosition=function($row){var $container=$row.scrollParent(),position=$container.scrollTop(),offset=$row.offset().top-$container.height()-$row.height();if(offset>0)$container.scrollTop(position+offset)};if(mode===0){checkedTickets=$("#ticket_filter_list_items :checked");if(checkedTickets.length>0){if(!$("#ticket_filter_items_manage_menu").is(":visible")){if(!$("#ticket_filter_items_manage_menu").hasClass("loaded"))jQuery.ajax({data:"id="+
current_ticket_filter_id,dataType:"script",type:"get",url:"/agent/ticket_filters/bulk_menu_change"});$("#ticket_filter_items_manage_menu").show();$("#right_tabs_ticket_panel").addClass("bulk_manage_mode").removeClass("cols_100_height");adjustScrollPosition(checkedTickets.first().parents("tr"))}}else{$("#ticket_filter_items_manage_menu").hide();$("#right_tabs_ticket_panel").removeClass("bulk_manage_mode").addClass("cols_100_height")}}if(mode==1){checkedTickets=$("#agent_search_results :checked");if(checkedTickets.length>
0){if(!$("#search_manage_menu").is(":visible")){if(!$("#search_manage_menu").hasClass("loaded"))jQuery.ajax({dataType:"script",type:"get",url:"/agent/searches/bulk_menu_change"});$("#search_manage_menu").show();$("#agent_search_tab").addClass("bulk_manage_mode").removeClass("cols_100_height");adjustScrollPosition(checkedTickets.first().parents("div.a-search-results-item"))}}else{$("#search_manage_menu").hide();$("#agent_search_tab").removeClass("bulk_manage_mode").addClass("cols_100_height")}}if(isIe7())Ie7TicketFilterHack(0)}
function Ie7TicketFilterHack(mode){if(mode==0)base_paginator_parent=$("#ticket_filter_item_paginator");if(mode==1)base_paginator_parent=$("#agent_search_paginator");if(base_paginator_parent.css("margin-bottom")!=undefined){var paginator_bottom=base_paginator_parent.css("margin-bottom").substr(0,base_paginator_parent.css("margin-bottom").length-2);base_paginator_parent.css("margin-bottom",Number(paginator_bottom)+1+"px");setTimeout(function(){base_paginator_parent.css("margin-bottom",Number(paginator_bottom)+
2+"px")},750);setTimeout(function(){base_paginator_parent.css("margin-bottom",Number(paginator_bottom)+3+"px")},1500)}}function closeAllToolTips(){$(".qtip").hide();setTimeout(function(){$(".qtip").hide()},1E3);setTimeout(function(){$(".qtip").hide()},5E3)}
function isDifferentTicketFilterInteractionTypesSelected(mode){var base_ticket_parent=-1;if(mode==0)base_ticket_parent=$ticket_filter_list_items;if(mode==1)base_ticket_parent=$("#agent_search_results");total_selected=base_ticket_parent.find(".ticket_filter_item_main_selected").length;web_callbacks_selected=base_ticket_parent.find(".ticket_filter_item_main_selected.interaction_type_10").length;chats_selected=base_ticket_parent.find(".ticket_filter_item_main_selected.interaction_type_20").length;tweets_selected=
base_ticket_parent.find(".ticket_filter_item_main_selected.interaction_type_30").length;emails_selected=base_ticket_parent.find(".ticket_filter_item_main_selected.interaction_type_40").length;qnas_selected=base_ticket_parent.find(".ticket_filter_item_main_selected.interaction_type_50").length;phones_selected=base_ticket_parent.find(".ticket_filter_item_main_selected.interaction_type_60").length;facebooks_selected=base_ticket_parent.find(".ticket_filter_item_main_selected.interaction_type_70").length;
if(web_callbacks_selected>0&&web_callbacks_selected!=total_selected)return true;if(chats_selected>0&&chats_selected!=total_selected)return true;if(tweets_selected>0&&tweets_selected!=total_selected)return true;if(emails_selected>0&&emails_selected!=total_selected)return true;if(qnas_selected>0&&qnas_selected!=total_selected)return true;if(phones_selected>0&&phones_selected!=total_selected)return true;if(facebooks_selected>0&&facebooks_selected!=total_selected)return true;return false}
function determineTicketFilterSelectedInteractionType(mode){var base_ticket_parent=-1;if(mode==0)base_ticket_parent=$ticket_filter_list_items;if(mode==1)base_ticket_parent=$("#agent_search_results");var base_ticket_manage_parent=-1;if(mode==0)base_ticket_manage_parent=$("#ticket_filter_items_manage_menu");if(mode==1)base_ticket_manage_parent=$("#search_manage_menu");if(isDifferentTicketFilterInteractionTypesSelected(mode))if(base_ticket_manage_parent.find("#ticket_filter_items_apply_to_all").is(":checked"))return base_ticket_manage_parent.find("#bulk_change_apply_to_all_interaction_type_id").val()==
""?0:parseInt(base_ticket_manage_parent.find("#bulk_change_apply_to_all_interaction_type_id").val());else return 0;else{if(base_ticket_parent.find(".ticket_filter_item_main_selected.interaction_type_10").length>0)return 10;if(base_ticket_parent.find(".ticket_filter_item_main_selected.interaction_type_20").length>0)return 20;if(base_ticket_parent.find(".ticket_filter_item_main_selected.interaction_type_30").length>0)return 30;if(base_ticket_parent.find(".ticket_filter_item_main_selected.interaction_type_40").length>
0)return 40;if(base_ticket_parent.find(".ticket_filter_item_main_selected.interaction_type_50").length>0)return 50;if(base_ticket_parent.find(".ticket_filter_item_main_selected.interaction_type_60").length>0)return 60;if(base_ticket_parent.find(".ticket_filter_item_main_selected.interaction_type_70").length>0)return 70;return 0}}
function updateBulkTicketFilterQuickReply(mode){var base_ticket_manage_parent=-1;if(mode==0)base_ticket_manage_parent=$("#ticket_filter_items_manage_menu");if(mode==1)base_ticket_manage_parent=$("#search_manage_menu");if(isDifferentTicketFilterInteractionTypesSelected(mode)&&!base_ticket_manage_parent.find("#ticket_filter_items_apply_to_all").prop("checked")||base_ticket_manage_parent.find("#ticket_filter_items_apply_to_all").prop("checked")&&base_ticket_manage_parent.find("#bulk_change_apply_to_all_interaction_type_id").val()==
""||$(".ticket_filter_item_main_selected.interaction_type_20").length>0){base_ticket_manage_parent.find("#bulk_change_quick_reply").parent().hide().val("");base_ticket_manage_parent.find("#quick_reply_not_allowed").show()}else{base_ticket_manage_parent.find("#bulk_change_quick_reply").parent().show();base_ticket_manage_parent.find("#quick_reply_not_allowed").hide();base_ticket_manage_parent.find("#quick_reply_with_macro_data_not_allowed").hide()}}
function filterDuplicates(arr){var r=new Array;o:for(var i=0,n=arr.length;i<n;i++){for(var x=0,y=r.length;x<y;x++)if(r[x]==arr[i])continue o;r[r.length]=arr[i]}return r}function update_ids_list(container_selector,item_id){var items=new Array;var current_items=$(container_selector).val();if(current_items.length>0)items=current_items.split(",");items.push(item_id);$(container_selector).val(filterDuplicates(items).join(","))}
function ticket_filter_bind_pagination(){$("#ticket_filter_item_paginator .pagination a").bind("click",function(){current_ticket_filter_page_num=selected_ticket_filter_page_num=this.href.split(/page=/)[1].split(/&/)[0];current_ticket_filter_items="";ticket_filter_page_change=1;removeTicketFilterBulkManageWindow();$("#ticket_filter_list_items_blank_div").show();$("#ticket_filter_list_items_data_div").hide();$("#ticket_filter_list_header").hide();remove_ticket_filter_spinners=1;poll_ticket_filter_at_warp_speed=
true;return false})}function setSkipToolTipRender(){skipToolTipRender=true;setTimeout(function(){skipToolTipRender=false},5E3)}function ticketDeleteTicketFilter(ticket_id,event){resetNotify();notify(I18n.translate("agent.case.delete.deleting"));setSkipToolTipRender();$(".ticket_filter_table_hover_container").hide();cancelEvent(event);jQuery.ajax({dataType:"script",type:"delete",url:"/agent/tickets/"+ticket_id})}
function ticketUndeleteTicketFilter(ticket_id,event){resetNotify();notify(I18n.translate("agent.case.undelete.undeleting"));setSkipToolTipRender();$(".ticket_filter_table_hover_container").hide();cancelEvent(event);jQuery.ajax({dataType:"script",type:"put",url:"/agent/tickets/"+ticket_id+"/undelete"})}
function ticketEditTableView(ticket_id,event,display_id){setSkipToolTipRender();$(".ticket_filter_table_hover_container").hide();var switchIntoView=true;if(event.metaKey||event.ctrlKey)switchIntoView=false;cancelEvent(event);showTicketLoad();jQuery.ajax({dataType:"script",type:"get",url:"/agent/tickets/"+ticket_id+"/edit?switch_into_view="+(switchIntoView?"1":"0")+(display_id?"&display_id="+ticket_id:""),complete:function(e,xhr,settings){if(e.status===404)notify(I18n.translate("agent.case.not_found",
{display_id:ticket_id}))}})}function ticketShowTableView(ticket_id,event){setSkipToolTipRender();$(".ticket_filter_table_hover_container").hide();var switchIntoView=true;if(event.metaKey||event.ctrlKey)switchIntoView=false;cancelEvent(event);showTicketLoad();jQuery.ajax({dataType:"script",type:"get",url:"/agent/tickets/"+ticket_id+"?switch_into_view="+(switchIntoView?"1":"0")})}
function ticketQuickReplyTableView(ticket_id,event){setSkipToolTipRender();$(".ticket_filter_table_hover_container").hide();cancelEvent(event);jQuery.ajax({dataType:"script",type:"post",url:"/agent/ticket_filters/quick_resolve?ticket_id="+ticket_id});Assistly.polling.ticket_filters.next_update=(new Date).getTime()}
function ticketEditFullView(ticket_id,event,view){setSkipToolTipRender();$(".ticket_filter_full_hover_container").hide();var switchIntoView=true;if(event.metaKey||event.ctrlKey)switchIntoView=false;cancelEvent(event);showTicketLoad();jQuery.ajax({dataType:"script",type:"get",url:"/agent/tickets/"+ticket_id+"/edit?switch_into_view="+(switchIntoView?"1":"0")+(view==1?"&current_view=search":"")})}
function ticketShowFullView(ticket_id,event,view){setSkipToolTipRender();$(".ticket_filter_full_hover_container").hide();var switchIntoView=true;if(event.metaKey||event.ctrlKey)switchIntoView=false;cancelEvent(event);showTicketLoad();jQuery.ajax({dataType:"script",type:"get",url:"/agent/tickets/"+ticket_id+"?switch_into_view="+(switchIntoView?"1":"0")+(view==1?"&current_view=search":"")})}
function ticketQuickReplyFullView(ticket_id,event,view){setSkipToolTipRender();$(".ticket_filter_full_hover_container").hide();cancelEvent(event);jQuery.ajax({dataType:"script",type:"post",url:"/agent/ticket_filters/quick_resolve?ticket_id="+ticket_id+(view==1?"&current_view=search":"")})}
function hotKeyHandler(evt){if(!Assistly.options.agent_kb_shortcuts_enabled)return;if(evt.keyCode==27)if($(".routing-modal").length==0)tb_remove();if(evt.ctrlKey)switch(evt.keyCode){case 219:if(evt.shiftKey){$tabs.tabs("select",current_tab_index==0?$tabs.tabs("length")-1:current_tab_index-1);cancelEvent(evt);return}break;case 221:if(evt.shiftKey){$tabs.tabs("select",$tabs.tabs("length")-1==current_tab_index?0:current_tab_index+1);cancelEvent(evt);return}break;case 38:switch(current_tab_type){case 1:break;
case 2:$("#tabs-tickets .previous_page").click();break;case 3:$("#tabs-twitter-search .prev_page").click();break;case 4:$("#tabs-search .prev_page").click();break;case 5:$("#tabs-tid_"+current_tab_id+" .prev_page").click();break}cancelEvent(evt);return;break;case 40:switch(current_tab_type){case 1:break;case 2:$("#tabs-tickets .next_page").click();break;case 3:$("#tabs-twitter-search .next_page").click();break;case 4:$("#tabs-search .next_page").click();break;case 5:$("#tabs-tid_"+current_tab_id+
" .next_page").click();break}cancelEvent(evt);return;break;case 82:if(evt.altKey&&evt.shiftKey){$("#user_status_link a").click();cancelEvent(evt);return}break;case 90:if(evt.shiftKey){$("#global_search").focus();cancelEvent(evt);return}break}switch(current_tab_type){case 1:break;case 2:hotKeyHandlerTicketFilter(evt);break;case 3:hotKeyHandlerTwitterSearch(evt);break;case 4:break;case 5:hotKeyHandlerTicket(evt);break;default:break}}
function hotKeyHandlerTicketFilter(evt){if($("#TB_window").length>0)return;if($(document.activeElement).is("input, textarea"))return;character=String.fromCharCode(evt.which).toLowerCase();if(evt.ctrlKey)switch(character){case "a":if(evt.shiftKey)selectAllTicketFilterItems(0);cancelEvent(evt);break;case "n":if(evt.shiftKey)deselectAllTicketFilterItems(0);cancelEvent(evt);break;case "m":if(evt.shiftKey)if(!$("#tabs_ticket_panel").hasClass("expanded"))collapseTicketFilters();else expandTicketFilters();
cancelEvent(evt);break;default:break}else{switch(character){case "j":var tmp_selected_ticket_filter_item=$ticket_filter_list_items.find(".ticket_filter_item_current_selected");if(tmp_selected_ticket_filter_item.length>0){tmp_next_ticket_filter_item=tmp_selected_ticket_filter_item.next(".ticket_filter_item");if(tmp_next_ticket_filter_item.length>0){tmp_selected_ticket_filter_item.removeClass("ticket_filter_item_current_selected");tmp_next_ticket_filter_item.addClass("ticket_filter_item_current_selected");
if(!isScrolledIntoView("#ticket_filter_list_items_outer_div","#"+tmp_next_ticket_filter_item.attr("id"))){var parent=$("#ticket_filter_list_items_outer_div");parentTop=parent.offset().top;parentInnerHeight=parent.height();parentOuterHeight=parent.outerHeight();elem=tmp_next_ticket_filter_item;elemTop=elem.offset().top;elemHeight=elem.outerHeight();elemBottom=elemTop+elemHeight;scrollPos=elemBottom+parent.scrollTop()+1-(parentTop+parentInnerHeight);parent.scrollTop(scrollPos)}}}cancelEvent(evt);break;
case "k":var tmp_selected_ticket_filter_item=$ticket_filter_list_items.find(".ticket_filter_item_current_selected");if(tmp_selected_ticket_filter_item.length>0){tmp_prev_ticket_filter_item=tmp_selected_ticket_filter_item.prev(".ticket_filter_item");if(tmp_prev_ticket_filter_item.length>0){tmp_selected_ticket_filter_item.removeClass("ticket_filter_item_current_selected");tmp_prev_ticket_filter_item.addClass("ticket_filter_item_current_selected");if(!isScrolledIntoView("#ticket_filter_list_items_outer_div",
"#"+tmp_prev_ticket_filter_item.attr("id"))){var parent=$("#ticket_filter_list_items_outer_div");parentTop=parent.offset().top;parentInnerHeight=parent.height();parentOuterHeight=parent.outerHeight();elem=tmp_prev_ticket_filter_item;elemTop=elem.offset().top;elemHeight=elem.outerHeight();elemBottom=elemTop+elemHeight;scrollPos=elemTop+parent.scrollTop()-parentTop;parent.scrollTop(scrollPos)}}}cancelEvent(evt);break;case " ":var tmp_selected_ticket_filter_item=$ticket_filter_list_items.find(".ticket_filter_item_current_selected:not(.ticket_filter_item_non_selectable)");
if(tmp_selected_ticket_filter_item.length>0){cb=tmp_selected_ticket_filter_item.find(".ticket_filter_check_box");val=cb.prop("checked");cb.prop("checked",!val);ticketFilterItemClick(cb,evt,0)}cancelEvent(evt);break;default:break}if(evt.keyCode==13){if(evt.shiftKey)var tmp_selected_ticket_filter_item=$ticket_filter_list_items.find(".ticket_filter_item_main_selected");else var tmp_selected_ticket_filter_item=$ticket_filter_list_items.find(".ticket_filter_item_current_selected");if(tmp_selected_ticket_filter_item.length>
0)tmp_selected_ticket_filter_item.find(".ticket_filter_action_open").click();cancelEvent(evt)}}}
function hotKeyHandlerTwitterSearch(evt){if(evt.keyCode==27){$("#tabs_twitter_searches_panel .HK_modal_window_escape").hide();cancelEvent(evt);return}character=String.fromCharCode(evt.which).toLowerCase();if(evt.ctrlKey)switch(character){case "m":if(evt.shiftKey)if(!$("#tabs_twitter_searches_panel").hasClass("expanded"))collapseTwitterSearches();else expandTwitterSearches();cancelEvent(evt);break;default:break}}
function hotKeyHandlerTicket(evt){if(evt.keyCode==27){$("#tabs-tid_"+current_tab_id+" .HK_modal_window_escape").hide();cancelEvent(evt);return}character=String.fromCharCode(evt.which).toLowerCase();if(evt.ctrlKey)switch(character){case "u":if(evt.shiftKey)if(!$("#tabs-tid_"+current_tab_id+" #close_view_on_completion").prop("checked"))$("#tabs-tid_"+current_tab_id+" #close_view_on_completion").click();$("#tabs-tid_"+current_tab_id+" .update:visible:enabled").click();$("#tabs-tid_"+current_tab_id+" .update_send:visible:enabled").click();
cancelEvent(evt);break;case "r":if(evt.altKey)$("#tabs-tid_"+current_tab_id+" .reply_area").focus();else{$("#tabs-tid_"+current_tab_id+" .update_resolve:visible:enabled").click();$("#tabs-tid_"+current_tab_id+" .update_send_resolve:visible:enabled").click()}cancelEvent(evt);break;case "c":if(evt.shiftKey){$("#tabs-tid_"+current_tab_id+"-closer").click();cancelEvent(evt)}if(evt.altKey){$("#tabs-tid_"+current_tab_id+" #close_view_on_completion").prop("checked",!$("#tabs-tid_"+current_tab_id+" #close_view_on_completion").prop("checked"));
cancelEvent(evt)}break;case "i":if(evt.altKey){$("#tabs-tid_"+current_tab_id+" .HK_iurl_menu").focus().click();cancelEvent(evt)}break;case "n":if(evt.altKey){$("#tabs-tid_"+current_tab_id+" .HK_add_note_link").click();cancelEvent(evt)}break;case "m":if(evt.altKey){$("#tabs-tid_"+current_tab_id+" .macro_box .label_popup_menu").focus();cancelEvent(evt)}break;case "l":if(evt.altKey){$("#tabs-tid_"+current_tab_id+" .agent_ticket_section .label_popup_menu").focus();cancelEvent(evt)}break;case "k":if(evt.shiftKey){$("#tabs-tid_"+
current_tab_id+" .HK_kb_view_link").click();cancelEvent(evt)}if(evt.altKey){$("#tabs-tid_"+current_tab_id+" .HK_kb_view_quickcode").focus();cancelEvent(evt)}break;default:break}if(evt.altKey)switch(character){case "w":if(evt.shiftKey){$("#tabs-tid_"+current_tab_id+"-closer").click();cancelEvent(evt)}break;default:break}}
function hotKeyHandlerTicketIurl(evt){switch(evt.keyCode){case 27:closeAllTicketIurlMenus();cancelEvent(evt);return;break;case 13:$("#tabs-tid_"+current_tab_id+" .ticket_iurl_selector_data .ticket_iurl_selector_data_row.selected").click();cancelEvent(evt);break;case 38:if($("#tabs-tid_"+current_tab_id+" .ticket_iurl_selector_data .ticket_iurl_selector_data_row.selected").prev().length!=0){$old_row=$("#tabs-tid_"+current_tab_id+" .ticket_iurl_selector_data .ticket_iurl_selector_data_row.selected").removeClass("selected");
$old_row.prev().addClass("selected");if(!isScrolledIntoView("#tabs-tid_"+current_tab_id+" .ticket_iurl_selector_data","#tabs-tid_"+current_tab_id+" .ticket_iurl_selector_data .ticket_iurl_selector_data_row.selected"))ticketIurlMenuScrollUp(current_tab_id)}break;case 40:if($("#tabs-tid_"+current_tab_id+" .ticket_iurl_selector_data .ticket_iurl_selector_data_row.selected").next().length!=0){$old_row=$("#tabs-tid_"+current_tab_id+" .ticket_iurl_selector_data .ticket_iurl_selector_data_row.selected").removeClass("selected");
$old_row.next().addClass("selected");if(!isScrolledIntoView("#tabs-tid_"+current_tab_id+" .ticket_iurl_selector_data","#tabs-tid_"+current_tab_id+" .ticket_iurl_selector_data .ticket_iurl_selector_data_row.selected"))ticketIurlMenuScrollDown(current_tab_id)}break;default:break}}function cancelEvent(evt){evt.cancelBubble=true;evt.returnValue=false;if(evt.stopPropagation){evt.stopPropagation();evt.preventDefault()}}
function showTicketViewInlineIURL(tab_id,iurl_url,iurl_id){$("#ticket_ticket_tid_"+tab_id).hide();$("#ticket_customer_tid_"+tab_id).hide();$("#ticket_iurl_tid_"+tab_id).show();$("#tickettab-tid_"+tab_id+" a").removeClass("selected");if($("#ticket_iurl_tid_"+tab_id).data("current_loaded_iurl")!=iurl_id){$("#ticket_iurl_tid_"+tab_id+" .ticket_iurl_embedded_iframe").prop("src",iurl_url);$("#ticket_iurl_tid_"+tab_id).data("current_loaded_iurl",iurl_id)}}
function showTicketViewLightboxIURL(tab_id,iurl_url,iurl_id,iurl_name){$("#tabs-tid_"+tab_id+" .agent_iurl_ticket_div").show();if($("#tabs-tid_"+tab_id+" .agent_iurl_ticket_div_selector").data("current_loaded_iurl")!=iurl_id){$("#tabs-tid_"+tab_id+" .agent_iurl_ticket_div_iframe").prop("src",iurl_url);$("#tabs-tid_"+tab_id+" .agent_iurl_ticket_div_title").html(iurl_name);$("#tabs-tid_"+tab_id+" .agent_iurl_ticket_div_selector").val(iurl_id);$("#tabs-tid_"+tab_id+" .agent_iurl_ticket_div_selector").data("current_loaded_iurl",
iurl_id)}}
function verifyFacebookPostNotDeleted(facebook_id,tab_id){$("#tabs-tid_"+tab_id+" .facebook_messages .a-spinner-wrapper").show();var complete=false;var timed_out=false;setTimeout(function(){timed_out=true;if(!complete);},5E3);$.getJSON("https://graph.facebook.com/"+facebook_id+"?callback=?",function(data,textStatus){complete=true;if(timed_out);if(data.error||data==false)verifyFacebookPostNotDeletedViaServer(facebook_id,tab_id);else{$("#tabs-tid_"+tab_id+" .facebook_comment_div").show();$("#tabs-tid_"+
tab_id+" .facebook_messages .a-spinner-wrapper").remove()}})}
function verifyFacebookPostNotDeletedViaServer(facebook_id,tab_id){if(typeof facebook_id=="undefined"||facebook_id==""){$("#tabs-tid_"+tab_id+" .facebook_post_deleted").show();$("#tabs-tid_"+tab_id+" .facebook_messages .a-spinner-wrapper").remove();$("#tabs-tid_"+tab_id+" .a-ticket-reply").hide()}else $.getJSON("/agent/facebooks/deleted_check?facebook_id="+facebook_id,function(data,textStatus){if(data.deleted==true){$("#tabs-tid_"+tab_id+" .facebook_post_deleted").show();$("#tabs-tid_"+tab_id+" .facebook_comment_div").hide()}else if(data.unauthorized==
true){$("#tabs-tid_"+tab_id+" .facebook_post_unauthorized_access").show();$("#tabs-tid_"+tab_id+" .facebook_comment_div").hide()}else $("#tabs-tid_"+tab_id+" .facebook_comment_div").show()}).complete(function(){$("#tabs-tid_"+tab_id+" .facebook_messages .a-spinner-wrapper").remove()})}function setTicketFilterSelectedItem(){if($ticket_filter_list_items.find(".ticket_filter_item_current_selected").length==0)$ticket_filter_list_items.find(":first").addClass("ticket_filter_item_current_selected")}
function isReplyAreaEmpty(tab_id){return $.trim($("#tabs-tid_"+tab_id+" .reply_area").val()).replace(/^\s\s*/,"").replace(/\B@[a-z0-9_]+\s*/i,"").length==0}function hasAttachments(tab_id){return $("#tabs-tid_"+tab_id+" .email_attachment .email_attachment_delete").length>0}
function updateTicketActionButtons(tab_id){if(isReplyAreaEmpty(tab_id)&&!hasAttachments(tab_id))$("#tabs-tid_"+tab_id+" .ticket_action_buttons_buttons").removeClass("send_interaction");else $("#tabs-tid_"+tab_id+" .ticket_action_buttons_buttons").addClass("send_interaction")}
function updateTicketFilterShowLabels(){if(Assistly.options.ticket_filter.show_labels)$ticket_filter_list_items.removeClass("ticket_filter_list_hide_labels");else $ticket_filter_list_items.addClass("ticket_filter_list_hide_labels")}function getLocalStoragePrefs(key){if(window.localStorage)return window.localStorage.getItem(key);return null}function setLocalStoragePrefs(key,value){if(window.localStorage)window.localStorage.setItem(key,value)}
function removeLocalStoragePrefs(key){if(window.localStorage)window.localStorage.removeItem(key)}function ticketSetCloseOnCompletionCheckBox(tab_id){var retval=getLocalStoragePrefs("close_ticket_view_on_completion");if(retval!=null)if(retval=="true")$("#tabs-tid_"+tab_id+" #close_view_on_completion").prop("checked",true);else $("#tabs-tid_"+tab_id+" #close_view_on_completion").prop("checked",false);else $("#tabs-tid_"+tab_id+" #close_view_on_completion").prop("checked",true)}
function insertArticleLinkToInteraction(tab_id,url,article_id,case_id){insertReplyTextAtCaret(tab_id,url);$("#tabs-tid_"+tab_id+" .agent_kb_ticket_div").hide();update_ids_list("#tabs-tid_"+tab_id+" .ticket_articles_used",article_id);update_ids_list("#tabs-tid_"+tab_id+" .ticket_article_attachments_already_applied",article_id);Desk.AppliedArticles.add(case_id,"kbSearchLink",url,article_id)}
function insertReplyTextAtCaret(tab_id,text){var reply_area=$("#tabs-tid_"+tab_id+" .reply_area");if(reply_area.data("caretSelection")){var startPos=reply_area.data("caretSelection").start;var endPos=reply_area.data("caretSelection").end;reply_area.setSelection(startPos,endPos);if(startPos>0){prev_char=reply_area.val().charAt(startPos-1);if(!(prev_char==" "||prev_char==""||prev_char=="\n"||prev_char=="\r"))text=" "+text}if(endPos<reply_area.val().length){last_char=reply_area.val().charAt(endPos+1);
if(!(last_char==" "||last_char==""||last_char=="\n"||last_char=="\r"))text=text+" "}reply_area.replaceSelection(text);if(startPos==endPos)reply_area.setSelection(startPos+text.length,startPos+text.length);else reply_area.setSelection(startPos,startPos+text.length);reply_area.focus()}else{reply_area.val(reply_area.val()+text);setTimeout(function(){reply_area.putCursorAtEnd()},1E3)}if(reply_area.data("autosize"))setTimeout(function(){reply_area.trigger("autosize")},100);return reply_area}
function insertBulkReplyTextAtCaret(mode,text){var base_ticket_manage_parent=-1;if(mode==0)base_ticket_manage_parent=$("#ticket_filter_items_manage_menu");if(mode==1)base_ticket_manage_parent=$("#search_manage_menu");var reply_area=base_ticket_manage_parent.find("#bulk_change_quick_reply");if(reply_area.data("caretSelection")){var startPos=reply_area.data("caretSelection").start;var endPos=reply_area.data("caretSelection").end;reply_area.setSelection(startPos,endPos);if(startPos>0){prev_char=reply_area.val().charAt(startPos-
1);if(!(prev_char==" "||prev_char==""||prev_char=="\n"||prev_char=="\r"))text=" "+text}if(endPos<reply_area.val().length){last_char=reply_area.val().charAt(endPos+1);if(!(last_char==" "||last_char==""||last_char=="\n"||last_char=="\r"))text=text+" "}reply_area.replaceSelection(text);if(startPos==endPos)reply_area.setSelection(startPos+text.length,startPos+text.length);else reply_area.setSelection(startPos,startPos+text.length);reply_area.focus()}else{reply_area.val(reply_area.val()+text);setTimeout(function(){reply_area.putCursorAtEnd()},
1E3)}if(reply_area.data("autosize"))setTimeout(function(){reply_area.trigger("autosize")},100);return reply_area}function closeAllTicketIurlMenus(){$(".ticket_iurl_selector").hide()}function hideIUrlPanel(){$(".a-case-tab:currentAgentTab [id*=ticket_iurl_tid]").hide()}
function ticketIurlMenuScrollUp(current_tab_id){var parent=$("#tabs-tid_"+current_tab_id+" .ticket_iurl_selector_data");parentTop=parent.offset().top;parentInnerHeight=parent.height();parentOuterHeight=parent.outerHeight();elem=parent.find(".ticket_iurl_selector_data_row.selected");elemTop=elem.offset().top;elemHeight=elem.outerHeight();elemBottom=elemTop+elemHeight;scrollPos=elemTop+parent.scrollTop()-parentTop;parent.scrollTop(scrollPos)}
function ticketIurlMenuScrollDown(current_tab_id){var parent=$("#tabs-tid_"+current_tab_id+" .ticket_iurl_selector_data");parentTop=parent.offset().top;parentInnerHeight=parent.height();parentOuterHeight=parent.outerHeight();elem=parent.find(".ticket_iurl_selector_data_row.selected");elemTop=elem.offset().top;elemHeight=elem.outerHeight();elemBottom=elemTop+elemHeight;scrollPos=elemBottom+parent.scrollTop()+1-(parentTop+parentInnerHeight);parent.scrollTop(scrollPos)}
function findTicketIdFromTabId(tab_id){if(typeof tab_id==="undefined")return;var class_name=$("#tabs-tid_"+tab_id);if(class_name.length===0)return;class_name=class_name.attr("class").split(" ").filter(function(item){return typeof item=="string"&&item.indexOf("ticket_id_")>-1});if(class_name.length>0)return class_name[0].match(/\d+$/)[0];else return null}
function toggleAgentTicketFooterButtons(current_tab_id,show){var currentTab=$(".a-case-tab:currentAgentTab");$(".ticket_action_buttons .button button",currentTab).prop("disabled",show);if(show)setTimeout(function(){toggleAgentTicketFooterButtons(current_tab_id,false)},7E3);else $(".ticket_action_status",currentTab).hide()}
function companyMergeSelectedMergeCustomerState(current_tab_id){if($("#tabs-tid_"+current_tab_id+" #new_company_merge :radio:checked").length>0)$("#tabs-tid_"+current_tab_id+" #company_merge_submit").prop("disabled",false);else $("#tabs-tid_"+current_tab_id+" #company_merge_submit").prop("disabled",true)}
function customerMergeSelectedMergeCustomerState(current_tab_id){if($("#tabs-tid_"+current_tab_id+" #new_customer_merge :radio:checked").length>0)$("#tabs-tid_"+current_tab_id+" #customer_merge_submit").prop("disabled",false);else $("#tabs-tid_"+current_tab_id+" #customer_merge_submit").prop("disabled",true)}
function customerChangeSelectedMergeCustomerState(current_tab_id){if($("#tabs-tid_"+current_tab_id+" #new_customer_change :radio:checked").length>0)$("#tabs-tid_"+current_tab_id+" #customer_change_submit").prop("disabled",false);else $("#tabs-tid_"+current_tab_id+" #customer_change_submit").prop("disabled",true)}
function ticketMergeSelectedMergeState(current_tab_id){if($("#tabs-tid_"+current_tab_id+" #new_ticket_merge :radio:checked").length>0)$("#tabs-tid_"+current_tab_id+" #ticket_merge_submit").prop("disabled",false);else $("#tabs-tid_"+current_tab_id+" #ticket_merge_submit").prop("disabled",true)}
function ticketLinkSelectedMergeState(current_tab_id){if($("#tabs-tid_"+current_tab_id+" #new_ticket_link :radio:checked").length>0)$("#tabs-tid_"+current_tab_id+" #ticket_link_submit").prop("disabled",false);else $("#tabs-tid_"+current_tab_id+" #ticket_link_submit").prop("disabled",true)}
function trackingBuildAndNotify(eventName,customAttrs){if(eventName=="undefined")return;var customAttrs={"data-custom-attrs":customAttrs}||null;var eventName={"data-tracking-name":eventName};var tracking_obj=$.extend({},Assistly.base_tracking_obj,eventName,customAttrs);Desk.Tracking.notify(tracking_obj)}$(".HK_modal_window_escape .close_modal").live("click",function(e){e.preventDefault();$(this).parents(".HK_modal_window_escape").hide()});
$("a.erase_link").live("ajax:before",function(){$modal=$(".agent_erase_attachments_div");var checked_boxes=$modal.find("input:checked");var keys=$.map(checked_boxes,function(val){return val.value}).join(",");var params={attachment_ids:keys};$(this).data("params",$.param(params));if(keys.length==0){$modal.hide();return false}}).live("ajax:complete",function(){$(".agent_erase_attachments_div").hide()});
$(document).on("click",".erase_interaction_link",function(e){e.preventDefault();var self=this;var $current_tab=$(".a-case-tab:currentAgentTab");var $modal=$current_tab.find(".agent_erase_content_div");var attachments=$current_tab.find(".customer_history_ticket_status_line a").length;var interactionType=$(self).data("interaction-type");var baseString="agent.case.erase."+interactionType+".";var interactionable_id=$(self).data("interactionable-id");$modal.find("[data-translate]").each(function(){var text=
I18n.translate(baseString+$(this).data("translate"));$(this).html(text)});$modal.find("button").unbind("click");$modal.find(".close_modal").click(function(e){e.preventDefault();$modal.hide()});$modal.find(".erase").click(function(e){e.preventDefault();var url=$(self).prop("href");switch(interactionType.split("_")[0]){case "facebook":var interactionable_id=$(self).data("interactionable-id");$.ajax({url:"/agent/facebooks/"+interactionable_id+"/delete",cache:false,dataType:"JSON",type:"POST",success:function(data,
textStatus,jqXHR){eraseTicketItem(url);notify(I18n.translate("agent.case.erase."+$(self).data("interaction-type")+".deleted"),true,5E3)},error:function(data,textStatus,jqXHR){data.responseText=JSON.parse(data.responseText);notify(data.responseText.message,true,8E3);$modal.hide()}});break;default:eraseTicketItem(url);break}});$modal.show();function eraseTicketItem(url){$.ajax({url:url,cache:false,dataType:"JSON",type:"POST",success:function(data,textStatus,jqXHR){switch(interactionType){case "email":var $attactments_count=
$current_tab.find(".case_ticket_attachment_div_header_count");var new_count=Math.max(parseInt($attactments_count.html())-attachments,0);$attactments_count.html(new_count);if(new_count==0){$current_tab.find(".erase_attachment").remove();$current_tab.find(".case_ticket_attachment_div_header_count_text").html(I18n.translate("agent.case.attachments"))}break;case "facebook_post":for(var i=0;i<data.comments.length;i++){var facebook_comment_div=$(self).parents("[id^='facebook_session_posts_tid_']").find("#customer_history_i"+
data.comments[i].id);facebook_comment_div.find(".customer_history_ticket_facebook_comment").html("<div class='erased_interaction_message'>"+data.comments[i].message+"</div>");facebook_comment_div.find(".a-ticket-footer .erase_interaction_link").remove()}$("#facebook_session_posts_tid_"+current_tab_id+" .a-like-button-container").remove();var fb_messages=$("#facebook_reply_div_tid_"+current_tab_id);fb_messages.find(".customer_history_ticket_facebook_reply_div").hide();fb_messages.find(".facebook_messages .a-spinner-wrapper").hide();
fb_messages.find(".facebook_messages .facebook_post_deleted").show();break}var ticket_container=$(self).parents(".a-ticket-center");ticket_container.find(".a-ticket-meat").html("<div class='erased_interaction_message'>"+data.message+"</div>");ticket_container.find(".a-like-button-container").remove();$(self).remove()},error:function(data,textStatus,jqXHR){notify("error",true,8E3)},complete:function(){$modal.hide()}})}});
function twitter_prepare_reply(current_tab,reply,kbArticleUrl){var current_reply=$("#tweet_reply_parent_tid_"+current_tab+" textarea").val();var full_reply=current_reply+reply;if(twttr.txt.getTweetLength(full_reply)>140)reply=reply.substr(0,110-current_reply.length)+"... "+kbArticleUrl;return reply}$(document).on("mouseup","#ticket_filter_table .ticket_filter_item td",function(){$("#ticket_filter_list_items_data_div .a-case-table-dropdown").hide()});
(function($){$(document).on("click","#view_achievements",showModal);$(document).on("click",".toast-achievement .toast-message a",showModal);$(document).on("click","#achievements_modal .a-modal-x a",closeModal);$(document).on("click","#achievements_modal ul.a-pill-navigation a",updateFilter);function closeModal(e){e.preventDefault();Desk.Achievements.close()}function refresh(e){e.preventDefault();Desk.Achievements.refresh()}function showModal(e){e.preventDefault();Desk.Achievements.show()}function updateFilter(e){e.preventDefault();
var current=$(e.currentTarget).parent().addClass("active"),filter=current.data("filter");current.siblings().removeClass("active");$("#achievements_modal .achievements").attr("data-filter",filter)}})(jQuery);
(function($){$(document).on("click","#view_keyboard_shortcuts",showModal);$(document).on("click","#keyboard_shortcuts_modal .a-modal-x a",closeModal);function closeModal(){tb_remove()}function showModal(){var container=getModalContainer();container.template("agent/keyboard_shortcuts",{isMac:navigator.userAgent.indexOf("Mac OS X")!=-1});tb_show("achievements","#TB_inline?height=550&width=700&inlineId=keyboard_shortcuts_modal_container&modal=true")}function getModalContainer(){var container=$("#keyboard_shortcuts_modal_container");
if(container.length===0)container=$("<div/>",{id:"keyboard_shortcuts_modal_container"}).hide().appendTo("body");return container}})(jQuery);
JiraApp=function(params){var self=this;var jira_new_url=function(data){return"/agent/app/jira/new?id="+data["app_id"]+"&case_id="+data["case_id"]};var jira_find_url=function(data){return"/agent/app/jira/"+data["app_id"]+"?case_id="+data["case_id"]};var jira_unlink_url=function(data){return"/agent/app/jira/"+data["app_id"]+"/unlink"};jQuery.expr[":"].JiraFieldId=function(a,i,m){if(jQuery(a).attr("id")==null)return false;return jQuery(a).attr("id").toUpperCase()==m[3].toUpperCase()};var render=function(data){var isoDateStr=
data.issues[0].fields["created"].split("T")[0];var parts=isoDateStr.match(/^(\d{4})\-(\d\d)\-(\d\d)?$/);var createdDate=new Date(parts[1],parts[2],parts[3]);return"<h6>"+"<img class='icon' src='"+data.issues[0].fields.issuetype.iconUrl+"'>"+htmlEntities(data.issues[0].fields["summary"])+"</h6>"+"<ul><li>"+htmlEntities(data.issues[0].fields["project"].name)+" / "+createdDate.toDateString()+"<div><b>Status:</b>&nbsp;"+(data.issues[0].fields["status"]==null?"unknown":data.issues[0].fields["status"]["name"])+
"</div>"+"</li></ul><a id='jira_unlink_"+params.current_tab_id+"' data-id='"+data.issues[0].key+"' class='jira-unlink-link' href='javascript:void(0)'>"+I18n.translate("agent.app.jira.unlink")+"</a>"};function displayErrors(response){for(var key in response.errors)if(response.errors.hasOwnProperty(key)){var field=$("*:JiraFieldId('jira_"+key+"')");if(field.length==0)field=$("*:JiraFieldId('_jira_fields_"+key+"')");if(field.length==0)$("<div class='error'>"+response.errors[key]+"</div>").insertBefore($(".a-modal-body .a-form-field:first").parent());
else $("<div class='error'>"+response.errors[key]+"</div>").insertAfter(field.parent())}for(var index in response.errorMessages)$("<div class='error'>"+response.errorMessages[index]+"</div>").insertBefore("#jira_search_panel")}this.show=function(){var info="#tabs-tid_"+params.current_tab_id+" .jira_case_info_box_items";var view="#tabs-tid_"+params.current_tab_id+" .jira_case_info_box_action_right_side";var arrow="#tabs-tid_"+params.current_tab_id+" .jira_app .case_info_box_header_left_side";$.ajax({url:jira_find_url({app_id:params.app_id,
case_id:params.case_id}),dataType:"json",success:function(data){$.parseJSON(data);if(data.issues.length==0){$(info).html("").removeClass("loaded");$(arrow).addClass("no-arrow");$(view).html("<a id='jira_create_"+params.current_tab_id+"' href='#'>"+I18n.translate("agent.app.jira.create_or_link")+"</a>");$("#jira_create_"+params.current_tab_id).click(function(){$.ajax({url:jira_new_url({app_id:params.app_id,case_id:params.case_id}),success:function(data){$("#create_jira_ticket").click(function(){var createBtn=
this;$(createBtn).attr("disabled","disabled");$("#agent_jira_lightbox .a-loading").show();$("#jira_form .error").remove();$.ajax({url:"/agent/app/jira",type:"post",dataType:"json",data:$("#jira_form").serialize(),success:function(data){tb_remove();self.show();$("#tabs-tid_"+params.current_tab_id+" .jira_app .info-left").click();notify(I18n.translate("agent.app.jira.create_ticket.confirm"),true)},error:function(data,status,msg){$(createBtn).attr("disabled",null);$("#agent_jira_lightbox .a-loading").hide();
var response=$.parseJSON(data.responseText);displayErrors(response)}})})}});return false})}else{$(info).html(render(data)).addClass("loaded");$(arrow).removeClass("no-arrow");$(".jira_app .case_info_box_header").addClass("case_info_box_header_expanded");$(".jira_app .jira_case_info_box_items").show();var remote_host=getLocation(data.issues[0].self);$(view).html("<a target='_blank' href='"+remote_host.protocol+"//"+remote_host.hostname+":"+remote_host.port+"/browse/"+data.issues[0].key+"'>"+data.issues[0].key+
"</a>");$("#jira_unlink_"+params.current_tab_id).attr("data-key",data.issues[0].key).click(function(){if(confirm(I18n.translate("agent.app.jira.unlink_prompt")))$.ajax({url:jira_unlink_url({app_id:params.app_id}),type:"put",dataType:"json",data:"case_id="+params.case_id+"&key="+data.issues[0].key+"&summary="+escape(data.issues[0].fields["summary"]),success:function(data){self.show()},error:function(data,status,msg){var response=$.parseJSON(data.responseText);for(var key in response.errors)alert(response.errors[key])}});
return false})}},error:function(request,status,error){var data=$.parseJSON(request.responseText);if(data==null)$(info).html("<span class='error'>"+I18n.translate("agent.app.jira.no_response")+"</span>");else $(info).html("<span class='error'>"+data.error+"</span>")}})};var getLocation=function(href){var l=document.createElement("a");l.href=href;return l};return this};
JiraForm=function(params){var self=this;var fields_displayed=false;this.bindEvents=function(data){$("#jira_search").each(function(){$(this).autocomplete({source:params.jira_search_path,method:"get"}).data("autocomplete")._renderItem=function(ul,item){return $("<li></li>").data("item.autocomplete",item).append($("<a></a>").text(item.label)).appendTo(ul)}});$(document).on("change","#jira_issuetype",function(){params.change_fields.call();fields_displayed=true;return false});$("#jira_project").on("change",
function(){params.change_issuetypes.call();fields_displayed=false;$("#create_jira_ticket").attr("disabled",!fields_displayed);if(this.value=="")$("#jira_project_issuetypes").hide();else $("#jira_project_issuetypes").show();return false});$(".a-jira-action-button").click(function(){$(".a-jira-action-button").parent().removeClass("active");$(this).parent().addClass("active");$("#jira_search_panel, #jira_fields_panel").hide();$("#"+$(this).data("panel-id")).show();$("#jira_action").val($(this).data("action"));
if($(this).data("panel-id")=="jira_search_panel")$("#create_jira_ticket").attr("disabled",null);else $("#create_jira_ticket").attr("disabled",!fields_displayed);$("#create_jira_ticket .text").text(I18n.translate("agent.app.jira."+$(this).data("panel-id")+".submit_button"))})}};
(function($){SalesforceApp=function(params){var self=this,salesforce_link=false;self.customer_id=params.customer_id;self.company_id=params.company_id;self.app_id=params.app_id;self.app_url=params.app_url;self.app_instance_url=params.app_instance_url;self.app_create_lead_url=params.app_create_lead_url;self.app_create_contact_url=params.app_create_contact_url;self.current_tab_id=params.current_tab_id;self.sub_tab_id=params.sub_tab_id;self.case_id=params.case_id;self.name_array=null;function humanize(string){string=
$.trim(string);var terms=string.split("_");for(var i=0;i<terms.length;i++)terms[i]=terms[i].charAt(0).toUpperCase()+terms[i].slice(1);return terms.join(" ")}function salesforce_url(data){return self.app_instance_url+data["attributes"]["url"].replace(/\/services\/data\/v[0-9]+\.[0-9]+\/sobjects\/[a-zA-Z0-9_]+/,"")}function find_name(parent,sobject,name){result=humanize(name.replace(/__c|__r/,""));if(self.name_array!=null){var name_array=[parent,sobject,name];full_object_name=name_array.filter(function(e){return e}).join(".");
$.each(self.name_array,function(index,my_object){for(var prop in my_object)if(full_object_name==prop)result=my_object[prop]})}return htmlEscape(result)}function find_name_singularization(parent,sobject,name){if(sobject!=null){var put_relation_ship_on=false;if(sobject.match(/__r$/)){sobject=sobject.replace(/__r$/,"");put_relation_ship_on=true}sobject=singularize(sobject);if(put_relation_ship_on==true)sobject+="__c"}return find_name(parent,sobject,name)}function parse(value){if(value.match(/^@[a-z0-9_]+$/))return'<a href="http://twitter.com/'+
value.substr(1)+'" target="_blank">'+value+"</a>";else if(value.match(/^[\w-]+(\.[\w-]+)*@([a-z0-9-]+(\.[a-z0-9-]+)*?\.[a-z]{2,6}|(\d{1,3}\.){3}\d{1,3})(:\d{4})?$/))return'<a href="mailto:'+value+'" target="_blank">'+value+"</a>";else if(value.match(/^https?:\/\/([-\w\.]+)+(:\d+)?(\/([\w\/_\.]*(\?\S+)?)?)?/))return'<a href="'+value+'" target="_blank">'+value+"</a>";return value}function htmlEscape(string){var escape_values={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;"};$.each(escape_values,function(k,
v){regexp=new RegExp(k,"g");string=string.replace(regexp,escape_values[k])});return string}function render(parent,data,key){var this_html="",child_html="",sobject=key,val=null;if(key===undefined)sobject=data["attributes"]["type"];$.each(data,function(key,value){if(key=="attributes"||value==null)return true;if(value["totalSize"]){if(value["totalSize"]==0)return true;child_html+="<h3>"+humanize(key.replace(/__c|__r/,""))+"</h3>";child_html+="<ul class='a-child'>";records=value["records"];$.each(records,
function(idx){child_html+="<li>";$.each(records[idx],function(record){if(record!="attributes"){if(typeof records[idx][record]=="string"){clean_val=htmlEscape(records[idx][record]);val=parse(clean_val)}else val=records[idx][record];if(record.match(/Date|At/))val=(new Date(records[idx][record])).format(dateFormat.masks.mediumDate);child_html+="<div><span class='a-li-key'>"+find_name_singularization(sobject,key,record)+":</span>"+val+"</div>"}});child_html+="</li>"});child_html+="</ul>"}else if(value&&
value["attributes"])child_html+=render(sobject,value,key);else{if(value==null)value="";if(typeof value=="string"){clean_val=htmlEscape(value);value=parse(clean_val)}if(key.match(/Date|At/)&&value.match(/\d{2}T\d{2}/))value=(new Date(value)).format(dateFormat.masks.mediumDate+" "+dateFormat.masks.isoTime);else if(key.match(/Date|At/))value=(new Date(value)).format(dateFormat.masks.mediumDate);this_html+="<li><span class='a-key'>"+find_name(parent,sobject,key)+":</span><span class='a-value'>"+value+
"</span>"}});if(parent.length>0)parent=parent+" ";if(parent.length==0)parent="Salesforce ";var link="";if(key===undefined&&salesforce_link==false){salesforce_link=true;link=" <span><a href='"+salesforce_url(data)+"' target='_blank'>"+I18n.translate("agent.app.salesforce.salesforce_link")+"</a></span>"}var result="<h3>"+parent+sobject+link+"</h3>";result+="<ul>"+this_html+"</ul>";result+=child_html;return result}this.show=function(){var view=$(".a-case-tab:currentAgentTab ."+self.sub_tab_id+"_widget").empty(),
params={company_id:self.company_id,customer_id:self.customer_id};$.getJSON(self.app_url+".json",params,function(data){if(data.results.totalSize>0){if(data.results.records.length>1||moreThanBaseAttrs(data.results.records[0])){self.name_array=data.results.names;$.each(data.results.records,function(record){view.append(render("",data.results.records[record]))});view.parent().show()}}else if(self.sub_tab_id!="company")if(data.sync_enabled)view.template("agent/customers/new_salesforce_contact_sync").parent().show();
else{view.template("agent/customers/new_salesforce_contact",{sfdc_ext_acc_id:data.sfdc_ext_acc_id}).parent().show();$(".sf-widget-add-as-contact",view).bind("click",function(e){e.preventDefault();var account_id=$(this).attr("data-attr-accid");if(account_id.length!==0)createLeadOrContact("contact",account_id);else showAccountSearchModal(this)});$("#case_sidebar .sf-widget-add-as-lead").bind("click",function(e){e.preventDefault();createLeadOrContact("lead")})}})};function continueAgain(){var view=$(".a-case-tab:currentAgentTab ."+
self.sub_tab_id+"_widget").empty(),params={company_id:self.company_id,customer_id:self.customer_id};view.template("agent/customers/new_salesforce_contact").parent().show();$(".sf-widget-add-as-contact",view).bind("click",function(e){e.preventDefault();var account_id=$(this).attr("data-attr-accid");if(account_id.length!==0)createLeadOrContact("contact",account_id);else showAccountSearchModal(this)});$("#case_sidebar .sf-widget-add-as-lead").bind("click",function(e){e.preventDefault();createLeadOrContact("lead")})}
function showAccountSearchModal(e){tb_show("companySearch","#TB_inline?height=550&width=600&inlineId=screen_pop_window&modal=true");var view=$("#TB_ajaxContent");var isContact=$(e).hasClass("sf-widget-add-as-contact");var url=isContact?self.app_url+"/get_accounts":self.app_create_lead_url;var params={search_placeholder:I18n.translate("agent.customer.salesforce_search.placeholder"),button_text:I18n.translate("agent.customer.salesforce_search.search_button_text"),salesforce_search:I18n.translate("agent.customer.salesforce_search.sfdc"),
salesforce_company_note:I18n.translate("agent.customer.salesforce_search.salesforce_company_note"),search_instructions:I18n.translate("agent.customer.salesforce_search.search_instructions"),cancel_button:I18n.translate("agent.customer.salesforce_search.search_cancel"),search_heading:I18n.translate("agent.customer.salesforce_search.search_heading"),account_not_found:I18n.translate("agent.customer.salesforce_search.account_not_found"),add_lead_button:I18n.translate("agent.customer.salesforce_search.add_lead_button")};
view.template("agent/customers/salesforce_account_search",params).show();$("#salesforce_account_search_modal .a-cancel-button").on("click",function(){tb_remove()});$("#salesforce_account_search_modal .sf-widget-add-as-lead").on("click",function(){createLeadOrContact("lead")});$("#salesforce_account_search_modal button[type='submit']").on("click",function(e){e.preventDefault();$.ajax({type:"POST",dataType:"json",url:url+".json",data:$("#salesforce_account_search_modal form").serialize(),beforeSend:function(){$("#salesforce_account_search_modal .search-instructions, #salesforce_account_search_modal .a-modal-body ul.account_list, #salesforce_account_search_modal .search-not-found").hide();
$("#salesforce_account_search_modal .a-modal-loader").show()},success:function(data){$("#salesforce_account_search_modal .a-modal-loader").hide();if(typeof data.length==="undefined"||data.length===0)$("#salesforce_account_search_modal .search-not-found").show();else{var search_res="";$.each(data,function(k,v){search_res+="<li><a data-attr-id='"+v.external_id+"'>"+v.name+"</a></li>"});$("#salesforce_account_search_modal .a-modal-body ul.account_list").html(search_res).show();$("#salesforce_account_search_modal .a-modal-body ul.account_list li a").click(function(){createLeadOrContact("contact",
$(this).attr("data-attr-id"))})}},error:function(data){$("#salesforce_account_search_modal .a-modal-loader").hide();$("#salesforce_account_search_modal .search-not-found").show()},complete:function(data){}})});$("#salesforce_account_search_modal #term").on("keyup",function(e){if(e.keyCode==13)$(this).find("#salesforce_account_search_modal button[type='submit']").click()})}function createLeadOrContact(user_type,account_name){var view=$(".a-case-tab:currentAgentTab ."+self.sub_tab_id+"_widget").hide(),
isContact=user_type||false,url=isContact==="contact"?self.app_create_contact_url:self.app_create_lead_url,account_name=account_name||null;$("button",view).attr("disabled","disabled");$.ajax({type:"POST",dataType:"json",url:url+".json",data:{customer_id:self.customer_id,case_id:self.case_id,account_name:account_name},beforeSend:function(){$(".a-case-tab:currentAgentTab .salesforce_app_container .a-modal-loader").show()},success:function(data){if(data.totalSize>0&&(data.records.length>1||moreThanBaseAttrs(data.records[0]))){view.empty();
self.name_array=data.names;$.each(data.records,function(record){view.append(render("",data.records[record]))})}else if(data.totalSize>0&&data.records.length==1){view.empty();if(isContact)view.template("agent/customers/new_salesforce_contact_success").parent().show();else view.template("agent/customers/new_salesforce_lead_success").parent().show()}else $("button",view).removeAttr("disabled");view.show()},error:function(data){var error_object=$.parseJSON(data.responseText);if(error_object.error_type==
"app_not_installed")view.template("agent/customers/salesforce_app_not_installed",{url:error_object.install_url}).parent().show();else if(error_object.error_type=="email_or_twitter_required")view.template("agent/customers/salesforce_app_insufficient_information",{message:error_object.error}).parent().show();else view.template("agent/customers/new_salesforce_failure",{error_string:"Error Occurred",type:isContact?"Contact":"Lead"}).parent().show();view.show();$(".sf-widget-continue",view).bind("click",
continueAgain)},complete:function(){tb_remove()}});return false}function moreThanBaseAttrs(o){var count=0;$.each(o,function(key,value){if(value)count++});return count>1}var inflections={singulars:[],uncountables:[]};var SINGULARS=inflections.singulars,UNCOUNTABLES=inflections.uncountables;function singular(rule,replacement){inflections.singulars.unshift([rule,replacement])}function uncountable(word){inflections.uncountables.unshift(word)}function irregular(s,p){if(s.substr(0,1).toUpperCase()==p.substr(0,
1).toUpperCase())singular(new RegExp("("+p.substr(0,1)+")"+p.substr(1)+"$","i"),"$1"+s.substr(1));else{singular(new RegExp(p.substr(0,1).toUpperCase()+p.substr(1)+"$"),s.substr(0,1).toUpperCase()+s.substr(1));singular(new RegExp(p.substr(0,1).toLowerCase()+p.substr(1)+"$"),s.substr(0,1).toLowerCase()+s.substr(1))}}function singularize(word){if(word==null)return word;var wlc=word.toLowerCase();for(var i=0;i<UNCOUNTABLES.length;i++){var uncountable=UNCOUNTABLES[i];if(wlc==uncountable)return word}for(var i=
0;i<SINGULARS.length;i++){var rule=SINGULARS[i][0],replacement=SINGULARS[i][1];if(rule.test(word))return word.replace(rule,replacement)}return word}singular(/s$/i,"");singular(/(n)ews$/i,"$1ews");singular(/([ti])a$/i,"$1um");singular(/((a)naly|(b)a|(d)iagno|(p)arenthe|(p)rogno|(s)ynop|(t)he)ses$/i,"$1$2sis");singular(/(^analy)ses$/i,"$1sis");singular(/([^f])ves$/i,"$1fe");singular(/(hive)s$/i,"$1");singular(/(tive)s$/i,"$1");singular(/([lr])ves$/i,"$1f");singular(/([^aeiouy]|qu)ies$/i,"$1y");singular(/(s)eries$/i,
"$1eries");singular(/(m)ovies$/i,"$1ovie");singular(/(x|ch|ss|sh)es$/i,"$1");singular(/([m|l])ice$/i,"$1ouse");singular(/(bus)es$/i,"$1");singular(/(o)es$/i,"$1");singular(/(shoe)s$/i,"$1");singular(/(cris|ax|test)es$/i,"$1is");singular(/(octop|vir)i$/i,"$1us");singular(/(alias|status)es$/i,"$1");singular(/^(ox)en/i,"$1");singular(/(vert|ind)ices$/i,"$1ex");singular(/(matr)ices$/i,"$1ix");singular(/(quiz)zes$/i,"$1");singular(/(database)s$/i,"$1");irregular("person","people");irregular("man","men");
irregular("child","children");irregular("sex","sexes");irregular("move","moves");irregular("cow","kine");uncountable("equipment");uncountable("information");uncountable("rice");uncountable("money");uncountable("species");uncountable("series");uncountable("fish");uncountable("sheep");uncountable("jeans");return this}})(jQuery);
function AssistlyApp(){this.current_user={};this.current_site={};this.users=new AssistlyCollection("user_");this.groups=new AssistlyCollection("group_");this.labels={cases:new AssistlyCollection("label_")};this.options={};this.options.ticket_filter={};this.options.interactions={};this.routing={};this.system_message={}}
(function($){$(".reschedule_webcallback").live("ajax:before",function(){var callback_id=$(this).data("callback-id");$("#web_callback_resched_button_"+callback_id).prop("disabled","true")});$(".new_note_webcallback").live("ajax:before",function(){resetNotify();notify(I18n.translate("agent.case.note.save.saving"))}).live("ajax:failure",function(x,status){alert(I18n.translate("agent.case.note.save.error"))})})(jQuery);
(function($){$(".send-chat-session form").live("ajax:before",function(){var message=$(this).find(".reply_area").val();if(!message||message=="")return false;message=message.replace(/^\s\s*/,"").replace(/\B@[a-z0-9_]+\s*/i,"");message_length=message.length;var too_short=message_length>0&&message_length<10;var confirm_too_short=$(this).data("confirm-short")=="true";var warning_msg=I18n.translate("agent.case.save.reply_too_short_warning");if(confirm_too_short&&too_short)return confirm(warning_msg)}).live("ajax:success",
function(){$(this).find(".reply_area").val("")}).live("ajax:failure",function(x,status){alert("HTTP Error "+status+"!")});$(".end_chat_link").live("ajax:complete",function(){$(this).parent().hide()})})(jQuery);
(function($){$(".customer_history_ticket_email_reply_div form").live("ajax:before",function(){var ticket_id=$(this).data("ticket-id");$("#email_submit_spinner_ticket_"+ticket_id).show()}).live("ajax:complete",function(){var ticket_id=$(this).data("ticket-id");$("#email_submit_spinner_ticket_"+ticket_id).hide()})})(jQuery);(function($){$("#agent_outbound_facebook_post form").live("ajax:before",function(){$("#agent_outbound_facebook_post #submit_spinner").show()})})(jQuery);
if(typeof assistly==="undefined")assistly={};
(function($,w){var shown=false;var messageShownDate;var showDisabledTimeFlag;var refreshTime=5E3;var updateFilterDisableTime=function(){$("#network_reconnect_live_time").html($.timeago(messageShownDate))};assistly.showFiltersDisabledMessage=function(){if(shown===false){$("#kill_switch_overlay").show();$("#kill_switch_window").show();shown=true;messageShownDate=new Date;updateFilterDisableTime();showDisabledTimeFlag=w.setInterval(updateFilterDisableTime,refreshTime)}};assistly.hideFiltersDisabledMessage=
function(){if(shown===true){$("#kill_switch_overlay").hide();$("#kill_switch_window").hide();shown=false;w.clearInterval(showDisabledTimeFlag)}}})(jQuery,window);
(function($){$(".agent_kb_search_box form").live("ajax:before",function(){var current_tab_id=$(this).data("current-tab");var val=$.trim($(this).find(".agent_kb_search_question").val());if(val=="")return false;$(this).find(".agent_kb_search_question").val(val);kbArticleOnSearch("'"+current_tab_id+"'")});$("div.a-item-data","div.agent_kb_article_mini_center").live("click",function(e){e.preventDefault();$(this).parents("div.agent_kb_article_mini").find(".a-item-arrow").click()})})(jQuery);
$(function(){$(document).bind("screenpopLoaded",function(event,routingData){var ticketId=routingData.ticketId,context=$("#screen_pop_div_ticket_"+ticketId),timer=$(".screenpop_timer",context);if(routingData.soundEnabled&&routingData.loopAudio)loopSound("screenpop");else if(routingData.soundEnabled)soundManager.play("screenpop");$.timeago.settings.refreshMillis=0;$(".a-timeago",context).timeago();timer.countdown({until:routingData.timeout,format:"MS",compact:true,tickInterval:2,onExpiry:function(){document.title=
ORIGINAL_TITLE;if(routingData.soundEnabled)soundManager.stop("screenpop");routingData.expireCallback()},onTick:function(){document.title=document.title!=ORIGINAL_TITLE?ORIGINAL_TITLE:routingData.altTitle}});if(routingData.passiveRouting){$("#TB_overlay").hide();$("#TB_window").css({"margin-top":0,"top":"60px"});$(".a-modal-actions .input.button, .screen_pop_middle, .screen_pop_footer",context).hide();$(".routing-modal-more",context).bind("click",function(){$(".screen_pop_middle, .screen_pop_footer",
context).toggle();$(this).toggleClass("expanded")});context.draggable()}else $("#screen_pop_accept_button",context).focus();var disableRoutingButtonHandler=function(e){disableAndClose();e.preventDefault();routingData.cancelCallback();return false};$(".a-accept",context).click(function(e){showTicketLoad();disableAndClose();routingData.acceptCallback()});$("#user_status_link").one("click.routingPopupCancel",function(e){disableAndClose();e.preventDefault();routingData.cancelCallback();return false});
$(".a-cancel",context).click(function(e){if(ticket_routing_method_id==-2)$("#user_status_link").click();else{stopRouting(null);disableAndClose();e.preventDefault();routingData.cancelCallback()}});function disableAndClose(e){document.title=ORIGINAL_TITLE;if(routingData.soundEnabled)soundManager.stop("screenpop");timer.countdown("destroy");$(this).prop("disabled","true").parent().next().children().prop("disabled","true");timer.countdown("pause");$(".screenpop_spinner",context).show();tb_remove()}})});
(function($){$(".agent_settings_panels form").live("ajax:before",function(){$(".agent_settings_panels .error_message").remove();$(".agent_settings_panels .a-error").removeClass("a-error");notifyHide();$(this).find(".spinner").show()}).live("ajax:complete",function(){$(this).find(".spinner").hide()});$("#agent_settings_password_settings form").live("ajax:error",function(event,xhr){var self=$(this);self.find("div").removeClass("a-error");var resp=$.parseJSON(xhr.responseText);if(!resp.success){var err_msg=
$("<div/>");$.each(resp.errors,function(index,value){self.find("#user_"+index).parent().addClass("a-error");if($.isArray(value)){var err_arr_len=value.length;for(var i=0;i<err_arr_len;i++)err_msg.append("<p>"+value[i]+"</p>")}else err_msg.append("<p>"+value+"</p>")});$("#flash .agent_notifier_msg").removeClass().addClass("agent_notifier_msg flash_error");notify(err_msg.html(),true,8E3);window.setTimeout("resetNotify()",9E3)}});$("a.sound_preview").live("ajax:before",function(e){var id=$(this).parents(".a-form-field").find("select").val();
$(this).data("params","sound_id="+id)});$("#agent_settings_password_menu").live("click",function(e){$("#_current_password").val("").focus()})})(jQuery);
(function($){$(document).ready(function(){$("#tabs").delegate("a.qna_textile_preview","click",function(){show_textile_preview($(this))});$("#tabs").delegate("a.qna_textile_edit","click",function(){show_answer_editor($(this))});$("#tabs").delegate("a.email_textile_preview","click",function(){show_textile_preview($(this))});$("#tabs").delegate("a.email_textile_edit","click",function(){show_answer_editor($(this))})});function show_textile_preview(link){var type=link.attr("class").indexOf("qna")>=0?"qna":
"email";var reply_area=$("#"+type+"_reply_area_container_"+current_tab_id);var preview_area=$("#"+type+"_preview_area_container_"+current_tab_id);var input=reply_area.find(".reply_area").val();$.ajax({data:{textile:input},type:"get",dataType:"html",url:"/agent/textile/parse",success:function(data){preview_area.find(".preview").html(data);link.hide();link.siblings("a."+type+"_textile_edit").show();reply_area.hide();preview_area.show()}})}})(jQuery);
function show_answer_editor(link){if(link.length<1)return false;var type=link.attr("class").indexOf("qna")>=0?"qna":"email";var reply_area=$("#"+type+"_reply_area_container_"+current_tab_id);var preview_area=$("#"+type+"_preview_area_container_"+current_tab_id);link.hide();link.siblings("a."+type+"_textile_preview").show();preview_area.hide();reply_area.show()}
(function(win,$){var ticketIds=[];var ticketStatusInterval=3E4;$(".case-refresh-lock-button").live("click",function(){$(this).attr("disabled","disabled");$(this).find(".loading-small").removeClass("hidden")});var parseTicketStatuses=function(data,status,obj){for(var i in data){var ticketTab=$("#tabs .ticket_id_"+i);var lockButton=ticketTab.find(".warning_box_with_refresh_button div button.case-refresh-lock-button");var openButton=ticketTab.find(".warning_box_with_refresh_button div button.case-refresh-open-button");
var spinnerSpan=ticketTab.find(".loading-small");var lockMessage=ticketTab.find(".warning_box_with_refresh_button span[data-description='lock-message']");spinnerSpan.addClass("hidden");lockButton.removeAttr("disabled");if(data[i]===null){lockButton.removeClass("visible").addClass("hidden");openButton.removeClass("hidden").addClass("visible");lockMessage.html(I18n.translate("agent.case.read_only"))}else{var activeUserId=data[i];var activeUserObj=Assistly.users.get(data[i]);lockButton.removeClass("hidden").addClass("visible");
openButton.removeClass("visible").addClass("hidden");lockMessage.html(I18n.translate("agent.case.locked.read_only")+" "+activeUserObj.name+" "+Handlebars.helpers.agentThumb(activeUserId,"16",encodeURIComponent("https://cdn.desk.com/assets/unknown_user_16-29d1c36e8f9de4782ebc5b442eab5581.png"),true))}}};var getStatusOnTickets=function(){$.getJSON("/agent/tickets/active_users",{"ticket_ids":ticketIds.join()},parseTicketStatuses);ticketIds=[]};var getTicketsWhoseStatusWeWant=function(){$(".a-case-tab").not(".active_ticket_type").each(function(){if($(this).find("#ticket_ticket_status_type_id").val()<
90)ticketIds.push($(this).data("ticket_id"))});if(ticketIds.length>0)getStatusOnTickets();win.setTimeout(getTicketsWhoseStatusWeWant,ticketStatusInterval)};getTicketsWhoseStatusWeWant()})(window,jQuery);
function AssistlyTicketFilters(){this.updateUserList=function(selectedUserId){var userSelect=jQuery("#bulk_change_user_id");var selectedGroupId=jQuery("#bulk_change_group_id").val();var userArray=new Array;var unassignedUserObject=new Object;unassignedUserObject.id=0;unassignedUserObject.name=I18n.translate("agent.common.unassigned");var noChangeUserObject=new Object;noChangeUserObject.id="";noChangeUserObject.name=I18n.translate("agent.common.nochange");userSelect.empty();if(typeof selectedGroupId==
"undefined")return;if(selectedGroupId!=""&&selectedGroupId!=0)$.each(Assistly.groups.get(selectedGroupId).assigned_user_ids,function(idx,user_id){var userObj=Assistly.users.get(user_id);if(userObj&&user_id==Assistly.current_user.id)userObj.name=I18n.translate("agent.common.me");if(userObj&&!userObj.deleted)userArray.push(userObj)});else $.each(Assistly.users.array,function(idx,user){var userObj=user;if(userObj.id==Assistly.current_user.id)userObj.name=I18n.translate("agent.common.me");if(!userObj.deleted)userArray.push(userObj)});
userArray.sort(function(a,b){return a.name.toLowerCase()>b.name.toLowerCase()});userArray.unshift(unassignedUserObject);userArray.unshift(noChangeUserObject);$.each(userArray,function(idx,user){userSelect.append($("<option />").val(user.id).text(user.name))});if(!(typeof selectedUserId=="undefined"))userSelect.val(selectedUserId)}}
function generateHandlebarsTicketFilterItem(json){return current_ticket_filter_view_mode==100?generateHandlebarsTicketFilterItemFullHTML(json):generateHandlebarsTicketFilterItemTableHTML(json)}function allowQuickResolve(interactionTypeId){var allowedIds=[30,40,50,60,70];return $.inArray(interactionTypeId,allowedIds)!=-1}function startedRoutingControl(){return"<div class='routing-control-btn started'>&nbsp;</div>"}
function stoppedRoutingControl(){return"<div class='routing-control-btn stopped'>&nbsp;</div>"}function showTfDescRoutingStatus(obj){$(obj).parent().children(".ticket_filter_row-contents").children(".ticket-filter-routing-status").show()}function hideTfDescRoutingStatus(obj){$(obj).parent().children(".ticket_filter_row-contents").children(".ticket-filter-routing-status").hide()}
function initRoutingControls(obj,id){obj.data("route_method_id",id);if(Assistly.routing.online&&obj.data("route_method_id")==ticket_routing_method_id)obj.html(startedRoutingControl());else obj.html(stoppedRoutingControl());if(obj.attr("id").match(/routing-controls-\d/))$("#tab-ticket-filter-total-count-"+id).removeClass("a-filter-list-item-count").addClass("a-filter-list-item-count-routing");else $("#a-filters-expander-count-"+id).removeClass("a-filters-expander-count").addClass("a-filters-expander-count-routing")}
function refreshRoutingControls(){$("#tabs-tickets .routing-controls").each(function(){if(Assistly.routing.online&&$(this).data("route_method_id")==ticket_routing_method_id){$(this).html(startedRoutingControl());showTfDescRoutingStatus($(this))}else{$(this).html(stoppedRoutingControl());hideTfDescRoutingStatus($(this))}})}
function trackRoutingToggle(obj){var routingState=Assistly.routing.online?"started":"stopped";if(ticket_routing_method_id>0)var routingConfig="By Case Filter";else if(ticket_routing_method_id==-2)var routingConfig="All Cases";else var routingConfig="Disabled";if(obj!=null)var name=$("#tab-ticket-filter-name-"+$(obj).data("route_method_id")).children("a").first().text().trim();else var name="";trackingBuildAndNotify("Agent Toggled Case Routing",{"routing_state":routingState,"routing_configuration":routingConfig,
"filter_name":name})}function startRouting(obj){Assistly.routing.online=true;$(obj).html(startedRoutingControl());showTfDescRoutingStatus($(obj));var ticket_routing_method_id_was=ticket_routing_method_id;ticket_routing_method_id=$(obj).data("route_method_id");$.ajax({url:"/agent/update_status",data:{user_status:"online"},type:"PUT"});trackRoutingToggle(obj)}
function startRoutingById(id){if(id>=0){var obj=$("#routing-controls-"+id);startRouting(obj)}else if(id==-2){Assistly.routing.online=true;ticket_routing_method_id=-2;$.ajax({url:"/agent/update_status",data:{user_status:"online"},type:"PUT"});trackRoutingToggle(null)}}
function stopRouting(except){var stop_routing=true;$(".routing-controls").each(function(index){if(except==null||$(this).attr("id")!=except.attr("id")){$(this).html(stoppedRoutingControl());hideTfDescRoutingStatus($(this))}else stop_routing=false});if(stop_routing){Assistly.routing.online=false;$.ajax({url:"/agent/update_status",data:{user_status:"offline"},type:"PUT"});trackRoutingToggle(null)}}
$(function(){jQuery.timeago.settings.refreshMillis=0;jQuery.timeago.settings.strings.seconds="1 minute";jQuery.timeago.settings.strings.minute="1 minute";jQuery.timeago.settings.strings.hour="1 hour";jQuery.timeago.settings.strings.hours="%d hours";jQuery.timeago.settings.strings.month="1 month";jQuery.timeago.settings.strings.year="1 year";if(getLocalStoragePrefs("visible_columns")===null){var visible_columns=["customer_name","message_count","status","updated","assigned","priority"];if(getLocalStoragePrefs("hidden_columns")===
null||getLocalStoragePrefs("hidden_columns").length===0)setLocalStoragePrefs("visible_columns",visible_columns.join(","));else{var hidden_columns=getLocalStoragePrefs("hidden_columns").split(",");visible_columns=$.grep(visible_columns,function(n,i){return $.inArray(n,hidden_columns)==-1});setLocalStoragePrefs("visible_columns",visible_columns.join(","));removeLocalStoragePrefs("hidden_columns")}}$(document).on("click","html",function(){$(".a-case-table-dropdown").hide()});$(document).on("click",".a-case-table-dropdown",
function(e){e.stopPropagation()});$(document).on("click",".a-case-table-custom-arrow",function(e){e.stopPropagation();e.preventDefault();$(".a-case-table-dropdown").toggle()});$(document).on("click",".a-case-table-dropdown label",function(e){e.stopPropagation();var $this=$(this),visible_columns=[],id=$this.find("input").attr("id"),column=$(".a-case-table-contents table .ticket_filter_item_tv_"+id);$this.find("input").is(":checked")?column.show():column.hide();$this.parents("ul").find("input:checked").each(function(index,
element){visible_columns.push(element.id)});setLocalStoragePrefs("visible_columns",visible_columns.join(","))});$(window).resize(function(e){var width=$(window).width(),table=$("#ticket_filter_table");if(width<1115)table.addClass("lowres");else table.removeClass("lowres")});$(document).bind("ticketFilterUpdateComplete",function(){var visible_columns=getLocalStoragePrefs("visible_columns")||"customer_name,message_count,status,updated,assigned,priority,actions";assistly.visible_columns=visible_columns.length>
0?visible_columns.split(","):[];var table=$("#ticket_filter_table");$(".ticket_filter_item_time",table).timeago();table.find("div","span").disableSelection();$.each(assistly.visible_columns,function(index,field){$(".ticket_filter_item_tv_"+field).show();$(".a-case-table-dropdown input#"+field).prop("checked",true)});$("#ticket_filter_table, #ticket_filter_item_paginator").fadeIn();$(window).resize()});$(document).on("click",".routing-controls",function(e){var route_method_id=$(this).data("route_method_id");
var changed_filter=route_method_id!=ticket_routing_method_id;if(changed_filter){startRouting($(this));stopRouting($(this))}else if(!Assistly.routing.online)startRouting($(this));else stopRouting(null);return false});var SAMPLE_RATE=1E4;var lastSampleAt=Date.now();function refreshAfterWakeup(){if(Date.now()-lastSampleAt>=SAMPLE_RATE)refreshRoutingControls();lastSampleAt=Date.now();setTimeout(refreshAfterWakeup,SAMPLE_RATE)}refreshAfterWakeup()});
(function($){$(".ticket_load").live("ajax:before",function(){showTicketLoad()});$(".new_forward_forget").live("ajax:before",function(){resetNotify();notify(I18n.translate("agent.case.forward.save.saving"))}).live("ajax:failure",function(x,status){alert(I18n.translate("agent.case.forward.save.error"))});$(".new_ticket_note").live("ajax:before",function(){resetNotify();notify(I18n.translate("agent.case.note.save.saving"))}).live("ajax:failure",function(x,status){alert(I18n.translate("agent.case.note.save.error"))});
$(".edit_customer").live("ajax:failure",function(x,status){alert(I18n.translate("agent.customer.save.error"))}).live("ajax:complete",function(){var current_tab_id=$(this).data("current-tab");toggleAgentTicketFooterButtons("#"+current_tab_id,false)});$(".edit_ticket_form").live("ajax:failure",function(x,status){alert(I18n.translate("agent.case.save.error"))}).live("ajax:complete",function(){var current_tab_id=$(this).data("current-tab");toggleAgentTicketFooterButtons("#"+current_tab_id,false)});$(".a-case-delete-modal").live("click",
function(){$(".a-case-tab:currentAgentTab .agent_delete_ticket_div .agent_delete_ticket_details_data").html(I18n.translate("agent.case.delete.confirmation.body",{duration:Assistly.site_config.ticket_delete_duration}));$(".a-case-tab:currentAgentTab .agent_delete_ticket_div").show()});$(".a-case-delete").live("click",function(){$.ajax({type:"DELETE",url:"/agent/tickets/"+$(".a-case-tab:currentAgentTab").data("ticket_id"),success:function(){resetNotify();notify(I18n.translate("agent.case.delete.success"));
$("#tabs-tid_"+current_tab_id).addClass("about_to_close");closeTab(current_tab_id)},error:function(){resetNotify();notify(I18n.translate("agent.case.delete.error"))}})});$(".a-case-undelete").live("ajax:failure",function(x,status){resetNotify();notify(I18n.translate("agent.case.undelete.failure"))}).live("ajax:complete",function(){resetNotify();notify(I18n.translate("agent.case.undelete.success"));$("#tabs-tid_"+current_tab_id).addClass("about_to_close");closeTab(current_tab_id)});$(".HK_kb_view_link").live("click",
function(){$(this).parents("form").find(".reply_area").click()});$("#email_outbound_mailbox_id").live("change",function(){$(this).prev().val(true)});$(".agent_notifier_msg .a-undo").live("click",function(e){e.preventDefault();var $this=$(this),path=$this.data("path"),ticket_id=$this.data("id");$("#flash").stop();$.ajax({type:"PUT",dataType:"json",url:path}).complete(function(event){var response=JSON.parse(event.responseText);if(response.errors)$this.parent().html(response.errors[0]);closeTabByTicketId(ticket_id);
if(current_ticket_filter_view_mode==200)ticketEditTableView(ticket_id,e);else ticketEditFullView(ticket_id,e)})});$(".a-dismiss-ticket-error").live("click",function(e){e.preventDefault();var $this=$(this),path=$this.data("path"),ticket_id=$this.data("id"),params={ticket:{last_interaction_out_status_id:$this.data("last-interaction-out-status-id")}};$.ajax({type:"PUT",dataType:"json",data:params,url:path}).complete(function(event){var response=JSON.parse(event.responseText);if(response.errors)notify(I18n.translate("agent.case.dismiss_error.failure"));
else{notify(I18n.translate("agent.case.dismiss_error.success"));$this.parent().hide()}})});$(document).on("focus","#tabs .a-ticket-reply textarea.reply_area",function(e){if(!$(this).hasClass("autosize")){$(this).autosize();$(this).addClass("autosize");updateTicketActionButtons($(this).attr("id"))}});$(document).on("blur paste keyup cut","#tabs .a-ticket-reply textarea.reply_area",function(e){updateTicketActionButtons($(this).attr("id"))});$(document).on("desk:reply_form_rendered",function(event,interaction_type,
tab_id,ticket_id,draft_id){var autosave_path,draft_id_element;switch(interaction_type){case "email":autosave_path="/agent/emails/";draft_id_element="#email_id";break;case "tweet":autosave_path="/agent/twitters/";draft_id_element="#tweet_id";break;case "qna":autosave_path="/agent/qnas/";draft_id_element="#email_id";break;case "facebook":autosave_path="/agent/facebooks/";draft_id_element="#facebook_comment_id";break}$("#tabs-tid_"+tab_id+" .core_interaction .autosave").on("keyup paste",function(){$("form.core_interaction",
"#tabs-tid_"+tab_id).data("updated",true)}).autoSave(function(){if($("form.core_interaction","#tabs-tid_"+tab_id).data("updated"))jQuery.ajax({beforeSend:function(request){$("#tabs-tid_"+tab_id+" .autosave_text").html(I18n.translate("agent.interaction.autosave.initial")).show();$("#tabs-tid_"+tab_id+" .autosave_spinner").css({"visibility":"visible"})},complete:function(request){$("#tabs-tid_"+tab_id+" .autosave_spinner").css({"visibility":"hidden"});$("form.core_interaction","#tabs-tid_"+tab_id).data("updated",
false)},data:jQuery.param($("#tabs-tid_"+tab_id+" .core_interaction .autosave").serializeArray()),dataType:"script",type:"post",url:autosave_path+$(draft_id_element,"#tabs-tid_"+tab_id).val()+"/draft?ctid="+tab_id+"&ticket_id="+ticket_id})},{doClassChange:false});setTimeout(function(){updateTicketActionButtons(tab_id)},1)});$(document).on("desk:ticket_attachment_upload_form_rendered",function(event,tab_id,ticket_id,interaction_id,maxUploadSize,post_url,uploadCallback){var theTab=$("#tabs-tid_"+tab_id);
var dropbox=theTab.find(".cols.interaction_panel.right_interaction");assistly.uploader({"fileUploadCallBack":function(xhr){var data=jQuery.parseJSON(xhr.responseText);$("#email_id","#tabs-tid_"+data.tab_id).val(data.draft_id);jQuery.ajax({dataType:"script",type:"get",url:"/agent/tickets/attachments/email_out_update_display?ctid="+data.tab_id+"&email_out_id="+data.draft_id+"&interaction_id="+data.interaction_id+"&ticket_id="+data.ticket_id})},"theTab":theTab,"dropbox":dropbox,"fileElem":window.document.getElementById("email_out_ticket_attachment_add_button_tid"+
tab_id),"addAttachLink":dropbox.find(".blue_highlight.file_upload_link"),"maxSize":maxUploadSize,"extraParamsToSubmit":{"ticket_id":ticket_id,"ctid":tab_id,"interaction_id":interaction_id},"postUrl":post_url,"fileParamName":"ticket_attachment[attachment]","uploadForm":dropbox.find(".ticketAttachForm"),"tabid":tab_id,"progressDiv":dropbox.find(".reply_attachment_progress")})});$(document).on("desk:tweet_reply_form_rendered",function(event,tab_id,ticket_id,tweet_type_id){$("#twitter_reply_area_ticket_"+
ticket_id).charLimit({limit:140,speed:"slow",descending:true,display_box:"#char_count_tid_"+tab_id,warn_orange:25,warn_red:15,default_color:"#333",orange_color:"#FF7500",hardStop:false,countFunction:function(obj){return countTweetLength(obj.val())},callback:function(){if(countTweetLength($("#twitter_reply_area_ticket_"+ticket_id).val())>140)$("#tweet_truncation_warn_tid_"+tab_id).show();else $("#tweet_truncation_warn_tid_"+tab_id).hide();if($("#twitter_reply_area_ticket_"+ticket_id).val().search(/(^D\s|^DM\s)/i)!=
-1&&$("#tweet_reply_tweet_type_ticket_"+ticket_id).val()==tweet_type_id)$("#tweet_bad_dm_warn_tid_"+tab_id).show();else $("#tweet_bad_dm_warn_tid_"+tab_id).hide()}})});$(document).on("desk:tweet_reply_type_changed",function(event,changed_to,screen_name,tab_id,ticket_id,tweet_type_id){var $replyField=$("#twitter_reply_area_ticket_"+ticket_id),screen_name="@"+screen_name,replyValue=$replyField.val();if(changed_to==="mention"){var reply=screen_name+" "+$replyField.val();$replyField.val(reply)}if(changed_to===
"dm")$replyField.val(replyValue.replace(screen_name+" ",""));$(document).trigger("desk:tweet_reply_form_rendered",[tab_id,ticket_id,tweet_type_id])})})(jQuery);
function AssistlyTweetSearches(){this.updateUserList=function(selectedUserId){var userSelect=jQuery("#tweet_transfer_ticket_item_user_id");var selectedGroupId=jQuery("#tweet_transfer_ticket_item_group_id").val();var userArray=new Array;var unassignedUserObject=new Object;unassignedUserObject.id=0;unassignedUserObject.name=I18n.translate("agent.common.unassigned");var noChangeUserObject=new Object;noChangeUserObject.id="";noChangeUserObject.name=I18n.translate("agent.common.nochange");userSelect.empty();
if(typeof selectedGroupId=="undefined")return;if(selectedGroupId!=""&&selectedGroupId!=0)$.each(Assistly.groups.get(selectedGroupId).assigned_user_ids,function(idx,user_id){var userObj=Assistly.users.get(user_id);if(userObj&&user_id==Assistly.current_user.id)userObj.name=I18n.translate("agent.common.me");if(userObj&&!userObj.deleted)userArray.push(userObj)});else $.each(Assistly.users.array,function(idx,user){var userObj=user;if(userObj.id==Assistly.current_user.id)userObj.name=I18n.translate("agent.common.me");
if(!userObj.deleted)userArray.push(userObj)});userArray.sort(function(a,b){return a.name.toLowerCase()>b.name.toLowerCase()});userArray.unshift(unassignedUserObject);userArray.unshift(noChangeUserObject);$.each(userArray,function(idx,user){userSelect.append($("<option />").val(user.id).text(user.name))});if(!(typeof selectedUserId=="undefined"))userSelect.val(selectedUserId)}}
(function($){Desk=window.Desk||{};$(document).on("ajax:before","#agent_outbound_tweet form",function(){$("#submit_spinner").show()});Desk.Twitter={replyBoxRelationshipCheck:function(twitter_box,twitter_user,tab_id){if(typeof twitter_box==="undefined"||typeof twitter_user==="undefined")return;if(typeof current_tab_id==="undefined"||current_tab_id===0)return;var tab_id=tab_id||current_tab_id;var tab_id=tab_id||current_tab_id;var follow_data=Desk.Twitter.getFollowStatus(twitter_box,twitter_user,tab_id);
if(follow_data)Desk.Twitter.printReplyBoxMessage(follow_data,tab_id)},printReplyBoxMessage:function(follow_obj,tab_id){var tweet_type=$("#session_text_tid_"+tab_id+" .customer_history_ticket_outside_twitter_agent_response_first").attr("data-attr-tweet-type");$("#session_text_tid_"+tab_id+" .twitter_reply_relationship_verify_spinner").show();$("#twitter_reply_tweet_type_ticket_"+tab_id).hide();$("#session_text_tid_"+tab_id+" .twitter_reply_relationship_not_friends_ticket").hide();$("#session_text_tid_"+
tab_id+" .twitter_reply_change_from_dm_to_mention_ticket").hide();$("#session_text_tid_"+tab_id+" .twitter_reply_verify_follower_error_ticket").hide();$("#session_text_tid_"+tab_id+" .twitter_reply_verify_follower_no_permission_ticket").hide();$("#session_text_tid_"+tab_id+" .twitter_reply_relationship_verify_spinner").hide();if(typeof follow_obj!=="object")$("#session_text_tid_"+tab_id+" .twitter_reply_verify_follower_no_permission_ticket").show();else if(follow_obj.can_dm)$("#twitter_reply_tweet_type_ticket_"+
tab_id).show();else{if(typeof tweet_type!=="undefined"&&tweet_type==="dm")$("#session_text_tid_"+tab_id+" .twitter_reply_change_from_dm_to_mention_ticket").show();else $("#session_text_tid_"+tab_id+" .twitter_reply_relationship_not_friends_ticket").show();$("#session_text_tid_"+tab_id+" .tweet_reply_parent_tid [name='tweet[twitter_box_id]'] option").filter(function(){return $.trim($(this).text())==follow_obj.login}).prop("selected",true)}},getFollowStatus:function(twitter_box,twitter_user,tab_id){if(typeof tab_id===
"undefined")return;var current_data_container=$("#session_text_tid_"+tab_id);var follow_data=current_data_container.data("follow_data");if(typeof follow_data!=="undefined"&&typeof follow_data[twitter_box]!=="undefined")return follow_data[twitter_box];else{var uri=location.protocol+"//"+location.host+"/agent/twitter_boxes";$.ajax(uri,{type:"GET",dataType:"json",data:"username="+twitter_user,cache:false,success:function(result){if(result!=null){for(var i=0;i<result.length;i++){Desk.Twitter.storeFollowData(result[i].twitter_box,
current_data_container);Desk.Twitter.updateFollowPill(result[i].twitter_box,twitter_user,tab_id,result.length);if($("#session_text_tid_"+tab_id+" .twitter_reply_action_line select.twitter_reply_account").length>0&&result[i].twitter_box.login===twitter_box)Desk.Twitter.printReplyBoxMessage(result[i].twitter_box,tab_id)}Desk.Twitter.showFollowPill(tab_id,result.length)}else handleGenericTwitterError()},error:function(){handleGenericTwitterError()},complete:function(){}})}},updateFollowPill:function(result,
twitter_user,tab_id,twitter_box_len){var target=$("#session_text_tid_"+tab_id).data("follow_data");var users_info={username:twitter_user,login:result.login};result.is_following_user?twitterFollowUpdatePage(users_info,result.id,result.login,tab_id,twitter_box_len):twitterUnfollowUpdatePage(users_info,result.id,result.login,tab_id,twitter_box_len)},showFollowPill:function(tab_id){var target=$("#session_text_tid_"+tab_id+" .follow_user_interaction_button");if(target.length>1)target.find(".twitter-tick").removeClass("loading-small");
else target.removeClass("hidden").parent().siblings(".loading-small").addClass("hidden")},storeFollowData:function(result,current_data_container){var follow_data=current_data_container.data("follow_data");follow_data=typeof follow_data==="undefined"?{}:follow_data;follow_data[result.login]={login:result.login,id:result.id,following:result.is_following_user,can_dm:result.can_dm};current_data_container.data("follow_data",follow_data)}}})(jQuery);
function countTweetLength(text){return twttr.txt.getTweetLength(text)}
function twitterFollowUpdatePage(result,box_id,box_name,current_tab_id,box_len){var target=$(".twitter_box_name_"+result.login+"_"+result.username);if(box_len>1){target.addClass("twitter-following");target.parent().parent().find(".twitter-button-text").text(I18n.translate("agent.twitter_box.following"));target.parent().parent().find(".multi-twitter-box").addClass("twitter-following")}else{target.text(I18n.translate("agent.twitter_box.following"));target.parent().addClass("twitter-following twitter-following-single")}target.attr("onclick",
"unfollowTwitterUser("+box_id+', "'+result.login+'", "'+result.username+'","'+current_tab_id+'", this, '+box_len+")");if($(".agent_customer_twitter_link ."+result.username+" #twitter_follow_"+box_id).length>0)$(".agent_customer_twitter_link ."+result.username+" #twitter_follow_"+box_id).replaceWith(twitter_unfollow_link(box_id,box_name))}
function twitterUnfollowUpdatePage(result,box_id,box_name,current_tab_id,box_len){var target=$(".twitter_box_name_"+result.login+"_"+result.username);if(box_len>1){target.removeClass("twitter-following");if(target.siblings().hasClass("twitter-following")===false){target.parent().parent().find(".twitter-button-text").text(I18n.translate("agent.twitter_box.to_follow"));target.parent().parent().find(".multi-twitter-box").removeClass("twitter-following")}}else{target.text(I18n.translate("agent.twitter_box.to_follow"));
target.parent().removeClass("twitter-following").removeClass("twitter-following-single")}target.attr("onclick","followTwitterUser("+box_id+', "'+result.login+'", "'+result.username+'","'+current_tab_id+'", this, '+box_len+")");if($(".agent_customer_twitter_link ."+result.username+" #twitter_unfollow_"+box_id).length>0)$(".agent_customer_twitter_link ."+result.username+" #twitter_unfollow_"+box_id).replaceWith(twitter_follow_link(box_id,box_name))}
function unfollowTwitterUser(box_id,box_name,twitter_user,current_tab_id,target,box_len){var uri=location.protocol+"//"+location.host+"/agent/twitter_boxes/"+box_id+"/unfollow";target=$(target);target.removeAttr("onclick");$.ajax(uri,{type:"POST",dataType:"json",data:"username="+twitter_user,cache:false,beforeSend:function(){box_len>1?target.find(".twitter-tick").addClass("loading-small"):target.parent().siblings(".loading-small").removeClass("hidden")},success:function(result){if(result!=null){twitterUnfollowUpdatePage(result,
box_id,box_name,current_tab_id,box_len);var follow_data={login:result.login,id:result.id,is_following_user:false,can_dm:result.can_dm};$("#session_text_tid_"+current_tab_id+" .twitter_reply_action_line select.twitter_reply_account option:contains('"+box_name+"')").data("follow_data",follow_data);var current_reply_twitter_box=$("#tweet_reply_parent_tid_"+current_tab_id+" [name='tweet[twitter_box_id]'] option:selected").text();Desk.Twitter.storeFollowData(follow_data,$("#session_text_tid_"+current_tab_id));
Desk.Twitter.printReplyBoxMessage(follow_data,current_tab_id)}else handleGenericTwitterError()},error:function(){handleGenericTwitterError()},complete:function(){box_len>1?target.find(".twitter-tick").removeClass("loading-small"):target.parent().siblings(".loading-small").addClass("hidden")}})}
function followTwitterUser(box_id,box_name,twitter_user,current_tab_id,target,box_len){var uri=location.protocol+"//"+location.host+"/agent/twitter_boxes/"+box_id+"/follow";target=$(target);target.removeAttr("onclick");$.ajax(uri,{type:"POST",dataType:"json",data:"username="+twitter_user,cache:false,beforeSend:function(){box_len>1?target.find(".twitter-tick").addClass("loading-small"):target.parent().siblings(".loading-small").removeClass("hidden")},success:function(result){if(result!=null){twitterFollowUpdatePage(result,
box_id,box_name,current_tab_id,box_len);var follow_data={login:result.login,id:result.id,is_following_user:true,can_dm:result.can_dm};$("#session_text_tid_"+current_tab_id+" .twitter_reply_action_line select.twitter_reply_account option:contains('"+box_name+"')").data("follow_data",follow_data);var current_reply_twitter_box=$("#tweet_reply_parent_tid_"+current_tab_id+" [name='tweet[twitter_box_id]'] option:selected").text();Desk.Twitter.storeFollowData(follow_data,$("#session_text_tid_"+current_tab_id));
Desk.Twitter.printReplyBoxMessage(follow_data,current_tab_id)}else handleGenericTwitterError()},error:function(){handleGenericTwitterError()},complete:function(){box_len>1?target.find(".twitter-tick").removeClass("loading-small"):target.parent().siblings(".loading-small").addClass("hidden")}})}
function handleGenericTwitterError(){$("#flash .agent_notifier_msg").removeClass().addClass("agent_notifier_msg flash_error");notify(I18n.translate("agent.twitter_box.generic_error"),true,8E3);window.setTimeout("resetNotify()",9E3)}function getProtocol(){var url=window.location.href}$(".email_attachment_delete").live("ajax:before",function(){$(this).prop("disabled","true")}).live("ajax:error",function(){$(this).prop("disabled","false")}).live("ajax:success",function(){$(this).parent().remove()});
Handlebars.registerHelper("isCurrentTicketFilterViewTableMode",function(conditional,block){if(current_ticket_filter_view_mode==200)return block.fn(this);else return block.inverse(this)});Handlebars.registerHelper("isCurrentTicketFilterViewFullMode",function(conditional,block){if(current_ticket_filter_view_mode==100)return block.fn(this);else return block.inverse(this)});
Handlebars.registerHelper("assistlyOptionsShowTicketFilterLabels",function(conditional,block){if(!Assistly.options.ticket_filter.show_labels)return block.fn(this);else return block.inverse(this)});Handlebars.registerHelper("isNotTicketFilterTicketActive",function(ticket,block){if(!ticket.active_user_id)return block.fn(this);else return block.inverse(this)});
Handlebars.registerHelper("isTicketFilterTicketClosedOrActive",function(ticket,block){if(ticket.active_user_id||ticket.ticket_status_type_id==90)return block.fn(this);else return block.inverse(this)});Handlebars.registerHelper("isTicketFilterTicketClosedDeletedOrActive",function(ticket,block){if(ticket.active_user_id||ticket.ticket_status_type_id==90||ticket.ticket_status_type_id==110)return block.fn(this);else return block.inverse(this)});
Handlebars.registerHelper("isNotTicketFilterTicketClosedOrActive",function(ticket,block){if(!(ticket.active_user_id||ticket.ticket_status_type_id==90))return block.fn(this);else return block.inverse(this)});Handlebars.registerHelper("isNotTicketFilterTicketClosedDeletedOrActive",function(ticket,block){if(!(ticket.active_user_id||ticket.ticket_status_type_id==90||ticket.ticket_status_type_id==110))return block.fn(this);else return block.inverse(this)});
Handlebars.registerHelper("isTicketFilterTicketDeleted",function(ticket,block){if(ticket.ticket_status_type_id==110)return block.fn(this);else return block.inverse(this)});Handlebars.registerHelper("isTicketInteractionType",function(ticket,ticketInteractionTypeId,block){if(ticket.interaction_type_id==ticketInteractionTypeId)return block.fn(this);else return block.inverse(this)});
Handlebars.registerHelper("isTicketStatusType",function(ticket,ticketStatusId,block){if(ticket.ticket_status_type_id==ticketStatusId)return block.fn(this);else return block.inverse(this)});Handlebars.registerHelper("isInteractionOutStatus",function(ticket,interactionOutStatusIds,block){var keys=interactionOutStatusIds.split(","),id=ticket.last_interaction_out_status_id||"";if($.inArray(id.toString(),keys)!=-1)return block.fn(this);else return block.inverse(this)});
Handlebars.registerHelper("isTicketPriority",function(ticket,ticketPriority,block){if(ticket.priority==ticketPriority)return block.fn(this);else return block.inverse(this)});Handlebars.registerHelper("isInteractionTypeSupportsMessages",function(ticket,block){if(ticket.interaction_type_id==40||ticket.interaction_type_id==30||ticket.interaction_type_id==50||ticket.interaction_type_id==70)return block.fn(this);else return block.inverse(this)});
Handlebars.registerHelper("hasOneMessage",function(ticket,block){if(ticket.message_count==1)return block.fn(this);else return block.inverse(this)});Handlebars.registerHelper("allowTicketFilterTicketResolve",function(ticket,block){if(!ticket.in_search&&allowQuickResolve(ticket.interaction_type_id)&&!ticket.active_user_id&&ticket.ticket_status_type_id<70)return block.fn(this);else return block.inverse(this)});
Handlebars.registerHelper("ticketFilterSubjectDisplay",function(ticket,empty_str){return!ticket.subject.nil&&ticket.subject.length>0?ticket.subject:empty_str});Handlebars.registerHelper("ticketFilterUserName",function(ticket,me_str){if(ticket.user_id==Assistly.current_user.id&&me_str)return me_str;else return typeof Assistly.users.get(ticket.user_id)=="undefined"?"":Assistly.users.get(ticket.user_id).name});
Handlebars.registerHelper("ticketFilterUserExists",function(ticket,block){if(ticket.user_id&&typeof Assistly.users.get(ticket.user_id)!="undefined")return block.fn(this);else return block.inverse(this)});Handlebars.registerHelper("isTicketFilterActiveUserCurrentUser",function(ticket,block){if(ticket.active_user_id==Assistly.current_user.id)return block.fn(this);else return block.inverse(this)});
Handlebars.registerHelper("ticketFilterActiveUserName",function(ticket,me_str){if(me_str!=null&&ticket.active_user_id==Assistly.current_user.id)return me_str;else return typeof Assistly.users.get(ticket.active_user_id)=="undefined"?"":Assistly.users.get(ticket.active_user_id).name});Handlebars.registerHelper("ticketFilterActiveUserExists",function(ticket,block){if(ticket.active_user_id&&typeof Assistly.users.get(ticket.active_user_id)!="undefined")return block.fn(this);else return block.inverse(this)});
Handlebars.registerHelper("ticketFilterGroupName",function(ticket,empty_str){if(ticket.group_id)return typeof Assistly.groups.get(ticket.group_id)=="undefined"?"":Assistly.groups.get(ticket.group_id).name;else return empty_str});
Handlebars.registerHelper("ticketFilterUserThenGroupName",function(ticket,me_str){if(ticket.user_id)if(ticket.user_id==Assistly.current_user.id&&me_str)return me_str;else return typeof Assistly.users.get(ticket.user_id)=="undefined"?"":Assistly.users.get(ticket.user_id).name;else if(ticket.group_id)return typeof Assistly.groups.get(ticket.group_id)=="undefined"?"":Assistly.groups.get(ticket.group_id).name});
Handlebars.registerHelper("ticketFilterLabelIdsToSortedLabelNames",function(ticket){var new_labels=[];var ret="";for(var i=0,j=ticket.labels.length;i<j;i++){var label=Assistly.labels.cases.get(ticket.labels[i]);var label=typeof Assistly.labels.cases.get(ticket.labels[i])=="undefined"?null:Assistly.labels.cases.get(ticket.labels[i]);if(label&&label.active&&!label.deleted)new_labels.push([label.name,label.label_color])}new_labels.sort(function(a,b){a=a[0].toLowerCase(),b=b[0].toLowerCase();return a<
b?-1:a>b?1:0});for(var i=0,j=new_labels.length;i<j;i++)ret=ret+"<li class='a-label-color-"+new_labels[i][1]+"'><p>"+new_labels[i][0]+"</p></li>";return new Handlebars.SafeString(ret)});Handlebars.registerHelper("twitterUserLogin",function(ticket){if(ticket&&ticket.customer&&ticket.customer.twitter_user&&ticket.customer.twitter_user.login)return ticket.customer.twitter_user.login;else return""});Handlebars.registerHelper("siteAgentDescriptor",function(){return Assistly.site_config.agent_name_descriptor});
Handlebars.registerHelper("isCurrentUserAllowedCaseDeletion",function(block){if(Assistly.current_user.allow_case_deletion)return block.fn(this);else return block.inverse(this)});
function adjustForTicketFilterCounts(){var interval=Assistly.options.ticket_filter.ticket_count_rate_seconds*1E3,pollStatus=Assistly.polling.ticket_filters,hasErrors=pollStatus.failures>0,nextUpdate=pollStatus.next_update,currentTime=(new Date).getTime(),include=isNaN(nextUpdate)||hasErrors||currentTime>=nextUpdate;pollStatus.include_count=include?1:0;if(include)pollStatus.next_update=currentTime+interval}
function adjustTicketFilterPollThrottle(){poll_ticket_filter_throttle_rate=1;if(Assistly.polling.ticket_filters.failures>0)adjustTicketFilterPollByErrorStatus();else adjustTicketFilterPollByActivity()}function adjustTicketFilterPollByErrorStatus(){var failures=Assistly.polling.ticket_filters.failures;poll_ticket_filter_throttle_rate=adjustBackoffPollerRate(failures)}
function adjustTicketFilterPollByActivity(){var curTime=new Date;var millisSinceLastActivity=curTime-last_user_action;if(millisSinceLastActivity>5*60*1E3)poll_ticket_filter_throttle_rate=2;if(millisSinceLastActivity>10*60*1E3)poll_ticket_filter_throttle_rate=4;if(millisSinceLastActivity>15*60*1E3)poll_ticket_filter_throttle_rate=6}function adjustAgentPollThrottle(){poll_agent_throttle_rate=1;if(Assistly.polling.agent.failures>0)adjustAgentPollByErrorStatus()}
function adjustAgentPollByErrorStatus(){var failures=Assistly.polling.agent.failures;poll_agent_throttle_rate=adjustBackoffPollerRate(failures)}function adjustBackoffPollerRate(failures){var max_failures=Assistly.polling.agent.max_failures;failures=failures>max_failures?max_failures:failures;var jitter=1/(Math.floor(Math.random()*10)+1);var rate=Math.pow(2,failures);return rate+jitter}
function AssistlyTab(tab_id){this.tab_id=tab_id;this.tabDOM=function(selector){if(selector===undefined)selector="";return $("#tabs-tid_"+this.tab_id+" "+selector)};this.customerDOM=function(selector){if(selector===undefined)selector="";return $("#ticket_customer_tid_"+this.tab_id+" "+selector)};this.companyDOM=function(selector){if(selector===undefined)selector="";return $("#ticket_company_tid_"+this.tab_id+" "+selector)};this.ticketDOM=function(selector){if(selector===undefined)selector="";return $("#ticket_ticket_tid_"+
this.tab_id+" "+selector)};this.isReplyTooShortWarning=function(){message=this.tabDOM(".reply_area").val();if(!message)return false;message=message.replace(/^\s\s*/,"").replace(/\B@[a-z0-9_]+\s*/i,"");message_length=message.length;if(message_length>0&&message_length<10)return true;else return false};this.checkForRecipients=function(){if($("#email_to, #email_cc, #email_bcc",this.tabDOM).length>0)return $("#email_to, #email_cc, #email_bcc",this.tabDOM).filter(function(index){return this.value.length>
0}).length>0;return true};this.isRecipientCountTooHigh=function(){if($("#email_to, #email_cc, #email_bcc",this.tabDOM).length==0)return false;if(MAX_RECIPIENTS<=0)return false;var recipient_count=0;recipient_count+=$("#email_to",this.tabDOM).val().split(",").filter(function(n){return n}).length;recipient_count+=$("#email_cc",this.tabDOM).val().split(",").filter(function(n){return n}).length;recipient_count+=$("#email_bcc",this.tabDOM).val().split(",").filter(function(n){return n}).length;if(recipient_count>
MAX_RECIPIENTS)return true;else return false};this.updateUserList=function(selectedUserId){var userSelect=this.ticketDOM("#ticket_user_id");var selectedGroupId=this.ticketDOM("#ticket_group_id").val();this.buildUserList(userSelect,selectedGroupId);if(!(typeof selectedUserId=="undefined"))userSelect.val(selectedUserId)};this.updateSplitModalUserList=function(selectedUserId,selectedGroupId){if(selectedGroupId===undefined)selectedGroupId=0;var userSelect=$("#tabs-tid_"+current_tab_id+" .agent_new_split_at_div_inside").find("select#ticket_user_id");
this.buildUserList(userSelect,selectedGroupId);if(!(typeof selectedUserId=="undefined"))userSelect.val(selectedUserId)};this.buildUserList=function(userSelect,selectedGroupId){var userArray=new Array;var unassignedUserObject=new Object;unassignedUserObject.id=0;unassignedUserObject.name=I18n.translate("agent.common.unassigned");userSelect.empty();if(typeof selectedGroupId!=="undefined"&&selectedGroupId!=""&&selectedGroupId!=0)$.each(Assistly.groups.get(selectedGroupId).assigned_user_ids,function(idx,
user_id){var userObj=Assistly.users.get(user_id);if(typeof userObj!=="undefined"){var userJSON=JSON.parse(JSON.stringify(userObj));if(userObj&&user_id==Assistly.current_user.id)userObj.name=I18n.translate("agent.common.me");if(userObj&&!userObj.deleted)userArray.push(userObj)}});else $.each(Assistly.users.array,function(idx,user){var userObj=JSON.parse(JSON.stringify(user));if(user.id==Assistly.current_user.id)userObj.name=I18n.translate("agent.common.me");if(!userObj.deleted)userArray.push(userObj)});
userArray.sort(function(a,b){a=a.name.toLowerCase(),b=b.name.toLowerCase();return a<b?-1:a>b?1:0}).unshift(unassignedUserObject);$.each(userArray,function(idx,user){userSelect.append($("<option />").val(user.id).text(user.name))})};this.updateGroupList=function(selectedGroupId){if(selectedGroupId===undefined)selectedGroupId=0;var groupSelect=this.ticketDOM("#ticket_group_id");this.buildGroupList(groupSelect,selectedGroupId)};this.updateSplitModalGroupList=function(selectedGroupId){if(selectedGroupId===
undefined)selectedGroupId=0;var groupSelect=$("#tabs-tid_"+current_tab_id+" .agent_new_split_at_div_inside").find("select#ticket_group_id");this.buildGroupList(groupSelect,selectedGroupId)};this.buildGroupList=function(groupSelect,selectedGroupId){var groupArray=new Array;var unassignedGroupObject=new Object;unassignedGroupObject.id=0;unassignedGroupObject.name=I18n.translate("agent.common.unassigned");groupSelect.empty();$.each(Assistly.groups.array,function(idx,group){if(!group.deleted)groupArray.push(group)});
groupArray.sort(function(a,b){a=a.name.toLowerCase(),b=b.name.toLowerCase();return a<b?-1:a>b?1:0}).unshift(unassignedGroupObject);$.each(groupArray,function(idx,group){groupSelect.append($("<option />").val(group.id).text(group.name))});if(!(typeof selectedGroupId=="undefined"))groupSelect.val(selectedGroupId)};this.save=function(case_close_option_id,current_ticket,ticket_check_for_short_messages){if(!current_ticket||!(Assistly.options.interactions.confirm_on_short_replies&&ticket_check_for_short_messages)||
!this.isReplyTooShortWarning()||confirm(I18n.translate("agent.case.save.reply_too_short_warning"))){if(!this.checkForRecipients()){alert(I18n.translate("agent.case.save.no_recipients"));return false}if(this.isRecipientCountTooHigh()){alert(I18n.translate("agent.case.save.too_many_recipients"));return false}var closeCase=this.tabDOM("#close_view_on_completion").prop("checked"),activePanel=this.tabDOM(".inside_case_panel:visible"),tab=activePanel.data("tab"),action=closeCase?".close.closing":".save.saving",
message=I18n.translate("agent."+tab+action);this.tabDOM(".ticket_action_status_text").html(message);this.tabDOM(".ticket_action_status").show();resetNotify();this.ticketDOM("#ticket_agent_case_close_option_id").val(case_close_option_id);this.customerDOM("#customer_agent_case_close_option_id").val(case_close_option_id);this.companyDOM("#company_agent_case_close_option_id").val(case_close_option_id);this.ticketDOM("#ticket_agent_case_close_on_completion").val(closeCase);this.customerDOM("#customer_agent_case_close_on_completion").val(closeCase);
this.companyDOM("#close_case").val(closeCase);if(closeCase!==false)this.tabDOM("#ticket_seconds_handled").val(Desk.AHTCounter.calcHandleTime(this.tab_id));toggleAgentTicketFooterButtons(this.tab_id,true);if(closeCase&&tab==="company"){var companyId=$("#company_id",activePanel).val();$(document).trigger("companyClosed",companyId)}if(current_ticket)this.tabDOM(".edit_ticket_form").submit();else $(".a-case-tab-form",activePanel).submit()}}}AssistlyTab.find=function(tab_id){return new AssistlyTab(tab_id)};
function toggleUserJobActivity(){Assistly.polling.ticket_filters.next_update=(new Date).getTime();if(Assistly.current_user.active_user_jobs_count>0){$("#a-systembar .a-jobs span").html(Assistly.current_user.active_user_jobs_count);$("#a-systembar .a-jobs").removeClass("hide")}else $("#a-systembar .a-jobs").addClass("hide")}
$(document).ready(function(){$("#a-systembar .a-jobs").qtip({show:{delay:TOOLTIP_DELAY},style:{name:"assistly_middle",width:400},position:{corner:{target:"bottomMiddle",tooltip:"topMiddle"},adjust:{screen:true}},api:{beforeShow:function(){$("#user_jobs_loading").show();$("#user_jobs_body").hide();$.get("/agent/user_jobs.json",function(data){content=handlebarsUserJobsIndex(data);$("#a-systembar .a-jobs").qtip("api").updateContent(content);$("#user_jobs_loading").hide()})}}});toggleUserJobActivity()});
(function($){var formSelector=".agent_company_main_form_part",sectionSelector=".agent_company_section",removeOrgSelector=".remove_domain",addAnotherSelector=".add_domain",maxOrgsAllowed=10;$(document).on("click",".agent_company_section_data "+addAnotherSelector,addOrg);$(document).on("click",".agent_company_section_data "+removeOrgSelector,removeOrg);$(document).on("blur",".agent_company_section.org_section input",validateOrg);$(document).on("loaded","form.edit_company.a-case-tab-form",refreshOrgStyles);
function addOrg(e){e.preventDefault();var form=$(this).parents(formSelector),newSection=$.template("agent/companies/field_domain",{id:(new Date).getTime()});$(addAnotherSelector,form).parents(sectionSelector).before(newSection);refreshOrgStyles(e,form);$("input[name*=company_domains_attributes]",form).focus()}function removeOrg(e){e.preventDefault();var form=$(this).parents(formSelector);$(this).parents(sectionSelector).remove();refreshOrgStyles(e,form)}function refreshOrgStyles(e,form){if(form===
undefined)form=$(e.currentTarget);var tab=form.parents(".a-case-tab"),orgSections=$(".org_section",form),hasErrors=$(".error",form).length>0,maximumOrgs=orgSections.length>=maxOrgsAllowed;$(".org_section_new",form).toggle(!maximumOrgs);orgSections.removeClass("first").first().addClass("first");$(".ticket_action_buttons_buttons button",tab).prop("disabled",hasErrors)}function validateOrg(e){var input=$(e.currentTarget),form=input.parents(formSelector),section=input.parents(sectionSelector);valid=/^([a-z0-9-]+\.[a-z0-9-]+\.?)+$/i.test(input.val());
section.toggleClass("error",!valid);refreshOrgStyles(e,form)}})(jQuery);
(function($){var submitBtnSelector="#company_merge_submit";$(document).on("click",submitBtnSelector,submitForm);$(document).on("click",".a-merge-company input",toggleSubmitButton);$(document).on("ajax:complete","#new_company_merge",toggleSubmitButton);$(document).on("keyup",".agent_new_merge_company_div #search_q",autoSearch);$(document).on("focus",".agent_new_merge_company_div #search_q",closeAllToolTips);function toggleSubmitButton(){var checked=$(".a-merge-company :checked").length>0;if(checked)$(submitBtnSelector).enable();
else $(submitBtnSelector).disable()}function submitForm(){$(submitBtnSelector).disable();$("#new_company_merge").submit()}function autoSearch(){var input=$(this),searchQuery=input.val(),form=input.parents("form"),modal=form.parents(".agent_new_merge_company_div"),resultsPanel=$(".customer_search_results",modal).hide();$(submitBtnSelector).disable();if(searchQuery!==""){clearTimeout(Assistly.agentSearchTimer);$("#agent_customer_merge_searching",modal).show();Assistly.agentSearchTimer=setTimeout(function(){form.submit()},
250)}}})(jQuery);
(function($){var timeoutID=null;$(document).on("click","#company_search_modal .a-modal-bottom .a-button",closeModal);$(document).on("click","#company_search_modal .a-pill-navigation a",changeCompanyType);$(document).on("ajax:beforeSend","#company_search_modal form",displayLoader);$(document).on("ajax:complete","#company_search_modal form",displayResults);$(document).on("ajax:error","#company_search_modal form",displayError);$(document).on("keyup","#company_search_modal #term",refreshResults);function closeModal(e){e.preventDefault();
tb_remove()}function displayError(){alert(I18n.translate("agent.company.search.error"))}function displayLoader(){clearTimeout(timeoutID);$("#company_search_modal").addClass("loading")}function displayResults(){$("#company_search_modal").removeClass("loading")}function refreshResults(e){clearTimeout(timeoutID);if(e.keyCode===13||e.keyCode===27)return;timeoutID=setTimeout(function(){$(e.currentTarget).parents("form").submit()},1E3)}function changeCompanyType(e){e.preventDefault();var companyType=$(e.currentTarget);
companyType.parent().addClass("active").siblings().removeClass("active").end().data("company-type");$("#company_search_modal #company_type").val(companyType.data("company-type"));$("#company_search_modal form").submit()}})(jQuery);
(function($){var storageKey="open_company_tabs";function getOpenCompanyIds(){var ids=[],data=getLocalStoragePrefs(storageKey)||"";if(data!=="")ids=data.split(",");return ids}function saveOpenCompanyIds(openIds){var ids=$.unique(openIds);setLocalStoragePrefs(storageKey,ids)}function reopenCompanyTabs(e,path){var ids=getOpenCompanyIds();ids=$.unique(ids);$.each(ids,function(){if(isNaN(this))return;$.getScript(path+"?company_id="+this)})}function removeFromOpenTabs(e,companyId){var ids=getOpenCompanyIds(),
indx=$.inArray(companyId.toString(),ids);ids.splice(indx,1);saveOpenCompanyIds(ids)}function addToOpenTabs(e,companyId){var ids=getOpenCompanyIds();ids.push(companyId.toString());saveOpenCompanyIds(ids)}})(jQuery);(function(){$(function(){return $("a[data-open-customer]").live("click",function(e){var customerId,path;e.preventDefault();path="/agent/tickets/open_customer?customer_id=REPLACE";customerId=$(this).data("open-customer");path=path.replace("REPLACE",customerId);return $.getScript(path)})})}).call(this);
(function($){Desk=window.Desk||{};Desk.AppliedArticles=function(){var validArticleType=["quickcode","macro","kbSearchText","kbSearchLink"];var appliedArticles={};var clearTextBasedArticles=function(caseId,articleType){for(var i=0;i<validArticleType.length;i++){var temp=appliedArticles[caseId][validArticleType[i]];if(temp!==articleType&&validArticleType[i]!=="kbSearchLink")appliedArticles[caseId][validArticleType[i]]=null}};var caseIdCheck=function(caseId){if(typeof appliedArticles[caseId]==="undefined")return false;
else return true};var setupNewCase=function(caseId){appliedArticles[caseId]={quickcode:null,macro:null,kbSearchText:null,kbSearchLink:[]}};var updateAppliedArticle=function(caseId,articleType,content){if(articleType==="kbSearchLink"){if(appliedArticles[caseId]["kbSearchLink"].indexOf(content)===-1){console.log("updateAppliedArticle",caseId,articleType,content);appliedArticles[caseId]["kbSearchLink"].push(content)}}else{clearTextBasedArticles(caseId,articleType);appliedArticles[caseId][articleType]=
content}};var add=function(caseId,articleType,content,articleId){if(typeof caseId==="undefined"||validArticleType.indexOf(articleType)===-1||typeof content==="undefined")return;if(!caseIdCheck(caseId))setupNewCase(caseId);updateAppliedArticle(caseId,articleType,content);if(Assistly.options.agent_kb_record_events!==true)return};var removeAll=function(caseId){if(typeof caseId==="undefined")return;delete appliedArticles[caseId]};return{add:add,removeAll:removeAll,appliedArticles:appliedArticles}}()})(jQuery);
(function($){Desk=window.Desk||{};Desk.CaseExports=function(){var init=function(data){if(typeof data!=="object")return null;showModal(data,"loading");if(data.req_type==="request"){var agent_location=agentLocation();data.query=selectedCases(agent_location,data.export_all);data.all_selected=function(){var all_checkboxes_len=$("#"+data.query.agent_area+" .ticket_filter_check_box:not([name='ticket_filter_all_items'])").length;var all_checked_checkboxes_len=$("#"+data.query.agent_area+" .ticket_filter_check_box:checked:not([name='ticket_filter_all_items'])").length;
return all_checkboxes_len===all_checked_checkboxes_len?true:false}();data.filter_len=function(){if(data.query.agent_area==="tabs-tickets")return $("#tab-ticket-filter-total-count-"+data.query.ticket_filter).text();else{var search_totals_text=$("#agent_search_results_header .a-search-results-count .numbers").text();var total_results=search_totals_text.substring(search_totals_text.lastIndexOf("of ")+3,search_totals_text.length).replace(/\s/gi,"");return total_results}}()}req(data);return data};var index=
function(data){if(typeof data!=="object")return null;data.type="get";data.url=data.url||"/agent/case_exports";data.callback=function(){updateNav(data.req_type)};req(data);return data};var cancel=function(data){if(typeof data!=="object")return null;data.type="delete";data.query={ticket_id:data.query};req(data);return data};var download=function(data){if(typeof data!=="object")return null;data.type="get";req(data);return data};var confirmExport=function(data){if(typeof data!=="object")return null;data.type=
"post";req(data);return data};var templateLocation=function(template){if(typeof template==="undefined")return null;switch(template){case "loading":return"agent/case_exports/loading";case "queue_full":return"agent/case_exports/queue_full";case "export_too_big":return"agent/case_exports/export_too_big";case "download":return"agent/case_exports/download";case "no_cases_selected":return"agent/case_exports/no_cases_selected";case "confirm_export":return"agent/case_exports/confirm_export";default:actionError("generic");
break}};var closeModal=function(){tb_remove();return true};var showModal=function(data,template){if(typeof data!=="object"||typeof template==="undefined")return null;var container=getModalContainer();container.template(templateLocation(template),data);tb_show("case_exports","#TB_inline?height=450&width=600&inlineId=case_exports_modal_container&modal=true")};var export_complete=function(){notify(I18n.translate("agent.case_exports.export_request_success"),true,7E3);var loc=agentLocation();if(loc.attr("id")===
"tabs-tickets")loc=0;else loc=1;deselectAllTicketFilterItems(loc);closeModal()};var updateModal=function(data,req_type,nav_settings){if(typeof data!=="object"||typeof req_type==="undefined")return null;var container=$("<div/>");container.template(templateLocation(req_type),data);if(req_type==="download"){$("#TB_ajaxContent .a-modal-body .a-download-container").html(container).show();$("#TB_ajaxContent .a-modal-body .a-request-container").hide()}else{$("#TB_ajaxContent .a-modal-body .a-request-container").html(container).show();
$("#TB_ajaxContent .a-modal-body .a-download-container").hide()}$("#TB_ajaxContent .a-modal-body .a-spinner-wrapper").hide()};var updateNav=function(name){if(typeof name==="undefined")return;if(name==="download"){$("#case_exports_modal .download-nav-button").addClass("active");$("#case_exports_modal .request-nav-button").removeClass("active")}else{$("#case_exports_modal .download-nav-button").removeClass("active");$("#case_exports_modal .request-nav-button").addClass("active")}};var manageNav=function(req_type,
nav_settings){var nav_settings=nav_settings||null;if(nav_settings!=null){if(nav_settings.request.hide)$("#TB_ajaxContent .a-pill-navigation li.request-nav-button").hide();if(nav_settings.download.disabled===true)$("#TB_ajaxContent .a-pill-navigation li.download-nav-button a").removeClass("active-link")}else $("#TB_ajaxContent .a-pill-navigation li").show()};var req=function(data){if(typeof data!=="object")return null;$.ajax({url:data.url,type:data.type,dataType:"json",data:function(){if(data.type.toLowerCase()===
"post")return $.param(data.query);else return null}(),beforeSend:function(xhr,opts){if(data.req_type==="request")if(!data.query.all_ticket_type&&!data.query.ticket_ids){xhr.abort();updateModal({},"no_cases_selected");return}if(data.req_type==="download"){updateNav(data.req_type);$("#TB_ajaxContent .a-modal-body .a-request-container").hide();$("#TB_ajaxContent .a-modal-body .a-spinner-wrapper").show()}if(data.req_type==="export_confirm"){$("#TB_ajaxContent .a-modal-body .a-request-container").hide();
$("#TB_ajaxContent .a-modal-body .a-spinner-wrapper").show()}},success:function(resp){if(resp.error)actionError(resp.error);else switch(data.req_type){case "request":updateModal($.extend({},resp,data),resp.data.status);break;case "export_confirm":export_complete();break;case "download":updateModal(resp,data.req_type);break;case "download-export":downloadCSV(resp.link);break;case "cancel":deleteRow(data.query.ticket_id);break}},error:function(resp){actionError(resp.status)},complete:function(resp){if(typeof data.callback===
"function")data.callback();if(data.req_type==="download")$("#case_exports_modal .timeago").timeago();if($("#case_exports_modal .a-tooltip"))$("#case_exports_modal .a-tooltip").assistlyTooltip()}})};var deleteRow=function(row_id){if(typeof row_id==="undefined")return null;$("#case_exports_modal [data-row-id='"+row_id+"']").remove();notify(I18n.translate("agent.case_exports.success.cancel"),true,7E3)};var downloadCSV=function(link){if(typeof link==="undefined"){actionError("");return null}window.open(link)};
var getModalContainer=function(){var container=$("#case_exports_modal_container");if(container.length===0)container=$("<div/>",{id:"case_exports_modal_container"}).hide().appendTo("body");return container};var selectedCases=function(agent_location,export_all){if(typeof agent_location!=="object")return null;var resp={all_ticket_type:false,ticket_ids:null,agent_area:agent_location.attr("id"),ticket_filter:selected_ticket_filter_id};if(agent_location.attr("id")==="tabs-search")resp.search=$("#search_q").val();
if(agent_location.find(".ticket_filter_items_apply_to_all:checked").length===0&&export_all!=true)resp.ticket_ids=buildArray(agent_location.find(".ticket_filter_check_box:checked")).join();else{resp.all_ticket_type=agent_location.find("select.ticket_filter_submenu_select").val();if(resp.all_ticket_type===""||resp.all_ticket_type==="All"||export_all==true)resp.all_ticket_type="*";delete resp.ticket_ids}return resp;function buildArray(tickets){var tem_arr=[];tickets.each(function(){if($(this).attr("name")!==
"ticket_filter_all_items")tem_arr.push($(this).attr("id").replace(/ticket_filter_item_/g,""))});delete resp.all_ticket_type;return tem_arr}};var showRequest=function(){$("#TB_ajaxContent .a-request-container").show();$("#TB_ajaxContent .a-download-container").hide();updateNav("request")};var agentLocation=function(){if($("#tabs-search").hasClass("ui-tabs-hide"))return $("#tabs-tickets");else return $("#tabs-search")};var actionError=function(error){debugger;if(typeof error==="object")return null;
var error=error||"generic";closeModal();notify(errorMessage(error),true,7E3)};var errorMessage=function(error){if(typeof error==="undefined")return null;var msg=I18n.translate("agent.case_exports.errors."+error);if(msg!=="Missing translation en.agent.case_exports.errors."+error)return msg;else return I18n.translate("agent.case_exports.errors.generic")};return{closeModal:closeModal,init:init,index:index,cancel:cancel,download:download,confirmExport:confirmExport,showRequest:showRequest}}();$(document).on("click",
"#systemBar_exportedCases",function(e){e.preventDefault();Desk.CaseExports.init({req_type:"download",type:"get",url:$(this).attr("href"),nav_settings:{request:{hide:true},download:{disabled:true}}})});$(document).on("click","#case_exports_modal .a-case-exports-link.active-link",function(e){e.preventDefault();Desk.CaseExports.index({req_type:"download",url:"/agent/case_exports"})});$(document).on("click","#case_exports_modal .a-case-export-request-link.active-link",function(e){e.preventDefault();Desk.CaseExports.showRequest({req_type:"request"})});
$(document).on("click","#case_exports_modal .a-modal-x a",function(e){e.preventDefault();Desk.CaseExports.closeModal()});$(document).on("click","#case_exports_modal .queue-link a",function(e){e.preventDefault();Desk.CaseExports.cancel({req_type:"cancel",url:$(this).attr("href"),query:$(this).attr("data-obj-id")})});$(document).on("click",".ticket_filter_bulk_export_button",function(e){e.preventDefault();Desk.CaseExports.init({req_type:"request",type:"post",url:$(this).attr("href")})});$(document).on("click",
".ticket_filter_bulk_export_all_button",function(e){e.preventDefault();Desk.CaseExports.init({req_type:"request",type:"post",url:$(this).attr("href"),export_all:true})});$(document).on("click","#export_cases_button",function(e){e.preventDefault();Desk.CaseExports.confirmExport({req_type:"export_confirm",type:"post",url:"/agent/case_exports",query:$("#case_exports_modal input").serializeObject()})})})(jQuery);
function InteractionFromSelect(currentTabId,ticketId){this.currentTabId=currentTabId;this.ticketId=ticketId;this.linkedInteractions={};this.getTicketLinkData=function(){var that=this;$.ajax({url:"/agent/tickets/"+this.ticketId+"/linked_interactions",cache:true,dataType:"json",type:"GET",data:{"ticket_id":this.ticketId},success:function(jsonData){that.linkedInteractions=jsonData;that.loadSplitCases()}})};this.rightTextArea=function(){var selection=this.getSelectionObject();if(selection instanceof Selection){if(selection.isCollapsed===
false&&$(selection.anchorNode.parentNode).find(".from_ticket_container").length===0)if(selection.focusNode.parentElement.nodeName==="A"||selection.anchorNode.parentElement.nodeName==="A")return($.inArray("customer_history_ticket_email_body",selection.anchorNode.parentNode.classList)>=0||$.inArray("customer_history_ticket_email_body",selection.focusNode.parentNode.classList)>=0)===true;else return($.inArray("customer_history_ticket_email_body",selection.anchorNode.parentNode.classList)>=0||$.inArray("customer_history_ticket_email_body",
selection.anchorNode.classList)>=0)&&($.inArray("customer_history_ticket_email_body",selection.focusNode.parentNode.classList)>=0||$.inArray("customer_history_ticket_email_body",selection.focusNode.classList)>=0)===true}else if(selection instanceof TextRange)return $.inArray("customer_history_ticket_email_body",selection.parentElement().classList)>=0===true&&selection.htmlText.match(/<a|http|https|www/gi)===null};this.getSelectedText=function(){if(this.getSelectionObject()instanceof Selection)return this.getSelectionObject().toString();
else if(this.getSelectionObject()instanceof TextRange)return this.getSelectionObject().text};this.getSelectionObject=function(){var userSelection;if($.browser.msie)userSelection=document.selection.createRange();else userSelection=window.getSelection();return userSelection};this.selectionEmpty=function(){return(this.getSelectedText().match(/highlighBlocker/)===null&&this.getSelectedText().replace(/\s|\r|\n/gm,"").length>0)===false};this.preventTextHighlight=function(){$(".text_match_block").on("mousedown onselectstart",
function(){return false})};this.setSelectionCatch=function(){this.preventTextHighlight();this.removeHighlightOnContextChange();this.checkReplyClick();var that=this;$("#tabs-tid_"+this.currentTabId).find(".a-ticket-meat").on("mouseup",function(e){if(that.rightTextArea()===true&&that.selectionEmpty()===false){var $newInteractionButton=$(this).parent().find(".split_from_selection_link");$newInteractionButton.removeClass("hidden");that.checkUnhighlight();that.checkNewHighLightClick()}})};this.checkReplyClick=
function(){$(".email_reply_div_reply_area").on("click dblclick",function(){$(".customer_history_ticket_center .split_from_selection_link").addClass("hidden")})};this.removeHighlightOnContextChange=function(){$('a[id^="tab_header_ticket_id_"]').on("click dblclick",function(){if($.browser.msie)document.selection.clear();else window.getSelection().removeAllRanges();$(".customer_history_ticket_center .split_from_selection_link").addClass("hidden")})};this.checkNewHighLightClick=function(){var that=this;
$("#tabs-tid_"+this.currentTabId).on("click dblclick",".split_from_selection_link",function(){$(this).on("ajax:complete",function(){var charToDisplay=60;var selectedText=that.getSelectedText();$("#tabs-tid_"+that.currentTabId).parent().find("#split_from_text").val("").val(selectedText);var newLineCount=0;var displayText=selectedText.replace(/\n{2}/gm,"\n").split(/\n/).slice(0,3).join("\n").trim();$.each(displayText.split(/\n/),function(i,v){if(v.length===0)newLineCount++});charToDisplay=charToDisplay-
newLineCount*40;var appendedStringEnd=displayText.length>charToDisplay?'..."</span>':'"<span>';var targetDisplayText=$("#tabs-tid_"+that.currentTabId).parent().find("#split_from_text_display");$(targetDisplayText).find("span").remove();$('<span>"'+displayText.substring(0,charToDisplay).replace(/\n/gm,"<br>")+appendedStringEnd).appendTo(targetDisplayText)})})};this.checkUnhighlight=function(){var that=this;$("#tabs-tid_"+this.currentTabId).on("click dblclick",".customer_history_ticket_center",function(){that.hideSelectionLink();
that.checkUnhighlightDelay()})};this.checkUnhighlightDelay=function(){var that=this;setTimeout(function(){that.hideSelectionLink()},200)};this.hideSelectionLink=function(){if(this.selectionEmpty()===true)$("#tabs-tid_"+this.currentTabId).find(".customer_history_ticket_center .split_from_selection_link").addClass("hidden")};this.loadFromInteraction=function(from_interaction){$($("<div class='from_ticket_container'><p>"+I18n.translate("agent.ticket.split_from.link_back")+" <a id='ticket_child_link_"+
from_interaction.from_ticket_id+"' onclick='ticketShowTableView("+from_interaction.from_ticket_id+", event);return false;' href='#'>"+from_interaction.from_ticket_display_id+"</a>\u200b</p></div>")).appendTo($("#customer_history_i"+from_interaction.to_interaction_id+" .customer_history_ticket_email_body.a-ticket-meat"))};this.loadToInteraction=function(to_interaction,index){var searchText=Desk.StringUtils.removeXSSVals(to_interaction.to_ticket_body.replace(/\r/gm,""));var targetDiv=$("#customer_history_i"+
to_interaction.from_interaction_id+" .customer_history_ticket_email_body.a-ticket-meat");var replacementText;var threadedSection;var urlRegex=/\b((?:[a-z][\w-]+:(?:\/{1,3}|[a-z0-9%])|www\d{0,3}[.]|[a-z0-9.\-]+[.][a-z]{2,4}\/)(?:[^\s()<>]+|\(([^\s()<>]+|(\([^\s()<>]+\)))*\))+(?:\(([^\s()<>]+|(\([^\s()<>]+\)))*\)|[^\s`!()\[\]{};:'".,<>?\u00ab\u00bb\u201c\u201d\u2018\u2019]))/ig;if(urlRegex.test(searchText)){var urls=searchText.match(urlRegex);for(var i=0;i<urls.length;i++){var targetUrls=$(targetDiv[0]).find("a:contains('"+
urls[i]+"')").filter(function(){return $(this).text().indexOf(urls[i])===0});if(targetUrls.length>0){searchText=searchText.replace(targetUrls[0].text,targetUrls[0].outerHTML);threadedSection="<div class='text_match_block'><b><span class='case_bullet_indicator "+to_interaction.ticket_status_type+"'></span> "+I18n.translate("agent.ticket.split_to.case")+" <a id='ticket_child_link_"+to_interaction.to_ticket_id+"' onclick='ticketShowTableView("+to_interaction.to_ticket_id+", event);return false;' href='#'>#"+
to_interaction.to_ticket_display_id+" </a><span class='ticket_status_name'>("+to_interaction.ticket_status_type+")</span><span class='text_highlight_prevent_block'>highlighBlocker</span></b><span class='highlight_text_match'>"+searchText+"</span></div>";replacementText=$(targetDiv[0]).html().replace(searchText,threadedSection);$(targetDiv).html(replacementText)}}}else try{threadedSection="<div class='text_match_block'><b><span class='case_bullet_indicator "+to_interaction.ticket_status_type+"'></span> "+
I18n.translate("agent.ticket.split_to.case")+" <a id='ticket_child_link_"+to_interaction.to_ticket_id+"' onclick='ticketShowTableView("+to_interaction.to_ticket_id+", event);return false;' href='#'>#"+to_interaction.to_ticket_display_id+" </a><span class='ticket_status_name'>("+to_interaction.ticket_status_type+")</span><span class='text_highlight_prevent_block'>highlighBlocker</span></b><span class='highlight_text_match'>"+searchText+"</span></div>";replacementText=$(targetDiv[0]).html().replace(searchText,
threadedSection)}finally{$(targetDiv).html(replacementText)}};this.loadSplitCases=function(){var that=this;$.each(this.linkedInteractions.from_ticket_interactions,function(i,from_interaction){if($("#customer_history_i"+from_interaction.to_interaction_id).length>0)that.loadFromInteraction(from_interaction)});$.each(this.linkedInteractions.to_ticket_interactions,function(i,to_interaction){if($("#customer_history_i"+to_interaction.from_interaction_id).length>0)that.loadToInteraction(to_interaction)})};
this.getTicketLinkData();this.setSelectionCatch()}InteractionFromSelect.init=function(currentTabId,ticketId){return new InteractionFromSelect(currentTabId,ticketId)};
$(function(){var buildInlineMacrosDomContainer=function(){var body=$("body");var macroSource=$("#macro_data_div");var allLis=macroSource.find("li a");var inlineMacrosContainer=$("<div class='inlineMenuConatiner' id='inlineMacrosContainer'><ul></ul></div>");var ulInsideInlineMacrosContainer=inlineMacrosContainer.find("ul");allLis.each(function(idx,elem){elem=$(elem);var itemid=elem.attr("itemid");var folderName=elem.attr("label");var macroName=elem.text();var tempLiToInsert,tempSpanWithFolderName,
tempSpanwithMacroName;if(typeof itemid!=="undefined"){tempLiToInsert=$("<li data-macro="+itemid+">");if(folderName){tempSpanWithFolderName=$("<span>");tempSpanWithFolderName.text(folderName+" > ");tempLiToInsert.append(tempSpanWithFolderName)}tempSpanwithMacroName=$("<span>");tempSpanwithMacroName.text(macroName);tempLiToInsert.append(tempSpanwithMacroName);ulInsideInlineMacrosContainer.append(tempLiToInsert)}});body.append(inlineMacrosContainer)};buildInlineMacrosDomContainer();var rebuildInlineMacros=
_.debounce(function(){$("#inlineMacrosContainer").remove();buildInlineMacrosDomContainer();$(document).trigger("inlineMacrosDomHasBeenUpdated")},2E3);$("#macro_data_div").bind("DOMSubtreeModified",function(e){if($("#inlineMacrosContainer").is(":visible")===false)rebuildInlineMacros();else window.setTimeout(arguments.callee,1E3)});var addInlineMenu=function(event,interaction_type,tab_id,ticket_id,draft_id){var itemAppliedCallback=function(itmId){var currentTab=$("#tabs-tid_"+tab_id);toggleAgentTicketFooterButtons(tab_id,
true);$(".ticket_action_status",currentTab).show();$(".ticket_action_status_text",currentTab).html(I18n.translate("agent.macro.apply"));$.ajax({url:"/agent/tickets/"+ticket_id+"/apply_macro",data:{"ctid":tab_id,"macro_id":itmId,"inline":"true"},cache:false});var customAttrs={"data-custom-attrs":{"interaction_type":interaction_type,"tab_id":tab_id,"ticket_id":ticket_id,"macro_id":itmId,"draft_id":draft_id}}||null;var eventName={"data-tracking-name":"inlineMacro"};var trackingLocation={"data-tracking-model":"Agent"};
var tracking_obj=$.extend({},Assistly.base_tracking_obj,trackingLocation,eventName,customAttrs);Desk.Tracking.notify(tracking_obj)};var replyTextAreaSelector;if(interaction_type=="tweet")replyTextAreaSelector="#twitter_reply_area_ticket_"+ticket_id;else if(interaction_type=="chat")replyTextAreaSelector="#chat_message_name_"+draft_id;else if(interaction_type=="phone")replyTextAreaSelector="#phone_summary_area_ticket_"+ticket_id;else replyTextAreaSelector="#"+interaction_type+"_reply_area_ticket_"+
ticket_id;var inlineMenu=new desk.InlineMenu;inlineMenu.setupInlineMenu({"dropDownSelector":"#inlineMacrosContainer","textAreaSelctor":replyTextAreaSelector,"itemAppliedCallback":itemAppliedCallback,"callbackScope":this,"elementDataId":"macro",startingLettersLength:1});$(document).bind("inlineMacrosDomHasBeenUpdated",function(){if($(replyTextAreaSelector).length>0)inlineMenu.createOrUpdateDomReferences({"dropDownSelector":"#inlineMacrosContainer","textAreaSelctor":replyTextAreaSelector});else $(document).unbind("inlineMacrosDomHasBeenUpdated",
arguments.callee)})};$(document).on("desk:reply_form_rendered desk:chat_ticket_footer_rendered desk:phone_reply_area_rendered",addInlineMenu)});Desk.StringUtils={removeXSSVals:function(searchVal){return searchVal.replace(/\<script\>|\<\/script\>|javascript\:|\<script type=\"text\/javascript\"\>|\<script type\=\'text\/javascript\'\>/g,"")}};
(function(){var e=document.createElement("script");e.async=true;e.src=document.location.protocol+"//ecn.dev.virtualearth.net/mapcontrol/mapcontrol.ashx?v=6.3&s=1";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(e,s)})();
AgentHistoryEmail=function(params){var self=this;self._currentTabId=0;this.preview_path=function(attachment_id){return"/agent/tickets/attachments/"+attachment_id+"/preview_image?ctid="+self._currentTabId};this.header_path=function(email_id){return"/agent/emails/"+email_id+"/show_header?ctid="+self._currentTabId};this.html_part_path=function(email_id){return"/agent/emails/"+email_id+"/show_html_part?ctid="+self._currentTabId};this.text_part_path=function(email_id){return"/agent/emails/"+email_id+"/show_text_part?ctid="+
self._currentTabId};this.toggle_outbound_path=function(email_id){return"/agent/emails/"+email_id+"/toggle_outbound_usage?view_name=agent_response&ctid="+self._currentTabId};this.show_error_path=function(email_id){return"/agent/emails/"+email_id+"/show_error_part?ctid="+self._currentTabId};this.basic_update_path=function(ticket_id){return"/agent/tickets/"+ticket_id+"/basic_update"};this.split_at_path=function(interaction_id,index){return"/agent/interactions/"+interaction_id+"/splits/new?ctid="+self._currentTabId};
this.split_from_selection_path=function(interaction_id,index){return"/agent/interactions/"+interaction_id+"/splits/new?ctid="+self._currentTabId+"&highlight=true"};this.erase_interaction_path=function(interaction_id,index){return"/agent/interactions/"+interaction_id+"/erase?index="+index+"&view_name=agent_response"};this.erase_attachment_path=function(ticket_id){return"/agent/tickets/attachments/erasable?ticket_id="+ticket_id+"&ctid="+self._currentTabId};this.edit_note_path=function(note_id,index){return"/agent/ticket_notes/"+
note_id+"/edit?index="+index+"&view_name=agent_response&ctid="+self._currentTabId};this.erase_note_path=function(note_id,index){return"/agent/ticket_notes/"+note_id+"/erase?index="+index+"&view_name=agent_response"};this.isWebForm=function(clientName){if(clientName=="assistly_portal"||clientName=="assistly_widget")return true;else return false};this.remoteLinkHelper=function(path,text,options){options=options||{};options["data-method"]=options["data-method"]||"get";options["data-remote"]=true;return this.linkHelper(path,
text,options)};this.linkHelper=function(path,text,options){var attrs=[];for(var prop in options)attrs.push(prop+'="'+options[prop]+'"');return"<a href="+path+" "+attrs.join(" ")+" >"+htmlEntities(text)+"</a>"};this.renderTemplateInline=function(domTarget,data,ctid){this.setCurrentTabId(ctid);var template=Handlebars.compile(this.templateSource()),jsonData=JSON.parse(data);$(domTarget).html(template(jsonData));$("span.timeago").timeago();if(jsonData.twitter)this.initTwitterLink(jsonData.twitter)};this.setCurrentTabId=
function(val){self._currentTabId=val};this.templateSource=function(){var template="{{#each items}} \t\t\t{{#ifEmailNotDraft interaction}} \t\t\t\t"+params.emailHistoryPartial+" \t\t\t{{/ifEmailNotDraft}} \t\t\t{{#if ticket_note}} \t\t\t\t"+params.noteHistoryPartial+" \t\t\t{{/if}} \t\t\t{{#if customer_feedback}} \t\t\t\t"+params.feedbackHistoryPartial+" \t\t\t{{/if}} \t\t{{/each}}";return template};this.initTwitterLink=function(twitterData){var current_data_container=$("#session_text_tid_"+current_tab_id);
if(current_data_container.find(".twitter_reply_account").length===0){var follow_data=current_data_container.data("follow_data");var twitter_boxes=[];var twitter_box_len=function(){var size=0,key;for(key in follow_data)if(follow_data.hasOwnProperty(key)){twitter_boxes.push(key);size++}return size}();if(typeof follow_data!=="undefined"){for(var i=0;i<twitter_box_len;i++){Desk.Twitter.storeFollowData(follow_data[twitter_boxes[i]],current_data_container);Desk.Twitter.updateFollowPill(follow_data[twitter_boxes[i]],
twitterData.customer_twitter_login,current_tab_id,twitterData.twitter_boxes_count)}Desk.Twitter.showFollowPill(current_tab_id)}else Desk.Twitter.getFollowStatus(twitterData.twitter_boxes[0].login,twitterData.customer_twitter_login,current_tab_id)}$("#session_text_tid_"+current_tab_id+" .multi-twitter-box-wrap").on({mouseenter:function(){$("#session_text_tid_"+current_tab_id+" .multi-twitter-boxes-list").removeClass("hidden");$("#session_text_tid_' + current_tab_id + ' .a-ticket-reply-textarea textarea").blur()},
mouseleave:function(){$("#session_text_tid_"+current_tab_id+" .multi-twitter-boxes-list").addClass("hidden")}});$("#session_text_tid_"+current_tab_id+" .single-twitter-box").hover(function(){if($(this).hasClass("twitter-following"))$(this).find("a").text(I18n.translate("agent.twitter.buttons.unfollow"))},function(){if($(this).hasClass("twitter-following"))$(this).find("a").text(I18n.translate("agent.twitter.buttons.following"))})};this.registerHandlebarsHelpers=function(interaction){var self=this;
Handlebars.registerHelper("showEmailErrorLink",function(interaction){return self.remoteLinkHelper(self.show_error_path(interaction.email_id),I18n.translate("agent.email.view_last_error"),{})});Handlebars.registerHelper("dismissEmailErrorLink",function(interaction,leftPipe){if(interaction.dismiss_error_url){var content='<span class="dismiss-error">';if(leftPipe)content+=" | ";content+='<a href="#" ';content+='class="a-dismiss-ticket-error" ';content+='data-id="'+interaction.ticket_id+'" ';content+=
"data-last-interaction-out-status-id='50' ";content+='data-path="'+self.basic_update_path(interaction.ticket_id)+'">';content+=I18n.translate("agent.case.error.dismiss");content+="</a>";content+="</span>";return new Handlebars.SafeString(content)}else return""});Handlebars.registerHelper("autoLinkContent",function(item){var item=Handlebars.Utils.escapeExpression(item),content=$.autolink(item,"_blank");content=content.replace(/\r\n/g,"<br/>");content=content.replace(/\r|\n/g,"<br/>");return new Handlebars.SafeString(content)});
Handlebars.registerHelper("autoLinkSafeContent",function(item){var content=$.autolink(item,"_blank");content=content.replace(/\r\n/g,"<br/>");content=content.replace(/\r|\n/g,"<br/>");return new Handlebars.SafeString(content)});Handlebars.registerHelper("erasedMessage",function(item,erasedType){return I18n.translate("agent.erase."+erasedType+".message",{name:item.erased_by_name,date_time:item.erased_at_long,ago_time:jQuery.timeago(item.erased_at_iso8601)})});Handlebars.registerHelper("emailSubmittedTo",
function(interaction){if(interaction.email_client_name&&(interaction.email_client_name=="assistly_portal"||interaction.email_client_name=="assistly_widget"))return I18n.translate("agent.history.email.submitted_via_web");else return interaction.to?interaction.to:I18n.translate("common.empty")});Handlebars.registerHelper("emailDisplayName",function(interaction){if(interaction.direction=="in")return interaction.from_name;else if(interaction.sender_user)return interaction.sender_user.user.name_public});
Handlebars.registerHelper("toggleReplyUrls",function(interaction){var showReplyLink=self.remoteLinkHelper(self.toggle_outbound_path(interaction.email_id),I18n.translate("agent.email.outbound_view.show"),{"class":"a-ticket-action-link show show_interaction_link"}),hideReplyLink=self.remoteLinkHelper(self.toggle_outbound_path(interaction.email_id),I18n.translate("agent.email.outbound_view.hide"),{"class":"a-ticket-action-link hide hide_interaction_link","title":I18n.translate("agent.email.outbound_view.hide_reply")});
return new Handlebars.SafeString(hideReplyLink+showReplyLink)});Handlebars.registerHelper("noteEditUrl",function(ticket_note,index){if(ticket_note.edit_url){var editNoteLink=self.remoteLinkHelper(self.edit_note_path(ticket_note.id,index),I18n.translate("agent.edit.note.button"),{"class":"edit_interaction_link show show_interaction_link","data-interaction-type":"note"});return new Handlebars.SafeString(editNoteLink)}else return""});Handlebars.registerHelper("noteEraseUrl",function(ticket_note,index){if(ticket_note.erase_url){var eraseNoteLink=
self.linkHelper(self.erase_note_path(ticket_note.id,index),I18n.translate("agent.erase.button"),{"class":"erase_interaction_link a-ticket-action-link","title":I18n.translate("agent.erase.note.tooltip"),"data-interaction-type":"note"});return new Handlebars.SafeString(eraseNoteLink)}else return""});Handlebars.registerHelper("emailBodyEmptyContent",function(interaction){if(interaction.body.length==0&&!self.isWebForm(interaction.email_client_name)){var htmlPartLink=self.remoteLinkHelper(self.html_part_path(interaction.email_id),
I18n.translate("agent.email.html_part"),{}),textPartLink=self.remoteLinkHelper(self.text_part_path(interaction.email_id),I18n.translate("agent.email.text_part"),{}),content=I18n.translate("agent.history.email.no_message_contents",{link:htmlPartLink});content+="<br/>";content+=I18n.translate("agent.history.email.no_message_contents",{link:textPartLink});return new Handlebars.SafeString(content)}else if(interaction.body.length==0)return new Handlebars.SafeString(I18n.translate("agent.history.email.no_message"))});
Handlebars.registerHelper("emailDetailUrls",function(interaction){var htmlPartLink=self.remoteLinkHelper(self.html_part_path(interaction.email_id),I18n.translate("agent.email.html_part"),{}),textPartLink=self.remoteLinkHelper(self.text_part_path(interaction.email_id),I18n.translate("agent.email.text_part"),{}),headerLink=self.remoteLinkHelper(self.header_path(interaction.email_id),I18n.translate("agent.email.headers"),{});return new Handlebars.SafeString(headerLink+htmlPartLink+textPartLink)});Handlebars.registerHelper("interactionEraseLink",
function(interaction,index){if(interaction.erase_message_url){var link=self.linkHelper(self.erase_interaction_path(interaction.id,index),I18n.translate("agent.erase.button"),{"title":I18n.translate("agent.erase.email.tooltip"),"class":"a-ticket-action-link erase_interaction_link","data-interaction-type":"email","data-interactionable-id":interaction.email_id});return new Handlebars.SafeString(link)}else return""});Handlebars.registerHelper("interactionSplitLink",function(interaction,index){if(interaction.read_only===
false&&interaction.direction=="in"&&!interaction.is_original){var link=self.remoteLinkHelper(self.split_at_path(interaction.id,index),I18n.translate("agent.ticket.split_to.button"),{"title":I18n.translate("agent.ticket.split_to.button"),"class":"a-ticket-action-link split_at_link","data-interaction-type":"email","data-interactionable-id":interaction.email_id});return new Handlebars.SafeString(link)}else return""});Handlebars.registerHelper("interactionSplitFromHighlight",function(interaction,index){if(interaction.read_only===
false&&interaction.direction=="in"){var link=self.remoteLinkHelper(self.split_from_selection_path(interaction.id,index),I18n.translate("agent.ticket.split_to.highlight_button"),{"title":I18n.translate("agent.ticket.split_to.button"),"class":"a-ticket-action-link split_from_selection_link hidden split_at_link","data-interaction-type":"email","data-interactionable-id":interaction.email_id});return new Handlebars.SafeString(link)}else return""});Handlebars.registerHelper("interactionEraseAttachmentLink",
function(interaction){if(interaction.erase_attachment_url){var link=self.remoteLinkHelper(self.erase_attachment_path(interaction.ticket_id),I18n.translate("agent.erase.attachments.tooltip"),{"title":I18n.translate("agent.erase.attachments.tooltip"),"class":"a-ticket-action-link erase_attachment_icon"});return new Handlebars.SafeString(link)}else return""});Handlebars.registerHelper("previewAttachmentLink",function(attachment){if(attachment.preview_url){var link=self.remoteLinkHelper(self.preview_path(attachment.id),
attachment.name.clipWExtension(20),{"title":attachment.name});return new Handlebars.SafeString(link)}else return""});Handlebars.registerHelper("downloadAttachmentLink",function(attachment){if(attachment.download_url){var link=self.linkHelper(attachment.download_url,attachment.name.clipWExtension(20),{"title":attachment.name,target:"_blank"});return new Handlebars.SafeString(link)}else return""});Handlebars.registerHelper("interactionHiddenAtClass",function(interaction){if(interaction&&interaction.hidden_at&&
interaction.hidden_at.length)return"customer_history_ticket_outside_outbound_disabled";else return""});Handlebars.registerHelper("firstItemCss",function(idx,trueStyle,falseStyle){if(parseInt(idx)==0)return trueStyle;else return falseStyle});Handlebars.registerHelper("ifHasSendError",function(block){if(true)return block.fn(this);else return block.inverse(this)});Handlebars.registerHelper("ifEmailNotDraft",function(interaction,block){if(interaction&&!(interaction.direction=="out"&&interaction.out_status==
"draft"))return block.fn(this);else return block.inverse(this)});Handlebars.registerHelper("ifShowReplyTo",function(interaction,block){if(interaction.reply_to&&interaction.from!=interaction.reply_to)return block.fn(this);else return block.inverse(this)});Handlebars.registerHelper("ifFirstItem",function(val,block){if(parseInt(val)==0)return block.fn(this);else return block.inverse(this)});Handlebars.registerHelper("ifOneItem",function(val,block){if(parseInt(val)==1)return block.fn(this);else return block.inverse(this)});
Handlebars.registerHelper("unlessFirstItem",function(val,block){if(parseInt(val)==0)return block.inverse(this);else return block.fn(this)});Handlebars.registerHelper("ifDirectionOut",function(interaction,block){if(interaction.direction=="out")return block.fn(this);else return block.inverse(this)});Handlebars.registerHelper("currentTabId",function(){return self._currentTabId})};this.registerHandlebarsHelpers()};
$(function(){var tour_admin_user=Assistly.current_user.user_level!="undefined"&&Assistly.current_user.user_level>=50?true:false;var first_visit=Assistly.current_user.visited_agent!="undefined"&&!Assistly.current_user.visited_agent?true:false;var created_postmark_on_this_tour=false;var current_tour_chapter=1;var current_tour={},end_current_tour=function(){current_tour.end()};var close_tour_button={name:I18n.translate("agent.inline_tour.global.buttons.close"),classString:"ds-secondary",onclick:guiders.hideAll};
var complete_phase1_tour_button={name:I18n.translate("agent.inline_tour.global.buttons.complete"),classString:"ds-secondary",onclick:function(){guiders.hideAll();setTimeout(function(){guiders.show("agent-tour-congrats_v"+AGENT_TOUR_VERSION)},500)}};var end_tour_button={name:I18n.translate("agent.inline_tour.global.buttons.complete"),classString:"ds-secondary",onclick:function(){end_current_tour();$(document).unbind("keyup.tour");mixpanel.track("Completed Agent Tour",{"Total Time":Desk.Tour.Agent.calcTourRunTime()})}};
var next_tour_button={name:I18n.translate("agent.inline_tour.global.buttons.next"),onclick:function(){guiders.next()}};var prev_tour_button={name:I18n.translate("agent.inline_tour.global.buttons.prev"),classString:"ds-secondary",onclick:guiders.prev};var escape_tour=function(_guider,closed_by_x){if(closed_by_x)guiders.createGuider({id:"agent-tour-viewTour",title:I18n.translate("agent.inline_tour.escape_tour_v5.title"),description:I18n.translate("agent.inline_tour.escape_tour_v5.description"),position:5,
buttons:[{name:I18n.translate("agent.inline_tour.get_congrats_v5.button_title"),onclick:guiders.hideAll}],offset:{top:0,left:0},attachTo:".a-gravatar span",highlight:".a-gravatar span",overlay:true,onShow:function(){mixpanel.track("Tour Skipped",{"chapter":current_tour_chapter,"hover_index":_guider.sequenceId,"hover_title":_guider.title})}}).show()};var start_tour_buttons=[next_tour_button];var mid_tour_buttons=[next_tour_button];var close_tour_buttons=[close_tour_button];var complete_phase1_tour_buttons=
[complete_phase1_tour_button];var end_tour_buttons=[end_tour_button];var tourStartTime;var register_tour_step=function(event_name){mixpanel.track(event_name);var attrs={};attrs[event_name]="Complete";mixpanel.people.set(attrs)};Desk.Tour={setOverlay:function(opacity,color){var opacity=opacity||"0.9";var color=color||"#fff";$("#ds-popover-overlay").css("opacity",opacity).css("background-color",color)},waitToProgress:function(element){if($("body").hasClass("tour_running")){if(typeof element=="undefined")element=
"#tabs-tid_"+current_tab_id;setTimeout(function(){if(typeof current_tab_id!="undefined"&&current_tab_id!=0){$("#"+guiders._currentGuiderID).hide();if(Desk.Tour.currentTourVersion([5,6])){current_tour_chapter=2;register_tour_step("Chapter 2: Opened a Case");setTimeout(function(){showSequence(Desk.Tour.Agent.sequence_v5_ch2)},1E3)}else setTimeout(guiders.next,1500);return}else Desk.Tour.waitToProgress(element)},100)}else return},waitToHighlight:function(element,limit){var limit=limit||0;if(limit<25)setTimeout(function(){if($(element).is(":visible"))return element;
else Desk.Tour.waitToHighlight(element,limit)},100);else return},waitForOpenCase:function(callback){if($("body").hasClass("tour_running"))setTimeout(function(){if(typeof current_tab_id!="undefined"&&current_tab_id!=0&&$("#case_sidebar:visible").length>0)callback.call(this);else Desk.Tour.waitForOpenCase(callback)},100);else return},waitForInbox:function(callback){if($("body").hasClass("tour_running"))setTimeout(function(){if(typeof current_tab_id=="undefined"||current_tab_id==0)callback.call(this);
else Desk.Tour.waitForInbox(callback)},100);else return},currentTourVersion:function(acceptedVersions){return acceptedVersions.indexOf(AGENT_TOUR_VERSION)>=0},Agent:{init:function(){mixpanel.register({"tour_version":AGENT_TOUR_VERSION});current_tour=Desk.Tour.Agent;Desk.Tour.Agent.congratsGuider();Desk.Tour.Agent.getStartedGuider();$(document).on("click","#systemBar_showTour",function(){guiders.hideAll();Desk.Tour.Agent.start();mixpanel.track("Started Agent Tour via Menu")});$(document).on("click",
".ds-popover a.tour_external_link",function(){var path=this.pathname;path=path.length==0||path[0]!="/"?"/"+path:path;mixpanel.track("Clicked link within tour",{"url":path})});$("body").addClass("tour_running");if(first_visit&&$.cookie("agent_tour_user_"+Assistly.current_user.id)!="true"&&AGENT_TOUR_VERSION>0){var tourPrefUrl="/api/v2/users/me/preferences",tourPrefId=11100;$.ajax(tourPrefUrl).then(function(data){if(!data)return;data._embedded.entries.some(function(pref){if(pref.id!==tourPrefId)return false;
if(pref.value)return true;$.ajax({url:[tourPrefUrl,tourPrefId].join("/"),type:"PATCH",data:JSON.stringify({value:100+AGENT_TOUR_VERSION})});return true})});$.cookie("agent_tour_user_"+Assistly.current_user.id,"true",{path:"/"});if(Desk.Tour.currentTourVersion([1,5,6]))Desk.Tour.Agent._createWelcomeGuider();Desk.Tour.Agent.waitForFilters()}},_createWelcomeGuider:function(){var welcome_id="welcome";var width=550;if(Desk.Tour.currentTourVersion([5,6]))welcome_id="welcome_new";guiders.createGuider({closeOnEscape:false,
id:"agent-tour-"+welcome_id,classString:"ds-modal",title:I18n.translate("agent.inline_tour."+welcome_id+".title"),description:I18n.translate("agent.inline_tour."+welcome_id+".description"),buttons:[{name:I18n.translate("agent.inline_tour."+welcome_id+".button")}],position:0,onShow:function(){if(Desk.Tour.currentTourVersion([1]))$(document).bind("keyup.tour_welcome","#agent-tour-welcome",function(event){if(event.keyCode==27||event.which==27){mixpanel.track("Skipped Agent Tour");$(document).unbind("keyup.tour_welcome");
$(".ds-popover-button").off("click.agent_tour")}else return false});else if(Desk.Tour.currentTourVersion([5,6])){$("#agent-tour-welcome_new .ds-popover-content").after("<div class='please-wait'><div class='cloud'></div><div class='text-block'><h3>"+I18n.translate("agent.inline_tour.postmark_overlay.please_wait")+"</h3></div></div>");register_tour_step("Chapter 1: Registered / Viewed Signup Complete");$(".postmark-emailaddr").text(POSTMARK_MAILBOX);$(".ds-popover-button").on("click.agent_tour",function(event){$(".ds-popover-button").off("click.agent_tour");
Desk.Tour.Agent.start()});$(".ds-take-me-to-desk a").on("click.agent_tour_exit",function(event){$(".ds-take-me-to-desk a").off("click.agent_tour_exit");guiders.hideAll();escape_tour({"sequenceId":0,"title":I18n.translate("agent.inline_tour."+welcome_id+".title")},true)})}},onClose:Desk.Tour.Agent.welcomeEnd,overlay:true,width:width}).show()},_updateWelcomeGuider:function(){$("#agent-tour-welcome .ds-loading-tour-message").fadeOut("slow");$("#agent-tour-welcome .ds-welcome-loading-icon").hide();$("#agent-tour-welcome .ds-starthere, #agent-tour-welcome .ds-start-icon").fadeIn("slow");
$("#agent-tour-welcome .ds-popover-button").on("click",function(){Desk.Tour.Agent.start();mixpanel.track("Started Agent Tour")})},start:function(){function testThickBoxStatus(){var tb=$("#TB_overlay").length;if(tb===0){clearInterval(testTBStatus);if(Desk.Tour.currentTourVersion([2,3,4]))Desk.Tour.Agent.startPostmarkTour();else if(Desk.Tour.currentTourVersion([1,5,6]))Desk.Tour.Agent.startOriginalTour()}}var testTBStatus=setInterval(function(){testThickBoxStatus()},250)},startPostmarkTour:function(){if($(".interaction_panel.right_interaction").length>
0)Desk.Tour.Agent.preLaunchWarning();else Desk.Tour.Agent.launchTour()},launchPostmarkTour:function(){var tour=new TourWorkflow({"start_slide":Desk.Tour.currentTourVersion([4])?1:0,"escaped":function(){mixpanel.track("Agent Tour: Skipped")},"slides":[{"location":"/agent/tour/welcome","onload":function(){mixpanel.track("Viewed Welcome Slide")},"events":{"start_tour":function(){created_postmark_on_this_tour=false;this.next()}}},{"location":"/agent/tour/inbox","onload":function(){mixpanel.track("Viewed Agent Inbox Guide")},
"events":{"next":function(){if(Desk.Tour.currentTourVersion([3,4])){$(".a-tour-modal").after("<div class='postmark-overlay'><div class='cloud'></div><div class='text-block'><h3>"+I18n.translate("agent.inline_tour.postmark_overlay.please_wait")+"</h3>"+I18n.translate("agent.inline_tour.postmark_overlay.wait_message")+"</div></div>");Desk.Tour.Agent.showCasePointer(tour,true);tour.skip()}else this.next()},"thanks":function(){Desk.Tour.Agent.showCasePointer(tour);tour.skip()}}},{"location":"/agent/tour/test_email",
"events":{"send":function(){Desk.Tour.Agent.showCasePointer(tour,true)},"continue":function(){Desk.Tour.Agent.showCasePointer(tour)},"close":function(){tour.close()}}},{"location":"/agent/tour/case","onload":function(){mixpanel.track("Viewed Support Case Guide")},"events":{"finish":function(){tour.close();$.post("/users/complete_agent_tour");if(created_postmark_on_this_tour)Desk.Tour.waitForInbox(function(){$("body").removeClass("tour_running");tour.next()});else $("body").removeClass("tour_running")}}},
{"location":"/agent/tour/ready_to_explore","onload":function(){mixpanel.track("Agent Tour: Completed")},"events":{"ready":function(){tour.close()},"restart_tour":function(){tour.close();setTimeout(function(){Desk.Tour.Agent.startPostmarkTour()},10)}}}]});tour.start();mixpanel.track("Started Agent Postmark Tour")},startOriginalTour:function(){Desk.Tour.setOverlay("0.0","#fff");guiders.hideAll();tourStartTime=new Date;$(document).unbind("keyup.tour_welcome");if($(".interaction_panel.right_interaction").length>
0)Desk.Tour.Agent.preLaunchWarning();else Desk.Tour.Agent.launchTour()},showCasePointer:function(tour,admin){mixpanel.track("Agent Tour: Land in Inbox");if(typeof admin==="undefined")admin=false;if(tour)tour.close();setTimeout(function(){var caseLink=$("#ticket_filter_table tr:first-child .ticket_filter_item_tv_subject a");$("body").addClass("tour_running");$("body").append('<div id="a-tooltip" class="a-tour-bubble"><div class="a-tour-bubble-text"></div><span>&nbsp;</span></div>');if(admin)$(".a-tour-bubble-text").text(I18n.translate("agent.inline_tour.test_email.message"));
else $(".a-tour-bubble-text").text(I18n.translate("agent.inline_tour.test_email.message_non_admin"));setTimeout(function(){if(admin)$(".a-tour-bubble").addClass("animate");else $(".a-tour-bubble").addClass("animate-non-admin");setTimeout(function(){$(".a-tour-bubble").remove()},3E4);$("body").click(function(){$(".a-tour-bubble").remove()})},100);if(tour)Desk.Tour.waitForOpenCase(function(){$(".a-tour-bubble").remove();tour.next()})},1E3)},preLaunchWarning:function(){guiders.createGuider({id:"agent-prelaunch-warning",
title:"You&rsquo;ve got tickets open!",description:"The tour will need to close all open tickets before starting.",width:250,overlay:true,buttons:[{name:I18n.translate("agent.inline_tour.global.buttons.cancel"),classString:"ds-link ds-right",onclick:guiders.hideAll},{name:I18n.translate("agent.inline_tour.global.buttons.continue"),onclick:Desk.Tour.Agent.launchTour}]}).show()},launchTour:function(){if($(".ticket_filter_item").length<1)$("#left_tabs_ticket_panel .ticket_filter_row:not(.ticket_filter_row_empty):first").trigger("click");
expandTicketFilters();if(current_ticket_filter_view_mode===100)$("#ticket_filter_toolbar_ticket_data .ticket_filter_view_mode_button").trigger("click");$(document).bind("keyup.tour","body.tour_running",function(event){if(event.keyCode==27||event.which==27){if(Desk.Tour.currentTourVersion([1])){Desk.Tour.Agent.end();mixpanel.track("Ended Agent Tour",{"Ended At":guiders._guiders[guiders._currentGuiderID].title,"Total Time":Desk.Tour.Agent.calcTourRunTime()});$(document).unbind("keyup.tour")}}else return false});
$("#tabs .tab_closer").trigger("click");$("#tab-tickets-label").trigger("click");$("body").addClass("tour_running");guiders.hideAll();if(Desk.Tour.currentTourVersion([2,3,4]))setTimeout(function(){Desk.Tour.Agent.launchPostmarkTour()},1E3);else if(Desk.Tour.currentTourVersion([5,6])){current_tour_chapter=1;setTimeout(function(){showSequence(Desk.Tour.Agent.sequence_v5_ch1)},1E3)}else setTimeout(function(){showSequence(Desk.Tour.Agent.sequence)},1E3)},sequence_v5_ch1:[{id:"agent-tour-caseTable",title:I18n.translate("agent.inline_tour.universal_inbox_v"+
AGENT_TOUR_VERSION+".title"),description:I18n.translate("agent.inline_tour.universal_inbox_v"+AGENT_TOUR_VERSION+".description"),position:7,highlight:"#right_tabs_ticket_panel_data",attachTo:"#ticket_filter_toolbar_ticket_data",offset:{top:120,left:70},width:280,overlay:true,onShow:function(){register_tour_step("Chapter 1: Hover 1 - Universal Inbox");$("#container").append("<div class='additional-overlay'></div>")},onHide:function(){$(".additional-overlay").remove()},skipStep:function(){return $(".ticket_filter_item").length<
1?true:false}},{id:"agent-tour-caseFilters",title:I18n.translate("agent.inline_tour.filters_v"+AGENT_TOUR_VERSION+".title"),description:I18n.translate("agent.inline_tour.filters_v"+AGENT_TOUR_VERSION+".description"),position:2,attachTo:".toolbar_ticket_filter_list",highlight:".a-filter-list-item",overlay:true,onShow:function(){register_tour_step("Chapter 1: Hover 2 - Filters");$("#container").append("<div class='additional-overlay'></div>")},onHide:function(){$(".additional-overlay").remove()},skipStep:function(){return $("#left_tabs_ticket_panel .ticket_filter_row:not(.ticket_filter_row_empty)").length==
0?true:false}},{id:"agent-tour-configure",title:I18n.translate("agent.inline_tour.configure_v"+AGENT_TOUR_VERSION+".title"),description:I18n.translate("agent.inline_tour.configure_v"+AGENT_TOUR_VERSION+".description"),position:2,offset:{top:-14,left:0},attachTo:"#filter_list_edit_navigation",highlight:"#filter_list_edit_navigation",overlay:true,onShow:function(){register_tour_step("Chapter 1: Hover 3 - Configure Filters");$("#filter_list_edit_navigation").css("z-index",100001);$("#tabs").append("<div class='additional-overlay'></div>")},
onHide:function(){$("#filter_list_edit_navigation").css("z-index",299);$(".additional-overlay").remove()}},{id:"agent-tour-admin-tools",title:I18n.translate("agent.inline_tour.admin_tools_v"+AGENT_TOUR_VERSION+".title"),description:I18n.translate("agent.inline_tour.admin_tools_v"+AGENT_TOUR_VERSION+".description"),position:7,buttons:complete_phase1_tour_buttons,offset:{top:10,left:-38},attachTo:"#systembar-system-nav span.a-arrow",highlight:"#systembar-system-nav",overlay:true,delay:function(){return $(".ticket_filter_item_tv_subject").length>
0?1:false},onShow:function(){register_tour_step("Chapter 1: Hover 4 - Agent/Admin Switcher");Desk.Tour.waitToProgress();$("#tabs .tab_closer").trigger("click");$("#ticket_filter_item_paginator").append("<div class='additional-overlay'></div>");$("#ticket_filter_data_toolbar_2").append("<div class='additional-overlay'></div>");$("#ticket_filter_item_paginator, #ticket_filter_data_toolbar_2").addClass("positionRelative");$(".ticket_filter_check_box").prop("disabled",true)},onHide:function(){$(".ticket_filter_item_table_view td, .ticket_filter_item_table_view td a").off("click.tour");
$("#ticket_filter_item_paginator, #ticket_filter_data_toolbar_2").removeClass("positionRelative");$(".additional-overlay").remove();$("#ticket_filter_table th").removeClass("positionRelative");$("#ticket_filter_table td").removeClass("positionRelative");$(".ticket_filter_check_box").prop("disabled",false)}}],sequence_v5_ch2:[{id:"agent-tour-caseDetails",title:I18n.translate("agent.inline_tour.case_details_v"+AGENT_TOUR_VERSION+".title"),description:I18n.translate("agent.inline_tour.case_details_v"+
AGENT_TOUR_VERSION+".description"),position:10,offset:{top:70,left:0},width:200,delay:function(){return 500},highlight:".interaction_view.case_contents",attachTo:".interaction_view.case_contents",overlay:true,onShow:function(){register_tour_step("Chapter 2: Hover 1 - Case Detail");$("#container").append("<div class='additional-overlay'></div>")},onHide:function(){$(".additional-overlay").remove()}},{id:"agent-tour-applyMacro1",title:I18n.translate("agent.inline_tour.macros_v"+AGENT_TOUR_VERSION+".title"),
description:I18n.translate("agent.inline_tour.macros_v"+AGENT_TOUR_VERSION+".description"),onShow:function(){register_tour_step("Chapter 2: Hover 2 - Macros");if($(".input.macro_box span:visible").length<1){$("#agent-tour-applyMacro1").hide();guiders.next()}else{$(".label_popup_menu").on("keyup.tour",function(e){if(e.which==13)guiders.next()});$("ul.ui-autocomplete li a").on("click.tour"),function(){guiders.next()};$("#case_footer").append("<div class='additional-overlay'></div>");$("#case_footer .macro_box").addClass("ds-popover-focus-highlight")}},
onHide:function(){$(".label_popup_menu").off("keyup.tour");$(".additional-overlay").remove();$("#case_footer .macro_box").removeClass("ds-popover-focus-highlight")},position:1,offset:{top:-10,left:0},width:210,attachTo:".input.macro_box span:first:visible",overlay:true,highlight:"#case_footer",skipStep:function(){return $(".input.macro_box span:first").length<1?true:false}},{id:"agent-tour-KBArticles",title:I18n.translate("agent.inline_tour.kb_articles_v"+AGENT_TOUR_VERSION+".title"),description:I18n.translate("agent.inline_tour.kb_articles_v"+
AGENT_TOUR_VERSION+".description"),onShow:function(){register_tour_step("Chapter 2: Hover 3 - Knowledge Articles");$("#container").append("<div class='additional-overlay'></div>")},onHide:function(){$(".additional-overlay").remove()},position:7,offset:{top:0,left:-10},width:200,attachTo:"#tab-kb img",overlay:true,highlight:"#tab-kb img",skipStep:function(){return $(".input.macro_box span:first").length<1?true:false}},{id:"agent-tour-updateButton",title:I18n.translate("agent.inline_tour.update_case_v"+
AGENT_TOUR_VERSION+".title"),description:I18n.translate("agent.inline_tour.update_case_v"+AGENT_TOUR_VERSION+".description"),position:1,offset:{top:0,left:122},width:200,attachTo:"#case_footer .a-button.update_send:visible, #case_footer .a-button.update:visible",overlay:true,highlight:"#case_footer .a-button.update_send:visible, #case_footer .a-button.update:visible, #case_footer .a-button.update_resolve:visible, #case_footer .a-button.update_send_resolve:visible",onShow:function(){register_tour_step("Chapter 2: Hover 4 - Send, Update and Resolve");
$("#case_footer").append("<div class='additional-overlay'></div>")},onHide:function(){$(".additional-overlay").remove()}},{id:"agent-tour-closeView",title:I18n.translate("agent.inline_tour.close_view_v"+AGENT_TOUR_VERSION+".title"),description:I18n.translate("agent.inline_tour.close_view_v"+AGENT_TOUR_VERSION+".description"),position:7,offset:{top:0,left:-15},width:280,attachTo:".tab_closer",overlay:true,highlight:".tab_closer",onShow:function(){register_tour_step("Chapter 2: Hover 5 - Closing out Case Detail");
$("#case_footer").append("<div class='additional-overlay'></div>")},onHide:function(){$(".additional-overlay").remove()}}],sequence:[{id:"agent-tour-caseFilters",title:I18n.translate("agent.inline_tour.filters.title"),description:I18n.translate("agent.inline_tour.filters.description"),position:2,attachTo:".toolbar_ticket_filter_list",highlight:".a-filter-list-item",overlay:true,onShow:function(){$("#container").append("<div class='additional-overlay'></div>")},onHide:function(){$(".additional-overlay").remove()},
skipStep:function(){return $("#left_tabs_ticket_panel .ticket_filter_row:not(.ticket_filter_row_empty)").length==0?true:false}},{id:"agent-tour-caseTable",title:I18n.translate("agent.inline_tour.universal_inbox.title"),description:I18n.translate("agent.inline_tour.universal_inbox.description"),position:10,attachTo:"#ticket_filter_list_items_outer_div",highlight:"#right_tabs_ticket_panel_data",width:200,overlay:true,onShow:function(){$("#container").append("<div class='additional-overlay'></div>")},
onHide:function(){$(".additional-overlay").remove()},skipStep:function(){return $(".ticket_filter_item").length<1?true:false}},{id:"agent-tour-agent-tools",title:I18n.translate("agent.inline_tour.agent_tools.title"),description:I18n.translate("agent.inline_tour.agent_tools.description"),position:7,offset:{top:20,left:-10},attachTo:"#tab-kb img",highlight:"#tab-kb",overlay:true,onShow:function(){$("#tabs ul").css("z-index",100001);$("#tabs").append("<div class='additional-overlay'></div>")},onHide:function(){$("#tabs ul").css("z-index",
299);$(".additional-overlay").remove()},buttons:[{name:I18n.translate("agent.inline_tour.global.buttons.next"),onclick:function(){if($(".ticket_filter_item").length==0)Desk.Tour.Agent.tourEscape("agent.inline_tour.case_not_found.title","agent.inline_tour.case_not_found.description",guiders._guiders[guiders._guiders[guiders._currentGuiderID].next].title);else guiders.next()}}]},{id:"agent-tour-task-openCase",title:I18n.translate("agent.inline_tour.working_with_cases.title"),description:I18n.translate("agent.inline_tour.working_with_cases.description"),
position:7,buttons:close_tour_buttons,highlight:"#right_tabs_ticket_panel_data",overlay:true,delay:function(){return $(".ticket_filter_item_tv_subject").length>0?1:false},onShow:function(){Desk.Tour.waitToProgress();$("#tabs .tab_closer").trigger("click");$("#ticket_filter_item_paginator").append("<div class='additional-overlay'></div>");$("#ticket_filter_data_toolbar_2").append("<div class='additional-overlay'></div>");$("#ticket_filter_item_paginator, #ticket_filter_data_toolbar_2").addClass("positionRelative");
$(".ticket_filter_check_box").prop("disabled",true)},onHide:function(){$(".ticket_filter_item_table_view td, .ticket_filter_item_table_view td a").off("click.tour");$("#ticket_filter_item_paginator, #ticket_filter_data_toolbar_2").removeClass("positionRelative");$(".additional-overlay").remove();$("#ticket_filter_table th").removeClass("positionRelative");$("#ticket_filter_table td").removeClass("positionRelative");$(".ticket_filter_check_box").prop("disabled",false)},width:300,attachTo:"tr .ticket_filter_item_tv_subject a:first"},
{id:"agent-tour-caseSidebar",title:I18n.translate("agent.inline_tour.case_sidebar.title"),description:I18n.translate("agent.inline_tour.case_sidebar.description"),position:3,width:300,delay:function(){return 500},highlight:"#case_sidebar",attachTo:"#case_sidebar",overlay:true,onShow:function(){$("#container").append("<div class='additional-overlay'></div>")},onHide:function(){$(".additional-overlay").remove()}},{id:"agent-tour-conversationView",title:I18n.translate("agent.inline_tour.conversation_view.title"),
description:I18n.translate("agent.inline_tour.conversation_view.description"),position:9,highlight:".interaction_view.case_contents",attachTo:".interaction_view.case_contents",autoFocus:true,overlay:true,onShow:function(){$("#container").append("<div class='additional-overlay'></div>")},onHide:function(){$(".additional-overlay").remove()}},{id:"agent-tour-applyMacro1",title:I18n.translate("agent.inline_tour.macros.title"),description:I18n.translate("agent.inline_tour.macros.description"),onShow:function(){if($(".input.macro_box span:visible").length<
1){$("#agent-tour-applyMacro1").hide();guiders.next()}else{$(".label_popup_menu").on("keyup.tour",function(e){if(e.which==13)guiders.next()});$("ul.ui-autocomplete li a").on("click.tour"),function(){guiders.next()};$("#case_footer").append("<div class='additional-overlay'></div>");$("#case_footer .macro_box").addClass("ds-popover-focus-highlight")}},onHide:function(){$(".label_popup_menu").off("keyup.tour");$(".additional-overlay").remove();$("#case_footer .macro_box").removeClass("ds-popover-focus-highlight")},
position:1,offset:{top:-10,left:0},width:210,attachTo:".input.macro_box span:first:visible",overlay:true,highlight:"#case_footer",skipStep:function(){return $(".input.macro_box span:first").length<1?true:false}},{id:"agent-tour-updateButton",title:I18n.translate("agent.inline_tour.update_case.title"),description:I18n.translate("agent.inline_tour.update_case.description"),position:1,offset:{top:-20,left:0},attachTo:"#case_footer .a-button.update_send:visible, #case_footer .a-button.update:visible",
overlay:true,highlight:"#case_footer .a-button.update_send:visible, #case_footer .a-button.update:visible, #case_footer .a-button.update_resolve:visible, #case_footer .a-button.update_send_resolve:visible",onShow:function(){$("#case_footer").append("<div class='additional-overlay'></div>")},onHide:function(){$(".additional-overlay").remove()}}],end:function(){guiders.hideAll();$("body").removeClass("tour_running");$(document).unbind("keyup.tour");if(tour_admin_user)setTimeout(function(){if(Desk.Tour.currentTourVersion([1]))guiders.show("agent-tour-getStarted");
else if(Desk.Tour.currentTourVersion([5,6]))guiders.show("agent-tour-getStarted_v"+AGENT_TOUR_VERSION)},500)},welcomeEnd:end_current_tour,congratsGuider:function(){guiders.createGuider({id:"agent-tour-congrats_v"+AGENT_TOUR_VERSION,classString:"ds-modal",closeOnEscape:false,buttons:[{name:I18n.translate("agent.inline_tour.get_congrats_v"+AGENT_TOUR_VERSION+".button_title"),onclick:function(){mixpanel.track("Agent Tour: Land in Inbox");guiders.hideAll();Desk.Tour.Agent.showCasePointer(null,true)}}],
onShow:function(){register_tour_step("Chapter 1: Completed Screen");$(".ds-take-me-to-desk a").on("click.agent_tour_exit",function(event){$(".ds-take-me-to-desk a").off("click.agent_tour_exit");guiders.hideAll();$("body").removeClass("tour_running")})},title:I18n.translate("agent.inline_tour.get_congrats_v"+AGENT_TOUR_VERSION+".title"),description:I18n.translate("agent.inline_tour.get_congrats_v"+AGENT_TOUR_VERSION+".description"),width:550,overlay:true})},getStartedGuider:function(){var version_postfix=
"";var width=360;if(Desk.Tour.currentTourVersion([5,6])){version_postfix="_v"+AGENT_TOUR_VERSION;width=550}guiders.createGuider({id:"agent-tour-getStarted"+version_postfix,classString:"ds-modal",closeOnEscape:false,buttons:[{name:I18n.translate("agent.inline_tour.get_started"+version_postfix+".button_title"),onclick:guiders.hideAll}],onShow:function(){if(Desk.Tour.currentTourVersion([1]))$(document).bind("keyup.tour",function(event){if(event.keyCode==27||event.which==27){guiders.hideAll();$(document).unbind("keyup.tour")}else return false});
else if(Desk.Tour.currentTourVersion([5,6])){$(".postmark-emailaddr").text(POSTMARK_MAILBOX);register_tour_step("Chapter 2: Completed Screen")}},title:I18n.translate("agent.inline_tour.get_started"+version_postfix+".title"),description:I18n.translate("agent.inline_tour.get_started"+version_postfix+".description"),width:width,overlay:true})},tourEscape:function(guiderTitle,guiderDesc,failedStep){guiders.hideAll();$("body").removeClass("tour_running");$(document).unbind("keyup.tour");var guiderTitle=
I18n.translate(guiderTitle)||I18n.translate("agent.inline_tour.default.title");var guiderDesc=I18n.translate(guiderDesc)||I18n.translate("agent.inline_tour.default.description");guiders.createGuider({id:"agent-tour-uhoh",buttons:[{name:"<span class='ds-check-icon'></span>Close",onclick:guiders.hideAll}],title:guiderTitle,description:guiderDesc,width:360});setTimeout(function(){guiders.show("agent-tour-uhoh");mixpanel.track("Agent Tour Failed",{"Step":failedStep})},500)},trackingBuild:function(eventName,
customAttrs){if(eventName=="undefined")return;var customAttrs={"data-custom-attrs":customAttrs}||null;var eventName={"data-tracking-name":eventName};var trackingLocation={"data-tracking-model":"Agent Tour"};var tracking_obj=$.extend({},Assistly.base_tracking_obj,trackingLocation,eventName,customAttrs);Desk.Tracking.notify(tracking_obj)},calcTourRunTime:function(){var tourEndTime=new Date;return(tourEndTime-tourStartTime)/1E3},waitForFilters:function(){var filterElems=$(".a-filter-list-item-count");
setTimeout(function(){for(var i=0;i<filterElems.length;i++){var num=parseInt($(filterElems[i]).text());if(!isNaN(num)&&num!=0){$(filterElems[i]).siblings(".ticket_filter_row-contents").find("a").trigger("click");Desk.Tour.Agent.waitForCases();return}}Desk.Tour.Agent.waitForFilters()},250)},waitForCases:function(){setTimeout(function(){if($("#ticket_filter_list_items .ticket_filter_item").length>0){if(Desk.Tour.currentTourVersion([5,6])){$(".ds-popover-button").show();$(".please-wait").remove()}else Desk.Tour.Agent.start();
return}else Desk.Tour.Agent.waitForCases()},250)}}};var showSequence=function(sequence){sequence=$.map(sequence,function(guider){return guider});$.each(sequence,function(i,guider){switch(i){case 0:guider.closeOnEscape=false;guider.buttons=$.isArray(guider.buttons)?guider.buttons:guider.buttons!==null?start_tour_buttons:null;guider.next=sequence[i+1].id;guider.sequenceId=i+1;guider.sequenceLength=sequence.length;guider.xButton=true;guider.onClose=escape_tour;break;case sequence.length-1:guider.closeOnEscape=
false;guider.buttons=$.isArray(guider.buttons)?guider.buttons:guider.buttons!==null?end_tour_buttons:null;guider.sequenceId=i+1;guider.sequenceLength=sequence.length;guider.xButton=true;guider.onClose=escape_tour;break;default:guider.closeOnEscape=false;guider.buttons=$.isArray(guider.buttons)?guider.buttons:guider.buttons!==null?mid_tour_buttons:null;guider.next=sequence[i+1].id;guider.sequenceId=i+1;guider.sequenceLength=sequence.length;guider.xButton=true;guider.onClose=escape_tour;break}guiders.createGuider(guider)});
guiders.hideAll().show(sequence[0].id)};Desk.Tour.Agent.init()});
TourWorkflow=function(params){var self=this;var current_slide=params["start_slide"]||0;this.start=function(){self.loadSlide(current_slide);$(document).bind("keydown.agentTour",function(e){if(e.which==27&&params["escaped"]){params["escaped"].call(self);$(document).unbind("keydown.agentTour")}})};this.next=function(){self.loadSlide(++current_slide)};this.skip=function(){current_slide++};this.close=function(){tb_remove();$(document).unbind("keydown.agentTour")};this.loadSlide=function(index){if($("#TB_window").length==
0)tb_show("Agent Tour","#TB_inline?height=333&width=622&inlineId=screen_pop_window&modal=true");var slide=params["slides"][index];$("#TB_ajaxContent").load(slide["location"],function(){for(key in slide["events"])$("#TB_ajaxContent").find("#"+key).click(function(){$(this).hide();$("#TB_ajaxContent").find(".a-loading").show();slide["events"][$(this).attr("id")].call(self);return false});if(slide["onload"])slide["onload"].call(self)})};return this};
$.fn.qtip.styles.assistly_left={width:{min:0,max:500},padding:5,border:{width:1,radius:5,color:"#FFF"},tip:{corner:"bottomLeft",size:{x:8,y:8}},name:"light"};$.fn.qtip.styles.assistly_left_bottom={width:{min:0,max:500},padding:5,border:{width:1,radius:5,color:"#FFF"},tip:{corner:"topLeft",size:{x:8,y:8}},name:"light"};$.fn.qtip.styles.assistly_middle={width:{min:0,max:500},padding:5,border:{width:1,radius:5,color:"#FFF"},tip:{corner:"bottomMiddle",size:{x:8,y:8}},name:"light"};
$.fn.qtip.styles.assistly_middle_bottom={width:{min:0,max:500},padding:5,border:{width:1,radius:5,color:"#FFF"},tip:{corner:"topMiddle",size:{x:8,y:8}},name:"light"};$.fn.qtip.styles.assistly_middle_bottom_dark={width:{min:0,max:500},padding:5,border:{width:1,radius:5,color:"#000"},tip:{corner:"topMiddle",size:{x:8,y:8}},name:"dark"};
$(function(){$(document).on("ajax:before",".company_item.a-search-results-item a.open-result",showCompanyLoad);$(document).on("ajax:before",".customer_item.a-search-results-item a.open-result",showCustomerLoad);$(document).on("ajax:before",".customer_item.a-search-results-item a.create-result",showCreatingNewCase)});
(function($){$(document).on("ajax:before",".a-search-results-header form",refreshSearch);$(document).on("click",".a-search-results-toolbar .a-search-type a",changeSearchType);$(document).on("click",".search-sfdc-hint a",goToSalesforce);function refreshSearch(e){var form=$(e.currentTarget),container=form.parents(".a-search-results"),orderId=$("#agent_search_results_main #select_search_order_id").val(),objectType=$("#search_search_object_type_id",form).val(),searchType=$("#a-search-type-tabs a.selected",
container).data("search-type");if(objectType==="100")searchType="local";$("#search_order_id").val(orderId);$("#agent_search_main_spinner").show();$("#search_search_type",container).val(searchType);$("#agent_search_results, .a-search-results-count, .new_customer_search_results").empty()}function clearSearchResults(container){container.empty()}function changeSearchType(e){e.preventDefault();var target=$(e.currentTarget),container=target.parents(".a-search-results");target.addClass("selected").siblings().removeClass("selected");
clearSearchResults(container.find(".a-search-results-list"));$(".a-search-results-header form",container).submit()}function goToSalesforce(e){e.preventDefault();$("#a-search-type-tabs a[data-search-type='sfdc']").trigger("click");clearSearchResults($(".a-search-results-list"))}})(jQuery);(function($){$(".customer_history_ticket_outside_email form").live("ajax:before",function(){$(this).find(".spinner").show()}).live("ajax:success",function(){$(this).find(".spinner").hide()})})(jQuery);
(function($){$(document).on("submit","form.edit_ticket_form",postAllTabs);function postAllTabs(e){var container=$(e.currentTarget).parents(".a-case-tab"),reply_length=$(".core_interaction textarea",container).val()>0?$(".core_interaction textarea",container).val().length:0,params=$(".edit_ticket_form, .edit_customer, .edit_company, .core_interaction",container).serialize()+"&debug[reply_length]="+reply_length+"&debug[num_textareas]="+$(".core_interaction textarea",container).length;$.post(this.action,
params,null,"script").error(function(){alert(I18n.translate("agent.case.save.error"));toggleAgentTicketFooterButtons(current_tab_id,false)});return false}})(jQuery);
$(function(){$(document).on("click",".case_contents .a-search-results-list .pagination a",loadPagination);$(document).on("click",".case_contents .a-search-results-item  [data-action=expand]",expandCase);$(document).on("change",".case_contents .toolbar-right select",changeFilter);$(document).on("ajax:before",".tab[data-view] a",changeView);$(document).on("ajax:success",".tab[data-view] a",loadView);$(document).on("click",".info-other-tickets a",viewCustomerHistory);function loadPagination(e){e.preventDefault();
var link=$(".a-case-tab:currentAgentTab .case_contents.active .active a"),view=link.parents(".tab").data("view");$(".a-case-tab:currentAgentTab .case_contents[data-view="+view+"]").data("loaded",false);link.prop("href",e.currentTarget.href).click()}function expandCase(e){var item=$(e.currentTarget).parents(".a-search-results-item").toggleClass("expanded"),path=item.parents("[data-history-path]").data("history-path");if(item.data("loaded")!==true){var params=$.param({show_ticket:true,ticket_id:item.data("ticket-id"),
ctid:current_tab_id});$.get(path+"?"+params,function(html){item.data("loaded",true);$(".interaction",item).html(html)})}}function changeFilter(e){var tab=$(".a-case-tab:currentAgentTab .case_contents:visible li.tab.active"),view=tab.data("view");$(".a-case-tab:currentAgentTab .case_contents[data-view="+view+"]").data("loaded",false);$("a",tab).click()}function changeView(e){var link=$(e.currentTarget),view=link.parents(".tab").data("view"),panel=$(".a-case-tab:currentAgentTab .case_contents[data-view="+
view+"]"),filter=$(".toolbar-right select",panel);link.data("params",filter.serialize());panel.addClass("active").siblings().removeClass("active");$("[data-view="+view+"]",panel).addClass("active");return panel.data("loaded")!==true&&view!=="interaction"}function loadView(e,data){var view=$(e.currentTarget).parents(".tab").data("view"),panel=$(".a-case-tab:currentAgentTab .case_contents[data-view="+view+"]").data("loaded",true),searchResults=$(".a-search-results",panel);if(data.tickets){$(".a-search-results-list",
panel).template("agent/case_histories/ticket",data);var currentItem=$("[data-ticket-id="+data.current_ticket_id+"]",panel).addClass("current");$(".current_case",panel).removeClass("loaded").empty();scrollToMe(searchResults,currentItem);$("[data-type=time]",panel).timeago();$.timeago.settings.refreshMillis=0}}function viewCustomerHistory(e){e.preventDefault();var ticketId=$(e.currentTarget).data("ticket-id"),customerId=$(e.currentTarget).data("customer-id"),link=$(".a-case-tab:currentAgentTab .tab[data-view=customer_history] a");
url=link.prop("href").split("?")[0]+"?"+$.param({ticket_id:ticketId,customer_id:customerId});$(".a-case-tab:currentAgentTab .case_contents[data-view=customer_history]").data("loaded",false);link.prop("href",url).click()}});
(function($){$(document).on("preload",".a-tabnav .idTabs a",preloadTab);$(document).on("click",".a-tabnav .idTabs a",changeCaseTab);$(document).on("ajax:complete",".a-tabnav .idTabs a",afterTabLoaded);$(document).on("ajax:before",".a-tabnav .idTabs a",beforeTabLoaded);function beforeTabLoaded(e){return!$(e.currentTarget).hasClass("loaded")}function afterTabLoaded(e){$(e.currentTarget).addClass("loaded")}function preloadTab(e){$.getScript(e.currentTarget.href,function(){afterTabLoaded(e)})}function changeCaseTab(e){var link=
$(e.currentTarget),tab=link.parents(".tab"),selection=tab.data("tab"),sidebar=tab.parents(".case_sidebar_container");e.preventDefault();hideIUrlPanel();closeAllTicketIurlMenus();tab.addClass("selected").siblings().removeClass("selected");$(".inside_case_panel[data-tab]",sidebar).hide().filter("[data-tab="+selection+"]").show()}})(jQuery);
(function($){var showMoreKey="desk.emailTicketReplyMore",tabSelector=".a-case-tab:visible",containerSelector=".a-ticket-reply";$(window).resize(toggleMoreBox);$(document).on("showInteraction",toggleMoreBox);$(document).on("click",".a-ticket-reply .text-link",toggleMoreBox);$(document).on("dragenter dragover dragleave dragexit",".case_contents",toggleMoreBox);function toggleMoreBox(e){var isOpen=false,messageArea=$(".message_area",tabSelector),scrollHeight=messageArea.prop("scrollHeight"),replyArea=
$(".a-ticket-reply",messageArea),isMoreBtn=$(e.currentTarget).hasClass("a-more-handler");if(e.type==="click"){isOpen=$(this).parents(containerSelector).find(".a-more").is(":visible");if(!isOpen||isMoreBtn){isOpen=!isOpen;setLocalStoragePrefs(showMoreKey,isOpen)}e.preventDefault()}else if(e.type==="dragenter"||e.type==="dragover")isOpen=true;else if(e.type==="dragleave"||e.type==="dragexit"){if(event.pageX!==0)return}else isOpen=getLocalStoragePrefs(showMoreKey)==="true";$(".a-more-link").toggleClass("less",
isOpen);$(".a-ticket-reply-footer.a-more").toggle(isOpen);messageArea.scrollTop(scrollHeight)}})(jQuery);
(function($){var minHeight=150,replyPinKey="desk.emailReplyPin",tabSelector=".a-case-tab:not(.ui-tabs-hide)",containerSelector=".case_contents_container";$(window).resize(togglePinning);$(document).on("showInteraction",togglePinning);$(document).on("click",".a-ticket-reply .text-link",togglePinning);$(document).on("click",".case_contents_container .pin",togglePinning);function togglePinning(e){if($(tabSelector).has(".pin").length===0)return;var isPinned=false,tabSelectorWithPin=$(tabSelector).has(".pin"),
pinBtn=$(".pin",tabSelectorWithPin),messageArea=$(containerSelector,tabSelectorWithPin),replyArea=$(".a-ticket-reply",messageArea),scrollHeight=messageArea.prop("scrollHeight"),messageAreaInner=$(".message_area_inside",messageArea),isMoreClick=$(e.currentTarget).hasClass("text-link");if(!isMoreClick&&e.type==="click"){isPinned=!$(this).parents(containerSelector).hasClass("pinned");setLocalStoragePrefs(replyPinKey,isPinned);e.preventDefault()}else isPinned=getLocalStoragePrefs(replyPinKey)==="true";
$(containerSelector,tabSelectorWithPin).toggleClass("pinned",isPinned);var bottom=isPinned?replyArea.outerHeight():0;$(messageAreaInner).css("bottom",bottom);var pinnedTextFieldHeight=replyArea.find("textarea").height()-60,containerHeight=$(messageAreaInner).height();if(isPinned)if(containerHeight<minHeight){isPinned=false;$(containerSelector,tabSelectorWithPin).removeClass("pinned").css("bottom",0);$(".pin",tabSelector).hide()}else $(".pin",tabSelector).show();else if(containerHeight-(replyArea.height()-
pinnedTextFieldHeight)<minHeight)$(".pin",tabSelector).hide();else $(".pin",tabSelector).show();var tooltip=I18n.translate("agent.case.docked."+isPinned);$(".pin a",tabSelector).prop("title",tooltip);messageArea.scrollTop(scrollHeight);messageAreaInner.scrollTop(scrollHeight)}})(jQuery);
(function($){Desk=window.Desk||{};Desk.AHTCounter=function(){var init=function(){Desk.AHTCounter["store"]={};Desk.AHTCounter["tickets"]={}};var newCounter=function(tabId,ticketId){if(typeof tabId=="undefined"||typeof ticketId=="undefined")return;if(typeof Desk.AHTCounter.store=="undefined"||typeof Desk.AHTCounter.store!=="object")init();Desk.AHTCounter.store[tabId]=new Date;if(typeof ticketId!="undefined"&&typeof tabId!="undefined")Desk.AHTCounter.tickets[tabId]=ticketId};var destroyCounter=function(tabId){if(typeof tabId==
"undefined")return;delete Desk.AHTCounter.store[tabId]};var calcHandleTime=function(tabId){if(typeof tabId=="undefined")return null;if(typeof Desk.AHTCounter.store==="undefined"||typeof Desk.AHTCounter.store!=="object")return null;if(typeof Desk.AHTCounter.store[tabId]==="undefined")return null;var totalHandleTime=0;if(typeof this.tickets[tabId]!=="undefined"&&this.tickets[tabId]!==null&&window["s_handle_ticket_"+this.tickets[tabId]])totalHandleTime=window["s_handle_ticket_"+this.tickets[tabId]].runtime;
else{var start=Desk.AHTCounter.store[tabId];var end=new Date;totalHandleTime=end-start}totalHandleTime=Math.round(totalHandleTime/1E3);destroyCounter(tabId);return totalHandleTime};var getTicketFromTab=function(tabId){payload=false;tabId=tabId.substr(tabId.indexOf("_")+1);if(Desk.AHTCounter.tickets&&Desk.AHTCounter.tickets[tabId])payload=Desk.AHTCounter.tickets[tabId];return payload};return{newCounter:newCounter,calcHandleTime:calcHandleTime,getTicketFromTab:getTicketFromTab}}()})(jQuery);
